#dejure_kingdom_claim_EMP	-Can be used by King against other Kings for a dejure claim on a Lord Paramountcy
#dejure_kingdom_claim
#dejure_duchy_claim
#other_dejure_duchy_claim
#dejure_county_claim
#other_dejure_county_claim
#dejure_barony_claim
#other_dejure_barony_claim DISABLED

dejure_kingdom_claim_EMP = {
	name = CB_NAME_DEJUREKINGCLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch }
			NOT = { is_nomadic = yes }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = { 
			has_landed_title = e_iron_throne
			NOT = { can_use_dragon_conquest_trigger = yes }				 
		}
		OR = {
			title = e_north 
			title = e_riverlands 
			title = e_vale
			title = e_westerlands 
			title = e_reach
			title = e_stormlands
			title = e_dorne
			title = e_iron_isles
		}
		FROM = {
			has_landed_title = PREV
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	is_valid_title = {
		ROOT = { has_landed_title = e_iron_throne }
		FROM = {
			has_landed_title = PREV
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		if = { #If target has another empire leave them independent
			limit = {
				FROM = {
					any_demesne_title = { 
						tier = EMPEROR
						NOT = { capital_scope = { region = world_westeros } }
						NOT = { title = e_iron_isles } #These titles dont have capitals
						NOT = { title = e_riverlands }
					}
				}	
			}
			custom_tooltip = {
				text = TOOLTIPDEJURKINGCLAIMA
				hidden_tooltip = {
					any_de_jure_vassal = {
						limit = { liege = { character = FROM } }
						set_defacto_liege = ROOT
					}
					destroy_landed_title = FROM
				}
			}
		}
		
		if = { #else absorb the target
			limit = {
				FROM = {
					NOT = {
						any_demesne_title = { 
							tier = EMPEROR
							NOT = { capital_scope = { region = world_westeros } }
							NOT = { title = e_iron_isles } #These titles dont have capitals
							NOT = { title = e_riverlands }
						}
					}	
				}	
			}
			FROM = {
				any_vassal = {
					limit = { 
						tier = KING
						OR = {
							NOT = { trait = wildling }
							ROOT = { trait = wildling }
						}
					}
					if = {
						limit = { ROOT = { trait = civil_war } }
						set_character_flag = neutral
						custom_tooltip = { text = TOOLTIPdejure_kingdom_EMP_vassal }
						hidden_tooltip = { character_event = { id = mega_wars.52 } }
					}
					if = {
						limit = { ROOT = { NOT = { trait = civil_war } } }
						character_event = { id = mega_wars.52 tooltip = EVTTOOLTIPmega_wars.52 }
					}	
				}
				set_character_flag = end_indep_wars #This ends any indep wars they be having against other kings
			}	
			if = { #Take holdings and titles back from wildlings
				limit = {
					FROM = { trait = wildling }			
					ROOT = { NOT = { trait = wildling } }
				}
				custom_tooltip = { 
					text = TOOLTIPDEJURKINGCLAIMwildling 
					hidden_tooltip = {
						save_event_target_as = wildling_title
						ROOT = { character_event = { id = maintenance.35 } } #take all occuped titles
						clear_event_target = wildling_title
					}
				}
			}	
			if = {
				limit = {
					OR = {
						FROM = { NOT = { trait = wildling } }
						ROOT = { trait = wildling }
					}
				}
				FROM = {
					if = { 	
						limit = { primary_title = { title = e_north } }
						k_north = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_riverlands } }
							k_riverlands  = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_vale } }
							k_vale = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_westerlands } }
							k_westerlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_reach } }
							k_reach = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_stormlands } }
							k_stormlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_dorne } }
							k_dorne = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
					}
					if = { 	limit = { primary_title = { title = e_iron_isles } }
							k_iron_isles = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } } 
					}
					hidden_tooltip = { character_event = { id = maintenance.20 } } #This event takes the defeated King's title and reorganises them
				}					
			}	
		}
		if = { # Conquest of Dorne
			limit = { has_global_flag = actual_conquest_of_dorne }
			ROOT = {
				character_event = { id = conquest_of_dorne.14 days = 1 }
				clr_global_flag = actual_conquest_of_dorne
			}
		}
		hidden_tooltip = {
			any_de_jure_vassal_title = {
				limit = { tier = KING }
				de_jure_liege = e_iron_throne
			}
		}
		any_attacker = {
			participation_scaled_prestige = 200
		}
	}

	on_fail = {
		any_attacker = {
			participation_scaled_prestige = -150
		}	
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 5.0
			}
		}
		FROM = { character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } }#Take back dejure vassals (AGOT)
		any_attacker = {
			participation_scaled_prestige = -300
		}
		any_defender = {
			participation_scaled_prestige = 150
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2 #More important than duchies
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		#Dorne Reluctance
		modifier = {
			factor = 0.1
			ROOT = { has_landed_title = e_iron_throne }
			FROM = { 
				primary_title = { title = e_dorne }
			}
		}	
		modifier = {
			factor = 0
			ROOT = { 
				has_landed_title = e_iron_throne 
				NOT = { trait = ambitious }
				NOT = { trait = greedy }	
			}
			FROM = { 
				primary_title = { title = e_dorne }
			}
		}		
	}
}
dejure_kingdom_claim = {
	name = CB_NAME_DEJUREKINGCLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { is_nomadic = yes }
			NOT = { can_use_dragon_conquest_trigger = yes }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		tier = KING
		NOT = {
			OR = {
				ROOT = {
					has_landed_title = PREV
				}
				holder_scope = {
					is_liege_or_above = ROOT
				}
			}
		}

		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = {
			dejure_liege_title = {
				AND = {
					has_holder = yes
					ROOT = {
						has_landed_title = PREV
					}
				}
			}
			AND = {
				ROOT = { has_landed_title = e_iron_throne }
				OR = {
					title = k_north
					title = k_riverlands
					title = k_vale
					title = k_westerlands
					title = k_reach
					title = k_stormlands
					title = k_iron_isles
					title = k_crownlands
					title = k_dorne
					title = k_the_most_devout
					AND = {
						NOT = { title = k_beyond_wall }
						NOT = { title = k_nightswatch }
						capital_scope = { region = world_westeros }
					}
				}
			}	
		}		
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			ROOT = {
				if = { #Expand Realm, special new valyria success
					limit = {
						has_ambition = obj_expand_realm
						has_character_flag = new_valyria_ambition_invasion
						has_landed_title = e_new_valyria
					}
					set_character_flag = obj_expand_realm_success
					set_character_flag = obj_expand_realm
				}
			}	
		} 
		if = {
			limit = { ROOT = { has_landed_title = e_iron_throne } }
			if = { 	limit = { title = k_north }
					ROOT = { set_character_flag = dejure_north }
			}
			if = { 	limit = { title = k_riverlands }
					ROOT = { set_character_flag = dejure_riverlands }
			}
			if = { 	limit = { title = k_vale }
					ROOT = { set_character_flag = dejure_vale }
			}
			if = { 	limit = { title = k_westerlands }
					ROOT = { set_character_flag = dejure_westerlands }
			}
			if = { 	limit = { title = k_reach }
					ROOT = { set_character_flag = dejure_reach }
			}
			if = { 	limit = { title = k_stormlands }
					ROOT = { set_character_flag = dejure_stormlands }
			}
			if = { 	limit = { title = k_dorne }
					ROOT = { set_character_flag = dejure_dorne }
			}
			if = { 	limit = { title = k_iron_isles }
					ROOT = { set_character_flag = dejure_iron_isles }
			}	
		}	
		if = {
			limit = {
				holder_scope = { 
					OR = {
						tier = EMPEROR 
						primary_title = { 
							NOT = { title = PREVPREV } #Leave kings with other primary title independent
							NOT = { dejure_liege_title = { holder_scope = { character = ROOT } } }
							is_titular = no
						} 
					}	
				}
			}
			usurp_title = { target = ROOT type = claim }
			hidden_tooltip = { ROOT = { character_event = { id = maintenance.21 } } }#Take dejure vassals (AGOT)
		}
		if = {
			limit = {
				holder_scope = { 
					NOR = {
						tier = EMPEROR 
						primary_title = { 
							NOT = { title = PREVPREV } #Leave kings with other primary title independent
							NOT = { dejure_liege_title = { holder_scope = { character = ROOT } } }
							is_titular = no
						} 
					}	
				}
			}
			if = {
				limit = {
					OR = {
						NOT = { holder_scope = { trait = wildling }	}		
						ROOT = { trait = wildling }
					}	
				}
				holder_scope = {
					set_defacto_liege = ROOT
					clr_character_flag = independant
					hidden_tooltip = {
						opinion = {
							modifier = opinion_subjugated_AGOT
							who = ROOT
							years = 10
						}
					}
					hidden_tooltip = {
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}					
				}
			}
			if = { #Take holdings and titles back from wildlings
				limit = {
					holder_scope = { trait = wildling }			
					ROOT = { NOT = { trait = wildling } }
				}
				custom_tooltip = { 
					text = TOOLTIPDEJURKINGCLAIMwildling 
					hidden_tooltip = {
						save_event_target_as = wildling_title
						ROOT = { character_event = { id = maintenance.35 } } #take all occuped titles
						clear_event_target = wildling_title
					}
				}
			}
		}		
		hidden_tooltip = {
			FROM = { character_event = { id = diplomatic.51 days = 2 } } #destroy redundant kingdoms
			ROOT = { 
				if = { #Volantene New Valyria Ambition
					limit = { 
						has_landed_title = e_new_valyria
					}
					if = { #Bleeding Years
						limit = { has_global_flag = bleeding_years }
						clr_global_flag = bleeding_years
					}
					if = { 
						limit = { has_global_flag = e_new_valyria_ambition }
						clr_global_flag = e_new_valyria_ambition
					}
				}			
			} 
		}
	}

	on_fail_title = {
		ROOT = {
			participation_scaled_prestige = -150
			if = { #Volantene New Valyria Ambition
				limit = { 
					has_landed_title = e_new_valyria
				}
				if = { #Bleeding Years
					limit = { has_global_flag = bleeding_years }
					clr_global_flag = bleeding_years
				}
				if = { 
					limit = { has_global_flag = e_new_valyria_ambition }
					clr_global_flag = e_new_valyria_ambition
					e_new_valyria = { 
						destroy_landed_title = ROOT 
						hidden_tooltip = { set_variable = { which = "de_facto_empire" value = 11 } }
					}
				}
			}
		}
		
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			participation_scaled_prestige = -300
			transfer_scaled_wealth = {
				to = FROM
				value = 5.0
			}
			if = { #Volantene New Valyria Ambition
				limit = { 
					has_landed_title = e_new_valyria
				}
				if = { #Bleeding Years
					limit = { has_global_flag = bleeding_years }
					clr_global_flag = bleeding_years
				}
				if = { 
					limit = { has_global_flag = e_new_valyria_ambition }
					clr_global_flag = e_new_valyria_ambition
					e_new_valyria = { destroy_landed_title = ROOT }
				}
			}
		}
		FROM = {
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 150
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 2 #More important than duchies
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}
dejure_duchy_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			NOT = { is_nomadic = yes }
			NOT = { can_use_dragon_conquest_trigger = yes }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		NOT = {
			any_vassal = { 
				any_war = {
					OR = {
						using_cb = dejure_duchy_claim
						using_cb = other_dejure_duchy_claim
					}	
					defender = { character = FROM }
				}
			}
			liege = {
				any_war = {
					OR = {
						using_cb = dejure_duchy_claim
						using_cb = other_dejure_duchy_claim
					}	
					defender = { character = FROM }
				}
			}
		}
	}

	can_use_title = {
		tier = DUKE
		OR = {
			holder = FROM
			holder_scope = { is_liege_or_above = FROM }
		}
		NOR = {
			holder = ROOT
			holder_scope = { is_liege_or_above = ROOT }
		}
		OR = {
			empire = { holder = ROOT }
			dejure_liege_title = { holder = ROOT }
			ROOT = { #Titular Kingdoms have claim in home duchy
				any_demesne_title = {
					tier = KING
					is_titular = yes
					is_landless_type_title = no
					capital_scope = {
						duchy = { title = PREVPREVPREVPREV }
					}
				}
			}
		}
		#Kingdom claims take precedence
		NOT = {
			FROM = {
				any_realm_title = {
					tier = KING
					dejure_liege_title = { holder = ROOT }
				}
			}
		}
		#Iron throne claim takes precedence
		NAND = {
			ROOT = { has_landed_title = e_iron_throne }
			empire = {
				has_holder = yes
				OR = {
					title = e_north 
					title = e_riverlands 
					title = e_vale
					title = e_westerlands 
					title = e_reach
					title = e_stormlands
					title = e_dorne
					title = e_iron_isles
				}
			}
		}	
		# FROM = {
			# NOT = {
				# OR = {
					# has_character_flag = supporting_king 
					# has_character_flag = neutral
					# has_character_flag = against_king 
					# has_character_flag = rebel_leader
				# }
			# }	
		# }
		OR = {
			NOT = { FROM = { capital_scope = { has_province_flag = dothraki_sea } } }	
			FROM = { NOT = { is_nomadic = yes } }
		}	
						
		FROM = {
			OR = {
				holy_order = no
				NOT = { religion = ROOT }
				NOT = { has_dlc = "Sons of Abraham" }
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		if = {
			limit = {
				holder_scope = { 
					OR = {
						AND = {
							higher_tier_than = DUKE
							OR = {
								NOT = { character = FROM }
								NOT = { tier = KING }
								NOT = { ROOT = { tier = EMPEROR } }
							}
						}	
						primary_title = { 
							NOT = { title = PREVPREV } #Leave dukes with other primary title independent
							NOT = { dejure_liege_title = { holder_scope = { character = ROOT } } }
							is_titular = no
						} 
					}	
				}
			}
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			hidden_tooltip = { ROOT = { character_event = { id = maintenance.21 } } }#Take dejure vassals (AGOT)
		}
		if = {
			limit = {
				holder_scope = { 
					NOR = {
						AND = {
							higher_tier_than = DUKE
							OR = {
								NOT = { character = FROM }
								NOT = { tier = KING }
								NOT = { ROOT = { tier = EMPEROR } }
							}
						}	
						primary_title = { 
							NOT = { title = PREVPREV } #Leave dukes with other primary title independent
							NOT = { dejure_liege_title = { holder_scope = { character = ROOT } } }
							is_titular = no
						} 
					}	
				}
			}
			if = {
				limit = {
					OR = {
						NOT = { holder_scope = { trait = wildling } }	 
						ROOT = { trait = wildling }
					}	
				}
				holder_scope = {
					set_defacto_liege = ROOT
					opinion = {
						modifier = opinion_subjugated_AGOT
						who = ROOT
						years = 10
					}
					hidden_tooltip = { character_event = { id = maintenance.25 } } #Subjugation flag maintenance
				}
			}	
			if = { #Take holdings and titles back from wildlings
				limit = {
					holder_scope = { trait = wildling }			
					ROOT = { NOT = { trait = wildling } }
				}
				custom_tooltip = { 
					text = TOOLTIPDEJURKINGCLAIMwildling 
					hidden_tooltip = {
						save_event_target_as = wildling_title
						ROOT = { character_event = { id = maintenance.35 } } #take all occuped titles
						clear_event_target = wildling_title
					}
				}
			}
		}	
		hidden_tooltip = {
			ROOT = { character_event = { id = maintenance.24 } } #Mega war flag maintenance
			FROM = { character_event = { id = diplomatic.51 days = 2 } } #destroy redundant kingdoms
		}	
	}

	on_fail_title = {
		ROOT = {
			participation_scaled_prestige = -100
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			participation_scaled_prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 2.5
			}
		}
		FROM = {
			participation_scaled_prestige = 75
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1.5 #More important than counties
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}
other_dejure_duchy_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_OTHER_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	other_de_jure_claim = yes # Optimization for de jure claims of vassals
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = PREV modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use = {
		NOT = { trait = nightswatch } 
		NOT = { culture_group = unoccupied_group }
		NOT = { culture_group = winter_group }
		NOT = { is_nomadic = yes }
		NOT = { can_use_dragon_conquest_trigger = yes }
		FROM = { 
			NOT = { is_liege_of = ROOT }
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			trait = wildling
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { has_global_flag = war_cooldown_period }
			had_global_flag = { flag = war_cooldown_period days = 25 }
		}	
		NOT = {
			any_vassal = { 
				any_war = {
					OR = {
						using_cb = dejure_duchy_claim
						using_cb = other_dejure_duchy_claim
					}	
					defender = { character = FROM }
				}
			}
			liege = {
				any_war = {
					OR = {
						using_cb = dejure_duchy_claim
						using_cb = other_dejure_duchy_claim
					}	
					defender = { character = FROM }
				}
			}
		}
		NOT = {
			ROOT = {
				character = PREV
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = PREV modifier = opinion_de_facto_liege } } }
			NOT = { higher_tier_than = FROM }
		}	
	}

	can_use_title = {
		tier = DUKE
		OR = {
			holder = FROM
			holder_scope = { is_liege_or_above = FROM }
		}
		holder_scope = {
			NOR = {
				character = ROOT
				character = FROMFROM
				is_liege_or_above = ROOT
				is_liege_or_above = FROMFROM # The potential attacker
			}
		}
		
		OR = {
			empire = { holder = ROOT }
			dejure_liege_title = { holder = ROOT }
			ROOT = { #Titular Kingdoms have claim in home duchy
				any_demesne_title = {
					tier = KING
					is_titular = yes
					is_landless_type_title = no
					capital_scope = {
						duchy = { title = PREVPREVPREVPREV }
					}
				}
			}
		}
		#Kingdom claims take precedence
		NOT = {
			FROM = {
				any_realm_title = {
					tier = KING
					dejure_liege_title = { holder = ROOT }
				}
			}
		}
		OR = {
			NOT = { FROM = { capital_scope = { has_province_flag = dothraki_sea } } }	
			FROM = { NOT = { is_nomadic = yes } }
		}		
		FROM = {
			OR = {
				holy_order = no
				NOT = { religion = ROOT }
				NOT = { has_dlc = "Sons of Abraham" }
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { add_character_modifier = { name = victory_timer duration = 3 } }
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
		}
		any_attacker = {
			participation_scaled_prestige = 100
		}
	}

	on_success_title = {
		if = {
			limit = {
				holder_scope = {
					tier = duke
				}
			}
			if = {
				limit = {
					OR = {
						NOT = { holder_scope = { trait = wildling } }	 
						ROOT = { trait = wildling }
					}	
				}
				holder_scope = {
					set_defacto_liege = ROOT
					opinion = {
						modifier = opinion_subjugated_AGOT
						who = ROOT
						years = 10
					}
					hidden_tooltip = {
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
						character_event = { id = diplomatic.51 days = 2 } #destroy redundant kingdoms
					}
				}
			}	
			if = { #Take holdings and titles back from wildlings
				limit = {
					holder_scope = { trait = wildling }			
					ROOT = { NOT = { trait = wildling } }
				}
				custom_tooltip = { 
					text = TOOLTIPDEJURKINGCLAIMwildling 
					hidden_tooltip = {
						save_event_target_as = wildling_title
						ROOT = { character_event = { id = maintenance.35 } } #take all occuped titles
						clear_event_target = wildling_title
					}
				}
			}
		}

		if = {
			limit = {
				holder_scope = {
					higher_tier_than = duke
				}
			}
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			any_de_jure_vassal_title = { # take all counties under the one we're fighting for
				limit = {
					tier = count
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						character = FROM
					}
				}

				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			}
		}
	}

	on_fail = {
		prestige = -50
		ROOT = {
			prestige = -100
		}
		any_defender = {
			participation_scaled_prestige = 50
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		prestige = -100
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		ROOT = {
			prestige = -200
		}
		any_defender = {
			participation_scaled_prestige = 100
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1.5 #More important than counties
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

dejure_county_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use = {	
		NOT = { is_nomadic = yes }
		NOT = { can_use_dragon_conquest_trigger = yes }
		NOT = {
			any_vassal = { 
				any_war = {
					OR = {
						using_cb = dejure_county_claim
						using_cb = other_dejure_county_claim
					}	
					defender = { character = FROM }
				}
			}
			liege = {
				any_war = {
					OR = {
						using_cb = dejure_county_claim
						using_cb = other_dejure_county_claim
					}	
					defender = { character = FROM }
				}
			}
		}
		NAND = {
			FROM = { has_landed_title = k_the_most_devout }
			religion_group = FROM
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			NOT = { has_global_flag = war_cooldown_period }
			had_global_flag = { flag = war_cooldown_period	 days = 25 }
		}
		NOT = { culture_group = unoccupied_group }
		NOT = { culture_group = winter_group }
	}

	can_use_title = {
		tier = COUNT		
		OR = {
			holder = FROM
			holder_scope = { is_liege_or_above = FROM }
		}
		NOR = {
			holder = ROOT
			holder_scope = { is_liege_or_above = ROOT }
		}
		OR = {
			kingdom = { holder = ROOT }
			empire = { holder = ROOT }
			dejure_liege_title = { holder = ROOT }
			ROOT = { #Titular Kingdoms have claim in home duchy
				any_demesne_title = {
					tier = KING
					is_titular = yes
					is_landless_type_title = no
					capital_scope = {
						duchy = { de_jure_vassal_or_below = PREVPREVPREVPREV }
					}
				}
			}	
		}
		
		#Duchy/Kingdom claims take precedence
		NOT = {
			FROM = {
				any_realm_title = {
					higher_tier_than = COUNT
					OR = {
						empire = { holder = ROOT }
						dejure_liege_title = { holder = ROOT }
						ROOT = { #Titular Kingdoms have claim in home duchy
							any_demesne_title = {
								tier = KING
								is_titular = yes
								is_landless_type_title = no
								capital_scope = {
									duchy = { title = PREVPREVPREVPREV }
								}
							}
						}
					}
				}
			}
		}
		OR = {
			NOT = { location = { has_province_flag = dothraki_sea } }
			FROM = { NOT = { is_nomadic = yes } }
		}	
		
		FROM = {
			OR = {
				holy_order = no
				NOT = { religion = ROOT }
				NOT = { has_dlc = "Sons of Abraham" }
				OR = {
					AND = {
						primary_title = { title = d_warriors_sons }
						ROOT = {
							has_character_modifier = expelled_d_warriors_sons
						}
					}
					AND = {
						primary_title = { title = d_poor_fellows }
						ROOT = {
							has_character_modifier = expelled_d_poor_fellows
						}
					}
				}	
			}
		}
		#Members of alliance cannot use this against leaders capital
		NAND = {
			ROOT = { any_demesne_title = { has_law = republic_alliance_member } }
			FROM = { 
				government = alliance_government
				OR = {
					is_vassal_or_below = ROOT
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
				}	
			}
			location = { is_capital = yes }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	is_valid_title = {
		OR = {
			holder = FROM
			holder_scope = { is_liege_or_above = FROM }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		if = {
			limit = {
				holder_scope = {
					tier = COUNT
					is_patrician = no
					NOT = {
						num_of_count_titles = 2
					}
				}
				OR = {
					NOT = { holder_scope = { trait = wildling } }	 
					ROOT = { trait = wildling }
				}	
			}
			holder_scope = {
				set_defacto_liege = ROOT
				opinion = {
					modifier = opinion_subjugated_AGOT
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					character_event = { id = maintenance.25 } #Subjugation flag maintenance
				}
			}
		}

		if = {
			limit = {
				OR = {
					AND = {
						holder_scope = {
							OR = {
								higher_tier_than = count
								num_of_count_titles = 2
								is_patrician = yes
							}
						}
					}
					AND = { #Take holdings and titles back from wildlings
						holder_scope = { trait = wildling }			
						ROOT = { NOT = { trait = wildling } }
					}
				}	
			}
			hidden_tooltip = { holder_scope = { character_event = { id = maintenance.22 days = 2 } } }#Mega War flag maintenance
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		#Reluctance for Total War over a county
		modifier = {
			factor = 0.2
			ROOT = { higher_tier_than = DUKE }
			FROM = { higher_tier_than = DUKE }
		}			
	}
}

other_dejure_county_claim = {
	name = CB_NAME_DEJURECLAIM
	war_name = WAR_NAME_OTHER_DEJURECLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	other_de_jure_claim = yes # Optimization for de jure claims of vassals
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = PREV modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use = {
		NOT = { culture_group = unoccupied_group }
		NOT = { culture_group = winter_group }
		NOT = { is_nomadic = yes }
		NOT = { can_use_dragon_conquest_trigger = yes }
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			NOT = { has_global_flag = war_cooldown_period }
			had_global_flag = { flag = war_cooldown_period days = 25 }
		}
		NOT = { character = ROOT }
		FROM = {
			NOT = { is_liege_of = ROOT }
			OR = {
				holy_order = no
				NOT = { religion = ROOT }
				NOT = { has_dlc = "Sons of Abraham" }
			}
		}
		NOT = {
			any_vassal = { 
				any_war = {
					OR = {
						using_cb = dejure_county_claim
						using_cb = other_dejure_county_claim
					}	
					defender = { character = FROM }
				}
			}
			liege = {
				any_war = {
					OR = {
						using_cb = dejure_county_claim
						using_cb = other_dejure_county_claim
					}	
					defender = { character = FROM }
				}
			}
		}
		NOT = {
			AND = {
				FROM = { has_landed_title = k_the_most_devout }
				religion_group = FROM
			}	
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = PREV modifier = opinion_de_facto_liege } } }
			NOT = { higher_tier_than = FROM }
		}
	}

	can_use_title = {
		tier = COUNT
		
		OR = {
			dejure_liege_title = { holder_scope = { character = ROOT } }
			ROOT = { #Titular Kingdoms have claim in home duchy
				any_demesne_title = {
					tier = KING
					is_titular = yes
					is_landless_type_title = no
					capital_scope = {
						duchy = { de_jure_vassal_or_below = PREVPREVPREVPREV }
					}
				}
			}
		}	
		OR = {
			holder = FROM
			holder_scope = { is_liege_or_above = FROM }
		}
		holder_scope = {
			NOR = {
				character = ROOT
				character = FROMFROM
				is_liege_or_above = ROOT
				is_liege_or_above = FROMFROM # The potential attacker
			}
		}

		#Duchy/Kingdom claims have precedence
		NOT = {
			FROM = {
				any_realm_title = {
					higher_tier_than = COUNT
					OR = {
						empire = { holder = ROOT }
						dejure_liege_title = { holder = ROOT }
						ROOT = { #Titular Kingdoms have claim in home duchy
							any_demesne_title = {
								tier = KING
								is_titular = yes
								is_landless_type_title = no
								capital_scope = {
									duchy = { title = PREVPREVPREVPREV }
								}
							}
						}
					}
				}
			}
		}
		
		OR = {
			NOT = { location = { has_province_flag = dothraki_sea } }
			FROM = { NOT = { is_nomadic = yes } }
		}	
		FROM = {
			OR = {
				holy_order = no
				NOT = { religion = ROOT }
				NOT = { has_dlc = "Sons of Abraham" }
			}
		}
		#Members of alliance cannot use this against leaders capital
		NAND = {
			ROOT = { any_demesne_title = { has_law = republic_alliance_member } }
			FROM = { 
				government = alliance_government
				OR = {
					is_vassal_or_below = ROOT
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
				}	
			}
			location = { is_capital = yes }
		}	
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}


	on_success = {
		hidden_tooltip = { add_character_modifier = { name = victory_timer duration = 3 } }
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_success_title = {
		if = {
			limit = {
				holder_scope = {
					tier = count
					is_patrician = no
					NOT = {
						num_of_count_titles = 2
					}
				}
				OR = {
					NOT = { holder_scope = { trait = wildling } }	 
					ROOT = { trait = wildling }
				}	
			}
			holder_scope = {
				set_defacto_liege = ROOT
				opinion = {
					modifier = opinion_subjugated_AGOT
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					character_event = { id = maintenance.25 } #Subjugation flag maintenance
				}
			}
		}

		if = {
			limit = {
				OR = {
					AND = {
						holder_scope = {
							OR = {
								higher_tier_than = count
								num_of_count_titles = 2
								is_patrician = yes
							}
						}
					}
					AND = { #Take holdings and titles back from wildlings
						holder_scope = { trait = wildling }			
						ROOT = { NOT = { trait = wildling } }
					}
				}	
			}
			hidden_tooltip = { holder_scope = { character_event = { id = maintenance.22 days = 2 } } }#Mega War flag maintenance
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			any_de_jure_vassal_title = { # take all baronies under the one we're fighting for
				limit = {
					has_holder = yes
					NOT = {
						de_facto_liege = PREV
					}
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
				}

				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			}
		}
	}

	on_fail = {
		prestige = -50
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		prestige = -100
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		ROOT = {
			prestige = -200
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
		#Reluctance for Total War over a county
		modifier = {
			factor = 0.2
			ROOT = { higher_tier_than = DUKE }
			FROM = { higher_tier_than = DUKE }
		}
	}
}

dejure_barony_claim = {
	name = CB_NAME_DEJUREBARONYCLAIM
	war_name = WAR_NAME_DEJUREBARONYCLAIM
	sprite = 16
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	check_de_jure_tier = COUNT
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use = {
		ROOT = { 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			NOT = { is_nomadic = yes }
			NOT = { can_use_dragon_conquest_trigger = yes }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		NOT = {
			any_vassal = { 
				any_war = {
					#OR = {
						using_cb = dejure_barony_claim
						#using_cb = other_dejure_barony_claim
					#}	
					defender = { character = FROM }
				}
			}
			liege = {
				any_war = {
					#OR = {
						using_cb = dejure_barony_claim
						#using_cb = other_dejure_barony_claim
					#}	
					defender = { character = FROM }
				}
			}
		}
		NOT = {
			AND = {
				FROM = { has_landed_title = k_the_most_devout }
				ROOT = { religion_group = FROM }
			}	
		}
	}

	can_use_title = {
		tier = COUNT
		holder = ROOT
		any_direct_de_jure_vassal_title = {
			NOR = {
				holder = ROOT
				holder_scope = { is_liege_or_above = ROOT }
			}
			OR = {
				holder = FROM
				holder_scope = { is_liege_or_above = FROM }
			}
		}

		#NOT = {
			#holder_scope = {
				#liege = {
					#ROOT = {
						#liege = {
							#character = PREVPREV
						#}
					#}
				#}
			#}
		#}
		OR = {
			NOT = { location = { has_province_flag = dothraki_sea } }
			FROM = { NOT = { is_nomadic = yes } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		
		FROM = {
			OR = {
				holy_order = no
				NOT = { religion = ROOT }
				NOT = { has_dlc = "Sons of Abraham" }
			}
		}
	}

	is_valid_title = {
		holder = ROOT
		any_direct_de_jure_vassal_title = {
			NOR = {
				holder = ROOT
				holder_scope = { is_liege_or_above = ROOT }
			}
			OR = {
				holder = FROM
				holder_scope = { is_liege_or_above = FROM }
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_direct_de_jure_vassal_title = {
			limit = {
				OR = {
					holder = FROM
					holder_scope = { is_liege_or_above = FROM }
				}
			}	
			if = {
				limit = {
					holder_scope = {
						tier = baron
						is_patrician = no
						NOT = { demesne_size = 2 }
					}
					OR = {
						NOT = { holder_scope = { trait = wildling } }	 
						ROOT = { trait = wildling }
					}	
				}
				holder_scope = {
					set_defacto_liege = ROOT
					opinion = {
						modifier = opinion_subjugated_AGOT
						who = ROOT
						years = 10
					}
					hidden_tooltip = {
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}
				}
			}

			if = {
				limit = {
					OR = {
						AND = {
							holder_scope = {
								OR = {
									higher_tier_than = baron
									demesne_size = 2
									is_patrician = yes
								}
							}
						}
						AND = { #Take holdings and titles back from wildlings
							holder_scope = { trait = wildling }			
							ROOT = { NOT = { trait = wildling } }
						}
					}	
				}
				hidden_tooltip = { holder_scope = { character_event = { id = maintenance.22 days = 2 } } }#Mega War flag maintenance
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			}
		}	
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -50
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 25
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 25 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 75
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 75
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 0.75 #Less important than counties
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		#Reluctance for Total War over a barony
		modifier = {
			factor = 0.2
			ROOT = { higher_tier_than = DUKE }
			FROM = { higher_tier_than = DUKE }
		}		
	}
}

# other_dejure_barony_claim = {
	# name = CB_NAME_DEJUREBARONYCLAIM
	# war_name = WAR_NAME_OTHER_DEJUREBARONYCLAIM
	# sprite = 16
	# truce_days = 3650
	# hostile_against_others = yes
	# #is_permanent = yes
	# other_de_jure_claim = yes # Optimization for de jure claims of vassals
	# #press_claim = yes
	# can_ask_to_join_war = no
	
	# check_de_jure_tier = COUNT

	# infamy_modifier = 0
	
	# can_use_gui = {
		# # custom_tooltip = {
			# # text = TOOLTIPCBENFORCEDTRUCE
			# # hidden_tooltip = {
				# # FROM = {
					# # NOT = { has_opinion_modifier = { who = PREV modifier = opinion_enforced_truce } }
				# # }	
			# # }
		# # }
	# }

	# can_use = {
		# NOT = { culture_group = unoccupied_group }
		# NOT = { culture_group = winter_group }
		# NOT = { culture = dothraki}
		# NOT = { culture = jogos_nhai }
		# FROM = { NOT = { culture_group = unoccupied_group } }
		# FROM = { NOT = { culture_group = winter_group } }
		# OR = {
			# NOT = { has_global_flag = war_cooldown_period }
			# had_global_flag = { flag = war_cooldown_period days = 25 }
		# }	
		# NOT = { primary_title = { title = d_kingsguard } }
		# NOT = {
			# any_vassal = { 
				# any_war = {
					# OR = {
						# using_cb = dejure_barony_claim
						# using_cb = other_dejure_barony_claim
					# }	
					# defender = { character = FROM }
				# }
			# }
			# liege = {
				# any_war = {
					# OR = {
						# using_cb = dejure_barony_claim
						# using_cb = other_dejure_barony_claim
					# }	
					# defender = { character = FROM }
				# }
			# }
		# }
		# NOT = {
			# AND = {
				# FROM = { has_landed_title = k_the_most_devout }
				# religion_group = FROM
			# }	
		# }
		# NOT = {
			# ROOT = {
				# character = PREV
			# }
		# }
		# OR = { #Cannot attack vassals split by mega war
			# NOT = { FROM = { has_opinion_modifier = { who = PREV modifier = opinion_de_facto_liege } } }
			# NOT = { higher_tier_than = FROM }
		# }	
	# }

	# can_use_title = {
		# tier = COUNT
		# holder = ROOT
		# any_direct_de_jure_vassal_title = {
			# OR = {
				# holder = FROM
				# holder_scope = { is_liege_or_above = FROM }
			# }
		# }
		# OR = {
			# NOT = { location = { has_province_flag = dothraki_sea } }
			# FROM = { NOT = { is_nomadic = yes } }
		# }	
		# FROM = {
			# OR = {
				# holy_order = no
				# NOT = { religion = ROOT }
				# NOT = { has_dlc = "Sons of Abraham" }
			# }
		# }	
	# }

	# is_valid_title = {
		# holder = ROOT
		# any_direct_de_jure_vassal_title = {
			# OR = {
				# holder = FROM
				# holder_scope = { is_liege_or_above = FROM }
			# }
		# }
	# }
	
	# on_add_title = {
		# event_target:chronicle_player = {
			# if = {
				# limit = { character = ROOT }
				# chronicle = {
					# entry = CHRONICLE_WAR_CLAIM_ATTACKER
					# portrait = [From.GetID]
				# }
				# break = yes
			# }
			# if = {
				# limit = { character = FROM }
				# chronicle = {
					# entry = CHRONICLE_WAR_CLAIM_DEFENDER
					# portrait = [Root.GetID]
				# }
				# break = yes
			# }
			# if = {
				# limit = { is_liege_or_above = ROOT }
				# chronicle = {
					# entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					# portrait = [Root.GetID]
				# }
				# break = yes
			# }
			# if = {
				# limit = { is_liege_or_above = FROM }
				# chronicle = {
					# entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					# portrait = [From.GetID]
				# }
			# }
		# }
	# }


	# on_success = {
		# hidden_tooltip = { add_character_modifier = { name = victory_timer duration = 3 } }
		# ROOT = {
			# opinion = {
				# modifier = pressed_my_claim 
				# who = PREV
			# }
		# }
		# any_attacker = {
			# limit = { character = PREV }
			# participation_scaled_prestige = 100
		# }
		# any_attacker = {
			# limit = { NOT = { character = PREVPREV } }
			# hidden_tooltip = { participation_scaled_prestige = 100 }
		# }
	# }

	# on_success_title = {
		# any_direct_de_jure_vassal_title = {
			# limit = {
				# OR = {
					# holder = FROM
					# holder_scope = { is_liege_or_above = FROM }
				# }
			# }	
			# if = {
				# limit = {
					# holder_scope = {
						# tier = baron
						# is_patrician = no
						# NOT = { demesne_size = 2 }
					# }
					# OR = {
						# NOT = { holder_scope = { trait = wildling } }	 
						# ROOT = { trait = wildling }
					# }	
				# }
				# holder_scope = {
					# set_defacto_liege = ROOT
					# opinion = {
						# modifier = opinion_subjugated_AGOT
						# who = ROOT
						# years = 10
					# }
					# hidden_tooltip = {
						# character_event = { id = maintenance.25 } #Subjugation flag maintenance
					# }
				# }
			# }

			# if = {
				# limit = {
					# OR = {
						# AND = {
							# holder_scope = {
								# OR = {
									# higher_tier_than = baron
									# demesne_size = 2
									# is_patrician = yes
								# }
							# }
						# }
						# AND = { #Take holdings and titles back from wildlings
							# holder_scope = { trait = wildling }			
							# ROOT = { NOT = { trait = wildling } }
						# }
					# }	
				# }
				# hidden_tooltip = { holder_scope = { character_event = { id = maintenance.22 days = 2 } } }#Mega War flag maintenance
				# usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
			# }
		# }
	# }

	# on_fail = {
		# prestige = -50
		# ROOT = {
			# prestige = -100
		# }
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 50
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 50 }
		# }
	# }

	# on_reverse_demand = {
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		# prestige = -100
		# transfer_scaled_wealth = {
			# to = FROM
			# value = 4.0
		# }
		# ROOT = {
			# prestige = -200
		# }
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 100
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 100 }
		# }
		# hidden_tooltip = {
			# if = {
				# limit = { 
					# FROM = { tier = EMPEROR }
					# #
				# }
				# any_attacker = {
					# character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				# }
			# }
		# }
	# }

	# attacker_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# defender_ai_defeat_worth = {
		# factor = 100
	# }
	
	# # ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	# ai_will_do = { 
		# factor = 1
		# #Dragon intimidation
		# modifier = {
			# factor = 0.1
			# ROOT = { NOT = { trait = dragon_rider } }
			# FROM = { 
				# trait = dragon_rider 
				# NOT = { trait = incapable }
			# }
		# }	
		# #Reluctance for Total War over a barony
		# modifier = {
			# factor = 0.2
			# ROOT = { higher_tier_than = DUKE }
			# FROM = { higher_tier_than = DUKE }
		# }
	# }
# }


