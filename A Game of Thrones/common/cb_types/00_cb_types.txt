## normal scopes(including posttitle scopes) ##
# ROOT = receiver
# FROM = giver
# <no scope change> = attacker or receiver
## title scopes ##
# ROOT = receiver
# FROM = giver
# <no scope change> = thirdparty landed title	
#
# the following effects/triggers exists (example execution order: on_success->on_success_title->on_success_posttitle):
# is_valid, is_valid_title, on_add, on_add_title, on_add_posttitle, on_success, on_success_title, on_success_posttitle, on_fail, on_fail_title, on_fail_posttitle, on_reverse_demand, on_reverse_demand_title, on_reverse_demand_posttitle
#
# Added on_attacker_leader_death, on_defender_leader_death and on_thirdparty_death, which all trigger when corresponding character dies
# These three all have war scopes, which currently has the following scope changes: 
# attacker, defender, thirdparty(only valid if thirdparty character is involved), thirdparty_title(only valid if thirdparty title is involved)
#
# ai_will_do: modifies value AI places on the CB compared to other CBs (default: 1)
# can_use_gui: If otherwise valid, the CB is listed in the Diplo View, but you can't declare war unless 'can_use_gui' is also valid (also shows a trigger tooltip.)
#

claim = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM
	sprite = 1
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no

	press_claim = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
		
	can_use = {
	}

	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { 
			ROOT = { has_strong_claim = PREV }
			ROOT = { has_character_flag = claimant_adventurer  }
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					OR = {
						AND = {
							OR = {
								has_law = cognatic_succession
								has_law = agnatic_succession
							}
							ROOT = { is_female = no }
							holder_scope ={ is_female = yes }
						}
						AND = {
							OR = {
								has_law = enatic_succession
								has_law = enatic_cognatic_succession
							}
							ROOT = { is_female = yes }
							holder_scope ={ is_female = no }
						}
					}	
					is_contested = yes # Is already being contested in some form of Claim or Succession War
					holder_scope = { trait = bastard }
					holder_scope = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_suspected_bastard } }
					AND = {
						has_global_flag = race_to_kings_landing
						title = e_iron_throne
					}
				}
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		ROOT = { has_claim = PREV }
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success_title = {
		hidden_tooltip = { 
			holder_scope = { save_event_target_as = old_usurped_title_holder }
			ROOT = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				disband_event_forces = faction_revolters				
				if = {
					limit = { has_character_flag = claimant_adventurer }
					clr_character_flag = claimant_adventurer
					disband_event_forces = claimant_adventure
				}
			} 
			if = {
				limit = { higher_tier_than = DUKE }
				ROOT = {
					if = {
						limit = {
							has_nickname = no
							lower_tier_than = PREV
						}
						random = {
							chance = 20
							give_nickname = nick_the_usurper
						}
					}
				}
			}
		} 
		hidden_tooltip = { 
			holder_scope = { character_event = { id = maintenance.22 days = 2 } }#Mega War flag maintenance
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
			###If iron bank insurer take on debt
			if = {
				limit = {
					ROOT = { 
						has_character_flag = loan_insurer 
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_debt_insurer
						}
					}	
				}
				ROOT = { character_event = { id = bankruptcy.101 } }
			}
			#If capital of a merchant republic move their capital to another coastal province if possible
			if = {
				limit = {
					FROM = { is_merchant_republic = yes }
					tier = COUNT
					location = { FROM = { capital_scope = { province_id = PREVPREV } } }
				}
				FROM = { character_event = { id = maintenance.27 } }
			}
		}	
		hidden_tooltip = { #Vanilla bug resets laws, so fix empire tracker law and primogeniture
			if = { #If this splits ROOT from liege give liege claim on titles
				limit = {
					ROOT = {
						liege = {
							NOT = { character = PREV }
							NOT = { higher_tier_than = PREVPREV }
						}
					}	
				}
				ROOT = {
					liege = {
						ROOT = {
							any_demesne_title = {
								limit = {
									controls_religion = no
									tier = PREV
								}
								add_pressed_claim = PREVPREV
							}
						}
						if = {
							limit = { ai = no }
							character_event = { id = maintenance.30 }
						}
					}
				}	
			}
			if = { #If this splits ROOT from liege give liege claim on titles (split during mega war)
				limit = { 
					ROOT = {
						independent = yes 
						primary_title = { NOT = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } } }
					}	
				}	
				any_independent_ruler = {
					limit = {
						NOT = { character = ROOT }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } }
						NOT = { higher_tier_than = PREV }
					}	
					ROOT = {
						any_demesne_title = {
							limit = {
								controls_religion = no
								tier = PREV
							}
							add_pressed_claim = PREVPREV
						}
					}
					if = {
						limit = { ai = no }
						character_event = { id = maintenance.30 }
					}
				}
			}
		}	
		if = { #Special gender change war
			limit = {
				tier = FROM
				ROOT = { has_character_flag = prefers_cognatic }
				FROM = { has_character_flag = prefers_agnatic }
			}
			custom_tooltip = { 
				text = TOOLTIPWARCOGNATIC 
				hidden_tooltip = { add_law_w_cooldown = true_cognatic_succession }
			}
			ROOT = {
				custom_tooltip = { 
					text = TOOLTIPPREFERSLAW
					hidden_tooltip = {
						set_dynasty_flag = prefers_cognatic 
						clr_dynasty_flag = prefers_agnatic 
					}
				}
			}
		}		
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		FROM = {
			prestige = -100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		
		if = {
			limit = {
				tier = KING
				ROOT = {
					tier = KING
				}
				FROM = { liege = { ROOT = { liege = { character = PREVPREV } } } }
				ROOT = { 
					higher_tier_than = FROM
				}
			}
			hidden_tooltip = {
				FROM = {
					set_defacto_liege = ROOT
				}
			}
		}
		hidden_tooltip = {
			ROOT = {			
				character_event = { id = maintenance.26 } #Vanilla bug resets laws, so fix empire tracker law and primogeniture
				character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
			}
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } } 
			}
			#Yellow Emperor Yi Ti invasion
			if = {
				limit = {
					title = e_yi_ti
					ROOT = { has_landed_title = d_carcosa_raiders }
				}
				d_carcosa_raiders = {
					activate_title = { title = THIS status = no }
					destroy_landed_title = THIS
				}
			}
			if = { #Special Reynes of Castamere stuff
				limit = {
					ROOT = { 
						has_character_flag = reynes_of_castamere 
						has_global_flag = ninepenny_kings
						ai = yes
					}		
					e_iron_throne = { holder_scope = { any_current_enemy = { has_landed_title = k_stepstones } } }
				}
				ROOT = {
					clr_character_flag = reynes_of_castamere
					clr_character_flag = neutral
					clr_character_flag = supporting_king
					set_character_flag = against_king
					e_iron_throne = {
						holder_scope = { 
							character_event = { id = mega_wars.32 }
							opinion = {
								modifier = opinion_joined_rebellion
								who = ROOT
								years = 20
							}
						}
					}
					k_stepstones = {
						holder_scope = { 
							letter_event = { id = mega_wars.30 }
							opinion = {
								who = ROOT
								modifier = opinion_joined_cause
							}
							reverse_opinion = {
								modifier = opinion_with_rebel_leader
								who = ROOT
								years = 100
							}
							ROOT = { join_attacker_wars = PREV }
						}
					}
				}
			}
		}
		clear_event_target = old_usurped_title_holder
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
				if = {
					limit = { has_character_flag = claimant_adventurer }
					disband_event_forces = claimant_adventure
					clr_character_flag = claimant_adventurer
					character_event = { id = TOG.1377 days = 1 } #Post Adventure Loss Maintenance
				}
				if = {
					limit = { has_character_flag = reynes_of_castamere  }
					clr_character_flag = reynes_of_castamere 
				}
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				disband_event_forces = faction_loyalists
			} 
		} 
		ROOT = {
			prestige = -150			
			if = {
				limit = { 
					lower_tier_than = FROM
					has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege }
				}
				imprison = FROM
			}
			if = {
				limit = { 
					OR = {
						NOT = { lower_tier_than = FROM }
						NOT = { has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege } }
					}
				}
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
			if = {
				limit = { has_character_flag = claimant_adventurer }
				imprison = FROM 
				clr_character_flag = captured_in_battle
				clr_character_flag = claimant_adventurer			
				hidden_tooltip = { 
					disband_event_forces = claimant_adventure
					character_event = { id = TOG.1377 days = 1 } #Post Adventure Loss Maintenance
				}
			}
			if = {
				limit = { has_character_flag = reynes_of_castamere  }
				clr_character_flag = reynes_of_castamere 
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 150			
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	on_reverse_demand_title = {
		if = { #Special gender change war
			limit = {
				tier = FROM
				ROOT = { has_character_flag = prefers_cognatic }
				FROM = { has_character_flag = prefers_agnatic }
			}		
			custom_tooltip = { 
				text = TOOLTIPWARAGNATIC 
				hidden_tooltip = { add_law_w_cooldown = agnatic_succession }
			}
			FROM = {
				custom_tooltip = { 
					text = TOOLTIPPREFERSLAW
					hidden_tooltip = {
						clr_dynasty_flag = prefers_cognatic 
						set_dynasty_flag = prefers_agnatic 
					}
				}
			}
		}
		remove_claim = ROOT
	}
	
	on_attacker_leader_death = {
		if = {
			limit = {
				ROOT = { has_character_flag = claimant_adventurer }
			}
			ROOT = {
				hidden_tooltip = {
					disband_event_forces = claimant_adventure
					clr_character_flag = claimant_adventurer
				}
			}
			end_war = invalid
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}		
	}	
}


other_claim = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_OTHER_CLAIM
	sprite = 2
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no

	press_claim = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use = {
		ROOT = {
			OR = {			
				can_press_claims_trigger = yes
				trait = slave
			}
		}
		NOT = { trait = nightswatch } 
		NOT = { trait = kingsguard } 
		NOT = { culture_group = unoccupied_group }
		NOT = { culture_group = winter_group }
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			trait = wildling
			FROM = { NOT = { trait = nightswatch } }
		}			
		OR = {
			NOT = { has_global_flag = war_cooldown_period }
			had_global_flag = { flag = war_cooldown_period days = 25 }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = PREV modifier = opinion_de_facto_liege } } }
			NOT = { higher_tier_than = FROM }
		}	
	}

	can_use_title = {	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}
		OR = {
			AND = {
				ROOT = { is_female = no }
				NOT = { succ_law_title = { has_law = enatic_succession } }
			}	
			AND = {
				ROOT = { is_female = yes }
				NOT = { succ_law_title = { has_law = agnatic_succession } }
			}
		}
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}

		NOT = {
			any_war = { # when used in title scope, checks all wars for that title
				attacker = {
					character = ROOT
				}
			}
		}
		
		OR = { 
			ROOT = { has_strong_claim = PREV }
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					ROOT = { is_pretender = yes }# Checks vs ROOT character
					holder_scope = { has_regent = yes }
					OR = {
						AND = {
							OR = {
								has_law = cognatic_succession
								has_law = agnatic_succession
							}
							ROOT = { is_female = no }
							holder_scope ={ is_female = yes }
						}
						AND = {
							OR = {
								has_law = enatic_succession
								has_law = enatic_cognatic_succession
							}
							ROOT = { is_female = yes }
							holder_scope ={ is_female = no }
						}
					}	
					is_contested = yes # Is already being contested in some form of Claim or Succession War
					holder_scope = { trait = bastard }
					holder_scope = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_suspected_bastard } }
				}
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		ROOT = { has_claim = PREV }
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	on_success = {
		hidden_tooltip = { add_character_modifier = { name = victory_timer duration = 3 } } 
		hidden_tooltip = {
			ROOT = {
				opinion = {
					modifier = pressed_my_claim 
					who = PREV
				}
				if = {
					limit = { trait = slave }
					character_event = { id = slavery.0 }
				}
			}
			if = {
				limit = { 
					trait = rebel_leader
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			prestige = -100
		}
	}

	on_success_title = {
		hidden_tooltip = {
			holder_scope = { 
				save_event_target_as = old_usurped_title_holder 
				opinion = { who = FROMFROM modifier = opinion_usurped_title }
			}
			if = {
				limit = { higher_tier_than = DUKE }
				ROOT = {
					if = {
						limit = {
							has_nickname = no
							lower_tier_than = PREV
						}
						random = {
							chance = 20
							give_nickname = nick_the_usurper
						}
					}
				}
			}	
			holder_scope = { character_event = { id = maintenance.22 days = 2 } }#Mega War flag maintenance
			if = { 	
				limit = {	
					holder_scope = { has_character_flag = post_civil_war_wars }
				}
				ROOT = { set_character_flag = post_civil_war_wars }
			}
			if = { 	
				limit = {	
					holder_scope = { 
						OR = {
							has_character_flag = supporting_king 
							has_character_flag = neutral 
							has_character_flag = against_king 
						}		
					}
					ROOT = { lower_tier_than = PREV }
				}
				ROOT = { set_character_flag = neutral }
			}
			#If capital of a merchant republic move their capital to another coastal province if possible
			if = {
				limit = {
					FROM = { is_merchant_republic = yes }
					tier = COUNT
					location = { FROM = { capital_scope = { province_id = PREVPREV } } }
				}
				FROM = { character_event = { id = maintenance.27 } }
			}
		}
		if = {
			limit = {
				controls_religion = yes
				holder_scope = { religion = the_seven }
			}
			holder_scope = {
				abdicate_to = ROOT
			}
			if = {
				limit = {
					FROMFROM = { higher_tier_than = PREV }
				}
				ROOT = { set_defacto_liege = FROMFROM }
			}
		}
		if = {
			limit = {
				OR = {
					controls_religion = no
					NOT = { holder_scope = { religion = the_seven } }
				}
			}
			
			if = {
				limit = {
					holder_scope = {
						same_realm = FROMFROM # The current holder and the one pressing my claim are in the same larger realm
					}
				}
				ROOT = {
					set_character_flag = other_claim_tmp_flag
				}
			}
			
			if = {
				limit = {
					ROOT = {
						is_ruler = yes
						OR = { # The claimant is a vassal ruler of the presser
							is_liege_or_above = FROMFROM 
							has_opinion_modifier = { who = FROMFROM modifier = opinion_de_facto_liege }
							any_liege = { has_opinion_modifier = { who = FROMFROM modifier = opinion_de_facto_liege } }
						}	
					}
				}
				ROOT = {
					set_character_flag = claimant_is_vassal_ruler_flag
				}
			}
			
			#If this is The Iron Throne pressing claim on a free kingdom, vassalise the kingdom
			if = {
				limit = { 
					FROMFROM = { has_landed_title = e_iron_throne } 
					OR = {
						title = e_north 
						title = e_riverlands 
						title = e_vale
						title = e_westerlands 
						title = e_reach
						title = e_stormlands
						title = e_dorne
						title = e_iron_isles
					}
				}
				if = { 	
					limit = { title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_riverlands }
					k_riverlands = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				if = { 	
					limit = { title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPother_claim_iron_throne_kingdom_SUCCESS } }
				}
				set_title_flag = other_claim_kingdom_target
				FROM = {
					set_character_flag = other_claim_CB_war
					hidden_tooltip = { character_event = { id = maintenance.20 } } #This event takes the defeated King's title and reorganises them
				}	
				hidden_tooltip = { ROOT = { set_defacto_liege = FROMFROM } }
			}	
			tooltip = { usurp_title = ROOT }
			if = {
				limit = { has_holder = yes }
				hidden_tooltip = { #Don't want ousted person to steal a vassal's title
					if = { 
						limit = {
							holder_scope = { 
								NOT = { demesne_size = 2 } 
								OR = {	#pretender is... 						
									ROOT = { NOT = { demesne_size = 1 } } #unlanded	
									AND =  { #small baron
										ROOT = { tier = BARON }
										PREV = { higher_tier_than = COUNT }
									}
									capital_scope = { county = { ROOT = { has_claim = PREV } } } #has claim on capital
								}	
								OR = { #Must be related in some way
									dynasty = ROOT
									is_close_relative = ROOT
									capital_scope = { county = { ROOT = { has_claim = PREV } } }
								}
							}					
						}
						holder_scope = {
							ROOT = { set_character_flag = abdication_usurp }
							abdicate_to = ROOT								
						}
						add_pressed_claim = event_target:old_usurped_title_holder	
						event_target:old_usurped_title_holder = {
							opinion = { who = ROOT modifier = opinion_usurped_title }
						}
					}
					if = { 
						limit = {
							ROOT = { NOT = { has_character_flag = abdication_usurp } }
						}
						if = {
							limit = { ROOT = { is_ruler = yes } }
							holder_scope = { opinion = { who = ROOT modifier = opinion_usurped_title } }
							gain_title = { target = ROOT type = claim } #usurp_title sometimes takes all titles for some reason
							add_pressed_claim = event_target:old_usurped_title_holder	
						}	
						if = {
							limit = { ROOT = { is_ruler = no } }
							usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
						}
					}	
					ROOT =  { clr_character_flag = abdication_usurp }
				}
				hidden_tooltip = {			
					# If we were erroneously vassalized, break free
					if = {
						limit = {
							NOT = { ROOT = { has_character_flag = claimant_is_vassal_ruler_flag } }
							holder_scope = {
								is_liege_or_above = FROMFROM
							}
							NOT = { de_jure_liege_or_above = FROMFROM }
							ROOT = {
								NOT = { dynasty = FROMFROM }
							}
						}
						ROOT = { set_defacto_liege = ROOT }
					}
				
					# try and vassalize, but only conditionally
					if = {
						limit = {
							NOT = {
								holder_scope = {
									is_liege_or_above = FROMFROM
								}
							}
							OR = {
								holder_scope = { de_jure_liege_or_above = FROMFROM }
								ROOT = { has_character_flag = claimant_is_vassal_ruler_flag }
								ROOT = { dynasty = FROMFROM }						
							}
						}
						ROOT = {
							set_defacto_liege = FROMFROM
						}
					}

					# check if the previous effect managed to make us part of the same realm
					# if not, we'll break the other realm
					if = {
						limit = {
							NOT = { ROOT = { has_character_flag = other_claim_tmp_flag } }
							FROM = {
								FROM = {
									top_liege = {
										ROOT = {
											top_liege = {
												NOT = {
													character = PREVPREV
												}
											}
										}
									}
								}
							}
						}
						ROOT = {
							set_defacto_liege = ROOT
						}
					}
					
					# If we have become independent from our mutual liege, restore that vassal tie
					if = {
						limit = {
							ROOT = { 
								has_character_flag = other_claim_tmp_flag 
								de_facto_liege = ROOT
							}
						}
						FROM = {
							FROM = {
								top_liege = {
									ROOT = { 
										set_defacto_liege = PREV
									}
								}
							}
						}
					}
				}
			}	
			hidden_tooltip = {		
				ROOT = { 
					clr_character_flag = other_claim_tmp_flag 
					clr_character_flag = claimant_is_vassal_ruler_flag 
					
					character_event = { id = maintenance.26 } #Vanilla bug resets laws, so fix empire tracker law and primogeniture
					character_event = { id = maintenance.23 } #Other Claim Mega War flag maintenance
					character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
				}
			}
		}
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		if = {
			limit = { title = e_iron_throne } #Lose crownlands
			hidden_tooltip = { holder_scope = { character_event = { id = maintenance.37 } } }
		}
		clear_event_target = old_usurped_title_holder
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
		}
		FROM = {
			FROM = {
				prestige = -100
			}
		}
		
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		prestige = -150
		transfer_scaled_wealth = {
			to = FROM
			value = 4.0
		}
		ROOT = {
			prestige = -150
			imprison = FROM
			clr_character_flag = captured_in_battle
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 150
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 150 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	on_reverse_demand_title = {
		remove_claim = ROOT
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			FROMFROM = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}
		modifier = {
			factor = 1.25
			holder_scope = { de_jure_liege_or_above = FROMFROM } 
		}
		modifier = {
			factor = 0
			ROOT = { NOT = { reverse_opinion = { who = FROMFROM value = -25 } } }
		}
		modifier = { #Must have some reason to do this
			factor = 0
			NOR = {
				holder_scope = { de_jure_liege_or_above = FROMFROM } #Title is in my dejure realm
				ROOT = { #Claimant...
					OR = {
						AND = { #Is my vassal
							is_ruler = yes
							is_liege_or_above = FROMFROM
						}
						AND = { #Is my dynasty whilst target isn't
							dynasty = FROMFROM
							NOT = { dynasty = FROM }
						}	
						AND = { #Is my relative whilst target isn't
							is_close_relative = FROMFROM
							NOT = { is_close_relative = FROM }
						}
						AND = { #Is my culture group whilst target isn't
							culture_group = FROMFROM
							NOT = { culture_group = FROM }
							FROM = { NOT = { culture = high_valyrian } }
						}
						AND = { #Is my religion whilst target isn't
							religion = FROMFROM
							NOT = { religion = FROM }
							FROMFROM = { trait = zealous }
						}
					}	
				}						
			}
		}		
	}	
}


claim_on_liege = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM_LIEGE
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	press_claim = yes
	can_call_vassals = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
			AND = {
				ROOT = { trait = nightswatch }
				FROM = { trait = nightswatch }
			}
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { 
			ROOT = { has_strong_claim = PREV }
			ROOT = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					is_pretender = yes # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					OR = {
						AND = {
							OR = {
								has_law = cognatic_succession
								has_law = agnatic_succession
							}
							ROOT = { is_female = no }
							holder_scope ={ is_female = yes }
						}
						AND = {
							OR = {
								has_law = enatic_succession
								has_law = enatic_cognatic_succession
							}
							ROOT = { is_female = yes }
							holder_scope ={ is_female = no }
						}
					}	
					is_contested = yes # Is already being contested in some form of Claim or Succession War
					holder_scope = { trait = bastard }
					holder_scope = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_suspected_bastard } }
				}
			}
		}
	}
	
	is_valid = {
	}

	is_valid_title = {
		NOT = { 
			holder_scope = { 
				character = ROOT 
			} 
		}
		
		ROOT = { NOT = { culture_group = unoccupied_group } }
		ROOT = { NOT = { culture_group = winter_group } }
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = {
			has_law = succ_feudal_elective
			ROOT = { has_claim = PREV }
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
			###If iron bank insurer take on debt
			if = {
				limit = {
					ROOT = { 
						has_character_flag = loan_insurer 
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_debt_insurer
						}
					}	
				}
				ROOT = { character_event = { id = bankruptcy.101 } }
			}
		} 
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
				opinion = {
					modifier = opinion_fought_for_claimant
					who = ROOT
				}
			}
		}
		
		FROM = {
			hidden_tooltip = { 
				disband_event_forces = faction_loyalists 
				change_variable = { which = fear_actions value = -20 }
			}			
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
		if = {
			limit = {
				ROOT = {
					prisoner = yes
					host = { character = FROM  }
				}
			}
			ROOT = { prisoner = no }
		}
	}
	
	on_success_title = {
		hidden_tooltip = {
			holder_scope = { save_event_target_as = old_usurped_title_holder }
			if = {
				limit = { higher_tier_than = DUKE }
				ROOT = {
					if = {
						limit = {
							has_nickname = no
							lower_tier_than = PREV
						}
						random = {
							chance = 20
							give_nickname = nick_the_usurper
						}
					}
				}
			}
			holder_scope = { character_event = { id = maintenance.22 days = 2 } }#Mega War flag maintenance
			if = { 	
				limit = {	
					holder_scope = { has_character_flag = post_civil_war_wars }
				}
				ROOT = { set_character_flag = post_civil_war_wars }
			}
			#If capital of a merchant republic move their capital to another coastal province if possible
			if = {
				limit = {
					FROM = { is_merchant_republic = yes }
					tier = COUNT
					location = { FROM = { capital_scope = { province_id = PREVPREV } } }
				}
				FROM = { character_event = { id = maintenance.27 } }
			}
		}
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
			hidden_tooltip = { #This stops wars to depose liege
				ROOT = {
					add_character_modifier = {
						name = installed_pretender
						duration = 10
						hidden = yes
					}
				}	
			}
		}
		if = { #Special gender change war
			limit = {
				tier = FROM
				ROOT = { has_character_flag = prefers_cognatic }
				FROM = { has_character_flag = prefers_agnatic }
			}
			custom_tooltip = { 
				text = TOOLTIPWARCOGNATIC 
				hidden_tooltip = { add_law_w_cooldown = true_cognatic_succession }
			}
			ROOT = {
				custom_tooltip = { 
					text = TOOLTIPPREFERSLAW
					hidden_tooltip = {
						set_dynasty_flag = prefers_cognatic 
						clr_dynasty_flag = prefers_agnatic 
					}
				}
			}
		}
		if = { #Special Nightswatch case
			limit = {
				ROOT = { trait = nightswatch }
				title = d_nightswatch
			}
			FROM = { abdicate_to = ROOT }
		}
		if = {
			limit = {
				OR = {
					ROOT = { NOT = { trait = nightswatch } }
					NOT = { title = d_nightswatch }
				}
				OR = {
					is_primary_holder_title = no
					FROM = { is_merchant_republic = no }
					ROOT = { is_patrician = no }
				}
			}
			usurp_title_plus_barony_if_unlanded_and_vassals_no_adj = { target = ROOT type = claim }
		}	
		if = { #If patrician enforcing claim on republic hold election in their favour
			limit = {
				is_primary_holder_title = yes
				FROM = { is_merchant_republic = yes }
				ROOT = { is_patrician = yes }
			}
			hidden_tooltip = { ROOT = { prestige = 75000 } } #make ROOT heir
			FROM = { character_event = { id = REP.903 tooltip = TOOLTIPREP.903 } }
		}
		hidden_tooltip = {		
			ROOT = {
				
				character_event = { id = maintenance.26 } #Vanilla bug resets laws, so fix empire tracker law and primogeniture
				character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
			}
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } } 
			}
		}
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		if = {
			limit = {
				higher_tier_than = FROM
			}
			
			FROM = {
				set_defacto_liege = ROOT
			}
		}
		
		if = {
			limit = {
				has_global_flag = conquest_of_dorne
				title = k_dorne
			}
			ROOT = { set_defacto_liege = ROOT }
			hidden_tooltip = { 
				set_variable = { which = "de_facto_empire" value = 0 }
				gender_succ = true_cognatic 
				any_attacker = {
					limit = { liege = { has_landed_title = e_iron_throne } }
					set_defacto_liege = ROOT
				}
				ROOT = { 
					add_character_modifier = {
						name = "indep_faction_won"
						duration = 20
					}
					any_realm_lord = {
						any_demesne_title = { 
							limit = { 
								NOT = { tier = BARON } 
								NOT = { tier = EMPEROR }
							}
							set_variable = { which = "de_facto_empire" value = 0 } 
						}
					}
				}
				remove_claim = FROM
			}
			ROOT = {
				hidden_tooltip = { activate_title = { status = yes title = e_dorne } }
				set_character_flag = changing_westerosi_kingdom_tier #to stop other maintenance triggering
				e_dorne = {
					gain_title = ROOT
					copy_title_laws = k_dorne
					ROOT = {
						if = {
							limit = { ai = no }
							chronicle = {
								entry = CHRONICLE_CREATE_KINGDOM
								picture = GFX_evt_coronation
							}	
						}
					}
				}
				custom_tooltip = {
					text = TOOLTIPcreate_e_dorne
					hidden_tooltip = {
						k_dorne = {
							destroy_landed_title = ROOT
							de_jure_liege = e_dorne
						}
						character_event = { id = diplomatic.50 days = 1 }
					}	
				}
				clr_character_flag = changing_westerosi_kingdom_tier
				# e_iron_throne = {
					# holder_scope = {
						# any_realm_lord = {	
							# limit = { 
								# capital_scope = { region = world_dorne } 
								# liege = { has_landed_title = e_iron_throne } # Only direct vassals of the LP join sides
								# NOT = { character = ROOT }
							# }
							# set_defacto_liege = ROOT
						# }
					# }
				# }
			}
			clr_global_flag = conquest_of_dorne
		}
		clear_event_target = old_usurped_title_holder
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}
	on_fail_title = { 
		if = {
			limit = {
				has_global_flag = conquest_of_dorne
				title = k_dorne
			}
			hidden_tooltip = { 
				any_attacker = {
					limit = { independent = yes }
					set_defacto_liege = FROM
				}
			}
			clr_global_flag = conquest_of_dorne
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		}  
		ROOT = {
			prestige = -150
			prisoner = FROM
		}
		
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 100		
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters		
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}
	
	on_reverse_demand_title = {
		if = { #Special gender change war
			limit = {
				tier = FROM
				ROOT = { has_character_flag = prefers_cognatic }
				FROM = { has_character_flag = prefers_agnatic }
			}		
			custom_tooltip = { 
				text = TOOLTIPWARAGNATIC 
				hidden_tooltip = { add_law_w_cooldown = agnatic_succession }
			}
			FROM = {
				custom_tooltip = { 
					text = TOOLTIPPREFERSLAW
					hidden_tooltip = {
						clr_dynasty_flag = prefers_cognatic 
						set_dynasty_flag = prefers_agnatic 
					}
				}
			}
		}
		if = {
			limit = {
				has_global_flag = conquest_of_dorne
				title = k_dorne
			}
			hidden_tooltip = { 
				any_attacker = {
					limit = { independent = yes }
					set_defacto_liege = FROM
				}
			}
			clr_global_flag = conquest_of_dorne
		}		
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		ROOT = {
			if = {
				limit = {
					has_character_flag = rebel_leader
				}
				e_iron_throne = {
					holder_scope = {
						character_event = { id = mega_wars.8 }
					}
				}
			}
			
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}


claim_on_liege_plot = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_CLAIM_LIEGE
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	press_claim = yes
	#major_revolt = yes
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0

	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	
	is_valid = {
	}

	is_valid_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			if = {
				limit = { 
					ROOT = { 
						trait = rebel_leader 
						NOT = { trait = civil_war }
					}
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
			###If iron bank insurer take on debt
			if = {
				limit = {
					ROOT = { 
						has_character_flag = loan_insurer 
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_debt_insurer
						}
					}	
				}
				ROOT = { character_event = { id = bankruptcy.101 } }
			}
		} 
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = {
			
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
	}
	
	on_success_title = {
		hidden_tooltip = {
			holder_scope = { 
				character_event = { id = maintenance.22 days = 2 } #Mega War flag maintenance
				save_event_target_as = old_usurped_title_holder
			}
			if = { 	
				limit = {	
					holder_scope = { has_character_flag = post_civil_war_wars }
				}
				ROOT = { set_character_flag = post_civil_war_wars }
			}
		}
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		hidden_tooltip = {
			ROOT = {
				
				character_event = { id = maintenance.26 } #Vanilla bug resets laws, so fix empire tracker law and primogeniture
				character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
				
			}
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } } 
			}
		}
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		ROOT = {
			plot_succeeds = yes
		}
		clear_event_target = old_usurped_title_holder
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -200
			imprison = FROM
			clr_character_flag = captured_in_battle
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }

		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		ROOT = {
			if = {
				limit = {
					has_character_flag = rebel_leader
				}
				e_iron_throne = {
					holder_scope = {
						character_event = { id = mega_wars.8 }
					}
				}
			}
			
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

claim_on_vassal_plot = {
	name = CB_NAME_CLAIM_VASSAL
	war_name = WAR_NAME_CLAIM_VASSAL
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes
	reflect_titleholder_change = no

	press_claim = yes
	attacker_can_call_allies = no
	can_attack_vassals = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0

	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				de_facto_liege = ROOT
			}
		}
	}

	is_valid_title = {
		FROM = {
			has_landed_title = PREV
		}
		ROOT = {
			OR = {
				has_plot = plot_gain_vassal_title
				has_plot = plot_weaken_lord_paramount
			}	
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
		
	on_invalidation = {
		ROOT = {
			cancel_plot = yes
		}	
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			###If iron bank insurer take on debt
			if = {
				limit = {
					ROOT = { 
						has_character_flag = loan_insurer 
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_debt_insurer
						}
					}	
				}
				ROOT = { character_event = { id = bankruptcy.101 } }
			}
		}  
		ROOT = {
			prestige = 50
		}
	}
	
	on_success_title = {
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
		if = {
			limit = { ROOT = { has_plot = plot_weaken_lord_paramount } }
			FROM = {
				custom_tooltip = {
					text = TOOLTIPplot_event.34 #revoke kingdoms until two left
					hidden_tooltip = {
						character_event = { id = plot_event.349 }	
					}	
				}
			}
		}
		FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
		ROOT = { plot_succeeds = yes }
	}

	on_fail = {
		ROOT = {
			prestige = -100
			hidden_tooltip = {
				cancel_plot = yes
			}	
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -200
			hidden_tooltip = {
				cancel_plot = yes
			}	
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}
		end_war = invalid
	}
	
		
	on_defender_leader_death = {
		ROOT = {
			hidden_tooltip = {
				cancel_plot = yes
			}	
		}
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
}

other_claim_on_liege = {
	name = CB_NAME_CLAIM
	war_name = WAR_NAME_OTHER_CLAIM
	sprite = 4
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = yes

	press_claim = yes
	can_call_vassals = no
	#major_revolt = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = PREV modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use = {
		ROOT = {
			OR = {			
				can_press_claims_trigger = yes
				trait = slave
			}
		}
		NOT = { trait = nightswatch } 
		#NOT = { trait = kingsguard } 
		NOT = { culture_group = unoccupied_group }
		NOT = { culture_group = winter_group }
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			trait = wildling
			FROM = { NOT = { trait = nightswatch } }
		}		
	}

	can_use_title = {
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}
		
		OR = {
			ROOT = { is_female = no }
			NOT = { has_law = agnatic_succession }
			AND = {
				lower_tier_than = KING
				is_primary_holder_title = no
			}
			FROMFROM = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
		}

		#OR = {
			FROM = {
				has_landed_title = PREV
			}
		#}
		
		OR = { 
			ROOT = { has_strong_claim = PREV }
			FROMFROM = { has_character_flag = faction_claimant_ultimatum_taken } # Faction war. Ignore claim strength.
			AND = {
				ROOT = { has_weak_claim = PREV }
				OR = {
					ROOT = { is_pretender = yes } # Checks vs ROOT character
					holder_scope = { has_regent = yes }
					OR = {
						AND = {
							OR = {
								has_law = cognatic_succession
								has_law = agnatic_succession
							}
							ROOT = { is_female = no }
							holder_scope ={ is_female = yes }
						}
						AND = {
							OR = {
								has_law = enatic_succession
								has_law = enatic_cognatic_succession
							}
							ROOT = { is_female = yes }
							holder_scope ={ is_female = no }
						}
					}	
					is_contested = yes # Is already being contested in some form of Claim or Succession War
					holder_scope = { trait = bastard }
					holder_scope = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_suspected_bastard } }
				}
			}
		}
	}

	is_valid = {
	}
			
	is_valid_title = {
		NOT = { 
			holder_scope = { 
				character = ROOT 
			} 
		}	
	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		
		OR = {
			has_law = succ_feudal_elective
			ROOT = { has_claim = PREV }
		}
	
		NOT = {
			any_war = { # when used in title scope, checks all wars for that title
				attacker = {
					character = ROOT
				}
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		clr_character_flag = external_claimant
		hidden_tooltip = { 
			add_character_modifier = { name = victory_timer duration = 3 } 
			if = {
				limit = { 
					trait = rebel_leader
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
		} 
		any_attacker = {
			limit = { 
				OR = {
					character = ROOT 
					character = PREV
				}
			}
			participation_scaled_prestige = 100
			hidden_tooltip = {  disband_event_forces = faction_revolters }
		}
		any_attacker = {
			limit = { 
				NOT = { character = ROOT } 
				NOT = { character = PREV }
			}
			hidden_tooltip = { 
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
		ROOT = {
			opinion = {
				modifier = pressed_my_claim 
				who = PREV
			}		
			hidden_tooltip = { #AGOT
				if = {
					limit = { trait = slave }
					character_event = { id = slavery.0 }
				}
				reverse_remove_opinion = {
					modifier = opinion_supported_claimant
					who = PREV
				}
			}
		}
		hidden_tooltip = {
			any_attacker = {
				opinion = {
					modifier = opinion_fought_for_claimant
					who = ROOT
				}
			}
		}	
		FROM = {
			hidden_tooltip = { 
				disband_event_forces = faction_loyalists 
				change_variable = { which = fear_actions value = -20 }
			}			
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
		}
		if = {
			limit = { #High Septon raises Faith Authority
				religion = the_seven
				has_landed_title = k_the_most_devout
			}
			FROM = {
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}	
		}
		
		if = {
			limit = {
				ROOT = {
					prisoner = yes
					host = { character = FROM  }
				}
			}
			ROOT = { prisoner = no }
		}
	}
	
	on_success_title = {
		hidden_tooltip = {
			holder_scope = { 
				save_event_target_as = old_usurped_title_holder
			}
			ROOT = { #If claimant is independent duke or king make sure to keep independence	
				if = {
					limit = { 			
						independent = yes
						primary_title = { 
							higher_tier_than = COUNT
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } } 
						}
					}
					set_character_flag = keep_claimant_independent
				}
			}	
			if = {
				limit = { higher_tier_than = DUKE }
				ROOT = {
					if = {
						limit = {
							has_nickname = no
							lower_tier_than = PREV
						}
						random = {
							chance = 20
							give_nickname = nick_the_usurper
						}
					}
				}
			}
			holder_scope = { character_event = { id = maintenance.22 days = 2 } }#Mega War flag maintenance
			if = { 	
				limit = {	
					holder_scope = { has_character_flag = post_civil_war_wars }
				}
				ROOT = { set_character_flag = post_civil_war_wars }
			}
			if = { 	
				limit = {	
					holder_scope = { 
						OR = {
							has_character_flag = supporting_king 
							has_character_flag = neutral 
							has_character_flag = against_king 
						}		
					}
					ROOT = { lower_tier_than = PREV }
				}
				ROOT = { set_character_flag = neutral }
			}
			
			#If capital of a merchant republic move their capital to another coastal province if possible
			if = {
				limit = {
					FROM = { is_merchant_republic = yes }
					tier = COUNT
					location = { FROM = { capital_scope = { province_id = PREVPREV } } }
				}
				FROM = { character_event = { id = maintenance.27 } }
			}
		}
		if = {
			limit = {
				is_primary_holder_title = yes
			}
			hidden_tooltip = {
				FROM = { set_character_flag = temp_other_claim_on_liege_prison }
				hidden_tooltip = { #This stops wars to depose liege
					ROOT = {
						add_character_modifier = {
							name = installed_pretender
							duration = 10
							hidden = yes
						}
					}	
				}
			}
		}
		
		# If the claimant has the wrong government type, take care of that first.
		if = {
			limit = {
				higher_tier_than = ROOT
				holder_scope = {
					is_feudal = yes
				}
				ROOT = {
					is_ruler = yes
					OR = {
						is_theocracy = yes
						is_republic = yes
					}
				}
			}
			ROOT = { 
				hidden_tooltip = { #Universal on death/abdication event
					if = {
						limit = { has_character_modifier = owns_valyrian_steel_sword }
						set_character_flag = do_not_inherit_sword
					}
					set_character_flag = abdication
					character_event = { id = 45341 } 
					clr_character_flag = abdication
					clr_character_flag = do_not_inherit_sword
					if = {
						limit = { is_merchant_republic = no }
						transfer_wealth_to_heir_effect = yes
					}
				}
				abdicate = yes 
			}
		}
		tooltip = { usurp_title = ROOT }
		hidden_tooltip = { 
			if = { #Don't want ousted person to steal a vassal's title
				limit = {
					holder_scope = { 
						NOT = { demesne_size = 2 } 
						OR = {	#pretender is... 						
							ROOT = { NOT = { demesne_size = 1 } } #unlanded	
							AND =  { #small baron
								ROOT = { tier = BARON }
								PREV = { higher_tier_than = COUNT }
							}
							capital_scope = { county = { ROOT = { has_claim = PREV } } } #has claim on capital
						}
						OR = { #Must be related in some way
							dynasty = ROOT
							is_close_relative = ROOT
							capital_scope = { county = { ROOT = { has_claim = PREV } } }
						}
					}					
				}
				holder_scope = {
					ROOT = { set_character_flag = abdication_usurp }
					abdicate_to = ROOT								
				}
				add_pressed_claim = event_target:old_usurped_title_holder	
				event_target:old_usurped_title_holder = {
					opinion = { who = ROOT modifier = opinion_usurped_title }
				}
			}
			if = { 
				limit = {
					ROOT = { NOT = { has_character_flag = abdication_usurp } }
				}
				if = { #If patrician enforcing claim on republic hold election in their favour
					limit = {
						is_primary_holder_title = yes
						FROM = { is_merchant_republic = yes }
						ROOT = { 
							is_patrician = yes
							liege = { character = FROM }
						}
					}
					ROOT = { set_character_flag = patrician_usurp }
					hidden_tooltip = { ROOT = { prestige = 75000 } } #make ROOT heir
					FROM = { character_event = { id = REP.903 tooltip = TOOLTIPREP.903 } }
				}
				if = {
					limit = {
						ROOT = { NOT = { has_character_flag = patrician_usurp } }
					}			
					usurp_title_plus_barony_if_unlanded_and_vassals_no_adj = { target = ROOT type = claim }	
				}				
			}	
			ROOT =  { 
				clr_character_flag = abdication_usurp 
				clr_character_flag = patrician_usurp 
			}
		}
		
		hidden_tooltip = {
			ROOT = {
				
				character_event = { id = maintenance.26 } #Vanilla bug resets laws, so fix empire tracker law and primogeniture
				character_event = { id = maintenance.21 } #Take dejure vassals (AGOT)
			}
			if = {
				limit = { title = e_iron_throne } #Lose crownlands
				holder_scope = { character_event = { id = maintenance.37 } } 
			}
		}
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}	
		hidden_tooltip = {
			# If claimant needs a regent, war leader becomes regent if possible
			if = {
				limit = {
					ROOT = {
						OR = {
							has_regent = yes
							is_adult = no
							is_incapable = yes
							prisoner = yes
						}
						is_liege_of = FROMFROM
					}			
				}
				FROMFROM = { character_event = { id = regency.55 days = 2 } }
			}
			if = {
				limit = { ###If iron bank insurer take on debt
					ROOT = { 
						has_character_flag = loan_insurer 
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_debt_insurer
						}
					}	
				}
				ROOT = { character_event = { id = bankruptcy.101 } }
			}
			if = {
				limit = { #Maybe give 'Kingmaker' nickname
					FROMFROM = { has_nickname = no }
					holder_scope = { 
						is_feudal = yes 
						is_female = no
						NOT = { culture = dothraki}
						NOT = { culture = jogos_nhai }
					}
					OR = {
						AND = {
							tier = EMPEROR
							OR = {
								capital_scope = { region = world_westeros }
								title = e_iron_isles #These titles dont have capitals
								title = e_riverlands
								holder_scope = {
									OR = {
										culture_group = andal
										culture_group = dornish
										culture_group = first_men
										culture_group = free_folk
										culture = ironborn
									}
								}
							}
						}
						AND = {
							tier = KING
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
					}
				}
				FROMFROM = {
					random = {
						chance = 20
						give_nickname = nick_the_kingmaker
					}
				}
			}
		}
		clear_event_target = old_usurped_title_holder		
	}

	on_success_posttitle = {
		hidden_tooltip = {
			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = PREV
				}
			}

			if = {
				limit = {
					top_liege = {
						ROOT = {
							NOT = {
								top_liege = {
									character = PREVPREV
								}
							}
						}
					}
				}

				ROOT = {
					set_defacto_liege = ROOT
				}
			}
			
			if = {
				limit = {
					FROM = { 
						has_character_flag = temp_other_claim_on_liege_prison 
						lower_tier_than = PREV
					}
				}
				FROM = { 
					imprison = ROOT
					clr_character_flag = captured_in_battle
				}
			}
			FROM = { clr_character_flag = temp_other_claim_on_liege_prison }
			ROOT = { character_event = { id = maintenance.23 } } #Other Claim Mega War flag maintenance
		}
	}

	on_fail = {
		prestige = -100
		clr_character_flag = external_claimant
		if = {
			limit = {
				OR = {
					is_liege_of = ROOT
					ROOT = { is_liege_or_above = FROM }
				}
			}
			ROOT = {
				hidden_tooltip = { #AGOT
					reverse_remove_opinion = {
						modifier = opinion_supported_claimant
						who = PREV
					}
				}
			}
		}
		
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		prestige = -200
		imprison = FROM
		clr_character_flag = captured_in_battle
		clr_character_flag = external_claimant
		if = {
			limit = {
				OR = {
					is_liege_of = ROOT
					ROOT = { is_liege_or_above = FROM }
				}
			}
			ROOT = {
				#imprison = FROM
				hidden_tooltip = { #AGOT
					reverse_remove_opinion = {
						modifier = opinion_supported_claimant
						who = PREV
					}
				}
			}
		}
		
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				disband_event_forces = faction_revolters
				prisoner = FROM
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}


claim_all = {
	name = CB_NAME_CLAIM_ALL
	war_name = WAR_NAME_CLAIM_ALL
	sprite = 5
	truce_days = 3650
	is_permanent = yes
	can_ask_to_join_war = no
	is_claim_all = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = kingsguard }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
		NAND = { #known to cause crashes
			ROOT = { is_nomadic = yes }
			FROM = { 
				has_landed_title = c_dosh_khaleen 
				trait = dosh_khaleen
			}
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		ROOT = {
			total_claims = {
				who = FROM
				strong = yes # Count only strong claims
				value = 2
			}
			#use vengeance CB instead
			NOR = { 
				has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
				has_opinion_modifier = { who = FROM modifier = opinion_blood_feud }
			}
			NOT = {
				FROM = {
					is_allowed_to_loot = yes
					NOT = { trait = pirate } #seperate CB
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_looted }
				}
			}	
		}
	}

	is_valid = {
		ROOT = {
			total_claims = {
				who = FROM
				strong = yes # Count only strong claims
				value = 1 # must have at least one claim left
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	on_add = {
		ROOT = {
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				press_claim = ROOT
			}
		}
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ALL_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ALL_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ALL_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CLAIM_ALL_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }  
		hidden_tooltip = {
			FROM = { character_event = { id = maintenance.22 days = 2 } }#Mega War flag maintenance
			if = { 
				limit = {
					ROOT = {
						any_claim = {
							tier = KING
							holder_scope = {
								OR = {
									character = FROM
									is_liege_or_above = FROM
								}
							}
						}
					}
				}
				ROOT = {
					set_character_flag = kingdom_changed_hands
				}
			}
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
			###If iron bank insurer take on debt
			if = {
				limit = {
					ROOT = { 
						has_character_flag = loan_insurer 
						has_opinion_modifier = {
							who = FROM
							modifier = opinion_debt_insurer
						}
					}	
				}
				ROOT = { character_event = { id = bankruptcy.101 } }
			}
		}
		ROOT = {
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
				if = {
					limit = {
						higher_tier_than = BARON
						NOT = { culture = ROOT }
					}
					hidden_tooltip = { conquest_culture = ROOT }
				}
				if = {
					limit = { title = e_iron_throne } #Lose crownlands
					hidden_tooltip = { holder_scope = { character_event = { id = maintenance.37 } } }
				}
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -150
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 75
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 75 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			any_claim = {
				limit = {
					holder_scope = {
						OR = {
							character = FROM
							is_liege_or_above = FROM
						}
					}
					ROOT = { has_strong_claim = PREV }
				}
				remove_claim = ROOT
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1.2 #Use before single claim wars
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
		modifier = { #Should prefer Bloody Vengeance if possible
			factor = 0.1
			ROOT = {
				OR = {
					has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
					has_opinion_modifier = { who = FROM modifier = opinion_blood_feud }
					has_opinion_modifier = { who = FROM modifier = opinion_burned_closed_relative }
				}	
			}
		}
	}
}


change_seniority_succession_law = {
	name = CB_NAME_SENIORITY_SUCCESSION_LAW
	war_name = WAR_NAME_SENIORITY_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}
	
	is_valid = {
	}

	is_valid_title = {
		NOT = {
			has_law = succ_seniority
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}			
		} 
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			change_variable = { which = fear_actions value = -20 }
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_SENIORITY_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_SENIORITY_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_SENIORITY_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_SENIORITY_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success_title = {
		succession_w_cooldown = seniority
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture_group = andal
						culture_group = first_men
						culture = stone_dornish
					}
				}
			}	
			gender_succ = cognatic
		}
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture_group = iron_isles_culture
						culture = eastern_valyrian
						culture = mantaryan
						culture = tolosi
						culture = elyrian
					}
				}
			}	
			gender_succ = agnatic
		}
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture = salt_dornish
						culture = sand_dornish
						culture = rhoynar
					}
				}
			}	
			gender_succ = true_cognatic
		}
		if = {
			limit = { 
				ROOT = {
					culture = lengi
				}
			}	
			gender_succ = enatic_cognatic
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_seniority_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_seniority_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}


change_primogeniture_succession_law = {
	name = CB_NAME_PRIMOGENITURE_SUCCESSION_LAW
	war_name = WAR_NAME_PRIOGENITURE_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}
	
	is_valid = {
	}
		
	is_valid_title = {
		NOT = {
			has_law = succ_primogeniture
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_PRIMOGENITURE_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_PRIMOGENITURE_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_PRIMOGENITURE_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_PRIMOGENITURE_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}			
		}
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			change_variable = { which = fear_actions value = -20 }
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
	}

	on_success_title = {
		succession_w_cooldown = primogeniture
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture_group = andal
						culture_group = first_men
						culture = stone_dornish
					}
				}
			}	
			gender_succ = cognatic
		}
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture_group = iron_isles_culture
						culture = eastern_valyrian
						culture = mantaryan
						culture = tolosi
						culture = elyrian
					}
				}
			}	
			gender_succ = agnatic
		}
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture = salt_dornish
						culture = sand_dornish
						culture = rhoynar
					}
				}
			}	
			gender_succ = true_cognatic
		}
		if = {
			limit = { 
				ROOT = {
					culture = lengi
				}
			}	
			gender_succ = enatic_cognatic
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_primogeniture_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_primogeniture_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

change_feudal_elective_succession_law = {
	name = CB_NAME_FEUDAL_ELECTIVE_SUCCESSION_LAW
	war_name = WAR_NAME_FEUDAL_ELECTIVE_SUCCESSION_LAW
	sprite = 6
	truce_days = 3650
	attacker_can_call_allies = no
	can_ask_to_join_war = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM	
		}
	}

	is_valid = {
	}

	is_valid_title = {
		NOT = {
			has_law = succ_feudal_elective
		}
		OR = {
			tier = emperor
			tier = king
			is_primary_holder_title = yes
		}

#		OR = {
#			AND = {
#				tier = emperor
#				OR = {
#					ROOT = { tier = king }
#					ROOT = { tier = duke }
#				}
#			}
#			AND = {
#				tier = king
#				ROOT = { tier = duke }
#			}
#			AND = {
#				tier = duke
#				ROOT = { tier = count }
#			}
#		}

	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_FEUDAL_ELECTIVE_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_FEUDAL_ELECTIVE_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_FEUDAL_ELECTIVE_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_FEUDAL_ELECTIVE_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
		}
		FROM = {
		
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			change_variable = { which = fear_actions value = -20 }
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				disband_event_forces = faction_revolters
			}
		}
	}
	
	on_success_title = {
		succession_w_cooldown = feudal_elective
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture_group = andal
						culture_group = first_men
						culture = stone_dornish
					}
				}
			}	
			gender_succ = cognatic
		}
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture_group = iron_isles_culture
						culture = eastern_valyrian
						culture = mantaryan
						culture = tolosi
						culture = elyrian
					}
				}
			}	
			gender_succ = agnatic
		}
		if = {
			limit = { 
				ROOT = {
					OR = {
						culture = salt_dornish
						culture = sand_dornish
						culture = rhoynar
					}
				}
			}	
			gender_succ = true_cognatic
		}
		if = {
			limit = { 
				ROOT = {
					culture = lengi
				}
			}	
			gender_succ = enatic_cognatic
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_feudal_elective_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}
	
	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_succ_feudal_elective_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}


invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 7
	truce_days = 3650
	hostile_against_others = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = 200
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = FROM	
				if = {
					limit = { 
						NOT = { trait = deserter }
						has_nickname = no						
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_victorious }
						10 = { give_nickname = nick_the_bold }
						10 = { give_nickname = nick_the_conqueror }
					}
				}	
			}
		}
		
		FROM = {
			prestige = -200
		}
	}

	on_success_title = {	
		hidden_tooltip = {
			holder_scope = { character_event = { id = maintenance.22 days = 2 } }#Mega War flag maintenance
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
		}
		custom_tooltip = {
			text = invasion_succ_tip
			hidden_tooltip = {
				usurp_title_plus_barony_if_unlanded = { target = ROOT type = claim }
				FROM = { 
					if = {
						limit = { lower_tier_than = ROOT is_ruler = yes }
						set_defacto_liege = ROOT 
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
				if = {
					limit = {
						FROM = { is_liege_or_above = ROOT }
					}
					FROM = { imprison = ROOT clr_character_flag = captured_in_battle }
				}
			}
		}
		
		if = {
			limit = {
				higher_tier_than = BARON
				NOT = { culture = ROOT }
			}
			hidden_tooltip = { conquest_culture = ROOT }
		}
		if = {
			limit = { title = e_iron_throne } #Lose crownlands
			hidden_tooltip = { holder_scope = { character_event = { id = maintenance.37 } } }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -200
			hidden_tooltip = { disband_event_forces = summer_islanders }
		}
		FROM = {
			prestige = 100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			if = {
				limit = { NOT = { has_character_flag = summer_islander_invader } }
				transfer_scaled_wealth = {
					to = FROM
					value = 8.0
				}
			}	
			if = {
				limit = { has_character_flag = summer_islander_invader } 
				hidden_tooltip  = { wealth = -250 }
				FROM = { wealth = 250 }
				clr_character_flag = summer_islander_invader
			}	
			hidden_tooltip = { disband_event_forces = summer_islanders }
		}
		FROM = {
			prestige = 200
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	on_reverse_demand_title = {
		remove_claim = ROOT
	}

	on_attacker_leader_death = {
		hidden_tooltip = {
			any_defender = {
				letter_event = {
					id = 251
				}
			}
		}

		end_war = whitepeace
	}

	attacker_ai_victory_worth = {
		factor = 150
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}


tribal_invasion = {
	name = CB_NAME_INVASION
	war_name = WAR_NAME_INVASION
	sprite = 8
	truce_days = 3650
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0

	can_use_gui = {
		ROOT = {
			prestige = 500
		}
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}
	
	can_use_title = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}	
		ROOT = {
			OR = {
				AND = {
					independent = yes
					#OR = {
						#religion_group = pagan_group
						#AND = {
							OR = {
								has_horde_culture = yes
								has_character_flag = horde_invader
								culture = moon_clansman
							}
							#NOT = { religion_group = christian }
						#}
					#}
					#OR = {
						#culture_group = altaic
						#culture_group = magyar
					#}
					higher_tier_than = COUNT
					#OR = {
						#has_horde_culture = yes
						#has_character_flag = horde_invader
						#FROM = {
							#NOT = { religion_group = pagan_group } # Should subjugate these instead
						#}
					#}
				}
				
				AND = {
					mercenary = yes
					NOT = {
						num_of_titles = 2
					}
				}
			}
		}
		
		ROOT = {
			NOT = { same_realm = FROM }
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}
	
	on_add = {
		ROOT = { prestige = -500 }
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = 200
			if = {
				limit = { 
					has_landed_title = k_mountain_clans
					has_character_flag = moon_clansman_invader
				}
				clr_character_flag = moon_clansman_invader
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 200
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
		FROM = {
			prestige = -200
		}
		hidden_tooltip = {
			ROOT = {
				occupy_minors_of_occupied_settlements = FROM
				gain_all_occupied_titles = { who = FROM type = invasion }
				
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_victorious }
						10 = { give_nickname = nick_the_conqueror }
						10 = { give_nickname = nick_the_brave }
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_terrible }
					}
				}
			}
		}
	}
	
	on_success_title = {
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title_destroy_duchies = {
						title = PREV
						enemy = FROM
						is_crusade = yes # Even if the title holder is not participating in the war, gain holdings occupied by all Crusade participants
						type = invasion
					}
				}
				FROM = {
					if = {
						limit = { lower_tier_than = ROOT is_ruler = yes }
						set_defacto_liege = ROOT 
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
				if = {
					limit = {
						e_mexikha = {
							holder = ROOT
						}
					}
					ROOT = {
						any_realm_province = {
							limit = {
								OR = {
									has_province_flag = aztec_explorers
									has_province_flag = aztec_second_wave
								}
							}
							religion = aztec
							clr_province_flag = aztec_explorers
							clr_province_flag = aztec_second_wave
						}
					}
				}
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
						
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		ROOT = {
			prestige = -200
			if = {
				limit = { 
					has_landed_title = k_mountain_clans
					has_character_flag = moon_clansman_invader
				}
				clr_character_flag = moon_clansman_invader
				hidden_tooltip = { activate_title = { status = no title = k_mountain_clans } }
				k_mountain_clans = { 
					destroy_landed_title = ROOT 
				}
				hidden_tooltip = { disband_event_forces = clansmen_troops }
			}
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			if = {
				limit = { 
					has_landed_title = k_mountain_clans
					has_character_flag = moon_clansman_invader
				}
				clr_character_flag = moon_clansman_invader
				k_mountain_clans = { destroy_landed_title = ROOT }
				hidden_tooltip = { disband_event_forces = clansmen_troops }
			}
		}
		FROM = {
			prestige = 200
			
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_great }
						10 = { give_nickname = nick_the_hammer }
						10 = { give_nickname = nick_the_avenger }
						10 = { give_nickname = nick_the_lion }
						10 = { give_nickname = nick_the_bold }
					}
				}
			}			
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 200
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 200 }
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		
		modifier = {
			factor = 0.9 # Prefer using CB's without on_add costs
		}
		
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

# crusade = {
# }
	
# religious = {
# }

excommunicated_ruler = {
	name = CB_NAME_EXCOMMUNICATED_RULER
	war_name = WAR_NAME_EXCOMMUNICATED_RULER
	sprite = 11
	truce_days = 3650
	
	is_permanent = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = kingsguard }
		}
		ROOT = {
			religion = the_seven
			crownlaw_title = { has_law = investiture_law_3 }
		}
		FROM = {
			excommunicated_for = ROOT
			religion = the_seven
			in_revolt = no
			NOT = { 
				any_current_enemy = {
					NOT = {
						religion_group = ROOT
					}
				}
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}
	}

	is_valid = {
		FROM = {
			excommunicated_for = ROOT
		}
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_EXCOMMUNICATION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_EXCOMMUNICATION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_EXCOMMUNICATION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_EXCOMMUNICATION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		ROOT = {
			if = {
				limit = {
					FROM = {
						primary_title = {
							tier = BARON
						}
					}
				}
				ROOT = {
					piety = 10
					prestige = 50
				}
			}
			if = {
				limit = {
					FROM = {
						primary_title = {
							tier = COUNT
						}
					}
				}
				ROOT = {
					piety = 20
					prestige = 100
				}
			}
			if = {
				limit = {
					FROM = {
						primary_title = {
							tier = DUKE
						}
					}
				}
				ROOT = {
					piety = 30
					prestige = 150
				}
			}
			if = {
				limit = {
					FROM = {
						primary_title = {
							tier = KING
						}
					}
				}
				ROOT = {
					piety = 50
					prestige = 200
				}
			}
			if = {
				limit = {
					FROM = {
						primary_title = {
							tier = EMPEROR
						}
					}
				}
				ROOT = {
					piety = 70
					prestige = 400
				}
			}
		}

		FROM = {
			excommunicate = no
			prestige = -200
			rightful_religious_head_scope = {
				opinion = {
					who = PREV
					modifier = opinion_repented_sins
				}
			}
			hidden_tooltip = { #Universal on death/abdication event
				if = {
					limit = { has_character_modifier = owns_valyrian_steel_sword }
					set_character_flag = do_not_inherit_sword
				}
				set_character_flag = abdication
				character_event = { id = 45341 } 
				clr_character_flag = abdication
				clr_character_flag = do_not_inherit_sword
				if = {
					limit = { is_merchant_republic = no }
					transfer_wealth_to_heir_effect = yes
				}
			}
			abdicate = yes
		}
	}

	on_fail = {
		ROOT = {
			piety = -50
			prestige = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			piety = -100
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		FROM = {
			prestige = 200
		}
	}


	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

bid_for_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_INDEPENDENCE
	sprite = 12
	truce_days = 3650
	
	is_permanent = yes
	is_independence = yes

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
		custom_tooltip = {
			text = TOOLTIPJOGOSWARPROHIBITION
			hidden_tooltip = {
				OR = {
					NAND = { #jogos nhai do not make war on eachother
						ROOT = { religion = jogos_pagan }
						FROM = { religion = jogos_pagan }
					}
					ROOT = { has_character_flag = refused_nomad_absorption }
				}	
			}
		}
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			OR = {
				NOT = { is_nomadic = yes }
				NOT = {
					clan_opinion = { who = FROM value = 0 }
				}
				has_character_flag = refused_nomad_absorption
			}
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			de_facto_liege = FROM
			
			higher_tier_than = BARON
			OR = {
				ai = yes
				is_feudal = yes
				is_tribal = yes
				higher_tier_than = COUNT
			}
		}
		NOT = {
			FROM = { 
				liege = {
					NOT = { character = PREV }
					OR = {
						is_primary_war_attacker = yes
						is_primary_war_defender = yes
					}
				}
			}
		}	
		
		FROM = {
			NOT = {
				any_war = {
					attacker = {
						character = PREVPREV
					}
					OR = {
						using_cb = bid_for_independence
						using_cb = depose_liege
					}
				}
			}
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
				has_character_flag = post_civil_war_indep_war
			}
			NOT = { has_character_flag = end_indep_wars }
		}
		OR = {
			FROM = {
				any_demesne_title = {
					NOT = { lower_tier_than = ROOT }
					temporary = no
				}
			}
			AND = { 	
				FROM = { tier = EMPEROR }
				ROOT = { tier = EMPEROR }
			}
		}
	}
	
	on_add = {
		ROOT = {
			add_character_modifier = {
				name = "indep_war"
				duration = 100
			}
		}
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			# if = {
				# limit = { 
					# ROOT = { trait = rebel_leader }
					# FROM = { 
						# tier = EMPEROR
						# trait = civil_war	
					# }
				# }
				# any_defender = {
					# character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				# }
				# FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			# }			
		}
		if = {
			limit = {
				FROM = {
					independent = no
				}
			}
			FROM = {
				if = {
					limit = {
						in_revolt = yes
					}
					liege_before_war = {
						ROOT = {
							set_defacto_liege = PREV
						}
						if = {
							limit = { NOT = { tier = EMPEROR } }
							hidden_tooltip = { 
								ROOT = {
									any_demesne_title = { 
										limit = { 
											NOT = { tier = BARON } 
											NOT = { tier = EMPEROR }
										}
										set_variable = { which = "de_facto_empire" value = 0 } 
									}
									any_realm_lord = { 
										any_demesne_title = { 
											limit = { 
												NOT = { tier = BARON } 
												NOT = { tier = EMPEROR }
											}
											set_variable = { which = "de_facto_empire" value = 0 } 
										}
									}
								}	
							}
						}
					}
				}
				if = {
					limit = {
						in_revolt = no
					}
					liege = {
						ROOT = {
							set_defacto_liege = PREV
						}
						if = {
							limit = { NOT = { tier = EMPEROR } }
							hidden_tooltip = { 
								ROOT = {
									any_demesne_title = { 
										limit = { 
											NOT = { tier = BARON } 
											NOT = { tier = EMPEROR }
										}
										set_variable = { which = "de_facto_empire" value = 0 } 
									}
									any_realm_lord = { 
										any_demesne_title = { 
											limit = { 
												NOT = { tier = BARON } 
												NOT = { tier = EMPEROR }
											}
											set_variable = { which = "de_facto_empire" value = 0 } 
										}
									}
								}	
							}
						}
					}
				}
			}
		}

		if = {
			limit = {
				FROM = {
					independent = yes
				}
			}
			ROOT = {
				set_defacto_liege = ROOT	
				if = {
					limit = { 
						has_character_flag = post_civil_war_indep_war 
						lower_tier_than = KING
					}
					character_event = { id = mega_wars.51 tooltip = EVTTOOLTIPmega_wars.51 }
				}
			}
		}

		ROOT = {
			#prestige = 100
			any_demesne_title = {
				limit = {
					tier = ROOT
					controls_religion = no
					NOT = { 
						dejure_liege_title = { 
							OR = {
								FROM = { has_landed_title = PREV } 
								dejure_liege_title = {
									OR = {
										FROM = { has_landed_title = PREV } 
										dejure_liege_title = { FROM = { has_landed_title = PREV } }
									}	
								}
							}	
						}	
					}
				}
				add_weak_pressed_claim = FROM	
			}
			hidden_tooltip = {
				character_event = { id = mega_wars.50 } #Character wins indep war maintenance
				add_character_modifier = {
					name = "indep_faction_won"
					duration = 20
				}
			}
		}
			
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				if = {
					limit = {
						FROM = { tier = EMPEROR }
						OR = {
							liege_before_war = { character = FROM }
							is_liege_or_above = FROM
							primary_title = {
								FROM = {
									primary_title = {
										is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
									}
								}
							}
						}
					}
					character_event = { id = mega_wars.53 days = 1 }
				}	
			}
		}

		FROM = {
			change_variable = { which = fear_actions value = -20 }
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
	}

	on_fail = {
		ROOT = {
			#prestige = -100
			clr_character_flag = post_civil_war_indep_war
			clr_character_flag = indep_war
		}
		ROOT = {
			if = { 	limit = { has_landed_title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_riverlands }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
			}
			hidden_tooltip = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = {
					limit = {
						higher_tier_than = KING
					}

					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}	
				set_defacto_liege = FROM
				hidden_tooltip = { character_event = { id = maintenance.24 } } #Mega war flag maintenance 
			}	
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = -50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			#prestige = -100
			clr_character_flag = post_civil_war_indep_war
			clr_character_flag = indep_war
			if = {
				limit = { 
					is_nomadic = yes
					FROM = { is_nomadic = yes }
					has_character_flag = refused_nomad_absorption 
				}
				clr_character_flag = refused_nomad_absorption 
				hidden_tooltip = {
					any_demesne_title = {
						limit = { 
							tier = KING
							holder_scope = { clan_title = { title = PREVPREV } }							
						}
						destroy_landed_title = THIS
					}
				}
				any_demesne_title = {
					limit = { NOT = { holder_scope = { clan_title = { title = PREVPREV } } } }
					usurp_title = FROM
				}			
			}
		}
		ROOT = {
			if = { 	limit = { has_landed_title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_riverlands }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
			}
			hidden_tooltip = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = {
					limit = {
						higher_tier_than = KING
					}

					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}	
				set_defacto_liege = FROM
				hidden_tooltip = { character_event = { id = maintenance.24 } } #Mega war flag maintenance 
			}	
		}
		ROOT = { imprison = FROM clr_character_flag = captured_in_battle }
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = -100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = -100 }
		}
		FROM = {
			prestige = 50
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	on_attacker_leader_death = {
		if = {
			limit = {
				ROOT = { current_heir = { character = FROM } }
			}
			any_defender = {
				letter_event = {
					id = 251
				}
			}
			ROOT = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = {
					limit = {
						higher_tier_than = KING
					}

					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}	
				if = {
					limit = {
						has_character_flag = rebel_leader
					}
					e_iron_throne = {
						holder_scope = {
							character_event = { id = mega_wars.8 }
						}
					}
				}
			}	
			end_war = invalid			
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

depose_liege = {
	name = CB_NAME_DEPOSE_LIEGE
	war_name = WAR_NAME_DEPOSE_LIEGE
	sprite = 12
	truce_days = 3650
	
	is_permanent = yes
	can_call_vassals = no
	major_revolt = no

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
		custom_tooltip = {
			text = TOOLTIPJOGOSWARPROHIBITION
			hidden_tooltip = {
				NAND = { #jogos nhai do not make war on eachother
					ROOT = { religion = jogos_pagan }
					FROM = { religion = jogos_pagan }
				}
			}
		}
		FROM = { 
			is_feudal = yes 
			custom_tooltip = {
				text = TOOLTIPdepose_liegeWAR
				hidden_tooltip = {
					NOT = {
						any_war = {
							OR = {
								AND = { # Cannot depose liege when our liege is currently involved in such a war
									attacker = {
										character = PREVPREV
									}
									OR = {
										using_cb = bid_for_independence
										using_cb = depose_liege
									}
								}
								AND = { # Cannot depose liege if someone else is already deposing liege
									defender = {
										character = PREVPREV
									}
									using_cb = depose_liege
								}
							}
						}
					}
				}
			}	
			custom_tooltip = {
				text = TOOLTIPdepose_liegeWARB
				hidden_tooltip = {
					NOT = {
						liege = {
							NOT = { character = PREV }
							OR = {
								is_primary_war_attacker = yes
								is_primary_war_defender = yes
							}
						}
					}
				}
			}	
		}
	}

	can_use = {
		ROOT = { 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
			NOT = { trait = kingsguard }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			de_facto_liege = FROM
		}	
	}

	is_valid = {
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			NOT = { has_character_modifier = installed_pretender } #No longer valid if actual target was replaced by a pretender
		}
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
		FROM = { set_character_flag = depose_liege_target } #Mark initial target
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			prestige = -500
			change_variable = { which = fear_actions value = -20 }
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
			if = { #Night's watch versus Night's king, dethrone
				limit = { 
					ROOT = { trait = nightswatch }
					has_landed_title = k_nightswatch 
				}
				k_nightswatch = { destroy_landed_title = THIS }
				if = {
					limit = { has_landed_title = d_nightswatch }
					d_nightswatch = {
						succession = open_elective
						gender_succ = agnatic 
						holder_scope = { 
							recalc_succession = yes 
							set_government_type = NW_government
							set_global_flag = new_NW_LC_needed
						}
					}
				}	
			}
		}
		ROOT = {
			if = {
				limit = {					
					has_landed_title = d_brotherhood
					d_brotherhood = { has_title_flag = brotherhood_rebellion }
				}				
				if = {
					limit = { character = 1059 } #Stoneheart
					k_riverlands = {
						if = {
							limit = { holder_scope = { dynasty = 127 } } #Frey
							usurp_title = ROOT
						}
						any_de_jure_vassal_title = {
							limit = {
								holder_scope = { dynasty = 127 }
								NOT = { title = d_thecrossing }
								NOT = { location = { duchy = { title = d_thecrossing } } }
							}
							usurp_title = ROOT
						}
					}
				}
				e_iron_throne = { holder_scope = { ROOT = { set_defacto_liege = PREV } } }
				d_brotherhood = { clr_title_flag = brotherhood_rebellion }
			}
			if = { #Leader choose outcome (abdicate, usurp etc)	
				limit = { 
					OR = {					
						NOT = { has_landed_title = k_the_most_devout } 
						ROOT_FROM = { is_merchant_republic = yes }
					}	
				}
				ROOT_FROM = {
					save_event_target_as = depose_liege_target
					ROOT = { character_event = { id = 45370 tooltip = TOOLTIP45370 } }
				}	
			}			
			if = { #High Septon can choose successor
				limit = { 
					has_landed_title = k_the_most_devout 
					ROOT_FROM = { is_merchant_republic = no }
				}
				character_event = { id = religious.22 tooltip = TOOLTIPreligious.22 } 	
				hidden_tooltip = { character_event = { id = maintenance.21 days = 1 } } #Take dejure vassals (AGOT)
			}
			hidden_tooltip = {
				# If claimant needs a regent, war leader becomes regent if possible
				character_event = { id = regency.55 days = 2 }
			}
		}	
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
			if = {
				limit = {					
					has_landed_title = d_brotherhood
					d_brotherhood = { has_title_flag = brotherhood_rebellion }
				}				
				e_iron_throne = { holder_scope = { ROOT = { set_defacto_liege = PREV } } }
				d_brotherhood = { clr_title_flag = brotherhood_rebellion }
			}
		}
		FROM = { clr_character_flag = depose_liege_target }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
			if = {
				limit = {					
					has_landed_title = d_brotherhood
					d_brotherhood = { has_title_flag = brotherhood_rebellion }
				}				
				hidden_tooltip = {
					any_courtier = {
						limit = {
							prisoner = no
							is_abroad = no
						}
						imprison = FROM
						clr_character_flag = captured_in_battle
					}
					activate_title = { status = no title = d_brotherhood }
				}
				d_brotherhood = { 
					clr_title_flag = brotherhood_rebellion 
					destroy_landed_title = yes
				}
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		FROM = { clr_character_flag = depose_liege_target }
	}
	on_invalidation = {
		FROM = { clr_character_flag = depose_liege_target }
		ROOT = {
			if = {
				limit = {					
					has_landed_title = d_brotherhood
					d_brotherhood = { has_title_flag = brotherhood_rebellion }
				}				
				e_iron_throne = { holder_scope = { ROOT = { set_defacto_liege = PREV } } }
				d_brotherhood = { clr_title_flag = brotherhood_rebellion }
			}
		}
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

overthrow_ruler = {
	name = CB_NAME_OVERTHROWRULER
	war_name = WAR_NAME_OVERTHROWRULER
	sprite = 12
	truce_days = 3650
	
	is_revolt_cb = yes
	can_call_vassals = yes
	is_tyranny_cb = yes
	#major_revolt = yes

	infamy_modifier = 0

	can_use = {
		ROOT = { 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
		ROOT = {
			de_facto_liege = FROM
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			any_demesne_title = {
				NOT = { lower_tier_than = ROOT }
				temporary = no
			}
			NOT = { has_character_modifier = installed_pretender } #No longer valid if actual target was replaced by a pretender
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
		FROM = { set_character_flag = depose_liege_target }
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			if = { #sub vassal rebellion
				limit = { has_character_flag = sub_vassal_rebellion }	
				hidden_tooltip = {
					save_event_target_as = captured_vassal
					FROM = { 
						save_event_target_as = enforcer 
						if = {
							limit = { has_character_flag = enforce_justice_liege_1 }
							liege = { character_event = { id = 40035 } }
							clr_character_flag = enforce_justice_liege_1
						}	
						if = {
							limit = { has_character_flag = enforce_justice_liege_2 }
							liege = { liege = { character_event = { id = 40035 } } }
							clr_character_flag = enforce_justice_liege_2
						}
						if = {
							limit = { has_character_flag = enforce_justice_liege_3 }
							liege = { liege = { liege = { character_event = { id = 40035 } } } }
							clr_character_flag = enforce_justice_liege_3
						}
					}				
				}
				clr_character_flag = sub_vassal_rebellion
			}	
		}
		FROM = {
			prestige = -500
			change_variable = { which = fear_actions value = -20 }
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_2
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
			if = {
				limit = { #Slavers introduce slavery
					ROOT = {
						tier = KING
						OR = {	
							has_slavery_religion_trigger = yes
							has_slavery_culture_trigger = yes
							trait = slave_owner
							trait = slave_trader
							culture = ironborn
						}	
						NOT = { has_dynasty_flag = liberator_dynasty }
						NOT = { trait = liberator }
						primary_title = { 
							OR = {
								has_law = slavery_2 
								has_law = slavery_3
							}	
						}
					}
				}
				any_demesne_title = { # All titles
					limit = {
						tier = EMPEROR
						NOT = { has_law = slavery_2 }
						NOT = { has_law = slavery_3 }
					}
					if = {
						limit = { ROOT = { primary_title = { has_law = slavery_2 } } }
						add_law = slavery_2
					}	
					if = {
						limit = { ROOT = { primary_title = { has_law = slavery_3 } } }
						add_law = slavery_3
					}	
				}
			}
			ROOT = {
				if = { #Leader choose outcome (abdicate, usurp etc)	
					limit = { 
						OR = {					
							NOT = { has_landed_title = k_the_most_devout } 
							ROOT_FROM = { is_merchant_republic = yes }
						}	
					}
					ROOT_FROM = {
						save_event_target_as = depose_liege_target
						ROOT = { character_event = { id = 45370 tooltip = TOOLTIP45370 } }
					}
				}			
				if = { #High Septon can choose successor
					limit = { 
						has_landed_title = k_the_most_devout 
						ROOT_FROM = { is_merchant_republic = no }
					}
					character_event = { id = religious.22 tooltip = TOOLTIPreligious.22 } 	
					hidden_tooltip = { character_event = { id = maintenance.21 days = 1 } } #Take dejure vassals (AGOT)
				}
			}
			hidden_tooltip = {
				# If claimant needs a regent, war leader becomes regent if possible
				ROOT = { character_event = { id = regency.55 days = 2 } }
			}
			clr_character_flag = depose_liege_target
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 250
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 250 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
			if = { #sub vassal rebellion
				limit = { has_character_flag = sub_vassal_rebellion }			
				FROM = { 
					if = {
						limit = { has_character_flag = enforce_justice_liege_1 }
						liege = { ROOT = { imprison = PREV clr_character_flag = captured_in_battle } }
						clr_character_flag = enforce_justice_liege_1
					}	
					if = {
						limit = { has_character_flag = enforce_justice_liege_2 }
						liege = { liege = { ROOT = { imprison = PREV clr_character_flag = captured_in_battle } } }
						clr_character_flag = enforce_justice_liege_2
					}
					if = {
						limit = { has_character_flag = enforce_justice_liege_3 }
						liege = { liege = { liege = { ROOT = { imprison = PREV clr_character_flag = captured_in_battle } } } }
						clr_character_flag = enforce_justice_liege_3
					}
					save_event_target_as = enforcer
					hidden_tooltip = {
						ROOT = {
							save_event_target_as = captured_vassal
							host = { letter_event = { id = 40032 } }
						}
					}
				}
				clr_character_flag = sub_vassal_rebellion
			}	
		}
		FROM = {
			remove_opinion = {
				who = ROOT
				modifier = declared_war
			}
		}
		FROM = { clr_character_flag = depose_liege_target }
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		ROOT = {
			prestige = -200
			if = {
				limit = { NOT = { has_character_flag = sub_vassal_rebellion } }
				prisoner = FROM
			}	
			if = { #sub vassal rebellion
				limit = { has_character_flag = sub_vassal_rebellion }			
				FROM = { 
					if = {
						limit = { has_character_flag = enforce_justice_liege_1 }
						liege = { ROOT = { imprison = PREV clr_character_flag = captured_in_battle } }
						clr_character_flag = enforce_justice_liege_1
					}	
					if = {
						limit = { has_character_flag = enforce_justice_liege_2 }
						liege = { liege = { ROOT = { imprison = PREV clr_character_flag = captured_in_battle } } }
						clr_character_flag = enforce_justice_liege_2
					}
					if = {
						limit = { has_character_flag = enforce_justice_liege_3 }
						liege = { liege = { liege = { ROOT = { imprison = PREV clr_character_flag = captured_in_battle } } } }
						clr_character_flag = enforce_justice_liege_3
					}
					save_event_target_as = enforcer
					hidden_tooltip = {
						ROOT = {
							save_event_target_as = captured_vassal
							host = { letter_event = { id = 40032 } }
						}
					}
				}
				clr_character_flag = sub_vassal_rebellion
			}
			#Hand over any exiles
			if = {
				limit = { FROM = { tier = EMPEROR } }
				any_courtier = {
					limit = {
						is_ruler = no
						liege = { character = PREVPREV }
						any_claim = { tier = EMPEROR holder_scope = { character = FROM } }
						OR = {
							has_character_flag = exiled_royal_family
							reverse_has_opinion_modifier = {
								who = FROM
								modifier = opinion_exiled_pretender
							}
						}	
						NOT = { dynasty = FROM }
						NOT = { has_opinion_modifier = { who = FROM modifier = opinion_merciful } }
					}
					hidden_tooltip = { 
						move_character = FROM 
						if = {
							limit = { trait = slave }
							reverse_remove_opinion = { who = ROOT modifier = opinion_my_slave }
							remove_opinion = { who = ROOT modifier = opinion_my_owner }
							reverse_opinion = { who = FROM modifier = opinion_my_slave }
							opinion = { who = FROM modifier = opinion_my_owner }
						}
					}
					imprison = FROM
					clr_character_flag = captured_in_battle
				}
			}	
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		FROM = { clr_character_flag = depose_liege_target }
	}
	
	on_defender_leader_death = {
		hidden_tooltip = {
			any_attacker = {
				letter_event = {
					id = 251
				}
			}
		}
		ROOT = {
			if = { #sub vassal rebellion
				limit = { has_character_flag = sub_vassal_rebellion }	
				hidden_tooltip = {
					save_event_target_as = captured_vassal
					FROM = { 
						save_event_target_as = enforcer 
						if = {
							limit = { has_character_flag = enforce_justice_liege_1 }
							liege = { character_event = { id = 40035 } }
							clr_character_flag = enforce_justice_liege_1
						}	
						if = {
							limit = { has_character_flag = enforce_justice_liege_2 }
							liege = { liege = { character_event = { id = 40035 } } }
							clr_character_flag = enforce_justice_liege_2
						}
						if = {
							limit = { has_character_flag = enforce_justice_liege_3 }
							liege = { liege = { liege = { character_event = { id = 40035 } } } }
							clr_character_flag = enforce_justice_liege_3
						}
					}				
				}
				clr_character_flag = sub_vassal_rebellion
			}		
		}
		FROM = { 
			clr_character_flag = depose_liege_target
		}
		end_war = invalid
	}
	on_invalidation = {
		ROOT = {
			clr_character_flag = sub_vassal_rebellion			
		}
		FROM = { 
			clr_character_flag = depose_liege_target 
			clr_character_flag = enforce_justice_liege_1
			clr_character_flag = enforce_justice_liege_2
			clr_character_flag = enforce_justice_liege_3
		}
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

overthrow_ruler_no_calls = {
	name = CB_NAME_OVERTHROWRULER_NC
	war_name = WAR_NAME_OVERTHROWRULER_NC
	sprite = 12
	truce_days = 3650
	
	is_revolt_cb = yes
	can_call_vassals = no
	can_ask_to_join_war = no

	infamy_modifier = 0

	can_use = {
		ROOT = { 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		ROOT = {
			de_facto_liege = FROM
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
		}
		FROM = {
			higher_tier_than = ROOT
			NOT = { has_character_modifier = installed_pretender } #No longer valid if actual target was replaced by a pretender
		}
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_REVOLT_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
		FROM = { set_character_flag = depose_liege_target }
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		hidden_tooltip = {			
			FROM = { 
				save_event_target_as = old_usurped_title_holder
			}
			if = {
				limit = { FROM = { has_character_flag = depose_liege } }
				any_attacker = {
					FROM = {
						current_heir = {
							reverse_opinion = {
								modifier = opinion_fought_for_claimant
								who = PREVPREV
							}
						}
					}
				}
				FROM = { clr_character_flag = depose_liege }
			}
			any_attacker = {
				set_character_flag = deposed_liege
			}			
		}
		ROOT = {
			prestige = 200
		}
		FROM = {
			prestige = -500
			change_variable = { which = fear_actions value = -20 }
			hidden_tooltip = {
				remove_opinion = {
					who = ROOT
					modifier = declared_war
				}			
			}
			
			clr_character_flag = depose_liege			
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_2
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
			if = {
				limit = { 
					ROOT = { is_nomadic = yes } 
					is_nomadic = yes
				}
				any_demesne_title = {
					limit = { tier = EMPEROR }
					gain_title = { target = ROOT type = faction_demand }
				}
				hidden_tooltip = { character_event = { id = 154 } } #on_executed event
				death = {
					death_reason = death_execution
					killer = ROOT
				}
			}
			if = {
				limit = { 
					OR = {
						ROOT = { is_nomadic = no } 
						is_nomadic = no
					}	
				}
				ROOT = {
					if = { #Leader choose outcome (abdicate, usurp etc)	
						limit = { 
							OR = {					
								NOT = { has_landed_title = k_the_most_devout } 
								ROOT_FROM = { is_merchant_republic = yes }
							}	
						}
						ROOT_FROM = {
							save_event_target_as = depose_liege_target
							ROOT = { character_event = { id = 45370 tooltip = TOOLTIP45370 } }
						}
					}			
					if = { #High Septon can choose successor
						limit = { 
							has_landed_title = k_the_most_devout 
							ROOT_FROM = { is_merchant_republic = no }
						}
						character_event = { id = religious.22 tooltip = TOOLTIPreligious.22 } 	
						hidden_tooltip = { character_event = { id = maintenance.21 days = 1 } } #Take dejure vassals (AGOT)
					}
				}
			}	
			hidden_tooltip = {
				# If claimant needs a regent, war leader becomes regent if possible
				ROOT = { character_event = { id = regency.55 days = 2 } }
			}
		}
		any_attacker = {
			clr_character_flag = deposed_liege
		}
		clear_event_target = old_usurped_title_holder
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		
		FROM = {
			prestige = -100
			hidden_tooltip = {
				remove_opinion = {
					who = ROOT
					modifier = declared_war
				}
			}
			clr_character_flag = depose_liege
			clr_character_flag = depose_liege_targe
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			participation_scaled_prestige = -200
			prisoner = FROM
		}
		FROM = {
			prestige = 50
		}
		if = { #Special depose liege faction effects
			limit = { FROM = { has_character_flag = depose_liege } }
			hidden_tooltip = { 
				FROM = { 
					any_vassal = { opinion = { who = PREV modifier = opinion_defeated_major_revolt } } 
					clr_character_flag = depose_liege
				} 
			}
			any_attacker = {
				limit = { 
					NOT = { character = ROOT } 
					liege = { character = FROM } 
				}
				prisoner = FROM
				participation_scaled_prestige = -200
			}
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
			FROM = { clr_character_flag = depose_liege_target }
		}
	}
	
	on_defender_leader_death = {
		FROM = { clr_character_flag = depose_liege_target }
		end_war = invalid
	}
	on_invalidation = {
		FROM = { clr_character_flag = depose_liege_target }
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

# change_gavelkind_succession_law = {
	# name = CB_NAME_GAVELKIND_SUCCESSION_LAW
	# war_name = WAR_NAME_GAVELKIND_SUCCESSION_LAW
	# sprite = 6
	# truce_days = 3650
	# attacker_can_call_allies = no
	# can_ask_to_join_war = no
	# #major_revolt = yes

	# infamy_modifier = 0
	
	# can_use = {
		# ROOT = {
			# vassal_of = FROM	
		# }
	# }
	
	# is_valid = {
	# }

	# is_valid_title = {
		# NOT = {
			# has_law = succ_gavelkind
		# }
		# OR = {
			# tier = emperor
			# tier = king
			# is_primary_holder_title = yes
		# }
	# }
	
	# on_success = {
		# hidden_tooltip = { 
			# ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			# if = {
				# limit = { 
					# ROOT = { trait = rebel_leader }
					# FROM = { 
						# tier = EMPEROR
						# trait = civil_war	
					# }
				# }
				# any_defender = {
					# character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				# }
				# FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			# }		
		# }
		# FROM = {
			# hidden_tooltip = { disband_event_forces = faction_loyalists }
			# any_demesne_title = { # All titles
				# limit = {
					# OR = {
						# tier = king
						# tier = emperor
					# }
# #					is_titular = no
					# NOT = { has_law = centralization_0 }
				# }
				# if = {
					# limit = { has_law = centralization_1 }
					# add_law = centralization_0
				# }
				# if = {
					# limit = { has_law = centralization_2 }
					# add_law = centralization_1
				# }
				# if = {
					# limit = { has_law = centralization_3 }
					# add_law = centralization_2
				# }
				# if = {
					# limit = { has_law = centralization_4 }
					# add_law = centralization_3
				# }
			# }
			# if = {
				# limit = { #High Septon raises Faith Authority
					# ROOT = {
						# religion = the_seven
						# has_landed_title = k_the_most_devout
					# }
				# }
				# any_demesne_title = { # All titles
					# limit = {
						# OR = {
							# tier = king
							# tier = emperor
						# }
						# OR = {
							# tier = EMPEROR
							# NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						# }
						# NOT = { has_law = investiture_law_3 }
					# }
					# if = {
						# limit = { has_law = investiture_law_2 }
						# add_law = investiture_law_3
					# }
					# if = {
						# limit = { 
							# OR = {
								# has_law = investiture_law_1 
								# has_law = investiture_law_0
							# }	
						# }
						# add_law = investiture_law_2
					# }
				# }
			# }
		# }
		
		# any_attacker = {
			# limit = { character = ROOT }
			# participation_scaled_prestige = 100
			# hidden_tooltip = {
				# disband_event_forces = faction_revolters
			# }
		# }
		# any_attacker = {
			# limit = { NOT = { character = ROOT } }
			# hidden_tooltip = {
				# participation_scaled_prestige = 100 
				# disband_event_forces = faction_revolters
			# }
		# }
	# }

	# on_success_title = {
		# succession_w_cooldown = gavelkind
		# if = {
			# limit = { 
				# ROOT = {
					# OR = {
						# culture_group = andal
						# culture_group = first_men
						# culture = stone_dornish
					# }
				# }
			# }	
			# gender_succ = cognatic
		# }
		# if = {
			# limit = { 
				# ROOT = {
					# OR = {
						# culture_group = iron_isles_culture
						# culture = eastern_valyrian
						# culture = mantaryan
						# culture = tolosi
						# culture = elyrian
					# }
				# }
			# }	
			# gender_succ = agnatic
		# }
		# if = {
			# limit = { 
				# ROOT = {
					# OR = {
						# culture = salt_dornish
						# culture = sand_dornish
						# culture = rhoynar
					# }
				# }
			# }	
			# gender_succ = true_cognatic
		# }
		# if = {
			# limit = { 
				# ROOT = {
					# culture = lengi
				# }
			# }	
			# gender_succ = enatic_cognatic
		# }
	# }

	# on_fail = {
		# ROOT = {
			# prestige = -100
		# }
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 50
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 50 }
		# }
		
		# hidden_tooltip = {
			# any_attacker = {
				# disband_event_forces = faction_revolters
				# add_character_modifier = {
					# name = faction_succ_gavelkind_ultimatum_timer
					# hidden = yes
					# duration = 3650
				# }
			# }
		# }
		# FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	# }

	# on_reverse_demand = {
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } } 
		# ROOT = {
			# prestige = -200
			# prisoner = FROM
		# }
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 100
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 100 }
		# }
		
		# hidden_tooltip = {
			# any_attacker = {
				# limit = { liege = { character = FROM } }
				# prisoner = FROM
				# disband_event_forces = faction_revolters
				# add_character_modifier = {
					# name = faction_succ_gavelkind_ultimatum_timer
					# hidden = yes
					# duration = 3650
				# }
			# }
			# if = {
				# limit = { 
					# FROM = { tier = EMPEROR }
					# #
				# }
				# any_attacker = {
					# character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				# }
			# }
		# }
		
		# FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	# }

	# attacker_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# defender_ai_defeat_worth = {
		# factor = 100
	# }
# }

lower_crown_authority_law = {
	name = CB_NAME_LOWER_CROWN_AUTHORITY_LAW
	war_name = WAR_NAME_LOWER_CROWN_AUTHORITY_LAW
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}
	
	can_use_title = {
		holder_scope = { independent = yes }
		OR = {
			tier = king
			tier = emperor
		}
		OR = {
			has_law = centralization_1
			has_law = centralization_2
			has_law = centralization_3
			has_law = centralization_4
		}
	}
	
	is_valid = {
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CA_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CA_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CA_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CA_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
		}
		ROOT = {
			opinion = {
				modifier = opinion_lowered_crown_authority
				who = FROM
				months = 12
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = { 
			hidden_tooltip = { disband_event_forces = faction_loyalists } 
			change_variable = { which = fear_actions value = -20 }
		}
	}

	on_success_title = {
		if = {
			limit = { has_law = centralization_1 }
			add_law_w_cooldown = centralization_0
		}
		if = {
			limit = { has_law = centralization_2 }
			add_law_w_cooldown = centralization_1
		}
		if = {
			limit = { has_law = centralization_3 }
			add_law_w_cooldown = centralization_2
		}
		if = {
			limit = { has_law = centralization_4 }
			add_law_w_cooldown = centralization_3
		}
		if = {
			limit = { #High Septon raises Faith Authority
				ROOT = {
					religion = the_seven
					has_landed_title = k_the_most_devout
				}
			}
			FROM = {
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}	
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
	
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_CA_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_lower_CA_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
# lower_tribal_organization_law = {
	# name = CB_NAME_LOWER_TRIBAL_ORGANIZATION_LAW
	# war_name = WAR_NAME_LOWER_TRIBAL_ORGANIZATION_LAW
	# sprite = 6
	# truce_days = 3650
	# can_call_allies = no
	# can_ask_to_join_war = no
	# major_revolt = yes

	# infamy_modifier = 0
	
	# can_use = {
		# ROOT = {
			# vassal_of = FROM
		# }
	# }
	
	# can_use_title = {
		# holder_scope = { independent = yes }
		# higher_tier_than = COUNT
		# OR = {
			# has_law = tribal_organization_1
			# has_law = tribal_organization_2
			# has_law = tribal_organization_3
			# has_law = tribal_organization_4
		# }
	# }
	
	# is_valid = {
		# FROM = {
			# is_tribal = yes
			# in_revolt = no
			# liege_before_war = {
				# in_revolt = no
				# liege_before_war = {
					# in_revolt = no
				# }
			# }
		# }
		# ROOT = {
			# OR = {
				# liege = {
					# character = PREV # either independent
				# }
				# liege = { 
					# FROM = { 
						# is_liege_or_above = PREV # or have shared liege
					# }
				# }
			# }
		# }
	# }
	
	# on_success = {
		# hidden_tooltip = { 
			# ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			# if = {
				# limit = { 
					# ROOT = { trait = rebel_leader }
					# FROM = { 
						# tier = EMPEROR
						# trait = civil_war	
					# }
				# }
				# any_defender = {
					# character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				# }
				# FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			# }
		# }
		# ROOT = {
			# opinion = {
				# modifier = opinion_lowered_tribal_organization
				# who = FROM
				# months = 12
			# }
		# }
		# any_attacker = {
			# limit = { character = ROOT }
			# participation_scaled_prestige = 100
			# hidden_tooltip = {
				# disband_event_forces = faction_revolters
			# }
		# }
		# any_attacker = {
			# limit = { NOT = { character = ROOT } }
			# hidden_tooltip = { participation_scaled_prestige = 100 }
			# hidden_tooltip = {
				# disband_event_forces = faction_revolters
			# }
		# }
		# FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	# }

	# on_success_title = {
		# if = {
			# limit = { has_law = tribal_organization_1 }
			# add_law_w_cooldown = tribal_organization_0
		# }
		# if = {
			# limit = { has_law = tribal_organization_2 }
			# add_law_w_cooldown = tribal_organization_1
		# }
		# if = {
			# limit = { has_law = tribal_organization_3 }
			# add_law_w_cooldown = tribal_organization_2
		# }
		# if = {
			# limit = { has_law = tribal_organization_4 }
			# add_law_w_cooldown = tribal_organization_3
		# }
	# }

	# on_fail = {
		# ROOT = {
			# prestige = -100
		# }
		
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 50
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 50 }
		# }
		
		# hidden_tooltip = {
			# any_attacker = {
				# disband_event_forces = faction_revolters
				# add_character_modifier = {
					# name = faction_lower_TO_ultimatum_timer
					# hidden = yes
					# duration = 3650
				# }
			# }
		# }
		# FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	# }

	# on_reverse_demand = {
		# hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		# ROOT = {
			# prestige = -200
			# prisoner = FROM
		# }
		
		# any_defender = {
			# limit = { character = FROM }
			# participation_scaled_prestige = 100
		# }
		# any_defender = {
			# limit = { NOT = { character = FROM } }
			# hidden_tooltip = { participation_scaled_prestige = 100 }
		# }
		
		# hidden_tooltip = {
			# any_attacker = {
				# limit = { liege = { character = FROM } }
				# prisoner = FROM
				# disband_event_forces = faction_revolters
				# add_character_modifier = {
					# name = faction_lower_TO_ultimatum_timer
					# hidden = yes
					# duration = 3650
				# }
			# }
			# if = {
				# limit = { 
					# FROM = { tier = EMPEROR }
					# #
				# }
				# any_attacker = {
					# character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				# }
			# }
		# }
		# FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	# }

	# attacker_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# attacker_ai_defeat_worth = {
		# factor = 100
	# }

	# defender_ai_victory_worth = {
		# factor = -1 # always accept
	# }
	
	# defender_ai_defeat_worth = {
		# factor = 100
	# }
# }

coastal_republic = {
	name = CB_NAME_COASTAL_REPUBLIC
	war_name = WAR_NAME_COASTAL_REPUBLIC
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	
	allow_distant = yes # AI parameter

	infamy_modifier = 0
	
	can_use_gui = {
		ROOT = {
			NOT = { is_liege_or_above = FROM }
			NOT = { is_vassal_or_below = FROM }
			NOT = { same_liege = FROM }
		}
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
			
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}			
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	can_use_title = {
		tier = BARON
		is_capital = no # Minor Holding
		holding_type = city
		NOT = { holder_scope = { family_palace = { title = PREVPREV } } } #Can't take family palace
		
		OR = { #cant invade nomad domains
			holder_scope = {
				NOT = { is_nomadic = yes }
			}
			location = { NOT = { has_province_flag = dothraki_sea } }
		}
		OR = {
			NOT = { title = b_white_sword_tower }
			FROM = { NOT = { trait = kingsguard } }
		}	
		
		location = {
			OR = {
				AND = { # Must have a trade post there already
					port = yes						
					OR = {
						PREV = {
							holder_scope = {
								NOT = { same_realm = ROOT }
								OR = {
									is_patrician = yes
									is_merchant_republic = yes
								}
							}
						}
						trade_post_owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
				region = world_disputed_lands #Can freely use in the Disputed Lands
			}	
			
			# Not allowed to use this CB to take cities in the capital province of a rival merchant republic
			FROM = { 
				OR = {
					is_merchant_republic = no
					capital_scope = {
						NOT = { province_id = PREVPREV }
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
	}

	on_success_title = {
		if = {
			limit = {
				NOT = {
					location = {
						trade_post_owner = {
							is_liege_or_above = ROOT
						}
					}
				}
			}
			usurp_title = { target = ROOT type = invasion }
		}
		
		if = {
			limit = {
				location = {
					trade_post_owner = {
						is_liege_or_above = ROOT
					}
				}
			}
			location = {
				trade_post_owner = {
					usurp_title = { target = PREVPREV type = invasion }
				}
			}
		}
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}   

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 50
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 50
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}

coastal_county_republic = {
	name = CB_NAME_COASTAL_COUNTY_REPUBLIC
	war_name = WAR_NAME_COASTAL_COUNTY_REPUBLIC
	sprite = 1
	truce_days = 3650
	is_permanent = yes
	check_all_titles = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	
	allow_distant = yes # AI parameter

	infamy_modifier = 0
	
	can_use_gui = {
		NOT = { is_liege_or_above = FROM }
		NOT = { is_vassal_or_below = FROM }
		NOT = { same_liege = FROM }
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	can_use_title = {
		tier = COUNT
		
		OR = { #cant invade nomad domains
			holder_scope = {
				NOT = { is_nomadic = yes }
			}
			location = { NOT = { has_province_flag = dothraki_sea } }
		}
		location = {
			OR = {
				port = yes
				region = world_disputed_lands #Can freely use in the Disputed Lands
			}	
			county = {
				any_direct_de_jure_vassal_title = {
					holder_scope = {
						OR = {
							character = ROOT
							is_liege_or_above = ROOT
						}
					}
				}
			}
			any_neighbor_province = {
				OR = {
					AND = {
						has_owner = yes
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
					AND = {
						is_land = no
						any_neighbor_province = {
							OR = {
								AND = {
									has_owner = yes
									owner = {
										OR = {
											character = ROOT
											is_liege_or_above = ROOT
										}
									}
								}
								AND = {
									is_land = no
									any_neighbor_province = {
										owner = {
											OR = {
												character = ROOT
												is_liege_or_above = ROOT
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
	}

	on_success_title = {
		if = {
			limit = {
				OR = {
					any_direct_de_jure_vassal_title = {
						holder_scope = {
							character = ROOT
						}
					}
					NOT = {
						any_direct_de_jure_vassal_title = {
							holder_scope = {
								is_liege_or_above = ROOT
							}
						}
					}
				}	
			}
			usurp_title = { target = ROOT type = invasion }
		}
		
		if = {
			limit = {
				NOT = {
					any_direct_de_jure_vassal_title = {
						holder_scope = {
							character = ROOT
						}
					}
				}
			}
			any_de_jure_vassal_title = {
				limit = {
					holder_scope = {
						is_liege_or_above = ROOT
					}
				}
				holder_scope = {
					usurp_title = { target = PREVPREV type = invasion }
					set_defacto_liege = ROOT
				}
			}
		}
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
	}
}


weaken_vassal_plot = {
	name = CB_NAME_WEAKEN_VASSAL
	war_name = WAR_NAME_WEAKEN_VASSAL
	sprite = 3
	truce_days = 3650
	hostile_against_others = yes

	press_claim = yes
	attacker_can_call_allies = no
	can_ask_to_join_war = no

	infamy_modifier = 0

	can_use_title = {
		ROOT = { 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		NOT = {
			AND = {
				ROOT = { has_landed_title = e_iron_throne }
				FROM = { has_character_flag = post_civil_war_wars }
			}
		}
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
		
	on_invalidation = {
		ROOT = {
			cancel_plot = yes
		}
		
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_attacker = {
			participation_scaled_prestige = 100
		}
		ROOT = {
			if = {
				limit = { has_plot = plot_weaken_fellow_vassal }
				set_character_flag = weakened_fellow_vassal
			}
		}
		FROM = {
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
#					is_titular = no
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
	}
	
	on_success_title = {
		FROM = {
			random_vassal = {
				limit = {
					tier = count
					any_demesne_title = {
						tier = count
						dejure_liege_title = {
							ROOT = {
								plot_target_title = {
									title = PREVPREV
								}
							}
						}
					}
				}
				grant_title = PREVPREV
			}
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
			cancel_plot = yes
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			imprison = FROM
			clr_character_flag = captured_in_battle
			cancel_plot = yes
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	on_attacker_leader_death = {
		any_defender = {
			letter_event = {
				id = 251
			}
		}
		ROOT = {
			if = {
				limit = {
					has_character_flag = rebel_leader
				}
				e_iron_throne = {
					holder_scope = {
						character_event = { id = mega_wars.8 }
					}
				}
			}
			
		}
		end_war = invalid
	}
	
	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# decadence_invasion = {
# }

#muslim_invasion = {
#}

cb_faction_independence = {
	name = CB_NAME_INDEPENDENCE
	war_name = WAR_NAME_FACTION_INDEPENDENCE
	sprite = 12
	truce_days = 3650
	#major_revolt = yes
	
	attacker_can_call_allies = no
	can_ask_to_join_war = yes
	
	is_independence = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				liege = {
					character = PREV # either independent
				}
				liege = { 
					FROM = { 
						is_liege_or_above = PREV # or have shared liege
					}
				}
			}
			NOT = { has_character_flag = end_indep_wars }
		}
		OR = {
			FROM = {
				any_demesne_title = {
					NOT = { lower_tier_than = ROOT }
					temporary = no
				}
				independent = yes
			}
			AND = { 	
				FROM = { tier = EMPEROR }
				ROOT = { tier = EMPEROR }
			}
		}
	}
	
	on_add = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INDEPENDENCE_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			# if = {
				# limit = { 
					# ROOT = { trait = rebel_leader }
					# FROM = { 
						# tier = EMPEROR
						# trait = civil_war	
					# }
				# }
				# any_defender = {
					# character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				# }
				# FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			# }		
		} 
		if = {
			limit = {
				FROM = {
					independent = yes
				}
			}
			any_attacker = {
				limit = {
					OR = {
						vassal_of = FROM
						liege_before_war = { character = FROM }
						AND = {
							FROM = { tier = EMPEROR trait = civil_war }
							primary_title = { FROM = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } }
						}
						AND = {
							tier = EMPEROR
							has_character_flag = indep_war
						}	
					}
				}
				set_defacto_liege = THIS
				hidden_tooltip = {
					add_character_modifier = {
						name = "indep_faction_won"
						duration = 20
					}
					remove_character_modifier = indep_war
					clr_character_flag = indep_war
					prestige = 100
					any_demesne_title = {
						limit = {
							controls_religion = no
							tier = PREV
							NOT = { 
								dejure_liege_title = { 
									OR = {
										FROM = { has_landed_title = PREV } 
										dejure_liege_title = {
											OR = {
												FROM = { has_landed_title = PREV } 
												dejure_liege_title = { FROM = { has_landed_title = PREV } }
											}	
										}
									}	
								}	
							}
						}
						add_weak_pressed_claim = FROM
					}
					hidden_tooltip = {
						character_event = { id = mega_wars.50 } #Character wins indep war maintenance
						character_event = { id = mega_wars.54 days = 3} #AI lesser lords get vassalised
					}
				}
			}
		}
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = 100
				disband_event_forces = faction_revolters
			}
		}

		FROM = {
			
			hidden_tooltip = { disband_event_forces = faction_loyalists }
			change_variable = { which = fear_actions value = -20 }
			any_demesne_title = { # All titles
				limit = {
					OR = {
						tier = king
						tier = emperor
					}
					NOT = { has_law = centralization_0 }
				}
				if = {
					limit = { has_law = centralization_1 }
					add_law = centralization_0
				}
				if = {
					limit = { has_law = centralization_2 }
					add_law = centralization_1
				}
				if = {
					limit = { has_law = centralization_3 }
					add_law = centralization_2
				}
				if = {
					limit = { has_law = centralization_4 }
					add_law = centralization_3
				}
			}
			if = {
				limit = { #High Septon raises Faith Authority
					ROOT = {
						religion = the_seven
						has_landed_title = k_the_most_devout
					}
				}
				any_demesne_title = { # All titles
					limit = {
						OR = {
							tier = king
							tier = emperor
						}
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							OR = {
								has_law = investiture_law_1 
								has_law = investiture_law_0
							}	
						}
						add_law = investiture_law_2
					}
				}
			}
		}
	}

	on_fail = {
		any_attacker = {
			limit = {
				OR = {
					vassal_of = FROM
					liege_before_war = { character = FROM }
					AND = {
						FROM = { tier = EMPEROR trait = civil_war }
						primary_title = { FROM = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } }
					}
					AND = {
						tier = EMPEROR
						has_character_flag = indep_war
					}	
				}
			}
			clr_character_flag = post_civil_war_indep_war
			clr_character_flag = indep_war
			if = { 	limit = { has_landed_title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_riverlands }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
			}
			hidden_tooltip = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = {
					limit = {
						higher_tier_than = KING
					}

					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}	
				set_defacto_liege = FROM
				remove_character_modifier = indep_war
				hidden_tooltip = { character_event = { id = maintenance.24 } } #Mega war flag maintenance 
			}	
		}
		ROOT = {
			prestige = -50
#			prisoner = FROM
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = -50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = {
				participation_scaled_prestige = -50 
				disband_event_forces = faction_revolters
			}
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		any_attacker = {
			limit = {
				OR = {
					vassal_of = FROM
					liege_before_war = { character = FROM }
					AND = {
						FROM = { tier = EMPEROR trait = civil_war }
						primary_title = { FROM = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } }
					}
					AND = {
						tier = EMPEROR
						has_character_flag = indep_war
					}	
				}
			}
			clr_character_flag = post_civil_war_indep_war
			clr_character_flag = indep_war
			if = { 	limit = { has_landed_title = e_north }
					k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_riverlands }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_vale }
					k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_westerlands }
					k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_reach }
					k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_stormlands }
					k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_dorne }
					k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
			}
			if = { 	limit = { has_landed_title = e_iron_isles }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
			}
			hidden_tooltip = {
				if = { 	limit = { has_landed_title = e_north }
						k_north = { grant_title = PREV  }
						FROM = {
							primary_title = {
								k_north = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_riverlands }
						k_riverlands  = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_riverlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_vale }
						k_vale = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_vale = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_westerlands }
						k_westerlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_westerlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_reach }
						k_reach = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_reach = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_stormlands }
						k_stormlands = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_stormlands = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_dorne }
						k_dorne = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_dorne = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = { 	limit = { has_landed_title = e_iron_isles }
						k_iron_isles = { grant_title = PREV }
						FROM = {
							primary_title = {
								k_iron_isles = {
									de_jure_liege = PREV
								}	
							}
						}
				}
				if = {
					limit = {
						higher_tier_than = KING
					}

					any_demesne_title = {
						limit = { tier = EMPEROR }
						destroy_landed_title = ROOT
					}
				}	
				set_defacto_liege = FROM
				remove_character_modifier = indep_war
				hidden_tooltip = { character_event = { id = maintenance.24 } } #Mega war flag maintenance 
			}	
		}
		ROOT = {
			prestige = -100
			prisoner = FROM
			add_character_modifier = {
				name = faction_independence_ultimatum_timer
				hidden = yes
				duration = 3650
			}
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = -100
		}
		
		any_attacker = {
			limit = { 
				NOT = { character = ROOT }
				liege = { character = FROM } 
			}
			if = {
				limit = {
					prisoner = yes
					host = { character = FROM }
				}
				prisoner = FROM
			}
			participation_scaled_prestige = -100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_independence_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		
		FROM = {
			prestige = 50
			hidden_tooltip = { disband_event_forces = faction_loyalists }
		}
		hidden_tooltip = {
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
	}

	on_attacker_leader_death = {
		if = {
			limit = { 
				ROOT = { current_heir = { character = FROM } }
			}	
			hidden_tooltip = {
				any_defender = {
					letter_event = {
						id = 251
					}
				}
				any_attacker = { 
					remove_character_modifier = indep_war 
					clr_character_flag = post_civil_war_indep_war
					clr_character_flag = indep_war
					if = { 	limit = { has_landed_title = e_north }
							k_north = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_riverlands }
							k_riverlands  = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_vale }
							k_vale = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_westerlands }
							k_westerlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_reach }
							k_reach = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_stormlands }
							k_stormlands = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_dorne }
							k_dorne = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail } }
					}
					if = { 	limit = { has_landed_title = e_iron_isles }
							k_iron_isles = { custom_tooltip = { text = TOOLTIPbid_for_indep_fail }}
					}
					hidden_tooltip = {
						if = { 	limit = { has_landed_title = e_north }
								k_north = { grant_title = PREV  }
								FROM = {
									primary_title = {
										k_north = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_riverlands }
								k_riverlands  = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_riverlands = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_vale }
								k_vale = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_vale = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_westerlands }
								k_westerlands = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_westerlands = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_reach }
								k_reach = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_reach = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_stormlands }
								k_stormlands = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_stormlands = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_dorne }
								k_dorne = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_dorne = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = { 	limit = { has_landed_title = e_iron_isles }
								k_iron_isles = { grant_title = PREV }
								FROM = {
									primary_title = {
										k_iron_isles = {
											de_jure_liege = PREV
										}	
									}
								}
						}
						if = {
							limit = {
								higher_tier_than = KING
							}

							any_demesne_title = {
								limit = { tier = EMPEROR }
								destroy_landed_title = ROOT
							}
						}	
						set_defacto_liege = FROM
						remove_character_modifier = indep_war
					}
				}
			}

			end_war = invalid
		}	
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 150
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
#imperial_reconquest = {
#}

# Embargo Merchant Republic CB
embargo_cb = {
	name = CB_NAME_EMBARGO
	war_name = WAR_NAME_EMBARGO
	sprite = 11
	truce_days = 3650
	
	is_permanent = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			NOT = { is_nomadic = yes }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			independent = yes
			NOT = { has_embargo = FROM }
		}
		FROM = {
			OR = {
				AND = {
					is_merchant_republic = yes
					any_trade_post = {
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
				AND = {
					higher_tier_than = DUKE
					any_realm_lord = {
						is_merchant_republic = yes
						any_trade_post = {
							owner = {
								OR = {
									character = ROOT
									is_liege_or_above = ROOT
								}
							}
						}
					}
				}
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	is_valid = {
		ROOT = {
			independent = yes
			NOT = { has_embargo = FROM }
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = {
			OR = {
				is_merchant_republic = yes
				AND = {
					higher_tier_than = DUKE
					any_realm_lord = {
						is_merchant_republic = yes
					}
				}
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add = {
		hidden_tooltip = {
			if = { #Westerosi Rulers dont usually bother with foreign embargos
				limit = {
					ROOT = {
						ai = yes
						OR = {
							NOT = { culture_group = FROM }
							culture_group = valyrian
						}	
						capital_scope = { region = world_westeros }
					}
					FROM = { NOT = { capital_scope = { region = world_westeros } } }
				}
				ROOT = { 
					set_character_flag = no_embargo_mega_wars
					character_event = { id = 295665 days = 1 } 
				}
				break = yes
			}	
		}
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_EMBARGO_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_EMBARGO_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_EMBARGO_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_EMBARGO_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			embargo = FROM
			if = {
				limit = {
					NOT = { religion = FROM }
				}
				piety = 200
			}
		}
		#Disband the Triarchy
		FROM = {
			if = {
				limit = { government = alliance_government } #disband alliance
				character_event = { id = free_cities.15 tooltip = TOOLTIPfree_cities.15 } 
			}
		}
		# Found the Triarchy
		if = {
			limit = {
				has_global_flag = three_daughters_founding_war
				ROOT = {
					OR = {
						has_landed_title = k_myr
						has_landed_title = k_tyrosh
						has_landed_title = k_lys
					}
				}
			}
			clr_global_flag = three_daughters_founding_war
			ROOT = {
				character_event = { id = free_cities.18 tooltip = TOOLTIPfree_cities.18 }
			}
			hidden_tooltip = {
				ROOT = {
					activate_title = { status = yes title = e_three_daughters }
					k_lys = { de_jure_liege = e_three_daughters }
					k_myr = { de_jure_liege = e_three_daughters }
					k_tyrosh = { de_jure_liege = e_three_daughters }
					random_realm_character = {
						limit = {
							is_female = no
							age = 25
							is_ruler = no
							is_primary_heir = no
							NOT = { trait = incapable }
							NOT = { trait = eunuch }
							NOT = { trait = blinded }
							NOT = { trait = maester }
							NOT = { trait = slave }
							NOT = { dynasty = 0 }
							any_dynasty_member = {
								is_patrician = yes
								same_realm = ROOT
								any_liege = {
									OR = {
										has_landed_title = k_myr
										has_landed_title = k_tyrosh
										has_landed_title = k_lys
									}
								}
							}
						}
						save_event_target_as = triarchy_leader
					}
					if = {
						limit = { NOT = { event_target:triarchy_leader = { always = yes } } }
						random_realm_character = {
							limit = {
								is_female = no
								age = 25
								is_ruler = no
								is_primary_heir = no
								NOT = { trait = incapable }
								NOT = { trait = eunuch }
								NOT = { trait = blinded }
								NOT = { trait = maester }
								NOT = { trait = slave }
								NOT = { dynasty = 0 }
								any_liege = {
									any_demesne_title = { has_law = republic_alliance_member }
								}
								stewardship = 8
							}
							save_event_target_as = triarchy_leader
						}
						if = {
							limit = { NOT = { event_target:triarchy_leader = { always = yes } } }
							capital_scope = {
								ROOT = {
									create_random_steward = {
										random_traits = yes
										dynasty = culture
										female = no
										culture = PREV
									}
									new_character = {
										remove_trait = imbecile
										remove_trait = inbred
										remove_trait = slow
										remove_trait = infirm
										remove_trait = incapable
										remove_trait = leper
										remove_trait = possessed
										remove_trait = ill
										remove_trait = pneumonic
										remove_trait = maimed
										save_event_target_as = triarchy_leader
									}
								}
							}
						}
					}
					event_target:triarchy_leader = {
						c_forestofmyr = { gain_title = PREV }
						b_forestofmyr_castle = { gain_title = PREV }
						any_demesne_title = {
							limit = {
								holding_type = castle
								location = {
									is_capital = yes
								}
							}
							province_capital = yes
							event_target:triarchy_leader = { capital = PREV }
						}
						e_three_daughters = { gain_title = PREV } 
						set_character_flag = elected_triarchy_leader
					}
					k_myr = { holder_scope = { b_trellos = { holder_scope = { set_defacto_liege = PREVPREV } } } }
					e_three_daughters = { 
						holder_scope = { 
							k_myr = { 
								holder_scope = { set_defacto_liege = PREVPREV } 
								add_law = republic_alliance_member
							} 
							k_lys = {
								holder_scope = { set_defacto_liege = PREVPREV } 
								add_law = republic_alliance_member
							}
							k_tyrosh = {
								holder_scope = { set_defacto_liege = PREVPREV } 
								add_law = republic_alliance_member
							}
							any_realm_lord = {
								limit = {
									ai = no
									NOT = { character = ROOT }
									NOT = { character = event_target:triarchy_leader }
								}
								character_event = { id = free_cities.18 }
							}
							character_event = { id = free_cities.17 }
						} 
					}
				}
			}
		}
	}

	on_fail = {
		if = {
			limit = {
				NOT = {
					any_attacker = {
						NOT = { character = ROOT } 
						is_merchant_republic = yes
					}
				}
			}
			ROOT = {
				prestige = -100
			}
		}
		
		if = {
			limit = {
				any_attacker = {
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
			}
			any_attacker = {
				limit = { 
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
				prestige = -100
			}
		}
		
		FROM = {
			prestige = 50
		}

		# Found the Triarchy
		if = {
			limit = {
				has_global_flag = three_daughters_founding_war
				ROOT = {
					OR = {
						has_landed_title = k_myr
						has_landed_title = k_tyrosh
						has_landed_title = k_lys
					}
				}
			}
			clr_global_flag = three_daughters_founding_war
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		if = {
			limit = {
				NOT = {
					any_attacker = {
						NOT = { character = ROOT } 
						is_merchant_republic = yes
					}
				}
			}
			
			ROOT = {
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
		}
		
		if = {
			limit = {
				any_attacker = {
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
			}
			any_attacker = {
				limit = { 
					NOT = { character = ROOT } 
					is_merchant_republic = yes
				}
				prestige = -200
				transfer_scaled_wealth = {
					to = FROM
					value = 4.0
				}
			}
		}
		
		FROM = {
			prestige = 100
		}

		# Found the Triarchy
		if = {
			limit = {
				has_global_flag = three_daughters_founding_war
				ROOT = {
					OR = {
						has_landed_title = k_myr
						has_landed_title = k_tyrosh
						has_landed_title = k_lys
					}
				}
			}
			clr_global_flag = three_daughters_founding_war
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 50
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 50
	}
	
	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		
		#Dragon intimidation
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
		
		modifier = {
			factor = 0
			ROOT = {
				opinion = { who = FROM value = 25 }
			}
		}
		modifier = {
			factor = 0.5
			ROOT = {
				opinion = { who = FROM value = 0 }
			}
		}		
		modifier = {
			factor = 0.5
			ROOT = {
				opinion = { who = FROM value = -25 }
			}
		}	
		modifier = { #Westerosi Rulers dont usually bother with foreign embargos
			factor = 0
			ROOT = {
				OR = {
					NOT = { culture_group = FROM }
					culture_group = valyrian
				}
				capital_scope = { region = world_westeros }
			}
			FROM = { NOT = { capital_scope = { region = world_westeros } } }
		}		
	}		
}

seize_trade_post = {
	name = CB_NAME_SEIZE_TRADE_POST
	war_name = WAR_NAME_SEIZE_TRADE_POST
	sprite = 1
	truce_days = 1825
	is_permanent = yes
#	check_all_titles = yes
	check_all_trade_posts = yes
	can_ask_to_join_war = no
	ticking_war_score_multiplier = 5.0
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no
	
	allow_distant = yes

	infamy_modifier = 0
	
	can_use_gui = {
		# custom_tooltip = {
			# text = TOOLTIPCBENFORCEDTRUCE
			# hidden_tooltip = {
				# FROM = {
					# NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_enforced_truce } }
				# }	
			# }
		# }
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }

			OR = {
				NOT = { same_realm = FROM }
				
				# We cannot overtly attack much weaker Patricians in the same republic
				NOT = { 
					num_of_trade_post_diff = {
						character = FROM
						value = 3
					}
				}
			}
		}
		FROM = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = ROOT }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}

	can_use_title = {
		tier = COUNT
		location = {
			port = yes
		}
		has_trade_post = yes
		trade_post_owner = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}	
		}
		OR = { #Cannot hold Posts in foreign republic's realm
			trade_post_owner = { same_realm = ROOT }
			NOT = {
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
			}	
		}
		holder_scope = {
			NOT = { character = FROM }
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = FROM }
		}
		FROM = {
			OR = {
				is_merchant_republic = yes
				is_patrician = yes
			}
			NOT = { is_liege_or_above = ROOT }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	is_valid_title = {
		has_trade_post = yes
		trade_post_owner = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}
		}
		holder_scope = {
			NOT = { character = FROM }
		}
	}
	
	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		seize_trade_post = ROOT
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_fail = {
		ROOT = {
			prestige = -50
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 25
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 25 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -100
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 25
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 25
	}

	# ai importance placed on this CB: scope is the targeted title, ROOT is the attacking character, FROM is the defending character
	ai_will_do = { 
		factor = 1
		modifier = {
			factor = 0.1
			ROOT = { NOT = { trait = dragon_rider } }
			FROM = { 
				trait = dragon_rider 
				NOT = { trait = incapable }
			}
		}	
		modifier = {
			factor = 0.25
			ROOT = {
				NOT = { same_realm = FROM }
			}
		}					
	}		
}

# The Prepared Invasion CB of Norse Heathens
# viking_invasion = {
# }

# Pagans can subjugate other pagans
# AGOT, can be used by anyone to subjugate vacant kingdoms
pagan_subjugation = {
	name = CB_NAME_PAGAN_SUBJUGATION
	war_name = WAR_NAME_PAGAN_SUBJUGATION
	sprite = 8
	truce_days = 365
	hostile_against_others = yes
	is_permanent = yes
	can_ask_to_join_war = yes
	check_de_jure_tier = KING # this scans all de jure kingdoms for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {	
		ROOT = {
			has_ambition = obj_become_lord_paramount
			is_adult = yes
			prestige = 500
			piety = 150
			NOT = { trait = incapable }
			custom_tooltip = {
				text = ironborn_invasionFACTION
				hidden_tooltip = {
					OR = {
						tier = COUNT
						any_vassal = {
							leads_faction = faction_liege_loyalist
							faction_power = {
								faction = faction_liege_loyalist
								power = 0.75
							}
						}
						NOT = { #Every capable, adult vassal is in the liege/crown loyalist faction
							any_vassal = {
								NOT = { tier = BARON }
								is_adult = yes
								prisoner = no
								NOT = { trait = incapable }
								NOT = { trait = kingsguard }
								NOT = { trait = archmaester }
								NOT = { in_faction = faction_liege_loyalist }
							}
						}	
					}	
				}
			}
		}	
	}
	
	can_use = {
		ROOT = {
			has_ambition = obj_become_lord_paramount
			NOT = { same_realm = FROM }
			NOT = { is_liege_or_above = FROM }
			has_horde_culture = no # Should use tribal invasion instead
			NOT = { lower_tier_than = FROM }
		}
		FROM = {
			in_revolt = no
			NOT = { is_nomadic = yes }
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}	
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}
	}
	
	can_use_title = {		
		ROOT = {		
			capital_scope = {
				kingdom = {
					title = PREVPREVPREV
					has_holder = no					
				}				
			}
		}
		NOT = { #cannot target title if equivalent kingdom exists
			OR = {
				AND = {
					title = k_crownlands
					e_iron_throne = { has_holder = yes }
				}
				AND = {
					title = k_north
					e_north = { has_holder = yes }
				}
				AND = {
					title = k_riverlands
					e_riverlands = { has_holder = yes }
				}
				AND = {
					title = k_vale
					e_vale = { has_holder = yes }
				}
				AND = {
					title = k_westerlands
					e_westerlands = { has_holder = yes }
				}
				AND = {
					title = k_reach
					e_reach = { has_holder = yes }
				}
				AND = {
					title = k_stormlands
					e_stormlands = { has_holder = yes }
				}
				AND = {
					title = k_dorne
					e_dorne = { has_holder = yes }
				}
				AND = {
					title = k_iron_isles
					e_iron_isles = { has_holder = yes }
				}
			}
		}
		
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
	}
	
	is_valid_title = {
		FROM = {
			any_realm_title = {
				de_jure_liege_or_above = PREVPREV
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		FROM = {
			piety = -100
			prestige = -100
		}
	}
	
	on_success_title = {
		# # Usurp the target kingdom itself, if the enemy holds it
		# if = {
			# limit = {
				# tier = KING
				# holder_scope = { character = FROM }
				# NOT = { ROOT = { tier = EMPEROR } }
			# }
			# ROOT = { usurp_title = PREV }
		# }
		hidden_tooltip = { holder_scope = { character_event = { id = maintenance.22 days = 2 } } }#Mega War flag maintenance
		if = {
			# Take the enemy's duchies within the target kingdom, if we are the same or lower tier
			limit = {
				ROOT = {
					NOT = { higher_tier_than = FROM }
				}
			}
			FROM = {
				any_demesne_title = {
					limit = {
						tier = DUKE
						OR = {
							title = PREVPREV
							de_jure_liege_or_above = PREVPREV
						}
					}
					ROOT = { usurp_title = { target = PREV type = invasion } }
				}
			}
		}
		
		# Have I become the vassal of the loser due to taking a duchy or kingdom?
		if = {
			limit = {
				ROOT = {
					is_liege_or_above = FROM	
				}
			}
			ROOT = {
				set_defacto_liege = ROOT
			}
		}
		
		# Vassalize the rest
		custom_tooltip = {
			text = pagan_subjugation_tip
			hidden_tooltip = {
				ROOT = {
					subjugate_or_take_under_title = { # If the target only has territory within the kingdom, he is simply vassalized
						title = PREV
						enemy = FROM
					}
				}
				FROM = {
					if = {
						limit = { is_liege_or_above = ROOT }
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
			}
		}
	}

	on_fail = {
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		ROOT = {
			piety = -100
		}
	}

	on_reverse_demand = {
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 2.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
	}
	
	on_invalidation = {
		ROOT = {
			remove_character_modifier = launched_subjugation
		}
	}

	attacker_ai_victory_worth = {
		factor = 200
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
	
	ai_will_do = { 
		factor = 1
	}
}
# The CB used by "Peasant revolter" characters
peasant_revolt = {
	name = CB_NAME_PEASANT_CONQUEST
	war_name = WAR_NAME_PEASANT_CONQUEST
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no
	
	is_independence = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			primary_title = { temporary = yes } # Revolter or adventurer trigger
			war = no
			NOT = { is_liege_or_above = FROM }
		}
	}

	can_use_title = {
		tier = count
	}

	is_valid_title = {
		OR = {
			FROM = {
				has_landed_title = PREV
			}
			holder_scope = {
				is_liege_or_above = FROM
			}
		}
	}
	
	on_success = {
		ROOT = {
			if = { #If this is a wilding revolt, flag leader's liege
				limit = {
					NOT = { trait = peasant_leader }
					culture_group = free_folk
					liege = { NOT = { character = ROOT } }
				}
				set_character_flag = wildling_liege
				hidden_tooltip = { liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 1 } } }
			}
		}	
		FROM = { change_variable = { which = fear_actions value = -20 } }
	}

	on_success_title = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } }
			if = { #Pirates make province pirate religion
				limit = { 
					ROOT = { religion = pirate } 
					location = { region = world_stepstones }
				}
				location = { religion = pirate }
			}
			if = { 
				limit = { 
					ROOT = { religion = corsair } 
					location = { region = world_basilisk_isles }
				}
				location = { religion = corsair }
			}
			if = { #Non-pirates/wildlings convert province culture
				limit = { 
					ROOT = {
						NOT = { trait = pirate } 
						NOT = { trait = wildling }
						NOT = { primary_title = { has_title_flag = wildling_rebel_title } }
					} 
				}
				location = {
					culture = ROOT
				}
			}
		}	
		#if night's watch mutiny, usurp commander
		if = {
			limit = {
				ROOT = { trait = nightswatch }
				FROM = {
					OR = {
						trait = nightswatch
						has_landed_title = k_nightswatch 
					}
				}
			}
			FROM = {
				if = {
					limit = { has_landed_title = k_nightswatch }
					k_nightswatch = { destroy_landed_title = THIS }
				}
				hidden_tooltip = {
					if = {
						limit = { has_landed_title = d_nightswatch }
						d_nightswatch = {
							succession = open_elective
							gender_succ = agnatic 
							holder_scope = { 
								recalc_succession = yes 
								set_government_type = NW_government
							}
						}
					}	
				}	
				abdicate_to = ROOT
			}
		}
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = revolt }
		ROOT = { 
			gain_all_occupied_titles = { who = FROM type = revolt }
			if = {
				limit = { NOT = { has_character_flag = wildling_liege } }
				set_defacto_liege = ROOT
			}
			if = {
				limit = { has_character_flag = wildling_liege }
				hidden_tooltip = { character_event = { id = wildling.6 days = 1 } }
			}	
			#Special Kings Landing Riot, give pretender the city
			if = {
				limit = { has_character_flag = kings_landing_riot }
				random_courtier = {
					limit = {
						culture = western_valyrian
						has_character_flag = kings_landing_riot
					}
					clr_character_flag = kings_landing_riot
					c_kings_landing = { grant_title = PREV }
					hidden_tooltip = {
						ROOT = { 	
							if = {
								limit = { is_ruler = no }
								move_character = PREV 
								give_job_title = job_castellan
							}	
						}
					}
				}
				clr_character_flag = kings_landing_riot
			}
		}
		
		
		hidden_tooltip = { 				
			ROOT = { 
				character_event = { id = maintenance.34 days = 2 } #refill holding levies		
				any_demesne_title = { 
					limit = { 
						NOT = { tier = BARON } 
						NOT = { tier = EMPEROR }
					}
					set_variable = { which = "de_facto_empire" value = 0 } 
				}
				any_realm_lord = { 
					any_demesne_title = { 
						limit = { 
							NOT = { tier = BARON } 
							NOT = { tier = EMPEROR }
						}
						set_variable = { which = "de_facto_empire" value = 0 } 
					}
				}
			}
		}
		FROM = {
			prestige = -100
		}
	}

	on_fail_title = {
		FROM = {
			prestige = 10
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = { 
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			if = {
				limit = { has_character_flag = kings_landing_riot }
				random_courtier = {
					limit = {
						culture = western_valyrian
						has_character_flag = kings_landing_riot
					}
					clr_character_flag = kings_landing_riot
					imprison = FROM
					clr_character_flag = captured_in_battle
				}
				clr_character_flag = kings_landing_riot
			}
			hidden_tooltip = {
				FROM = { #Move to random barony
					random_vassal = {
						limit = {
							tier = BARON
							is_republic = yes
						}
						ROOT = { move_character = PREV }
					}
				}
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
			}
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			prestige = 20
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 3650
				}
			}
		}
		ROOT = { 
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			if = {
				limit = { has_character_flag = kings_landing_riot }
				random_courtier = {
					limit = {
						culture = western_valyrian
						has_character_flag = kings_landing_riot
					}
					clr_character_flag = kings_landing_riot
					imprison = FROM
					clr_character_flag = captured_in_battle
				}
				clr_character_flag = kings_landing_riot
			}
			hidden_tooltip = {
				FROM = { #Move to random barony
					random_vassal = {
						limit = {
							tier = BARON
							is_republic = yes
						}
						ROOT = { move_character = PREV }
					}
				}
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# The CB used by "Heretic revolter" characters
heretic_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	hostile_against_others = yes
	attacker_can_call_allies = no
	defender_can_call_allies = no
	can_ask_to_join_war = no

	infamy_modifier = 0
	
	can_use = {
		ROOT = { has_character_flag = heretic_revolter }
	}
	
	is_valid = {
		FROM = {
			NOT = { religion = ROOT }
		}
	}

	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = 200
			piety = 100
			occupy_minors_of_occupied_settlements = FROM
			gain_all_occupied_titles = { who = FROM type = revolt }
			clr_character_flag = heretic_revolter
			hidden_tooltip = { character_event = { id = maintenance.34 days = 2 } }#refill holding levies
		}
		
		FROM = {
			prestige = -500
			piety = -500
			religion_authority = {
				modifier = lost_heretic_revolt
			}	
			change_variable = { which = fear_actions value = -20 }		
		}
	}

	on_fail = {
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			clr_character_flag = heretic_revolter
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
				FROM = { #Move to random barony
					random_vassal = {
						limit = {
							tier = BARON
							is_theocracy = yes
						}
						ROOT = { move_character = PREV }
					}
				}
			}
		}
		FROM = {
			prestige = 50
			piety = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
			religion_authority = {
				modifier = won_heretic_revolt
			}
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			clr_character_flag = heretic_revolter
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
				FROM = { #Move to random barony
					random_vassal = {
						limit = {
							tier = BARON
							is_theocracy = yes
						}
						ROOT = { move_character = PREV }
					}
				}
			}
		}
		FROM = {
			prestige = 100
			piety = 200
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 3650
				}
			}
			religion_authority = {
				modifier = won_heretic_revolt
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 150
	}
}
# The CB used by "Religious revolter" characters
religious_revolt = {
	name = CB_NAME_HERETIC_UPRISING
	war_name = WAR_NAME_HERETIC_UPRISING
	sprite = 7
	truce_days = 365
	hostile_against_others = yes
	attacker_can_call_allies = no
	defender_can_call_allies = yes
	can_ask_to_join_war = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = { has_character_flag = religious_revolter }
		#is_primary_holder_title = yes
	}
	
	is_valid = {
		FROM = {
			NOT = { religion = ROOT }
		}
	}
 
	on_success = {
		hidden_tooltip = {
			ROOT = {
				any_courtier = {
					limit = { is_ruler = no }
					move_character = FROM #so they end up in the new court
				}
			}
		}		
		FROM = {
			if = {
				limit = { #Raises Faith Authority
					higher_tier_than = DUKE
					ROOT = { religion = the_seven }
				}
				any_demesne_title = { # All titles
					limit = {
						higher_tier_than = DUKE
						OR = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						NOT = { has_law = investiture_law_3 }
					}
					if = {
						limit = { has_law = investiture_law_2 }
						add_law = investiture_law_3
					}
					if = {
						limit = { 
							NOT = { has_law = investiture_law_2 }
							NOT = { has_law = investiture_law_3 }							
						}
						add_law = investiture_law_2
					}
				}
			}
			custom_tooltip = {
				text = TOOLTIPreligious_revoltABDICATE
				hidden_tooltip = { character_event = { id = TOG.1062 } }
			}
			change_variable = { which = fear_actions value = -20 }
		}
		ROOT = {
			prestige = 200
			piety = 200
			# occupy_minors_of_occupied_settlements = FROM
			# gain_all_occupied_titles = { who = FROM type = revolt }
			# clr_character_flag = religious_revolter
			# hidden_tooltip = { character_event = { id = maintenance.34 days = 2 } }#refill holding levies
		}
		
		FROM = {
			prestige = -500
			piety = -500
			religion_authority = {
				modifier = lost_religious_revolt
			}		
		}
	}

	on_fail = {
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			clr_character_flag = religious_revolter
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
				FROM = { #Move to random barony
					random_vassal = {
						limit = {
							tier = BARON
							is_theocracy = yes
						}
						ROOT = { move_character = PREV }
					}
				}
			}
		}
		FROM = {
			if = {
				limit = { NOT = { has_character_modifier = crushed_religious_revolt } }
				prestige = 50
				piety = 50
			}
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
			religion_authority = {
				modifier = won_religious_revolt
			}
		}
	}

	on_reverse_demand = {
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			clr_character_flag = religious_revolter
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
				FROM = { #Move to random barony
					random_vassal = {
						limit = {
							tier = BARON
							is_theocracy = yes
						}
						ROOT = { move_character = PREV }
					}
				}
			}
		}
		FROM = {
			if = {
				limit = { has_character_modifier = crushed_religious_revolt }
				prestige = 25
				piety = 25
			}
			if = {
				limit = { NOT = { has_character_modifier = crushed_religious_revolt } }
				prestige = 100
				piety = 100
				add_character_modifier = {
					name = crushed_religious_revolt
					duration = 3650
				}
			}
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_revolt
					days = 3650
				}
			}
			religion_authority = {
				modifier = won_religious_revolt
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 150
	}
}

# The CB used by "Nationalist Revolter" characters
liberation_revolt = {
	name = CB_NAME_LIBERATION_REVOLT
	war_name = WAR_NAME_LIBERATION_REVOLT
	sprite = 16
	truce_days = 365
	hostile_against_others = yes
	check_de_jure_tier = KING # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	press_claim = yes
	can_ask_to_join_war = no
	is_independence = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = { has_character_flag = nationalist_rebel }
	}

	can_use_title = {
		#tier = king
		OR = {
			has_holder = no
			holder_scope = { 
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
			}
		}
	}
	
	is_valid = {
		FROM = {
			NOT = { culture = ROOT }
		}
	}

	is_valid_title = {
		OR = {
			has_holder = no
			holder_scope = { 
				OR = {
					character = FROM
					is_liege_or_above = FROM
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = 1000
			#occupy_minors_of_occupied_settlements = FROM
			custom_tooltip = {
				text = TOOLTIPnationalist_rebelVICTORY
				hidden_tooltip = {
					#gain_all_occupied_titles = { who = FROM type = revolt }
					FROM = {
						any_demesne_title = { #take all occupied titles owned by defender
							limit = {
								tier = COUNT
								location = {
									capital_holding = {
										tier = BARON
										controller = { character = ROOT }
									}
								}	
							}	
							usurp_title = { who = ROOT type = revolt }
						}
						any_realm_lord = { #take all occupied titles owned by different culture vassals
							limit = { 
								higher_tier_than = BARON 
								NOT = { culture_group = ROOT }
							}
							any_demesne_title = { #take all occupied titles owned by defender
								limit = {
									tier = COUNT
									location = {
										capital_holding = {
											tier = BARON
											controller = { character = ROOT }
										}
									}	
								}	
								usurp_title = { who = ROOT type = revolt }
							}
						}
						any_vassal = { #vassalise all occupied titles owned by same culture vassals
							limit = { 
								tier = COUNT
								is_patrician = no
								culture_group = ROOT	
								any_demesne_title = { #take all occupied titles owned by defender
									tier = COUNT
									location = {
										capital_holding = {
											tier = BARON
											controller = { character = ROOT }
										}
									}
								}								
							}
							set_defacto_liege = ROOT
						}
					}
				}
			}			
			clr_character_flag = nationalist_rebel			
			hidden_tooltip = { 
				character_event = { id = maintenance.34 days = 2 } #refill holding levies
			}
		}
		FROM = {
			prestige = -500
			change_variable = { which = fear_actions value = -20 }
		}
	}

	on_success_title = {
		custom_tooltip = {
			text = tribal_invasion_succ_tip
			hidden_tooltip = {
				if = { #fail safe, take random title
					limit = { ROOT = { NOT = { demesne_size = 1 } } }
					FROM = {
						random_realm_title = {
							limit = {
								tier = COUNT
								de_jure_liege_or_above = PREVPREV
							}
							usurp_title = { who = ROOT type = revolt }
						}
					}
				}
				ROOT = {					
					usurp_title = { target = PREV type = revolt }
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						is_revolt = yes
						type = revolt
					}
					any_claim = {
						remove_claim = ROOT
					}
					if = {
						limit = { has_nickname = no }
						random_list = {
							10 = { give_nickname = nick_the_liberator }
							10 = { give_nickname = nick_the_saviour }
							10 = { give_nickname = nick_the_champion_of_kingdom }
							10 = { give_nickname = nick_the_victorious }
							10 = { give_nickname = nick_the_triumphant }
							40 = { }
						}
					}	
				}
				FROM = {
					if = {
						limit = { is_liege_or_above = ROOT }
						character_event = { id = maintenance.25 days = 1 } #Subjugation flag maintenance
					}	
				}
			}
		}
		hidden_tooltip = { 
			ROOT = { 
				any_demesne_title = { 
					limit = { 
						NOT = { tier = BARON } 
						NOT = { tier = EMPEROR }
					}
					set_variable = { which = "de_facto_empire" value = 0 } 
				}
				any_realm_lord = { 
					any_demesne_title = { 
						limit = { 
							NOT = { tier = BARON } 
							NOT = { tier = EMPEROR }
						}
						set_variable = { which = "de_facto_empire" value = 0 } 
					}
				}
				#Establish Merchant Republic if traditional		
				if = {
					limit = {
						is_feudal = yes
						higher_tier_than = COUNT
						OR = {
							culture_group = free_cities
							culture = yunkaii
							culture = astapori
							culture = meereenese
						}
						#capital_scope = { port = yes }
						NOT = { #Don't if any vassal is a republic
							any_realm_lord = {
								is_merchant_republic = yes
								demesne_size = 1
								is_liege_or_above = ROOT
							}
						}
					}
					if = { #Find capital republic holding
						limit = { capital_holding = { NOT = { holding_type = city } } }
						random_demesne_title = {
							limit = {
								tier = BARON
								holding_type = city
								location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
							}
							province_capital = yes
							ROOT = { capital = PREV }
						}
						random_realm_lord = {
							limit = {
								any_demesne_title = {
									tier = BARON
									holding_type = city
									location = { ROOT = { capital_scope = { province_id = PREVPREV } } }	
								}	
							}
							random_demesne_title = {
								limit = {
									tier = BARON
									holding_type = city
									location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
								}	
								usurp_title = ROOT
								province_capital = yes
								ROOT = { capital = PREV }
							}
						}
					}				
					create_family_palace = yes
					primary_title = {
						add_law = succ_patrician_elective
					}
					if = {
						limit = {
							higher_tier_than = DUKE
							OR = {			
								culture = eastern_valyrian
								AND = {
									OR = {
										culture_group = valyrian
										culture = volantene
									}	
									primary_title = { title = k_volantis }
								}
							}	
							OR = { #triarch elections do not happen in the revived freehold
								NOT = { has_global_flag = revived_valyrian_freehold }
								primary_title = { NOT = { title = e_new_valyria } }
							}
						}
						set_government_type = triarch_merchant_republic_government
					}
					if = {
						limit = {
							NOT = { government = triarch_merchant_republic_government }
						}
						set_government_type = merchant_republic_government
					}
					any_realm_lord = {
						limit = { is_patrician = yes }
						set_defacto_liege = ROOT
					}
					character_event = { id = faction_event_new.67 } #If still not 5 patricians found, randomly add more
					if = { #If Triarchy no election for a year
						limit = {
							government = triarch_merchant_republic_government
						}
						set_character_flag = volantene_election
					}			
				}
			}
			
		}
#		if = {
#			limit = { ROOT = { is_landed = no } }
#			FROM = {
#				random_realm_province = {
#					limit = {
#						culture = ROOT
#						kingdom = {
#							title = PREVPREVPREV
#						}
#					}
#					county = {
#						usurp_title = ROOT
#					}
#				}
#			}
#		}
#		grant_title = ROOT

	}

	on_fail_title = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
			}
		}
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			clr_character_flag = nationalist_rebel
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
				remove_trait = inspiring_leader
				if = {
					limit = { NOT = { dynasty = 0 } }
					random_dynasty_member = {
						limit = {
							is_ruler = yes
							is_alive = yes
						}
						ROOT = { move_character = PREV }
						break = yes
					}
					random_dynasty_member = {
						limit = {
							is_ruler = no
							is_alive = yes
						}
						liege = { ROOT = { move_character = PREV } }
						break = yes
					}
				}	
				FROM = {
					random_vassal = {
						limit = {
							tier = BARON
							is_republic = yes
						}
						ROOT = { move_character = PREV }
					}
				}
			}
		}
	}
	
	on_reverse_demand_title = {
		FROM = {
			hidden_tooltip = {
				any_realm_province = { # Five years of -100% revolt risk in entire kingdom
					limit = { kingdom = { title = PREVPREVPREV } }
					add_province_modifier = {
						name = recent_county_uprising
						duration = 1825
					}
				}
			}
		}	
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		FROM = {
			prestige = 200
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				add_character_modifier = { 
					name = crushed_major_revolt
					days = 3650
				}
			}
		}
		
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			clear_wealth = yes
			clr_character_flag = nationalist_rebel
			hidden_tooltip = {
				add_character_modifier = { 
					name = broken_spirit
					days = -1
				}
				remove_trait = inspiring_leader
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = 100
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

duchy_adventure = {
	name = CB_NAME_DUCHY_ADVENTURE
	war_name = WAR_DUCHY_ADVENTURE
	sprite = 9
	truce_days = 3650
	is_permanent = yes
	hostile_against_others = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	attacker_can_call_allies = no

	infamy_modifier = 0
	
	can_use = {
		ROOT = { 
			OR = {
				has_character_flag = duchy_adventurer 
				AND = { #Allow player who is somehow landless to attack someone
					ai = no
					NOT = { demesne_size = 1 }
					primary_title = { is_landless_type_title = yes }
					war = no
					NOT = { trait = nightswatch }
					NOT = { trait = kingsguard }
					NOT = { trait = liberator } #use liberation cb instead
				}
			}	
		}
		FROM = { 
			NOT = { culture_group = winter_group }
			NOT = { culture_group = unoccupied_group }		
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}
	}
	
	can_use_title = {
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}
	}

	is_valid = {
		always = yes
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = { 
			prestige = 250
			hidden_tooltip = {
				clr_character_flag = duchy_adventurer
				#give_nickname = nick_the_conqueror
			}
		}
		FROM = {
			prestige = -250 
			change_variable = { which = fear_actions value = -20 }
		}
	}

	on_success_title = {
		if = {
			limit = { 
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
					}
				}
				controls_religion = no
			}
			usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
		}
		custom_tooltip = {
			text = other_invasion_succ_tip
			hidden_tooltip = {
				any_de_jure_vassal_title = { # take all occupied counties under the one we're fighting for
					limit = {
						tier = COUNT
						holder_scope = {
							OR = {
								character = FROM
								is_liege_or_above = FROM
							}
						}
						location = {
							any_province_lord = {
								any_demesne_title = {
									tier = BARON
									location = { province_id = PREVPREVPREV }
									controller = { character = ROOT }
								}
							}
						}
						controls_religion = no
					}
					usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
					ROOT = { #convert to nomad
						if = {
							limit = { 
								is_tribal = yes
								OR = {
									culture = dothraki
									culture = jogos_nhai
									FROM = { is_nomadic = yes }
								}
							}	
							set_government_type = nomadic_government
						}
					}
					if = { #Nomads take traditional lands
						limit = { 
							location = { has_province_flag = dothraki_sea }
							ROOT = { is_nomadic = yes } 
						}
						location = {
							province_event = { id = dothraki.610 } #province maintenance
						}
					}
				}
				ROOT = {
					vassalize_or_take_under_title = { #vassalise the rest
						title = PREV
						enemy = FROM
						type = host
					}
					FROM = {
						if = {
							limit = { is_liege_or_above = ROOT }
							character_event = { id = maintenance.25 } #Subjugation flag maintenance
						}	
					}
					character_event = { id = maintenance.34 days = 2 } #refill holding levies
				}
			}
		}		
		if = {
			limit = { has_holder = no }
			gain_title = { target = ROOT type = invasion }
		}	
		#If in the Stepstones/Basilisk Isles give Kingdom title if possible
		if = {
			limit = {
				dejure_liege_title = {
					has_holder = no
					OR = {
						title = k_stepstones
						title = k_basilisk_isles
					}
				}
			}
			dejure_liege_title = { gain_title = { target = ROOT type = invasion } }
		}		
		
		hidden_tooltip = {
			ROOT = {
				if = { #Make sure demesne size is at least 1
					limit = { NOT = { demesne_size = 1 } }
					random_vassal = {
						limit = {	tier = COUNT }
						random_demesne_title = { 
							limit = { tier = COUNT }
							usurp_title = { target = ROOT type = invasion }
						}
					}
				}
				if = { #Make sure new realm is feudal
					limit = { 
						NOT = { is_nomadic = yes }
						NOT = { government = nomadic_government } 
						NOT = { government = feudal_government } 
					}
					family_palace = { destroy_settlement = THIS }
					set_government_type = feudal_government
					random_vassal = {
						limit = {						
							any_demesne_title = {
								tier = BARON
								holding_type = castle
								location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
							}
						}
						random_demesne_title = { 
							limit = {
								tier = BARON
								holding_type = castle
								location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
							}
							usurp_title = { target = ROOT type = invasion }
						}
					}
					random_demesne_title = { 
						limit = {
							tier = BARON
							holding_type = castle
							location = { ROOT = { capital_scope = { province_id = PREVPREV } } }
						}
						province_capital = yes
						ROOT = { capital = PREV }
					}				
				}
				if = {
					limit = { NOT = { has_character_flag = yi_ti_warlord } }
					set_defacto_liege = THIS
					any_demesne_title = { 
						limit = { 
							NOT = { tier = BARON } 
							NOT = { tier = EMPEROR } 
						}
						set_variable = { which = "de_facto_empire" value = 0 } 
					}
					any_realm_lord = {
						any_demesne_title = { 
							limit = { 
								NOT = { tier = BARON } 
								NOT = { tier = EMPEROR } 
							}
							set_variable = { which = "de_facto_empire" value = 0 } 
						}
					}
				}	
				clr_character_flag = yi_ti_warlord
			}
			#Special Rogue prince effect
			ROOT = {
				if = {
					limit = { 
						character = 779496 
						has_landed_title = d_daemons_host
					}	
					activate_title = { status = no title = d_daemons_host }
					d_daemons_host = { destroy_landed_title = ROOT }
					k_stepstones = { add_pressed_claim = FROM }
					character_event = { id = rogue_prince.8 days = 365 }
					if = {
						limit = { ai = yes }
						set_character_flag = mega_war_remove_leader
						clr_character_flag = mega_war_remove_leader
					}
				}			
			}
		}
	}

	on_fail = {
		FROM = {
			prestige = 100
			hidden_tooltip = {
				opinion = {
					modifier = opinion_rebel_traitor 
					who = ROOT
					months = 1200
				}
				character_event = { id = TOG.1377 days = 1 } #Post Adventure Loss Maintenance
			}
		}
		ROOT = {
			hidden_tooltip = {
				disband_event_forces = duchy_adventure
				clr_character_flag = duchy_adventurer
				clr_character_flag = yi_ti_warlord
				#Special Rogue prince effect
				if = {
					limit = { 
						character = 779496 
						has_landed_title = d_daemons_host
					}	
					activate_title = { status = no title = d_daemons_host }
					d_daemons_host = { destroy_landed_title = ROOT }
				}
			}
		}
	
		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			hidden_tooltip = { character_event = { id = TOG.1377 days = 1 } }#Post Adventure Loss Maintenance
		}
		
		FROM = {
			prestige = 200
		}
		
		ROOT = {
			imprison = FROM
			clr_character_flag = captured_in_battle
			prestige = -200
			hidden_tooltip = {
				disband_event_forces = duchy_adventure
				clr_character_flag = duchy_adventurer
				clr_character_flag = yi_ti_warlord
				#Special Rogue prince effect
				if = {
					limit = { 
						character = 779496 
						has_landed_title = d_daemons_host
					}	
					activate_title = { status = no title = d_daemons_host }
					d_daemons_host = { destroy_landed_title = ROOT }
				}
			}
		}
	}
	
	on_attacker_leader_death = {
		ROOT = {
			hidden_tooltip = {
				disband_event_forces = duchy_adventure
				clr_character_flag = duchy_adventurer
				#Special Rogue prince effect
				if = {
					limit = { 
						character = 779496 
						has_landed_title = d_daemons_host
					}	
					activate_title = { status = no title = d_daemons_host }
					d_daemons_host = { destroy_landed_title = ROOT }
				}
			}
		}
		end_war = invalid
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

pagan_holy_war = {
	name = CB_NAME_RELIGIOUS
	war_name = WAR_NAME_RELIGIOUS
	sprite = 9
	truce_days = 1825
	is_permanent = yes
	is_holy_war = yes
	check_de_jure_tier = DUKE # this scans all dejure duchies for the counties which are held by or vassals(or below) of selected character. Only valid if is_permanent = yes
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	can_use_gui = {
		ROOT = {
			piety = 100
		}
	}
	
	on_add = {
		ROOT = { piety = -100 }
	}

	can_use = {
		ROOT = { 
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard } 
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
		}
		FROM = { 
			NOT = { culture_group = unoccupied_group } 
			NOT = { culture_group = winter_group }
		}
		OR = {
			ROOT = { trait = wildling }
			FROM = { NOT = { trait = nightswatch } }
		}		
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
		ROOT = {
			OR = {
				#religion = norse_pagan_reformed
				#religion = tengri_pagan_reformed
				#religion = baltic_pagan_reformed
				#religion = slavic_pagan_reformed
				#religion = finnish_pagan_reformed
				religion = aztec_reformed
				religion = aztec
				#religion = west_african_pagan_reformed
			}
			NOT = { same_realm = FROM }
			NOT = { religion = FROM }
			top_liege = {
				religion = ROOT
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	can_use_title = {
		OR = {
			AND = {
				NOT = { title = d_kingsguard }
				NOT = { title = b_white_sword_tower }
			}
			FROM = { NOT = { trait = kingsguard } }
		}
		controls_religion = no
		# The attacker needs at least one county in the target kingdom, or a border, or be only two sea zones away from one of your counties
		any_direct_de_jure_vassal_title = {
			OR = {
				holder_scope = {
					OR = {
						character = ROOT
						is_liege_or_above = ROOT
					}
				}
				location = {
					any_neighbor_province = {
						OR = {
							AND = {
								has_owner = yes
								owner = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
									}
								}
							}
							AND = {
								is_land = no
								any_neighbor_province = {
									OR = {
										AND = {
											has_owner = yes
											owner = {
												OR = {
													character = ROOT
													is_liege_or_above = ROOT
												}
											}
										}
										AND = {
											is_land = no
											any_neighbor_province = {
												owner = {
													OR = {
														character = ROOT
														is_liege_or_above = ROOT
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}

	is_valid = {
		ROOT = {
			OR = {
				#religion = norse_pagan_reformed
				#religion = tengri_pagan_reformed
				#religion = baltic_pagan_reformed
				#religion = slavic_pagan_reformed
				#religion = finnish_pagan_reformed
				religion = aztec_reformed
				religion = aztec
				#religion = west_african_pagan_reformed
			}
			NOT = { same_realm = FROM }
			NOT = { religion = FROM }
			top_liege = {
				NOT = { religion = FROM }
			}
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}
	
	on_success = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_piety = 100
			participation_scaled_prestige = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_piety = 100
				participation_scaled_prestige = 50
			}
		}
		
		ROOT = { 
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}
			
			hidden_tooltip = {
				if = {
					limit = {
						has_nickname = no
					}
					random_list = {
						10 = { give_nickname = nick_the_dragon }
						10 = { give_nickname = nick_the_holy }
						10 = { give_nickname = nick_bloodaxe }
						10 = { give_nickname = nick_the_great }
						40 = { give_nickname = nick_the_sword_of_god }
					}
				}
			}
		}
		FROM = { 
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}		
		}
		FROM = { piety = -100 }
		FROM = { prestige = -50 }
	}

	on_success_title = {
		custom_tooltip = {
			text = religious_cb_succ_tip
			hidden_tooltip = {
				ROOT = {
					vassalize_or_take_under_title = {
						title = PREV
						enemy = FROM
						same_religion = yes # Only vassalize rulers of my religion
						is_religious = yes
						type = holy_war
					}
				}
				FROM = {
					if = {
						limit = { is_liege_or_above = ROOT }
						character_event = { id = maintenance.25 } #Subjugation flag maintenance
					}	
				}
			}
		}
	}

	on_fail = {
		ROOT = { piety = -50 }
		ROOT = { prestige = -100 }
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_piety = 200
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { 
				participation_scaled_piety = 200
				participation_scaled_prestige = 100
			}
		}
		ROOT = { 
			religion_authority = {
				modifier = lost_holy_war
				years = 20
			}
		}
		FROM = { 
			religion_authority = {
				modifier = won_holy_war
				years = 20
			}		
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

# Caliphs can subjugate people of their own religion
#caliphal_subjugation = {
#}

#muslim_county_conquest = { 
#}

pagan_county_conquest = {
	name = CB_NAME_COUNTY_CONQUEST
	war_name = WAR_NAME_COUNTY_CONQUEST
	sprite = 16
	truce_days = 1825
	hostile_against_others = yes
	is_permanent = yes
	check_all_titles = yes # if permanent, setting this to true will check against all of someones titles, including vassal held titles
	press_claim = yes
	can_ask_to_join_war = no
	allowed_to_target_tributaries = no
	allowed_to_target_suzerains = no

	infamy_modifier = 0
	
	allow_distant = yes
	
	can_use_gui = {
		ROOT = {
			is_adult = yes
			prestige = 350
			NOT = { trait = content }
			NOT = { trait = incapable }
		}
	}
	
	can_use = {
		ROOT = {
			OR = {
				religion_group = pagan_group
				AND = {
					culture = ibbenese
					independent = yes
					higher_tier_than = DUKE
				}	
			}	
			NOT = { same_realm = FROM }
			
			NOT = { trait = nightswatch } 
			NOT = { trait = kingsguard }
		}
		FROM = {
			NOT = { religion = ROOT }
			
			NOT = { culture_group = unoccupied_group }
			NOT = { culture_group = winter_group }
			NOT = { trait = nightswatch }
		}
		OR = { #Cannot attack vassals split by mega war
			NOT = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } } }
			NOT = { ROOT = { higher_tier_than = FROM } }
		}
		OR = {
			NOT = { ROOT = { has_global_flag = war_cooldown_period } }
			ROOT = { had_global_flag = { flag = war_cooldown_period	 days = 25 } }
		}	
	}

	can_use_title = {
		tier = count
		
		holder_scope = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}	
		}	
		OR = {
			AND = {
				ROOT = { culture = ibbenese }
				location = { 
					region = world_shivering_sea
				}
			}
			AND = {
				ROOT = { NOT = { culture = ibbenese } }
				location = {
					any_neighbor_province = {
						owner = {
							OR = {
								character = ROOT
								is_liege_or_above = ROOT
							}
						}
					}
				}
			}	
		}
		OR = { #cant invade nomad domains
			holder_scope = {
				NOT = { is_nomadic = yes }
			}
			location = { NOT = { has_province_flag = dothraki_sea } }
		}
	}
	
	on_add = { 
		ROOT = {
			if = {
				limit = { culture = ibbenese }
				prestige = -350 
			}
		}	
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_INVASION_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	is_valid_title = {
		ROOT = {
			OR = {
				religion_group = pagan_group
				AND = {
					culture = ibbenese
					independent = yes
					higher_tier_than = DUKE
				}	
			}
			NOT = { same_realm = FROM }
		}
		FROM = {
			NOT = { religion = ROOT }
		}
	
		holder_scope = {
			OR = {
				character = FROM
				is_liege_or_above = FROM
			}	
		}
	}

	on_success_title = {
		hidden_tooltip = { ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } }
		usurp_title_plus_barony_if_unlanded = { target = ROOT type = invasion }
		
		any_de_jure_vassal_title = { # take all baronies too
			limit = {
				has_holder = yes
				holder_scope = {
					OR = {
						character = FROM
						is_liege_or_above = FROM
						AND = {
							is_liege_or_above = ROOT
							NOT = { culture = ROOT }
							NOT = { religion = ROOT }
						}
					}
				}
			}

			usurp_title = ROOT
		}
		
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { 
				participation_scaled_prestige = 100 
				participation_scaled_piety = 50
			}
		}
		
		ROOT = {
			religion_authority = {
				modifier = won_county_conquest
			}
		}
	}

	on_fail_title = {
		ROOT = {
			prestige = -100
			religion_authority = {
				modifier = lost_county_conquest
			}
		}
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
	}

	on_reverse_demand = {
		hidden_tooltip = { FROM = { add_character_modifier = { name = victory_timer duration = 3 } } }
		ROOT = {
			prestige = -200
			transfer_scaled_wealth = {
				to = FROM
				value = 4.0
			}
			religion_authority = {
				modifier = lost_county_conquest
			}
		}
		any_defender = {
			limit = { character = FROM }
			character_event = { id = maintenance.2199 tooltip = TOOLTIPmaintenance.2199 } #Take back dejure vassals (AGOT)
			participation_scaled_prestige = 100
			participation_scaled_piety = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = {
				participation_scaled_prestige = 100 
				participation_scaled_piety = 50
			}
		}
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}
#64
increase_council_power_war = { # Started from faction
	name = CB_NAME_INCREASE_COUNCIL_POWER
	war_name = WAR_NAME_INCREASE_COUNCIL_POWER
	sprite = 6
	truce_days = 3650
	can_call_allies = no
	can_ask_to_join_war = no
	#major_revolt = yes

	infamy_modifier = 0
	
	can_use = {
		ROOT = {
			vassal_of = FROM
		}
	}
	
	can_use_title = {
		higher_tier_than = BARON
		OR = {
			has_law = law_voting_power_0
			has_law = diplomacy_voting_power_0
			has_law = titles_voting_power_0
			has_law = justice_voting_power_0
		}
	}
	
	is_valid = {
	}
	
	on_add_title = {
		event_target:chronicle_player = {
			if = {
				limit = { character = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CA_ATTACKER
					portrait = [From.GetID]
				}
				break = yes
			}
			if = {
				limit = { character = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CA_DEFENDER
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = ROOT }
				chronicle = {
					entry = CHRONICLE_WAR_CA_ATTACKER_LIEGE
					portrait = [Root.GetID]
				}
				break = yes
			}
			if = {
				limit = { is_liege_or_above = FROM }
				chronicle = {
					entry = CHRONICLE_WAR_CA_DEFENDER_LIEGE
					portrait = [From.GetID]
				}
			}
		}
	}

	on_success = {
		hidden_tooltip = { 
			ROOT = { add_character_modifier = { name = victory_timer duration = 3 } } 
			if = {
				limit = { 
					ROOT = { trait = rebel_leader }
					FROM = { 
						tier = EMPEROR
						trait = civil_war	
					}
				}
				any_defender = {
					character_event = { id = mega_wars.86 days = 1 } #rebel leader resolution
				}
				FROM = { any_courtier = { set_character_flag = former_royal_courtier } }
			}
		}
		ROOT = {
			opinion = {
				modifier = opinion_increased_council_power
				who = FROM
				months = 12
			}
		}
		any_attacker = {
			limit = { character = ROOT }
			participation_scaled_prestige = 100
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		any_attacker = {
			limit = { NOT = { character = ROOT } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
			hidden_tooltip = {
				disband_event_forces = faction_revolters
			}
		}
		FROM = {
			hidden_tooltip = { disband_event_forces = faction_loyalists } 
			change_variable = { which = fear_actions value = -20 }
		}
	}

	on_success_title = {
		if = {
			limit = { has_law = law_voting_power_1 }
			if = {
				limit = { has_law = diplomacy_voting_power_1 }
				if = {
					limit = { has_law = titles_voting_power_1 }
					if = {
						limit = { has_law = justice_voting_power_0 }
						add_law_w_cooldown = justice_voting_power_1
						break = yes
					}
				}
				if = {
					limit = { has_law = titles_voting_power_0 }
					add_law_w_cooldown = titles_voting_power_1
					break = yes
				}
			}
			if = {
				limit = { has_law = diplomacy_voting_power_0 }
				add_law_w_cooldown = diplomacy_voting_power_1
				break = yes
			}
			break = yes
		}
		if = {
			limit = { has_law = law_voting_power_0 }
			add_law_w_cooldown = law_voting_power_1
			break = yes
		}
	}

	on_fail = {
		ROOT = {
			prestige = -100
		}
		
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 50
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 50 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	on_reverse_demand = {
		hidden_tooltip = { 
			FROM = { 
				add_character_modifier = { name = victory_timer duration = 3 } 
				change_variable = { which = fear_actions value = 10 } 
			} 
		} 
		ROOT = {
			prestige = -200
			prisoner = FROM
		}
		
		any_defender = {
			limit = { character = FROM }
			participation_scaled_prestige = 100
		}
		any_defender = {
			limit = { NOT = { character = FROM } }
			hidden_tooltip = { participation_scaled_prestige = 100 }
		}
		
		hidden_tooltip = {
			any_attacker = {
				limit = { liege = { character = FROM } }
				prisoner = FROM
				disband_event_forces = faction_revolters
				add_character_modifier = {
					name = faction_council_power_ultimatum_timer
					hidden = yes
					duration = 3650
				}
			}
			if = {
				limit = { 
					FROM = { tier = EMPEROR }
					#
				}
				any_attacker = {
					character_event = { id = mega_wars.74 days = 1 } #king can revoke titles of LPs and non direct vassals
				}
			}
		}
		FROM = { hidden_tooltip = { disband_event_forces = faction_loyalists } }
	}

	attacker_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	attacker_ai_defeat_worth = {
		factor = 100
	}

	defender_ai_victory_worth = {
		factor = -1 # always accept
	}
	
	defender_ai_defeat_worth = {
		factor = 100
	}
}

#shia_caliphate_rising = {
#}
# depose_antipope = {
# }
# cb_install_antiking = {
# }
# buddhist_holy_war = {
# }
# indian_subjugation = {
# }
# manifest_destiny_invasion = {
# }
# cb_decadence_usurption = {
# }
# rivalry_cb = {
# }
# tributary_cb = {
# }
# free_tributary_cb = {
# }
# cb_install_khan = {
# }
# nomad_dispute = {
# }
# cb_liberate_nomad_duchy = {
# }
# cb_minor_clan_revolt = {
# }
# nomad_subjugation = {
# }
# nomad_invasion = {
# }
# nomad_expansion = {
# }






