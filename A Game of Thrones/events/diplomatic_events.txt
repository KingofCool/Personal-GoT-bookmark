namespace = diplomatic

#######################
###Republic Coalitions#####
#######################
#A foreign power is invading, can call to arms realms of same culture group
character_event = {
	id = diplomatic.3099

	only_independent = yes
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		demesne_size = 1
		FROM = {
			NOT = { liege_before_war = { character = ROOT } }
			NOT = { same_realm = ROOT }
			NOT = { primary_title = { ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } } }
			demesne_size = 1
		}
	}
	
	immediate = {
		character_event = { id = diplomatic.30 days = 20 }
	}
	
	option = {
		name = OK
	}
}	
character_event = {
	id = diplomatic.30
	desc = "EVTDESCdiplomatic.30"
	
	only_independent = yes
	is_triggered_only = yes
	show_from_from = yes
	war = yes	
	
	trigger = {	
		war_with = FROMFROM
		FROMFROM = {
			NOT = { liege_before_war = { character = ROOT } }
			NOT = { same_realm = ROOT }
			NOT = { primary_title = { ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } } }
			demesne_size = 1
			
			NAND = { #Only used for King tier or above during Aegon's Conquest
				has_landed_title = e_iron_throne
				has_global_flag = aegons_conquest
				ROOT = { lower_tier_than = KING }
			}
		}		
		any_war = {
			attacker = { character = FROMFROM }
			defender = { character = ROOT }
			OR = {
				ROOT = {
					OR = {
						is_theocracy = yes
						is_republic = yes
					}		
				}
				#All rulers can call for help in invasions
				using_cb = invasion
				using_cb = tribal_invasion
				using_cb = war_of_enslavement
				using_cb = war_of_liberation
				using_cb = dothraki_invasion
				using_cb = AGOT_invasion
				using_cb = invasion_ironborn
				using_cb = dragon_conquest
				using_cb = pirate_invasion
				using_cb = invasion_ambition
			}
			NOT = { using_cb = cb_faction_independence }
			NOT = { using_cb = embargo_cb }
			#NOT = { using_cb = other_dejure_barony_claim }
			NOT = { using_cb = dejure_barony_claim }
			NOT = { using_cb = dejure_county_claim }
			NOT = { using_cb = other_dejure_county_claim }
			NOT = { using_cb = seize_trade_post }
			NOT = { using_cb = dejure_duchy_claim }
			NOT = { using_cb = other_dejure_duchy_claim }
			NOT = { using_cb = bid_for_independence_CW }
			NOT = { using_cb = bloody_vengeance }
			NOT = { using_cb = reclaim_ancestral_sword }
			NOT = { using_cb = slave_raid }
			NOT = { using_cb = dothraki_raid }
			
			NOT = { using_cb = peasant_revolt }
			NOT = { using_cb = heretic_revolt }
			NOT = { using_cb = cb_minor_clan_revolt }
			NOT = { using_cb = native_revolt }
		}
		NAND = {
			is_nomadic = yes
			FROMFROM = { is_nomadic = yes }
		}
		any_independent_ruler = {
			demesne_size = 1	
			OR = {
				tier = EMPEROR
				primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
			}	
			#OR = { #Either
				culture_group = ROOT #Same culture group
				### using_cb does not work properly atm
				# AND = { #Is a fellow slaver and ROOT is being liberated
					# primary_title = { has_law = slavery_2 }
					# ROOT = { 
						# primary_title = { has_law = slavery_2 } 
						# any_war = { 
							# OR = {
								# using_cb = war_of_emancipation
								# using_cb = war_of_liberation 
							# }	
						# }
					# }					
				# }
				# AND = { #Is a liberator and ROOT is being enslaved
					# trait = liberator
					# ROOT = { 
						# any_war = { 
							# defender = { character = ROOT }
							# using_cb = war_of_enslavement 
						# }
					# }					
				# }
			#}			
			# capital_scope = { #Can only ask relatively close rulers
				# ROOT = {
					# capital_scope = {
						# NOT = {
							# distance = {
								# where = PREVPREV
								# value = 1150
							# }
						# }	
					# }
				# }
			# }
			OR = {
				NOT = { trait = pirate }
				ROOT = { trait = pirate }
			}
			is_within_diplo_range = ROOT
			NOT = { war_with = FROMFROM }
			NOT = { war_with = ROOT }
			NOT = { character = ROOT }
			NOT = { culture_group = unoccupied_group }
			#NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_rejected_coalition  } }
		}
		# OR = {
			# NOT = { has_character_flag = no_coalition_help }
			# had_character_flag = { flag = no_coalition_help days = 1825 }
		# }
	}

	option = {
		name = "EVTOPTAdiplomatic.30" #Yes, ask for help
		ai_chance = {
			factor = 80
			#Never ask for help agaisnt really weak powers
			modifier = {
				factor = 0.0001
				FROMFROM = { NOT = { relative_power = { who = ROOT power = 0.25 } }  } 
			}
			#Will want help against stronger powers
			modifier = {
				factor = 2
				FROMFROM = { relative_power = { who = ROOT power = 1.5 } } 
			}
			modifier = {
				factor = 3
				FROMFROM = { trait = dragon_rider }
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 2
				trait = diligent
			}
		}	
		clr_character_flag = no_coalition_help
		if = {
			limit = { ai = no }
			prestige = -100
			wealth = -50
		}	
		any_independent_ruler = {
			limit = {
				demesne_size = 1	
				OR = {
					tier = EMPEROR
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
				}	
				#OR = { #Either
					culture_group = ROOT #Same culture group
					### using_cb does not work properly atm
					# AND = { #Is a fellow slaver and ROOT is being liberated
						# primary_title = { has_law = slavery_2 }
						# ROOT = { 
							# primary_title = { has_law = slavery_2 } 
							# any_war = { 
								# OR = {
									# using_cb = war_of_emancipation
									# using_cb = war_of_liberation 
								# }	
							# }
						# }					
					# }
					# AND = { #Is a liberator and ROOT is being enslaved
						# trait = liberator
						# ROOT = { 
							# any_war = { 
								# defender = { character = ROOT }
								# using_cb = war_of_enslavement 
							# }
						# }					
					# }
				#}			
				# capital_scope = { #Can only ask relatively close rulers
					# ROOT = {
						# capital_scope = {
							# NOT = {
								# distance = {
									# where = PREVPREV
									# value = 1150
								# }
							# }	
						# }
					# }
				# }
				OR = {
					NOT = { trait = pirate }
					ROOT = { trait = pirate }
				}
				is_within_diplo_range = ROOT
				NOT = { war_with = FROMFROM }
				NOT = { war_with = ROOT }
				NOT = { character = ROOT }
				NOT = { culture_group = unoccupied_group }
				#NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_rejected_coalition  } }
			}
			letter_event = { id = diplomatic.31 days = 5 tooltip = TOOLTIPdiplomatic.31 }
		}
	}
	
	option = {
		name = "EVTOPTBdiplomatic.30" #No
		ai_chance = {
			factor = 20
			#always ask for help against strong powers
			modifier = {
				factor = 0
				FROMFROM = { relative_power = { who = ROOT power = 2 } } 
			}
			#Will not want help against weaker powers
			modifier = {
				factor = 2
				FROMFROM = { NOT = { relative_power = { who = ROOT power = 0.66 } }  } 
			}
			modifier = {
				factor = 2
				FROMFROM = { NOT = { relative_power = { who = ROOT power = 0.5 } } } 
			}
			modifier = {
				factor = 3
				FROMFROM = { NOT = { relative_power = { who = ROOT power = 0.33 } } } 
			}
			
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = slothful
			}
		}	
		#set_character_flag = no_coalition_help
	}
}
#Ruler receives calls to arms
letter_event = {
	id = diplomatic.31
	desc = "EVTDESCdiplomatic.31"
	
	is_triggered_only = yes

	option = {
		name = "EVTOPTAdiplomatic.31" #Yes
		ai_chance = {
			factor = 30
			
			modifier = {
				factor = 1.5
				is_married = FROM
			}
			modifier = {
				factor = 2
				is_close_relative = FROM
			}
			modifier = {
				factor = 1.5
				dynasty = FROM
			}
			modifier = {
				factor = 1.25
				religion = FROM
			}
			
			#Will want to help weaker powers
			modifier = {
				factor = 1.5
				relative_power = { who = FROM power = 1.5 }
			}
			modifier = {
				factor = 1.5
				relative_power = { who = FROM power = 2 }
			}
			modifier = {
				factor = 2
				relative_power = { who = FROM power = 3 }
			}
			modifier = {
				factor = 5
				relative_power = { who = FROM power = 4 }
			}
			
			#Will want to help against stronger powers
			modifier = {
				factor = 1.25
				FROMFROMFROM = { relative_power = { who = ROOT_FROM power = 1.5 } }
			}
			modifier = {
				factor = 1.25
				FROMFROMFROM = { relative_power = { who = ROOT_FROM power = 2 } }
			}
			modifier = {
				factor = 1.5
				FROMFROMFROM = { relative_power = { who = ROOT_FROM power = 3 } }
			}
			modifier = {
				factor = 2
				FROMFROMFROM = { relative_power = { who = ROOT_FROM power = 4 } }
			}
			modifier = {
				factor = 3
				FROMFROMFROM = { trait = dragon_rider }
			}
			modifier = {
				factor = 1.5
				FROMFROMFROM = { NOT = { culture_group = ROOT } }
			}
			modifier = {
				factor = 1.5
				FROMFROMFROM = { NOT = { religion_group = ROOT } }
			}
			
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 80 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROM value = 100 }
			}	
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROMFROM value = -19 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROMFROM value = -39 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROMFROM value = -59 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROMFROM value = -79 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROMFROM value = -99 } }
			}
			
			modifier = {
				factor = 1.5
				trait = diligent
			}	
			modifier = {
				factor = 1.5
				trait = honorable
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}	
			modifier = {
				factor = 1.5
				trait = proud
			}	
			modifier = {
				factor = 1.5
				trait = zealous
			}			
		}
		join_defender_wars = FROM
		FROMFROMFROM = { tooltip = { } }
		hidden_tooltip = {
			FROM = {
				letter_event = { id = diplomatic.32 }
			}
		}		
	}
	
	option = {
		name = "EVTOPTBdiplomatic.31" #No
		ai_chance = {
			factor = 50
			
			modifier = {
				factor = 2
				NOT = { wealth = -29 }
			}
			modifier = {
				factor = 2
				FROM = { trait = dragon_rider }
			}
			modifier = {
				factor = 1.5
				OR = {
					is_tribal = yes
					is_feudal = yes
				}	
			}
			
			#Reluctance to help slavers
			modifier = {
				factor = 4
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				OR = {
					trait = zealous
					trait = honorable
					trait = kind
					AND = {
						NOT = { trait = arbitrary }
						NOT = { trait = ruthless }
						NOT = { trait = lunatic }
					}	
				}
				FROM = { 
					OR = {
						has_slavery_religion_trigger = yes
						has_slavery_culture_trigger = yes
						culture = ironborn
						trait = slave_trader
					}
					crownlaw_title = { 
						OR = {
							has_law = slavery_2 
							has_law = slavery_3
						}	
					}
				}				
			}
			
			#Will not want to help stronger powers
			modifier = {
				factor = 1.5
				NOT = { relative_power = { who = FROM power = 0.66 } }
			}
			modifier = {
				factor = 2
				NOT = { relative_power = { who = FROM power = 0.5 } }
			}
			modifier = {
				factor = 2
				NOT = { relative_power = { who = FROM power = 0.33 } }
			}
			modifier = {
				factor = 5
				NOT = { relative_power = { who = FROM power = 0.25 } }
			}
			
			#Will not want to help against weaker powers
			modifier = {
				factor = 1.25
				FROMFROMFROM = { NOT = { relative_power = { who = ROOT_FROM power = 0.66 } } }
			}
			modifier = {
				factor = 1.5
				FROMFROMFROM = { NOT = { relative_power = { who = ROOT_FROM power = 0.5 } } }
			}
			modifier = {
				factor = 2
				FROMFROMFROM = { NOT = { relative_power = { who = ROOT_FROM power = 0.33 } } }
			}
			modifier = {
				factor = 5
				FROMFROMFROM = { NOT = { relative_power = { who = ROOT_FROM power = 0.25 } } }
			}
			
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -19 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -39 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -59 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -79 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROM value = -99 } }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROMFROM value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROMFROM value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROMFROM value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROMFROM value = 80 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROMFROM value = 100 }
			}
			
			#Too far away
			modifier = {
				factor = 4
				capital_scope = { region = world_westeros }
				NOT = { FROM = { capital_scope = { region = world_westeros } } }
			}
			modifier = {
				factor = 1.5
				FROM = {
					capital_scope = {
						ROOT = {
							capital_scope = {
								distance = {
									where = PREVPREV
									value = 500
								}
							}
						}
					}
				}
			}	
			modifier = {
				factor = 1.5
				FROM = {
					capital_scope = {
						ROOT = {
							capital_scope = {
								distance = {
									where = PREVPREV
									value = 700
								}
							}
						}
					}
				}
			}
			modifier = {
				factor = 2
				FROM = {
					capital_scope = {
						ROOT = {
							capital_scope = {
								distance = {
									where = PREVPREV
									value = 900
								}
							}
						}
					}
				}
			}
			
			modifier = {
				factor = 1.5
				trait = slothful
			}	
			modifier = {
				factor = 1.5
				trait = ruthless
			}
			modifier = {
				factor = 1.5
				trait = patient
			}	
			modifier = {
				factor = 1.5
				trait = humble
			}	
			modifier = {
				factor = 1.5
				trait = cynical
			}		
		}		
		FROM = {
			opinion = { who = ROOT modifier = opinion_rejected_coalition }
			hidden_tooltip = { letter_event = { id = diplomatic.34 } }
		}
	}
}
#Inform accept
letter_event = {
	id = diplomatic.32
	desc = "EVTDESCdiplomatic.32"
	
	is_triggered_only = yes

	option = {
		name = "EVTOPTAdiplomatic.32" #
		hidden_tooltip = { 
			FROMFROMFROMFROM = { 
				character_event = { id = diplomatic.33 } 
				ROOT = {
					if = {
						limit = { ai = no }
						chronicle = {
							entry = CHRONICLE_JOINED_COALITION
							portrait = [From.GetID]
						}
					}
				}
				FROM = {
					if = {
						limit = { ai = no }
						chronicle = {
							entry = CHRONICLE_JOINED_COALITION
							portrait = [Root.GetID]
						}
					}
				}
			} 
		}
	}
}
character_event = {
	id = diplomatic.33
	desc = "EVTDESCdiplomatic.33"
	
	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = "EVTOPTAdiplomatic.33"
		FROM = { tooltip = { } }
	}
}
#Inform reject
letter_event = {
	id = diplomatic.34
	desc = "EVTDESCdiplomatic.34"
	
	is_triggered_only = yes

	option = {
		name = "EVTOPTAdiplomatic.34"
	}
}
###############################
###Titular Kingdom Vassals#####
###############################
#Kings abolish spare titles
character_event = {
	id = diplomatic.50
	desc = "EVTDESCdiplomatic.50"
	
	only_playable = yes
	
	is_triggered_only = yes
	
	trigger = {
		higher_tier_than = DUKE
		OR = {
			# Holder of Iron Throne/Westeros shouldn't have any Westerosi Kingdom titles
			AND = {
				has_landed_title = e_iron_throne
				any_demesne_title = {
					tier = EMPEROR
					OR = {
						capital_scope = { region = world_westeros }
						title = e_iron_isles #These titles dont have capitals
						title = e_riverlands
					}		
				}
			}
			#Cannot hold kingdom and equivalent LP at the same time
			AND = {
				has_landed_title = e_north	
				has_landed_title = k_north
			}
			AND = {
				has_landed_title = e_riverlands	
				has_landed_title = k_riverlands	
			}
			AND = {
				has_landed_title = e_vale	
				has_landed_title = k_vale
			}
			AND = {
				has_landed_title = e_westerlands	
				has_landed_title = k_westerlands	
			}
			AND = {
				has_landed_title = e_reach	
				has_landed_title = k_reach
			}
			AND = {
				has_landed_title = e_stormlands	
				has_landed_title = k_stormlands
			}
			AND = {
				has_landed_title = e_dorne	
				has_landed_title = k_dorne
			}
			AND = {
				has_landed_title = e_iron_isles
				has_landed_title = k_iron_isles
			}
		}
	}
	
	option = {
		name = "EVTOPTAdiplomatic.50" #Yes
		if = { # Holder of Iron Throne/Westeros shouldn't have any Westerosi Kingdom titles
			limit = {
				has_landed_title = e_iron_throne
				any_demesne_title = {
					NOT = { title = e_iron_throne }
					tier = EMPEROR
				}
			}
			#Add king tier titles to iron throne dejure realm
			hidden_tooltip = {
				any_demesne_title = {
					limit = { 
						tier = KING 
						dejure_liege_title = { 
							OR = {
								capital_scope = { region = world_westeros }
								title = e_iron_isles #These titles dont have capitals
								title = e_riverlands
							}
						} 
					} 
					de_jure_liege = e_iron_throne
				}
				any_vassal = {
					limit = { tier = KING }
					any_demesne_title = {
						limit = { 
							tier = KING 
							OR = {
								capital_scope = { region = world_westeros }
								title = e_iron_isles #These titles dont have capitals
								title = e_riverlands
							}
						}
						de_jure_liege = e_iron_throne
					}
					set_character_flag = iron_throne_vassal #Mark vassal in case they seperate
				}	
			}	
			#Destroy the titles
			any_demesne_title = {
				limit = {
					tier = EMPEROR
					OR = {
						capital_scope = { region = world_westeros }
						title = e_iron_isles #These titles dont have capitals
						title = e_riverlands
					}			
				}
				destroy_landed_title = ROOT
				if = {
					limit = { title = e_north }
					k_north = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 2 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_riverlands }
					k_riverlands = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 9 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_vale }
					k_vale = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 4 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_westerlands }
					k_westerlands = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 5 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_reach }
					k_reach = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 6 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_stormlands }
					k_stormlands = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 7 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_dorne }
					k_dorne = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 8 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
				if = {
					limit = { title = e_iron_isles }
					k_iron_isles = { de_jure_liege = e_iron_throne }
					any_independent_ruler = {
						limit = { 
							NOT = { tier = EMPEROR }
							primary_title = { is_variable_equal = { which = "de_facto_empire" value = 3 } }
						}
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } }
							set_variable = { which = "de_facto_empire" value = 1 }
						}
					}
				}
			}
			#Re-add any erroneously split king tier vassals
			any_independent_ruler = {
				limit = { has_character_flag = iron_throne_vassal }
				set_defacto_liege = ROOT
			}
			any_vassal = {
				limit = { tier = KING }
				clr_character_flag = iron_throne_vassal
			}			
		}	
		#Cannot hold kingdom and equivalent LP at the same time
		if = { 
			limit = {
				AND = {
					has_landed_title = e_north	
					has_landed_title = k_north
				}
			}
			k_north = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_riverlands	
					has_landed_title = k_riverlands	
				}
			}
			k_riverlands = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_vale	
					has_landed_title = k_vale
				}
			}
			k_vale = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_westerlands	
					has_landed_title = k_westerlands	
				}
			}
			k_westerlands = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_reach	
					has_landed_title = k_reach
				}
			}
			k_reach = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_stormlands	
					has_landed_title = k_stormlands
				}
			}
			k_stormlands = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_dorne	
					has_landed_title = k_dorne
				}
			}
			k_dorne = { destroy_landed_title = ROOT }
		}	
		if = { 
			limit = {
				AND = {
					has_landed_title = e_iron_isles
					has_landed_title = k_iron_isles
				}
			}
			k_iron_isles = { destroy_landed_title = ROOT }
		}	
	}
}

#Has kingdom with no privilege status set, liege will decide what to do
character_event = {
	id = diplomatic.51
	desc = "EVTDESCdiplomatic.51"
	
	only_playable = yes
	
	is_triggered_only = yes
	war = no
	
	trigger = {
		tier = KING
		liege = { 
			tier = EMPEROR 
			is_nomadic = no
		}
		is_feudal = yes
		any_demesne_title = {
			tier = KING
			NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
			controls_religion = no
			is_landless_type_title = no
			NOT = { has_law = privilege_vassal_king }
		}
		
		is_nomadic = no
	}
	
	immediate = {
		hidden_tooltip = {
			#pick title to show in event text
			primary_title = {
				if = {
					limit = {
						tier = KING
						NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
						controls_religion = no
						is_landless_type_title = no
						NOT = { has_law = privilege_vassal_king }
					}
					save_event_target_as = titular_kingdom
				}
			}
			if = {
				limit = { NOT = { event_target:titular_kingdom = { always = yes } } }
				random_demesne_title = {
					limit = {
						tier = KING
						NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
						controls_religion = no
						is_landless_type_title = no
						NOT = { has_law = privilege_vassal_king }
					}
					save_event_target_as = titular_kingdom	
				}
			}
			
		}
	}
	
	option = {
		name = "EVTOPTAdiplomatic.51" #Appeal to keep kingship
		any_demesne_title = {
			limit = {
				tier = KING
				NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
				controls_religion = no
				is_landless_type_title = no
				NOT = { has_law = privilege_vassal_king }
			}
			custom_tooltip = { text = TOOLTIPdiplomatic.51KINGDOM }	
		}
		hidden_tooltip = { liege = { character_event = { id = diplomatic.52 days = 3 } } }
	}
}
character_event = { #liege decides
	id = diplomatic.52
	desc = "EVTDESCdiplomatic.52"
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			vassal_of = ROOT
			war = no
			any_demesne_title = {
				tier = KING
				NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
				controls_religion = no
				is_landless_type_title = no
				NOT = { has_law = privilege_vassal_king }
			}
		}
	}
		
	option = { #Revoke Kingship
		name = {
			text = "EVTOPTAdiplomatic.52" 
			trigger = { NOT = { character = 77000 } }
		}	
		name = {
			text = "EVTOPTAdiplomatic.52B" 
			trigger = { character = 77000 }
		}
		ai_chance = {
			factor = 50
			
			modifier = { #Emperors usually grant privilege
				factor = 0.1
				NOR = {
					primary_title = { title = e_iron_throne }
					culture_group = andal
					culture_group = first_men
					culture_group = free_folk
					culture_group = dornish
					culture = ironborn
				}
			}
			modifier = {
				factor = 10
				FROM = { 
					NOT = {
						any_demesne_title = {
							tier = KING
							controls_religion = no
							is_landless_type_title = no
							has_law = privilege_vassal_king
						}
					}	
				}
			}
			modifier = {
				factor = 2
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_subjugated_AGOT }
			}
			modifier = {
				factor = 5
				has_opinion_modifier = { who = FROM modifier = opinion_traitor }
			}
			modifier = {
				factor = 2
				is_rival = FROM
			}
			modifier = {
				factor = 5
				is_foe = FROM
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = envious
			}
			modifier = {
				factor = 1.33
				NOT = { opinion = { who = FROM value = -24 } }
			}
			modifier = {
				factor = 1.33
				NOT = { opinion = { who = FROM value = -49 } }
			}
			modifier = {
				factor = 1.33
				NOT = { opinion = { who = FROM value = -74 } }
			}
			modifier = {
				factor = 1.33
				NOT = { opinion = { who = FROM value = -99 } }
			}
			modifier = {
				factor = 1.5
				NOT = { culture = high_valyrian }
				NOT = { culture_group = FROM }
			}
			modifier = {
				factor = 1.5
				NOT = { religion_group = FROM }
			}
		}
		FROM = {
			if = { #Gain prestige for revoking status from king	
				limit = {
					any_demesne_title = {
						tier = KING
						controls_religion = no
						is_landless_type_title = no
						has_law = privilege_vassal_king
					}
				}
				ROOT = { prestige = 100 }
			}
			tooltip = {
				any_demesne_title = {
					limit = {
						tier = KING					
						controls_religion = no
						is_landless_type_title = no
						NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
					}
					#tooltip = { destroy_landed_title = FROM }		
					custom_tooltip = {
						text = TOOLTIPrevoked_royal_privilege
					}
				}
			}
			# opinion = {
				# who = ROOT
				# modifier = opinion_revoked_titular_kingdom
				# months = 120
			# }
			if = {
				limit = {
					any_demesne_title = {
						tier = KING
						controls_religion = no
						is_landless_type_title = no
						has_law = privilege_vassal_king
					}
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT } }
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_granted_kingdom } }				
				}
				opinion = {
					who = ROOT
					modifier = opinion_revoked_royal_privilege
					months = 120
				}
			}	
			if = {
				limit = {
					has_opinion_modifier = { who = ROOT modifier = opinion_granted_kingdom }
				}
				opinion = {
					who = ROOT
					modifier = opinion_revoked_royal_privilege
					months = 120
					multiplier = 0.5
				}
			}
			hidden_tooltip = { 
				any_realm_lord = {
					limit = { 
						ai = no 
						NOT = { character = PREV }
					}
					letter_event = { id = diplomatic.55 }
				}
				letter_event = { id = diplomatic.53 }
			}		
		}
	}
	
	option = {
		name = "EVTOPTBdiplomatic.52" #Grant privilege
		ai_chance = {
			factor = 50
			modifier = { #Aegon the conqueror doesnt do this
				factor = 0
				character = 77000
				has_global_flag = aegons_conquest
			}
			modifier = { #Westerosi usually dont give new privileges
				factor = 0
				OR = {
					primary_title = { title = e_iron_throne }
					culture_group = andal
					culture_group = first_men
					culture_group = free_folk
					culture_group = dornish
					culture = ironborn
				}
				FROM = { 
					NOT = {
						any_demesne_title = {
							tier = KING
							controls_religion = no
							is_landless_type_title = no
							has_law = privilege_vassal_king
						}
					}	
					OR = {
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_granted_kingdom } }
						primary_title = {
							OR = {
								capital_scope = { region = world_westeros }
								title = k_crownlands #These titles dont have capitals
								title = k_riverlands
								title = k_iron_isles
							}
						}	
					}
				}						
			}
			modifier = {
				factor = 5
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_granted_kingdom }
			}
			modifier = {
				factor = 2
				is_friend = FROM
			}
			modifier = {
				factor = 2
				is_close_relative = FROM
			}
			modifier = {
				factor = 2
				dynasty = FROM
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 2
				trait = arbitrary
			}
			modifier = {
				factor = 2
				trait = honorable
			}
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 1.33
				opinion = { who = FROM value = 25 }
			}
			modifier = {
				factor = 1.33
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 1.33
				opinion = { who = FROM value = 75 }
			}
			modifier = {
				factor = 1.33
				opinion = { who = FROM value = 100 }
			}
		}		
		FROM = {
			if = { #Lose prestige for granting status to lord	
				limit = {
					any_demesne_title = {
						tier = KING
						controls_religion = no
						is_landless_type_title = no
						NOT = { has_law = privilege_vassal_king }
						is_variable_equal = { which = "lord_paramount_status" value = 1 } #1 = lord paramount, 2 = interregnum
					}
				}
				ROOT = { 
					prestige = -200 
					custom_tooltip = {
						text = TOOLTIPgrant_privliege_vassals_annoyed
						hidden_tooltip = {
							any_vassal = {
								limit = {
									OR = {
										any_demesne_title = {
											tier = KING
											controls_religion = no
											is_landless_type_title = no
											NOT = { has_law = privilege_vassal_king }
											is_variable_equal = { which = "lord_paramount_status" value = 1 } #1 = lord paramount, 2 = interregnum
										}
										NOT = { opinion = { who = ROOT_FROM value = -29 } }
										AND = {
											NOT = { culture_group = ROOT_FROM }
											OR = {
												trait = wroth
												trait = envious
												trait = ambitious
											}
										}
										AND = {
											NOT = { religion = ROOT_FROM }
											trait = zealous
										}
									}
									NOT = { trait = content }
								}
								opinion = {
									who = ROOT
									modifier = opinion_someone_granted_royal_privilege
									months = 60
								}
							}
						}
					}
				}				
			}
			tooltip = {
				any_demesne_title = {
					limit = {
						tier = KING
						controls_religion = no
						is_landless_type_title = no
						NOT = { has_law = privilege_vassal_king }
					}
					add_law = privilege_vassal_king				
				}
			}
			if = {
				limit = {
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT } }
					NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_granted_kingdom } }
				}			
				opinion = {
					who = ROOT
					modifier = opinion_granted_royal_privliege
					months = 120
				}
			}
			if = {
				limit = {
					has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT }
				}			
				opinion = {
					who = ROOT
					modifier = opinion_granted_royal_privliege
					months = 60
					multiplier = 0.6
				}
			}			
			hidden_tooltip = { 
				letter_event = { id = diplomatic.54 }
			}		
		}
	}
}
letter_event = { #inform revoked
	id = diplomatic.53
	desc = "EVTDESCdiplomatic.53"
	
	is_triggered_only = yes
			
	option = {
		name = "EVTOPTAdiplomatic.53"
		liege = {
			ROOT = {
				# hidden_tooltip = { #If, no other kingdoms, any non-dejure vassals become vassals of the emperor
					# if = {
						# limit = {
							# NOT = {
								# any_demesne_title = {
									# tier = KING
									# OR = {
										# is_titular = no
										# controls_religion = yes
										# is_landless_type_title = yes
										# has_law = privilege_vassal_king
									# }				
								# }
							# }
						# }
						# any_vassal = {
							# limit = { 
								# OR = {
									# tier = DUKE 
									# AND = {
										# tier = COUNT
										# ROOT = { NOT = { num_of_duke_titles = 1 } }
									# }
								# }	
								# NOT = {
									# primary_title = {
										# dejure_liege_title = {
											# OR = {
												# holder_scope = { character = ROOT }
												# dejure_liege_title = { holder_scope = { character = ROOT } }
											# }
										# }
									# }
								# }
							# }	
							# set_defacto_liege = PREVPREV
						# }
					# }	
				# }
				any_demesne_title = {
					limit = {
						tier = KING
						NOT = { is_variable_equal = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum }
						controls_religion = no
						is_landless_type_title = no
					}
					if = {
						limit = { has_law = privilege_vassal_king }
						revoke_law = privilege_vassal_king
					}
					hidden_tooltip = { set_variable = { which = "lord_paramount_status" value = 1 } } #1 = lord paramount, 2 = interregnum
					custom_tooltip = {
						text = TOOLTIPrevoked_royal_privilege
					}
					#destroy_landed_title = ROOT						
				}
				if = {
					limit = {
						has_character_modifier = granted_royal_privilege_modifier
					}
					remove_character_modifier = granted_royal_privilege_modifier
				}
				hidden_tooltip = {
					#set_defacto_liege = PREV 
					if = {
						limit = {
							primary_title = {
								tier = KING
								is_variable_equal = { which = "lord_paramount_status" value = 1 } #1 = lord paramount, 2 = interregnum
							}
						}
						set_government_type = feudal_government_LP
					}
					#remove special titles
					if = {
						limit = {
							primary_title = {
								OR = {
									title = k_wolfswoodTK
									title = k_barrowlandsTK
									title = k_theneckTK
									title = k_dreadfortTK
									title = k_winterfellTK
									title = k_riverrunTK
									title = k_dragonstone
									title = k_duskendaleTK
									title = k_shipbreakerTK
								}
							}	
						}
						remove_special_character_title = yes
					}
				}		
			}
		}
	}
}	
letter_event = { #inform privilege granted
	id = diplomatic.54
	
	desc = {
		text = "EVTDESCdiplomatic.54"
		trigger = { NOT = { government = feudal_government_LP } }
	}	
	desc = {
		text = "EVTDESCdiplomatic.54B"
		trigger = { government = feudal_government_LP }
	}
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			if = {
				limit = { government = feudal_government_LP }
				set_government_type = feudal_government
			}
		}
	}
			
	option = {
		name = "EVTOPTAdiplomatic.54"
		any_demesne_title = {
			limit = {
				tier = KING
				controls_religion = no
				is_landless_type_title = no
				NOT = { has_law = privilege_vassal_king }
			}
			hidden_tooltip = { set_variable = { which = "lord_paramount_status" value = 0 } } #1 = lord paramount, 2 = interregnum
			add_law = privilege_vassal_king				
		}	
		if = {
			limit = {
				NOT = { has_character_modifier = granted_royal_privilege_modifier }
			}
			add_character_modifier = {
				name = granted_royal_privilege_modifier
				duration = -1
			}
		}
		if = {
			limit = { ai = no }
			chronicle = {
				entry = CHRONICLE_GRANTED_ROYAL_PRIVILEGE
				portrait = [From.GetID]
			}
		}
		FROM = {
			if = {
				limit = { ai = no }
				chronicle = {
					entry = CHRONICLE_GRANTED_VASSAL_ROYAL_PRIVILEGE
					portrait = [Root.GetID]
				}
			}
		}	
	}
}	
letter_event = { #inform realm revoked
	id = diplomatic.55
	desc = "EVTDESCdiplomatic.55"
	
	is_triggered_only = yes
			
	option = {
		name = OK
		FROMFROM = { tooltip = { } }
	}
}	
character_event = { #privilege maintenance, on_new_holder
	id = diplomatic.56
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		OR = {
			FROM = { #the title
				tier = KING
				has_law = privilege_vassal_king
			}
			has_character_modifier = granted_royal_privilege_modifier		
		}	
	}
	
	immediate = {
		remove_character_modifier = granted_royal_privilege_modifier
		character_event = { id = diplomatic.57 days = 1 } #needs to be a day later otherwise conditions aren't met
		FROMFROM = { #Check old holder as well
			if = {
				limit = {
					is_alive = yes
					has_character_modifier = granted_royal_privilege_modifier
					NAND = {
						tier = KING
						is_feudal = yes
						OR = {
							independent = no
							primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } }
						}
						any_demesne_title = {
							tier = KING
							controls_religion = no
							is_landless_type_title = no
							has_law = privilege_vassal_king
							NOT = { check_variable = { which = "lord_paramount_status" value = 0.9 } } #1 = lord paramount, 2 = interregnum
						}
					}
				}
				remove_character_modifier = granted_royal_privilege_modifier
			}
		}
	}
			
	option = {
		name = OK
	}
}	
character_event = {
	id = diplomatic.57
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		tier = KING
		is_feudal = yes
		OR = {
			independent = no
			primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } }
		}
		any_demesne_title = {
			tier = KING
			controls_religion = no
			is_landless_type_title = no
			has_law = privilege_vassal_king
			NOT = { check_variable = { which = "lord_paramount_status" value = 0.9 } } #1 = lord paramount, 2 = interregnum
		}	
	}
	
	immediate = {
		add_character_modifier = {
			name = granted_royal_privilege_modifier
			duration = -1
		}
	}
			
	option = {
		name = OK
	}
}	
#######################
###Diplomatic annexation#####
#######################
character_event = {
	id = diplomatic.1
	desc = "EVTDESCdiplomatic.1"
	
	is_triggered_only = yes

	immediate = {
		set_character_flag = diplomatic_annexation
		save_event_target_as = diplomatic_annexation_king	
		job_castellan = { save_event_target_as = job_castellan_target }
	}

	option = {
		name = "EVTOPTAdiplomatic.1" #I will go myself
		ai_chance = { 
			factor = 75
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 1.5
				trait = gregarious
			}
			modifier = {
				factor = 0.66
				trait = slothful
			}
			modifier = {
				factor = 0.66
				trait = paranoid
			}
			modifier = {
				factor = 0.66
				trait = shy
			}
			modifier = {
				factor = 1.5
				diplomacy = 12
			}
			modifier = {
				factor = 1.5
				diplomacy = 14
			}
			modifier = {
				factor = 1.5
				diplomacy = 16
			}
			modifier = {
				factor = 1.5
				diplomacy = 18
			}
			modifier = {
				factor = 1.5
				diplomacy = 20
			}
		}
		event_target:diplomatic_annexation_target = {
			tooltip = { }
		}
		scaled_wealth = -0.25
		#character_event = { id = diplomatic.2 days = 40  tooltip = EVTTOOLTIPdiplomatic.2 }
		character_event = { id = diplomatic.2 days = 40 tooltip = EVTTOOLTIPdiplomatic.2 }
	}
	
	option = {
		name = "EVTOPTBdiplomatic.1" #Send my hand to initiaite negotiations
		trigger = {
			job_castellan = { always = yes }
		}
		ai_chance = { 
			factor = 25
		
			modifier = {
				factor = 0.1
				job_castellan = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 1.75
				job_castellan = { diplomacy = 12 }
			}
			modifier = {
				factor = 1.75
				job_castellan = { diplomacy = 14 }
			}
			modifier = {
				factor = 1.75
				job_castellan = { diplomacy = 16 }
			}
			modifier = {
				factor = 1.75
				job_castellan = { diplomacy = 18 }
			}
			modifier = {
				factor = 1.75
				job_castellan = { diplomacy = 20 }
			}
		}		
		job_castellan = {
			character_event = { id = diplomatic.3 tooltip = EVTTOOLTIPdiplomatic.3 }
			hidden_tooltip = { character_event = { id = diplomatic.2 days = 40  tooltip = EVTTOOLTIPdiplomatic.2 } }
		}
	}
	
	option = {
		name = "EVTOPTDdiplomatic.1" #Spouse
		trigger = {
			spouse = {
				is_alive = yes
				is_incapable = no
				is_ill = no
				prisoner = no
				age = 18
				is_liege_or_above = ROOT
				NOT = { has_job_title = job_castellan }
			}
		}
		ai_chance = { 
			factor = 25
					
			modifier = {
				factor = 0
				spouse = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 1.75
				spouse = { diplomacy = 12 }
			}
			modifier = {
				factor = 1.75
				spouse = { diplomacy = 14 }
			}
			modifier = {
				factor = 1.75
				spouse = { diplomacy = 16 }
			}
			modifier = {
				factor = 1.75
				spouse = { diplomacy = 18 }
			}
			modifier = {
				factor = 1.75
				spouse = { diplomacy = 20 }
			}
		}		
		spouse = {
			character_event = { id = diplomatic.3 tooltip = EVTTOOLTIPdiplomatic.3 }
			hidden_tooltip = { character_event = { id = diplomatic.2 days = 40  tooltip = EVTTOOLTIPdiplomatic.2 } }
		}
	}
	
	option = {
		name = "EVTOPTEdiplomatic.1" #Heir
		trigger = {
			current_heir = {
				is_alive = yes
				is_incapable = no
				is_ill = no
				prisoner = no
				age = 18
				is_liege_or_above = ROOT
				dynasty = ROOT
				NOT = { has_job_title = job_castellan }
				NOT = { is_married = ROOT }
			}
		}
		ai_chance = { 
			factor = 25
					
			modifier = {
				factor = 0
				current_heir = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 1.75
				current_heir = { diplomacy = 12 }
			}
			modifier = {
				factor = 1.75
				current_heir = { diplomacy = 14 }
			}
			modifier = {
				factor = 1.75
				current_heir = { diplomacy = 16 }
			}
			modifier = {
				factor = 1.75
				current_heir = { diplomacy = 18 }
			}
			modifier = {
				factor = 1.75
				current_heir = { diplomacy = 20 }
			}
		}		
		current_heir = {
			character_event = { id = diplomatic.3 tooltip = EVTTOOLTIPdiplomatic.3 }
			hidden_tooltip = { character_event = { id = diplomatic.2 days = 40  tooltip = EVTTOOLTIPdiplomatic.2 } }
		}
	}
	
	option = {
		name = "EVTOPTCdiplomatic.1" #No
		ai_chance = { factor = 0 }
		clr_character_flag = diplomatic_annexation
	}
}
#Arrive at foreign King's court
character_event = {
	id = diplomatic.2
	desc = "EVTDESCdiplomatic.2"
	picture = GFX_evt_feast
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.2" 
		event_target:diplomatic_annexation_target = {
			character_event = { id = diplomatic.4 tooltip = EVTTOOLTIPdiplomatic.4 }
		}	
	}
}	
#Inform hand they are being sent to foreign court
character_event = {
	id = diplomatic.3
	desc = "EVTDESCdiplomatic.3"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.3" 
		event_target:diplomatic_annexation_target = {
			tooltip = { }
		}
		custom_tooltip = { text = EVTTOOLTIPdiplomatic.2 }
	}
}	
#Target informed of King's arrival, negotiation starts
long_character_event = {
	id = diplomatic.4
	desc = "EVTDESCdiplomatic.4"
	picture = GFX_evt_feast
	
	is_triggered_only = yes
	
	immediate = {
		##Find potential council seat
		event_target:diplomatic_annexation_king = {
			job_castellan = {
				if = {
					limit = { NOT = { character = FROM } }
					save_event_target_as = annnex_councillor_target
				}
				if = {
					limit = { character = FROM }
					liege = { job_chancellor = { save_event_target_as = annnex_councillor_target } }
					if = {
						limit = { ROOT = { martial = 12 } }
						liege = { job_marshal = { save_event_target_as = annnex_councillor_target } }
					}
					if = {
						limit = { ROOT = { intrigue = 12 } }
						liege = { job_spymaster = { save_event_target_as = annnex_councillor_target } }
					}
					if = {
						limit = { ROOT = { stewardship = 12 } }
						liege = { job_treasurer = { save_event_target_as = annnex_councillor_target } }
					}
					if = {
						limit = { ROOT = { diplomacy = 12 } }
						liege = { job_chancellor = { save_event_target_as = annnex_councillor_target } }
					}
				}
			}
		}
		##Find potential marriage
		#Try self first
		if = {
			limit = {
				can_marry_trigger = yes
				age = 10
				NOT = { trait = bastard }
				NOT = { trait = incapable }
				OR = {
					is_female = no
					NOT = { age = 30 }
				}
				event_target:diplomatic_annexation_king = {
					any_courtier = {
						dynasty = PREV
						can_marry_trigger = yes
						NOT = { same_sex = PREVPREV }
						age = 10
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						OR = {
							is_female = no
							NOT = { age = 30 }
						}
						OR = {
							character = PREV
							AND = {
								is_ruler = no	
								OR = {
									is_child_of = PREV
									sibling = PREV
								}
								liege = { character = PREVPREV }
							}
						}
					}
				}
			}
			save_event_target_as = diplomatic_annexation_marriage_TARGET
			add_trait = forbid_marriage
			event_target:diplomatic_annexation_king = {
				random_courtier = {
					limit = {
						dynasty = PREV
						can_marry_trigger = yes
						NOT = { same_sex = PREVPREV }
						age = 10
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						OR = {
							is_female = no
							NOT = { age = 30 }
						}
						OR = {
							character = PREV
							AND = {
								is_ruler = no	
								OR = {
									is_child_of = PREV
									sibling = PREV
								}
								liege = { character = PREVPREV }
							}
						}
					}
					save_event_target_as = diplomatic_annexation_marriage_KING	
					add_trait = forbid_marriage
				}
			}
			break = yes
		}	
		random_courtier = {
			limit = {
				dynasty = ROOT
				can_marry_trigger = yes
				age = 10
				NOT = { trait = bastard }
				NOT = { trait = incapable }
				OR = {
					is_female = no
					NOT = { age = 30 }
				}
				is_ruler = no	
				OR = {
					is_child_of = ROOT
					sibling = ROOT
				}
				liege = { character = ROOT }
				event_target:diplomatic_annexation_king = {
					any_courtier = {
						dynasty = PREV
						can_marry_trigger = yes
						NOT = { same_sex = PREVPREV }
						age = 10
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						OR = {
							is_female = no
							NOT = { age = 30 }
						}
						OR = {
							character = PREV
							AND = {
								is_ruler = no	
								OR = {
									is_child_of = PREV
									sibling = PREV
								}
								liege = { character = PREVPREV }
							}
						}
					}
				}	
			}
			save_event_target_as = diplomatic_annexation_marriage_TARGET
			add_trait = forbid_marriage
			event_target:diplomatic_annexation_king = {
				random_courtier = {
					limit = {
						dynasty = PREV
						can_marry_trigger = yes
						NOT = { same_sex = PREVPREV }
						age = 10
						NOT = { trait = bastard }
						NOT = { trait = incapable }
						OR = {
							is_female = no
							NOT = { age = 30 }
						}
						OR = {
							character = PREV
							AND = {
								is_ruler = no	
								OR = {
									is_child_of = PREV
									sibling = PREV
								}
								liege = { character = PREVPREV }
							}
						}
					}
					save_event_target_as = diplomatic_annexation_marriage_KING	
					add_trait = forbid_marriage
				}
			}					
		}
	}
	
	option = {
		name = "EVTOPTAdiplomatic.4" #I'm interested
		ai_chance = {
			factor = 10
			
			modifier = { #will never start negotiations
				factor = 0
				NOR = {
					trait = humble
					trait = charitable
					trait = patient
					trait = content
				}
				OR = {
					NOT = { religion = event_target:diplomatic_annexation_king }
					NOR = {
						culture_group = event_target:diplomatic_annexation_king
						event_target:diplomatic_annexation_king = { culture = high_valyrian }
					}
				}	
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 3
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = patient
			}
			modifier = {
				factor = 3
				trait = content
			}
			modifier = {
				factor = 1.5
				FROM  = { diplomacy = 13 }
			}
			modifier = {
				factor = 1.5
				FROM  = { diplomacy = 16 }
			}
			modifier = {
				factor = 1.5
				FROM  = { diplomacy = 19 }
			}
			modifier = {
				factor = 1.5
				FROM  = { diplomacy = 22 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = event_target:diplomatic_annexation_king value = 10 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = event_target:diplomatic_annexation_king value = 30 }
			}
			modifier = {
				factor = 2
				opinion = { who = event_target:diplomatic_annexation_king value = 50 }
			}
			modifier = {
				factor = 2
				opinion = { who = event_target:diplomatic_annexation_king value = 70 }
			}
		}
		event_target:diplomatic_annexation_marriage_TARGET = { tooltip = { } }
		event_target:diplomatic_annexation_marriage_KING = { tooltip = { } }
		set_character_flag = first_demand
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
	
	option = {
		name = "EVTOPTBdiplomatic.4" #No way!
		ai_chance = {
			factor = 10
			
			modifier = { #will at least start negotiations
				factor = 0
				NOR = {
					trait = proud
					trait = greedy
					trait = wroth
					trait = ambitious
				}
				religion = event_target:diplomatic_annexation_king
				OR = {
					culture_group = event_target:diplomatic_annexation_king
					event_target:diplomatic_annexation_king = { culture = high_valyrian }
				}
				opinion = { who = event_target:diplomatic_annexation_king value = 10 }
			}
			modifier = {
				factor = 3
				trait = proud
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 3
				trait = wroth
			}
			modifier = {
				factor = 3
				trait = ambitious
			}
			modifier = {
				factor = 2
				NOT = { religion = event_target:diplomatic_annexation_king }
			}
			modifier = {
				factor = 2
				NOT = { culture_group = event_target:diplomatic_annexation_king }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		FROM = { character_event = { id = diplomatic.6  tooltip = TOOLTIPdiplomatic.6 } } 
	}
	
}	
#Make Demand
character_event = {
	id = diplomatic.5
	desc = "EVTDESCdiplomatic.5"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	show_from_from = yes
	
	option = {
		name = "EVTOPTAdiplomatic.5" ##This negotiaition n is over
		ai_chance = {
			factor = 1
					
			modifier = {
				factor = 0.05
				has_character_flag = first_demand
			}
			modifier = {
				factor = 3
				trait = proud
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 3
				trait = wroth
			}
			modifier = {
				factor = 3
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		FROMFROM = {
			character_event = { id = diplomatic.6  tooltip = TOOLTIPdiplomatic.6 }
			if = {
				limit = { NOT = { character = event_target:diplomatic_annexation_king } }
				opinion = { who = ROOT modifier = opinion_annexation_failed }
			}
		}
		event_target:diplomatic_annexation_king = { 
			opinion = { who = ROOT modifier = opinion_annexation_failed }
		}
	}

	option = {
		name = "EVTOPTBdiplomatic.5" #Make marriage as first demand
		ai_chance = {
			factor = 50
			modifier = {
				factor = 2
				trait = familyperson
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		trigger = {
			NOT = { has_character_flag = diploannex_marriage }
			NOT = { has_character_flag = diploannex_marriage_reject }
			event_target:diplomatic_annexation_marriage_TARGET = { is_alive = yes }
			event_target:diplomatic_annexation_marriage_KING = { is_alive = yes }
		}	
		event_target:diplomatic_annexation_marriage_TARGET = {
			custom_tooltip = { text = TOOLTIPdiplomatic.5A }
		}	
		event_target:diplomatic_annexation_marriage_KING = {
			custom_tooltip = { text = TOOLTIPdiplomatic.5E }
		}
		FROM = {
			FROM = {			
				hidden_tooltip = { character_event = { id = diplomatic.7 days = 1 } } 
			}
		}		
	}
	
	option = {
		name = "EVTOPTCdiplomatic.5" #Make hand of the king title as first demand
		trigger = {
			NOT = { has_character_flag = diploannex_handoftheking }
			NOT = { has_character_flag = diploannex_handoftheking_reject }
			event_target:annnex_councillor_target = { always = yes }
			is_female = no
		}
		ai_chance = {
			factor = 5
			modifier = {
				factor = 3
				stewardship = 12
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		event_target:annnex_councillor_target = {
			custom_tooltip = { text = TOOLTIPdiplomatic.10 }
		}
		hidden_tooltip = { FROMFROM = { character_event = { id = diplomatic.10  days = 1 } } }
	}
	
	option = {
		name = "EVTOPTDdiplomatic.5" #Make land for son as first demand
		ai_chance = {
			factor = 5
			modifier = {
				factor = 3
				trait = familyperson
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		trigger = {
			NOT = { has_character_flag = diploannex_land_for_son }
			NOT = { has_character_flag = diploannex_land_reject }
			any_child = {
				is_female = no
				is_alive = yes
				is_ruler = no
				is_primary_heir = no
				NOT = { trait = bastard }
				OR = {
					is_married = yes
					is_betrothed = yes
				}
				liege = { character = ROOT }				
			}
			event_target:diplomatic_annexation_king = {
				any_demesne_title = {
					tier = COUNT
					can_be_given_away = yes
					NOT = {
						location = {
							is_capital = yes
						}						
					}
				}
			}	
		}	
		random_child = {
			limit = {
				is_female = no
				is_alive = yes
				is_ruler = no
				is_primary_heir = no
				NOT = { trait = bastard }
				OR = {
					is_married = yes
					is_betrothed = yes
				}
				liege = { character = ROOT }
			}
			custom_tooltip = { text = TOOLTIPdiplomatic.5B }
			save_event_target_as = diploannex_land
		}
		hidden_tooltip = { FROM = { FROM = { character_event = { id = diplomatic.12 days = 1  } } } }
	}
	
	option = {
		name = "EVTOPTEdiplomatic.5" #Make KG position for son as first demand
		ai_chance = {
			factor = 5
			modifier = {
				factor = 3
				trait = familyperson
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		trigger = {
			NOT = { has_character_flag = diploannex_KG }
			NOT = { has_character_flag = diploannex_KG_reject }
			event_target:diplomatic_annexation_king = { has_landed_title = e_iron_throne }
			d_kingsguard = { has_holder = yes }
			any_child = {
				is_female = no
				is_alive = yes
				is_ruler = no
				is_primary_heir = no
				age = 16
				trait = knight
				OR = {
					trait = trained_warrior
					trait = skilled_warrior
					trait = master_warrior
				}
				is_married = no
				is_betrothed = no #???
				liege = { character = ROOT }
				NOT = { event_target:diplomatic_annexation_marriage_TARGET = { character = PREV } }
			}
		}	
		random_child = {
			limit = {
				is_female = no
				is_alive = yes
				is_ruler = no
				is_primary_heir = no
				age = 16
				trait = knight
				OR = {
					trait = trained_warrior
					trait = skilled_warrior
					trait = master_warrior
				}
				is_married = no
				is_betrothed = no #???
				liege = { character = ROOT }
				NOT = { event_target:diplomatic_annexation_marriage_TARGET = { character = PREV } }
			}
			save_event_target_as = diploannex_KG
			custom_tooltip = { text = TOOLTIPdiplomatic.5C }
		}
		hidden_tooltip = { FROM = { FROM = { character_event = { id = diplomatic.14 days = 1  } } } }
	}
	
	option = {
		name = "EVTOPTFdiplomatic.5" #Make vassal transfer as first demand
		ai_chance = {
			factor = 5
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 3
				trait = diligent
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		trigger = {
			NOT = { has_character_flag = diploannex_vassal_transfer }
			NOT = { has_character_flag = diploannex_vassal_transfer_reject }
			event_target:diplomatic_annexation_king = {
				any_vassal = {
					NOT = { tier = KING }
					de_jure_liege_or_above = ROOT
				}
			}
		}	
		event_target:diplomatic_annexation_king = {
			any_vassal = {
				limit = {
					NOT = { tier = KING }
					de_jure_liege_or_above = ROOT
				}
				custom_tooltip = { text = TOOLTIPdiplomatic.5D }
			}
		}
		hidden_tooltip = { FROM = { FROM = { character_event = { id = diplomatic.16 days = 1  } } } }
	}
	
	option = {
		name = "EVTOPTHdiplomatic.5" #Royal Privilege
		ai_chance = {
			factor = 20
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 3
				trait = diligent
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -70 } }
			}
		}
		trigger = {
			NOT = { has_character_flag = diploannex_royal_privilege }
			NOT = { has_character_flag = diploannex_royal_privilege_reject }	
			is_feudal = yes
			higher_tier_than = DUKE
		}	
		custom_tooltip = { text = TOOLTIPdiplomatic.5H }
		FROM = {
			FROM = {
				hidden_tooltip = { character_event = { id = diplomatic.18 days = 1  } } 
			}
		}	
	}
	
	option = {
		name = "EVTOPTGdiplomatic.5" #I think we can agree to this
		ai_chance = {
			factor = 1
			
			modifier = {
				factor = 0.05
				has_character_flag = first_demand
			}
			modifier = {
				factor = 0.33
				NOT = { has_character_flag = diploannex_marriage }
			}
			modifier = {
				factor = 2
				has_character_flag = diploannex_handoftheking
			}
			modifier = {
				factor = 2
				has_character_flag = diploannex_land_for_son
			}
			modifier = {
				factor = 2
				has_character_flag = diploannex_KG 
			}
			modifier = {
				factor = 2
				has_character_flag = diploannex_vassal_transfer
			}
			modifier = {
				factor = 1.5
				has_character_flag = diploannex_royal_privilege
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 3
				trait = craven
			}
			modifier = {
				factor = 3
				trait = patient
			}
			modifier = {
				factor = 3
				trait = content
			}
			modifier = {
				factor = 1.5
				FROM = { FROM  = { diplomacy = 13 } }
			}
			modifier = {
				factor = 1.5
				FROM = { FROM  = { diplomacy = 16 } }
			}
			modifier = {
				factor = 1.5
				FROM = { FROM  = { diplomacy = 19 } }
			}
			modifier = {
				factor = 1.5
				FROM = { FROM  = { diplomacy = 22 } }
			}
			modifier = {
				factor = 1.5
				opinion = { who = event_target:diplomatic_annexation_king value = 10 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = event_target:diplomatic_annexation_king value = 30 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = event_target:diplomatic_annexation_king value = 50 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = event_target:diplomatic_annexation_king value = 70 }
			}
		}
		event_target:diplomatic_annexation_king = { 
			character_event = { id = diplomatic.29  tooltip = TOOLTIPdiplomatic.29 } 
			opinion = { who = ROOT modifier = opinion_agreed_annexation }
		}
		
		FROMFROM = {
			if = {
				limit = { NOT = { character = event_target:diplomatic_annexation_king } }
				opinion = { who = ROOT modifier = opinion_agreed_annexation }
				hidden_tooltip = { character_event = { id = diplomatic.2900 } }
			}
		}
		custom_tooltip = {
			text = TOOLTIPdiplomatic.5REALMUNHAPPY
			hidden_tooltip = {
				any_realm_character = {
					limit = {
						OR = {
							higher_tier_than = BARON
							is_patrician = yes
							liege = { character = ROOT }
							is_close_relative = ROOT						
						}
						OR = {
							trait = proud
							NOT = { opinion = { who = event_target:diplomatic_annexation_king value = -24 } }
							AND = {
								NOT = { culture_group = event_target:diplomatic_annexation_king }
								OR = {
									trait = wroth
									trait = envious
									trait = ambitious
								}
							}
							AND = {
								NOT = { religion = event_target:diplomatic_annexation_king }
								trait = zealous
							}
						}
					}
					opinion = { who = ROOT modifier = opinion_agreed_annexation_bad }
					opinion = { who = event_target:diplomatic_annexation_king modifier = opinion_agreed_annexation_bad }
				}
			}
		}
	}
	after = { clr_character_flag = first_demand }
}	
#Inform King target rejects annexation
character_event = {
	id = diplomatic.6
	desc = "EVTDESCdiplomatic.6"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.6" 
		FROM = { 		
			opinion = { who = ROOT modifier = opinion_annexation_failed }
			clr_character_flag = diplomatic_annexation_target	
			
			clr_character_flag = diploannex_marriage
			clr_character_flag = diploannex_marriage_reject
			clr_character_flag = diploannex_handoftheking
			clr_character_flag = diploannex_handoftheking_reject
			clr_character_flag = diploannex_land_for_son
			clr_character_flag = diploannex_land_reject
			clr_character_flag = diploannex_KG 
			clr_character_flag = diploannex_KG_reject 
			clr_character_flag = diploannex_vassal_transfer
			clr_character_flag = diploannex_vassal_transfer_reject
			clr_character_flag = diploannex_royal_privilege
			clr_character_flag = diploannex_royal_privilege_reject
			
			set_character_flag = diplomatic_annexation_refused	
		}
		clr_character_flag = diplomatic_annexation 
		prestige = -100
		event_target:diplomatic_annexation_king = {
			if = {
				limit = { NOT = { character = ROOT } }
				hidden_tooltip = { character_event = { id = diplomatic.690 } }
				opinion = { who = ROOT modifier = opinion_annexation_failed }
			}
		}
		hidden_tooltip = {
			event_target:diplomatic_annexation_marriage_TARGET = { remove_trait = forbid_marriage }
			event_target:diplomatic_annexation_marriage_KING = { remove_trait = forbid_marriage }
		}
	}
}	
character_event = { #inform king hand failed
	id = diplomatic.690
	desc = "EVTDESCdiplomatic.690"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	show_from_from = yes
	
	option = {
		name = "EVTOPTAdiplomatic.690" 
		clr_character_flag = diplomatic_annexation 
		prestige = -100
		FROMFROM = { opinion = { who = ROOT modifier = opinion_annexation_failed } }
	}
}	
#Inform King target demands ###marriage pact###
character_event = {
	id = diplomatic.7
	desc = "EVTDESCdiplomatic.7"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.7" #OK
		event_target:diplomatic_annexation_marriage_KING = {
			custom_tooltip = { text = TOOLTIPdiplomatic.5A }
		}	
		FROM = {
			event_target:diplomatic_annexation_marriage_TARGET = {
				custom_tooltip = { text = TOOLTIPdiplomatic.5E }
			}
			set_character_flag = diploannex_marriage
			character_event = { id = diplomatic.8  tooltip = TOOLTIPdiplomatic.8 } 
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.7" #No way
		ai_chance = { factor = 0 }
		FROM = {
			set_character_flag = diploannex_marriage_reject
			character_event = { id = diplomatic.9  tooltip = TOOLTIPdiplomatic.9 } 
		}
	}
}
#Inform target king accepts marriage pact
character_event = {
	id = diplomatic.8
	desc = "EVTDESCdiplomatic.8"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.8" #OK
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
}
#Inform target king rejects demand
character_event = {
	id = diplomatic.9
	desc = "EVTDESCdiplomatic.9"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.9" #Fine, I will ask something else
		ai_chance = {
			factor = 10
			modifier = {
				factor = 3
				trait = craven
			}
			modifier = {
				factor = 4
				trait = humble
			}
			modifier = {
				factor = 4
				trait = charitable
			}
			modifier = {
				factor = 4
				trait = patient
			}
			modifier = {
				factor = 4
				trait = content
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 10 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 30 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 50 }
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value = 70 }
			}
		}
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
	option = {
		name = "EVTOPTBdiplomatic.9" #Negotition over
		ai_chance = {
			factor = 10
			modifier = {
				factor = 3
				trait = brave
			}
			modifier = {
				factor = 3
				trait = proud
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 3
				trait = wroth
			}
			modifier = {
				factor = 3
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = -10 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = -30 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = -50 } }
			}
			modifier = {
				factor = 1.5
				NOT = { opinion = { who = FROM value = -70 } }
			}
		}
		FROM = {
			character_event = { id = diplomatic.6  tooltip = TOOLTIPdiplomatic.6 }
			if = {
				limit = { NOT = { character = event_target:diplomatic_annexation_king } }
				opinion = { who = ROOT modifier = opinion_annexation_failed }
			}
		}
		event_target:diplomatic_annexation_king = { 
			opinion = { who = ROOT modifier = opinion_annexation_failed }
		}
	}
}
#Inform King target demands ###Hand of the King###
character_event = {
	id = diplomatic.10
	desc = "EVTDESCdiplomatic.10"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.10" #OK
		ai_chance = { factor = 90 }
		event_target:annnex_councillor_target = { custom_tooltip = { text = TOOLTIPdiplomatic.10 } }
		FROM = {		
			set_character_flag = diploannex_handoftheking
			character_event = { id = diplomatic.11  tooltip = TOOLTIPdiplomatic.8 } 
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.7" #No way
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 0.75
				job_castellan = {
					NOT = { stewardship = FROM }
				}
			}
			modifier = {
				factor = 2
				job_castellan = {
					tier = KING
				}
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 4 } }
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 16 }
			}
		}
		FROM = {
			set_character_flag = diploannex_handoftheking_reject
			character_event = { id = diplomatic.9  tooltip = TOOLTIPdiplomatic.9 } 
		}
	}
}
#Inform target king accepts hand of the king
character_event = {
	id = diplomatic.11
	desc = "EVTDESCdiplomatic.11"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.11" #OK
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
}
#Inform King target demands ###Land for son###
character_event = {
	id = diplomatic.12
	desc = "EVTDESCdiplomatic.12"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.12" #OK
		ai_chance = { factor = 90 }
		FROM = {
			event_target:diploannex_land = {
				custom_tooltip = { text = TOOLTIPdiplomatic.12 }
			}
			set_character_flag = diploannex_land_for_son
			character_event = { id = diplomatic.13  tooltip = TOOLTIPdiplomatic.8 } 
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.12" #No way
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 4 } }
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 16 }
			}
		}
		FROM = {
			set_character_flag = diploannex_land_for_son_reject
			character_event = { id = diplomatic.9  tooltip = TOOLTIPdiplomatic.9 } 
		}
	}
}
#Inform target king accepts land for son
character_event = {
	id = diplomatic.13
	desc = "EVTDESCdiplomatic.13"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.13" #OK
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
}
#Inform King target demands ###KG for son###
character_event = {
	id = diplomatic.14
	desc = "EVTDESCdiplomatic.14"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.14" #OK
		ai_chance = { factor = 90 }
		FROM = {
			event_target:diploannex_KG = {
				custom_tooltip = { text = TOOLTIPdiplomatic.14 }
			}
			set_character_flag = diploannex_KG
			character_event = { id = diplomatic.15  tooltip = TOOLTIPdiplomatic.8 } 
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.14" #No way
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 2
				kingsguard = {
					is_alive = yes
					count = 7
				}
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 4 } }
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 16 }
			}
		}
		FROM = {
			set_character_flag = diploannex_KG_reject
			character_event = { id = diplomatic.9  tooltip = TOOLTIPdiplomatic.9 } 
		}
	}
}
#Inform target king accepts son KG
character_event = {
	id = diplomatic.15
	desc = "EVTDESCdiplomatic.15"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.15" #OK
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
}
#Inform King target demands ###Vassal Transfer###
character_event = {
	id = diplomatic.16
	desc = "EVTDESCdiplomatic.16"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.16" #OK
		ai_chance = { factor = 90 }
		event_target:diplomatic_annexation_king = {
			any_vassal = {
				limit = {
					NOT = { tier = KING }
					de_jure_liege_or_above = FROM
				}
				custom_tooltip = { text = TOOLTIPdiplomatic.5D }				
			}
		}	
		FROM = {
			set_character_flag = diploannex_vassal_transfer
			character_event = { id = diplomatic.17  tooltip = TOOLTIPdiplomatic.8 } 
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.16" #No way
		ai_chance = { 
			factor = 10 
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = greedy
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 4 } }
			}
			modifier = {
				factor = 1.5
				FROM = { NOT = { diplomacy = 8 } }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 12 }
			}
			modifier = {
				factor = 0.75
				FROM = { diplomacy = 16 }
			}
		}
		FROM = {
			set_character_flag = diploannex_vassal_transfer_reject
			character_event = { id = diplomatic.9  tooltip = TOOLTIPdiplomatic.9 } 
		}
	}
}
#Inform target king accepts vassal transfer
character_event = {
	id = diplomatic.17
	desc = "EVTDESCdiplomatic.17"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.17" #OK
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
}
#Inform King target demands ###royal privilege###
character_event = {
	id = diplomatic.18
	desc = "EVTDESCdiplomatic.18"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.18" #OK	
		FROM = {
			custom_tooltip = { text = TOOLTIPdiplomatic.5H }
			set_character_flag = diploannex_royal_privilege
			character_event = { id = diplomatic.19  tooltip = TOOLTIPdiplomatic.8 } 
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.18" #No way
		ai_chance = { factor = 0 }
		FROM = {
			set_character_flag = diploannex_royal_privilege_reject
			character_event = { id = diplomatic.9  tooltip = TOOLTIPdiplomatic.9 } 
		}
	}
}
#Inform target king accepts royal privilege
character_event = {
	id = diplomatic.19
	desc = "EVTDESCdiplomatic.19"
	picture = GFX_evt_council
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.19" #OK
		character_event = { id = diplomatic.5  tooltip = TOOLTIPdiplomatic.5 } 
	}
}
#Inform king target accepts annexation
character_event = {
	id = diplomatic.29
	desc = "EVTDESCdiplomatic.29"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.29" #OK
		FROM = {
			any_vassal = {
				limit = { tier = KING }
				if = {
					limit = { ROOT = { trait = civil_war } }
					set_character_flag = neutral
					custom_tooltip = { text = TOOLTIPdejure_kingdom_EMP_vassal }
					hidden_tooltip = { character_event = { id = mega_wars.52 } }
				}
				if = {
					limit = { ROOT = { NOT = { trait = civil_war } } }
					character_event = { id = mega_wars.52 tooltip = EVTTOOLTIPmega_wars.52 }
				}	
			}
			if = { 	limit = { primary_title = { title = e_north } }
					k_north = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_riverlands } }
					k_riverlands  = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_vale } }
					k_vale = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_westerlands } }
					k_westerlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_reach } }
					k_reach = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_stormlands } }
					k_stormlands = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_dorne } }
					k_dorne = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } }
			}
			if = { 	limit = { primary_title = { title = e_iron_isles } }
					k_iron_isles = { custom_tooltip = { text = TOOLTIPdejure_kingdom_claim_EMP_success } } 
			}
			tooltip = { set_defacto_liege = ROOT }
			hidden_tooltip = { 
				character_event = { id = maintenance.20 } #This event takes the defeated King's title and reorganises them
				remove_opinion = { who = ROOT modifier = opinion_subjugated_AGOT }
			} 
			opinion = { who = ROOT modifier = opinion_agreed_annexation }
			if = { #Marriage Pact
				limit = { has_character_flag = diploannex_marriage }
				event_target:diplomatic_annexation_marriage_TARGET = {
					event_target:diplomatic_annexation_marriage_KING = {
						add_spouse = PREV
						hidden_tooltip = { 
							child_fertility_debuff = yes 
							add_character_modifier = { name = "wedding" duration = 60 }
							PREV = { 
								child_fertility_debuff = yes 
								add_character_modifier = { name = "wedding" duration = 60 }
							}
						}
					}
				}
				clr_character_flag = diploannex_marriage
			}	
			if = { #Hand of the King
				limit = { has_character_flag = diploannex_handoftheking }
				event_target:annnex_councillor_target = {
					if = {
						limit = {
							is_councillor = yes
							liege = { character = ROOT }
						}
						if = {
							limit = { has_job_title = job_castellan }
							remove_title = job_castellan 
							opinion = { who = ROOT modifier = opinion_fired_from_council }
							ROOT_FROM = { give_job_title = job_castellan }
						}
						if = {
							limit = { has_job_title = job_chancellor }
							remove_title = job_chancellor 
							opinion = { who = ROOT modifier = opinion_fired_from_council }
							ROOT_FROM = { give_job_title = job_chancellor }
						}
						if = {
							limit = { has_job_title = job_treasurer }
							remove_title = job_treasurer
							opinion = { who = ROOT modifier = opinion_fired_from_council }
							ROOT_FROM = { give_job_title = job_treasurer }
						}
						if = {
							limit = { has_job_title = job_spymaster }
							remove_title = job_spymaster
							opinion = { who = ROOT modifier = opinion_fired_from_council }
							ROOT_FROM = { give_job_title = job_spymaster }
						}
						if = {
							limit = { has_job_title = job_marshal }
							remove_title = job_marshal 
							opinion = { who = ROOT modifier = opinion_fired_from_council }
							ROOT_FROM = { give_job_title = job_marshal }
						}
					}	
				}	
				hidden_tooltip = { #failsafe
					if = {
						limit = { is_councillor = no }
						ROOT = {
							job_chancellor = {
								remove_title = job_chancellor 
								opinion = { who = ROOT modifier = opinion_fired_from_council }
							}
						}
						give_job_title = job_chancellor
					}
				}
				clr_character_flag = diploannex_handoftheking 
			}	
			if = { #Land for son
				limit = { has_character_flag = diploannex_land_for_son }
				event_target:diploannex_land = {
					ROOT = {
						random_demesne_title = {
							limit = {
								tier = COUNT
								can_be_given_away = yes
								NOT = {
									location = {
										is_capital = yes
									}						
								}
							}
							grant_title = PREVPREV	
						}
					}
					if = {
						limit = { NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_granted_county } } }
						opinion = { who = ROOT modifier = opinion_granted_county }
					}
				}
				clr_character_flag = diploannex_land_for_son
			}	
			if = { #KG for son
				limit = { has_character_flag = diploannex_KG  }
				event_target:diploannex_KG = {
					if = {
						limit = {
							kingsguard = {
								is_alive = yes
								count = 7
							}
						}	
						d_kingsguard = {
							holder_scope = {
								#hidden_tooltip = { change_variable = { which = "kingsguard_count" value = -1 } }
								random_courtier = {
									limit = { 
										trait = kingsguard 
										trait = trained_warrior
									}
									custom_tooltip = { text = TOOLTIPclash_of_kings.20C }
									##opinion
									hidden_tooltip = {
										remove_trait = kingsguard
										recalc_succession = yes
									}	
								}
							}
						}
					}
					ROOT = { prestige = -50 }
					add_trait = kingsguard
					recalc_succession = yes
					hidden_tooltip = {
						d_kingsguard = {
							holder_scope = {
								reverse_banish = PREVPREV
								#change_variable = { which = "kingsguard_count" value = 1 }
							}
						}
					}
				}
				clr_character_flag = diploannex_KG 
			}			
			if = { #Vassal transfer
				limit = { has_character_flag = diploannex_vassal_transfer }
				ROOT = {
					any_vassal = {
						limit = {
							NOT = { tier = KING }
							de_jure_liege_or_above = ROOT_FROM
						}
						set_defacto_liege = ROOT_FROM
						hidden_tooltip = { character_event = { id = 63002 } } #inform
					}
				}
				clr_character_flag = diploannex_vassal_transfer
			}	
			if = { #Royal Privilege
				limit = { has_character_flag = diploannex_royal_privilege }
				custom_tooltip = {
					text = TOOLTIPdiploannex_royal_privilege
					hidden_tooltip = {
						any_demesne_title = {
							limit = {
								tier = KING
								controls_religion = no
							}
							hidden_tooltip = { set_variable = { which = "lord_paramount_status" value = 0 } } #1 = lord paramount, 2 = interregnum
							add_law = privilege_vassal_king
						}
						set_government_type = feudal_government
					}
				}	
				ROOT = {
					prestige = -100
					custom_tooltip = {
						text = TOOLTIPgrant_privliege_vassals_annoyed
						hidden_tooltip = {
							any_vassal = {
								limit = {									
									OR = {
										any_demesne_title = {
											tier = KING
											controls_religion = no
											is_landless_type_title = no
											NOT = { has_law = privilege_vassal_king }
											is_variable_equal = { which = "lord_paramount_status" value = 1 } #1 = lord paramount, 2 = interregnum
										}
										
										NOT = { opinion = { who = ROOT value = -29 } }
										AND = {
											NOT = { culture_group = ROOT_FROM }
											OR = {
												trait = wroth
												trait = envious
												trait = ambitious
											}
										}
										AND = {
											NOT = { religion = ROOT_FROM }
											trait = zealous
										}
									}
									NOT = { trait = content }
									NOT = { has_position = loyalist }
									NOT = { character = ROOT_FROM }
								}
								opinion = {
									who = PREV
									modifier = opinion_someone_granted_royal_privilege
									months = 60
								}
							}
						}
					}
				}
				clr_character_flag = diploannex_royal_privilege
			}	
			clr_character_flag = diploannex_marriage_reject
			clr_character_flag = diploannex_handoftheking_reject		
			clr_character_flag = diploannex_land_reject
			clr_character_flag = diploannex_KG_reject 	
			clr_character_flag = diploannex_vassal_transfer_reject
			clr_character_flag = diploannex_royal_privilege_reject				
		}
		if = {
			limit = { FROM = { higher_tier_than = DUKE } }
			prestige = 250
			tooltip = {
				if = {
					limit = { NOT = { character = FROMFROMFROM } }
					FROMFROMFROM = { prestige = 250 }
				}
			}
		}	
		if = {
			limit = { FROM = { tier = DUKE } }
			prestige = 150
			tooltip = {
				if = {
					limit = { NOT = { character = FROMFROMFROM } }
					FROMFROMFROM = { prestige = 150 }
				}
			}
		}	
		if = {
			limit = { FROM = { lower_tier_than = DUKE } }
			prestige = 75
			tooltip = {
				if = {
					limit = { NOT = { character = FROMFROMFROM } }
					FROMFROMFROM = { prestige = 75 }
				}
			}
		}
		
		hidden_tooltip = {
			event_target:diplomatic_annexation_marriage_TARGET = { remove_trait = forbid_marriage }
			event_target:diplomatic_annexation_marriage_KING = { remove_trait = forbid_marriage }
			any_playable_ruler = {
				limit = { 
					ai = no 
					OR = {
						same_realm = ROOT
						same_realm = FROM
						culture_group = ROOT
						culture_group = FROM
						religion_group = ROOT
						religion_group = FROM
						is_within_diplo_range = ROOT
					}
					NOR = {
						character = ROOT
						character = FROM
						character = FROMFROMFROM
					}
				}
				character_event = { id = diplomatic.2901 }
			}
		}
	}
}
character_event = { #Inform hand
	id = diplomatic.2900
	desc = "EVTDESCdiplomatic.2900"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.2900"
		if = {
			limit = { FROM = { higher_tier_than = DUKE } }
			prestige = 250
		}	
		if = {
			limit = { FROM = { tier = DUKE } }
			prestige = 150
		}	
		if = {
			limit = { FROM = { lower_tier_than = DUKE } }
			prestige = 75
		}
		event_target:diplomatic_annexation_king = { opinion = { who = ROOT modifier = opinion_service_rendered multiplier = 2 years = 5 } }
		hidden_tooltip = { 
			clr_character_flag = dirty_service
			change_variable = { which = "services_rendered" value = 5 }
			character_event = { id = 73560 days = 5 }
		}
	}
}
character_event = { #Inform world
	id = diplomatic.2901
	desc = "EVTDESCdiplomatic.2901"

	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAdiplomatic.2901"
		trigger = {
			OR = {
				same_realm = ROOT
				same_realm = FROM
			}
		}
	}
	option = {
		name = "EVTOPTBdiplomatic.2901"
		trigger = {
			is_liege_or_above = FROM
			NOT = { is_liege_or_above = FROMFROM }
		}
	}
	option = {
		name = "EVTOPTCdiplomatic.2901"
		trigger = {
			is_liege_or_above = FROMFROM
		}
	}
	option = {
		name = OK
		trigger = {
			NOR = {
				same_realm = ROOT
				same_realm = FROM
			}
		}
	}
}	
character_event = { #Ai finds annexation target, 5 year pulse
	id = diplomatic.2902

	is_triggered_only = yes
	only_independent = yes
	ai = yes
	capable_only = yes
	prisoner = no
	min_age = 16
	
	trigger = {	
		demesne_size = 1
		higher_tier_than = COUNT
		OR = {
			tier = EMPEROR
			primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
		}	
		is_nomadic = no	
		diplomacy = 10
		has_regent = no
		OR = {
			NOT = { has_character_flag = diplomatic_annexation }
			had_character_flag = { flag = diplomatic_annexation days = 400 }
		}		
	}
	
	immediate = {	
		random_allied_character = {
			limit = {
				is_ruler = yes
				independent = yes
				demesne_size = 1
				OR = {
					tier = EMPEROR
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
				}
				is_nomadic = no
				
				OR = {
					lower_tier_than = ROOT
					custom_tooltip = {
						text = TOOLTIPoffer_annexationWESTEROS
						hidden_tooltip = {
							AND = {
								ROOT = { has_landed_title = e_iron_throne }
								primary_title = {
									OR = {
										capital_scope = { region = world_westeros }
										title = e_iron_isles #These titles dont have capitals
										title = e_riverlands
									}
								}	
							}
						}
					}	
				}
				NOT = { trait = wildling }	
				NOT = { trait = pirate }
				has_regent = no		
				NOT = { has_character_flag = diplomatic_annexation_refused }
				
				opinion = { who = ROOT value = 0 }
				reverse_opinion = { who = ROOT value = -24 }
			}
			save_event_target_as = diplomatic_annexation_target
			ROOT = { character_event = { id = diplomatic.1 tooltip = TOOLTIPdiplomatic.1 } }	
		}
	}
	
	option = {
		name = OK
	}
}	
###############################################
###Demand Important Prisoners from Vassals#####
###############################################
#Vassal receives demand
letter_event = {
	id = diplomatic.200
	desc = "EVTDESCdiplomatic.200"
	
	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = "EVTOPTAdiplomatic.200" #Yes
		ai_chance = {
			factor = 75
			
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 20 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 40 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 60 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 80 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = FROMFROM value = 100 }
			}	
			modifier = {
				factor = 1.5
				NOT = { relative_power = { who = FROMFROM power = 0.5 } }
			}
			modifier = {
				factor = 1.5
				NOT = { relative_power = { who = FROMFROM power = 0.33 } }
			}
			modifier = {
				factor = 1.5
				NOT = { relative_power = { who = FROMFROM power = 0.1 } }
			}
			modifier = {
				factor = 2
				trait = content
			}	
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = humble
			}	
			modifier = {
				factor = 2
				trait = patient
			}	
			modifier = {
				factor = 4
				trait = just
			}			
		}
		any_courtier = {		
			limit = {
				prisoner = yes
				host = { character = PREVPREV }
				OR = {
					AND = {
						is_ruler = yes
						war_with = ROOT
					}
					liege = {
						is_close_relative = PREV
						war_with = ROOT
					}							
				}
				NOT = { has_character_flag = kidnapped_by_plot }
			}
			custom_tooltip = { text = EVTTOOLTIPprisreq }
			hidden_tooltip = {
				prisoner = no
				imprison = FROMFROM
			}
		}	
		hidden_tooltip = {
			FROMFROM = {
				letter_event = { id = diplomatic.201 }
			}
		}		
	}
	
	option = {
		name = "EVTOPTCdiplomatic.200" #No
		trigger = {
			NAND = {
				prisoner = yes
				host = { character = FROMFROM }
			}
		}
		ai_chance = {
			factor = 25
			
			modifier = {
				factor = 0
				trait = honorable
			}
			modifier = {
				factor = 0
				opinion = { who = FROMFROM value = -39 }
				NOT = { trait = lunatic }
				NOT = { trait = greedy }
				NOT = { trait = arbitrary }
				NOT = { #want to keep foes
					any_courtier = {
						prisoner = yes
						host = { character = PREVPREV }
						is_foe = ROOT
						OR = {
							AND = {
								is_ruler = yes
								war_with = FROMFROM
							}
							liege = {
								is_close_relative = PREV
								war_with = FROMFROM
							}							
						}	
						NOT = { has_character_flag = kidnapped_by_plot }
					}
				}
			}
			
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROM value = -19 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROM value = -39 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROM value = -59 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROM value = -79 } }
			}
			modifier = {
				factor = 1.25
				NOT = { opinion = { who = FROMFROM value = -99 } }
			}	
			modifier = {
				factor = 1.5
				relative_power = { who = FROMFROM power = 0.8 }
			}
			modifier = {
				factor = 2
				relative_power = { who = FROMFROM power = 1 }
			}
			modifier = {
				factor = 2
				relative_power = { who = FROMFROM power = 1.5 }
			}
			modifier = {
				factor = 2
				trait = ambitious
			}	
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = proud
			}	
			modifier = {
				factor = 2
				trait = wroth
			}	
			modifier = {
				factor = 4
				trait = arbitrary
			}	
			modifier = {
				factor = 4
				trait = ruthless
			}		
		}		
		FROMFROM = {
			opinion = { who = ROOT modifier = opinion_refused_prisoner_transfer months = 60 }
			hidden_tooltip = { letter_event = { id = diplomatic.202 } }
		}
	}
}
letter_event = { #Inform Accept
	id = diplomatic.201
	desc = "EVTDESCdiplomatic.201"
	
	is_triggered_only = yes
	ai = no

	option = {
		name = OK
	}
}	
letter_event = { #Inform Reject
	id = diplomatic.202
	desc = "EVTDESCdiplomatic.202"
	
	is_triggered_only = yes

	option = {
		name = "EVTOPTAdiplomatic.202"
		if = {
			limit = { tier = EMPEROR }
			prestige = -70
		}
		if = {
			limit = { tier = KING }
			prestige = -50
		}
		if = {
			limit = { tier = DUKE }
			prestige = -30
		}
		if = {
			limit = { lower_tier_than = DUKE }
			prestige = -10
		}
	}
}	