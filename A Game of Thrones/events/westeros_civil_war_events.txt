#-Westeros civil war events
namespace = mega_wars
# by knuckey and blackninja

#Main events
#-----------
#[mega_wars.1 - .3] - King is at war with a Lord Paramount/Independant realm, calls lords paramount banners
#[mega_wars.4] - Vassal  king/lp has empire title flag set immediately
#[mega_wars.5] - Rebel leader assigned flags and call banners if possible
#[mega_wars.6] - High Septon seeks refuge in your capital
#[mega_wars.7] - Lord Paramount responds
#[mega_wars.8] - Civil war ending event (King, triggered from on_action and MTTH)
#[mega_wars.901 & 9] - Inform king/LP of war end- re-vassalised if applicable, or post civil wars flag set
#[mega_wars.900] - Inform lord of war end- re-vassalised if applicable, or post civil wars flag set
#[mega_wars.10 - .11] - Sort out High Septon refuge
#[mega_wars.12] - Lord is re-vassalised after their post civil war wars are done
#[mega_wars.13] - Lord supporting king rejoins King's war if at peace
#[mega_wars.14 - .18] - Lord is defending against external realm post civil war- King decides to help or not
#[mega_wars.19] - Crown Loyalist joins King
#[mega_wars.20] - Liege Loyalist follows Liege

#Vassal control events 
#-----------------------
#[mega_wars.21-22] - AI Mid War Control
#[mega_wars.23] - On death vassal inherit control
#[mega_wars.24] - King/LP tier inherit/yearly decision
#[mega_wars.25] - Vassal of LP/King initial response
#[mega_wars.26] - Vassal of LP/King  inherit/yearly decision

#Inform character events
#----------------------
#[mega_wars.30 - .40 ] 


#Flag maintenance
#----------------------
#[mega_wars.41] - Diplomatic call to arms set flags
#[mega_wars.42] - Maintain defacto opinion link with split vassal
#[mega_wars.4299] - Vassal of split vassal rebels, add defacto liege link to emperor
#[mega_wars.43] - Flag maintenance
#[mega_wars.44] - on_create_title , reset defacto empire variables

#Independence Events
#----------------------
#[mega_wars.50] - Lord paramount/King wins indep war
#[mega_wars.51] - A Lord that wins independance from LP/King during civil chooses whether to swear fealty to Emperor (triggered from indep CB in cb_types)
#[mega_wars.52] - Character loses dejure kingdom war against King, assign flag to revassalise (from cb_types)
#[mega_wars.53] - Indep War Victory Ally Maintenance
#[mega_wars.54] - Small AI lords in successful independence faction attach to larger ally

#Mega War Drama
#-----------------------
#[mega_wars.60 - .73] - My close relative is opposing my host
#[mega_wars.74 - 85] - Emperor deals with defeated rebels/traitors
#[mega_wars.86-  95] - Rebel Leader resolution, deals with defeated emperor
#[mega_wars.96-  100] - Vassal is harbouring exiled pretender

#Maintaing the council - blackninja
#-----------------------
#[mega_wars.101 - 103] - Reappoint the old council members

# custom_tooltip = {
	# text = TOOLTIPINDEPENDENTCONDITION
	# hidden_tooltip = {
		# independent = yes
		# primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
	# }
# }
			
#Main events
#-----------

# #Game start maintenance events
# character_event = { #set title variables
	# id = mega_wars.999
	
	# is_triggered_only = yes
	# hide_window = yes
	# #only_rulers = yes
	
	# trigger = { 
		# has_landed_title = e_rebels 
		# NOT = { has_global_flag = scenario_initialised } 
	# }
	
	# immediate = {
		# #set_global_flag = scenario_initialised #set in roberts_rebellion_events
		# #Set mega war title law flags
		# e_rebels = { set_variable = { which = "de_facto_empire" value = 21 } } #e_rebels counts how many empires have been flagged
		# e_iron_throne = { set_variable = { which = "de_facto_empire" value = 1 } }
		# e_north = { set_variable = { which = "de_facto_empire" value = 2 } }
		# e_iron_isles = { set_variable = { which = "de_facto_empire" value = 3 } }
		# e_vale = { set_variable = { which = "de_facto_empire" value = 4 } }
		# e_westerlands = { set_variable = { which = "de_facto_empire" value = 5 } }
		# e_reach = { set_variable = { which = "de_facto_empire" value = 6 } }
		# e_stormlands = { set_variable = { which = "de_facto_empire" value = 7 } }
		# e_dorne = { set_variable = { which = "de_facto_empire" value = 8 } }
		# e_riverlands = { set_variable = { which = "de_facto_empire" value = 9 } }
		# e_mexikha = { set_variable = { which = "de_facto_empire" value = 10 } }
		# e_new_valyria = { set_variable = { which = "de_facto_empire" value = 11 } }
		# e_three_daughters = { set_variable = { which = "de_facto_empire" value = 12 } }
		# e_braavos = { set_variable = { which = "de_facto_empire" value = 13 } }
		# e_ghiscar = { set_variable = { which = "de_facto_empire" value = 14 } }
		# e_qarth = { set_variable = { which = "de_facto_empire" value = 15 } }
		# e_yi_ti = { set_variable = { which = "de_facto_empire" value = 17 } }
		# e_summer_sea = { set_variable = { which = "de_facto_empire" value = 18 } }
		# e_khalasar = { set_variable = { which = "de_facto_empire" value = 19 } }
		# e_jkhalasar = { set_variable = { which = "de_facto_empire" value = 20 } }
		
		# e_rebels = { set_variable = { which = "de_facto_kingdom" value = 45 } } #e_rebels counts how many kingdoms have been flagged
		# k_the_most_devout = { set_variable = { which = "de_facto_kingdom" value = 1 } }
		# k_north = { set_variable = { which = "de_facto_kingdom" value = 2 } }
		# k_riverlands = { set_variable = { which = "de_facto_kingdom" value = 3 } }
		# k_vale = { set_variable = { which = "de_facto_kingdom" value = 4 } }
		# k_iron_isles = { set_variable = { which = "de_facto_kingdom" value = 5 } }
		# k_reach = { set_variable = { which = "de_facto_kingdom" value = 6 } }
		# k_dorne = { set_variable = { which = "de_facto_kingdom" value = 7 } }
		# k_stormlands = { set_variable = { which = "de_facto_kingdom" value = 8 } }
		# k_westerlands = { set_variable = { which = "de_facto_kingdom" value = 9 } }
		# k_beyond_wall = { set_variable = { which = "de_facto_kingdom" value = 10 } }
		# k_summer_islands = { set_variable = { which = "de_facto_kingdom" value = 11 } }
		# k_basilisk_isles = {set_variable = { which = "de_facto_kingdom" value = 12 } }
		# k_stepstones = { set_variable = { which = "de_facto_kingdom" value = 13 } }
		# k_pentos = { set_variable = { which = "de_facto_kingdom" value = 14 } }
		# k_lys = { set_variable = { which = "de_facto_kingdom" value = 15 } }
		# k_qohor = { set_variable = { which = "de_facto_kingdom" value = 16 } }
		# k_norvos = { set_variable = { which = "de_facto_kingdom" value = 17 } }
		# k_myr = { set_variable = { which = "de_facto_kingdom" value = 18 } }
		# k_tyrosh = { set_variable = { which = "de_facto_kingdom" value = 19 } }
		# k_volantis = { set_variable = { which = "de_facto_kingdom" value = 20 } }
		# k_lorath = { set_variable = { which = "de_facto_kingdom" value = 21 } }
		# k_braavos = { set_variable = { which = "de_facto_kingdom" value = 22 } }
		# k_yunkai = { set_variable = { which = "de_facto_kingdom" value = 23 } }
		# k_astapor = { set_variable = { which = "de_facto_kingdom" value = 24 } }
		# k_meereen = { set_variable = { which = "de_facto_kingdom" value = 25 } }
		# k_new_ghis = { set_variable = { which = "de_facto_kingdom" value = 26 } }
		# k_lhazar = { set_variable = { which = "de_facto_kingdom" value = 27 } }
		# k_hazdahn = { set_variable = { which = "de_facto_kingdom" value = 28 } }
		# k_ibben = { set_variable = { which = "de_facto_kingdom" value = 29 } }
		# k_qarth = { set_variable = { which = "de_facto_kingdom" value = 30 } }
		# k_leng = { set_variable = { which = "de_facto_kingdom" value = 31 } }
		# k_asabhad = { set_variable = { which = "de_facto_kingdom" value = 32 } }
		# k_asshai = { set_variable = { which = "de_facto_kingdom" value = 33 } }
		# k_yin = { set_variable = { which = "de_facto_kingdom" value = 34 } }
		# k_jinqi = { set_variable = { which = "de_facto_kingdom" value = 35 } }
		# k_tiqui = { set_variable = { which = "de_facto_kingdom" value = 36 } }
		# k_linqi = { set_variable = { which = "de_facto_kingdom" value = 37 } }
		# k_piqui = { set_variable = { which = "de_facto_kingdom" value = 38 } }
		# k_xin = { set_variable = { which = "de_facto_kingdom" value = 39 } }
		# k_trader_town = { set_variable = { which = "de_facto_kingdom" value = 40 } }
		# k_nghai = { set_variable = { which = "de_facto_kingdom" value = 41 } }
		# k_dothraki = { set_variable = { which = "de_facto_kingdom" value = 42 } }
		# k_ifeqevron = { set_variable = { which = "de_facto_kingdom" value = 43 } }
		# k_jogos_nhai = { set_variable = { which = "de_facto_kingdom" value = 44 } }
		
		# character_event = { id = mega_wars.998 days = 1 }
	# }
	
	# option = {
		# name = OK
	# }	
# }	
# character_event = { #give flags to ruler designer characters
	# id = mega_wars.998
	
	# is_triggered_only = yes
	# hide_window = yes
	
	# trigger = { has_landed_title = e_rebels }
	
	# immediate = {
		# any_playable_ruler = { 
			# limit = { 
				# ai = no 
			# }	
			# if = {
				# limit = { 
					# NOT = { trait = civil_war }
					# NOT = { trait = rebel_leader }
					# NOT = { has_character_flag = supporting_king }
					# NOT = { has_character_flag = neutral }
					# NOT = { has_character_flag = against_king }
					# OR = {
						# AND = {
							# independent = yes
							# primary_title = { check_variable = { which = "de_facto_empire" value = 1 } }
						# }
						# liege = { 
							# OR = {
								# trait = civil_war
								# trait = rebel_leader
								# has_character_flag = supporting_king
								# has_character_flag = neutral
								# has_character_flag = against_king
							# }	
						# }
					# }	
				# }
				# set_character_flag = neutral
			# }	
		# }
	# }
	
	# option = {
		# name = OK
	# }	
# }	

###Main Event Series###
#King is at war with a Lord Paramount, calls lords paramounts banners
character_event = { #If triggered from on_actions, makes sure King is FROMFROM scope
	id = mega_wars.1
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		NOT = {
			has_game_rule = {
				name = mega_wars
				value = off
			}
		}
	}
	
	immediate = {
		if = { #Check defender
			limit = { tier = EMPEROR }
			character_event = { id = mega_wars.3 }
		}	
		FROM = { #Check attacker
			if = { 
				limit = { 
					tier = EMPEROR 
					NOT = { character = ROOT }
				}			
				character_event = { id = mega_wars.2 }
			}
		}	
	}
	
	option = {
		name = OK
	}	
}	
character_event = {
	id = mega_wars.2
	
	is_triggered_only = yes
	hide_window = yes
	
	trigger = { 
		tier = EMPEROR 
		
		##Westerosi Rulers dont usually bother with foreign embargos##
		OR = {
			ai = no
			AND = {
				NOT = { has_character_flag = no_embargo_mega_wars }
				NOT = { 
					any_war = {
						using_cb = embargo_cb
						attacker = { 
							character = ROOT 
							OR = {
								NOT = { culture_group = FROM }
								culture_group = valyrian
							}
							capital_scope = { region = world_westeros }
						}
						defender = { 
							character = FROM 
							NOT = { capital_scope = { region = world_westeros } }
						}
					}
				}
			}	
		}	
	}
	
	immediate = {
		character_event = { id = mega_wars.3 }
	}
	
	option = {
		name = OK
	}	
}	
character_event = {
	id = mega_wars.3
	desc = "EVTDESCmega_wars.3"
	
	hide_from = yes
	only_independent = yes
	war = yes
	
	trigger = {
		tier = EMPEROR	
		OR = { #Only trigger for nomads if they have non-nomad vassals, vassal nomad clans will not be split
			is_nomadic = no
			any_vassal = { tier = KING is_nomadic = no }
		}	
		NOT = {
			has_game_rule = {
				name = mega_wars
				value = off
			}
		}
		NOT = { crownlaw_title = { has_law = centralization_4 } } #Disabled on max authority
		NOT = { rebel_leader = { has_character_modifier = new_rebel_leader is_alive = yes war_with = ROOT } } #Only one new rebel leader can be considered at a time
		NOT = { has_character_flag = considering_surrender } #Do not trigger if still considering surrender to a dragon conquest
		NOT = { has_character_flag = no_embargo_mega_wars } #Does not apply to AI embargo wars
		NOT = { government = alliance_government } #Does not apply to alliance governments
		OR = { #Does not apply to westerosi kingdoms in an independence war
			has_landed_title = e_iron_throne
			primary_title = {
				NOT = { capital_scope = { region = world_westeros } }
				NOT = { title = e_iron_isles }#These titles dont have capitals
				NOT = { title = e_riverlands }
			}	
			NOT = { 
				any_war = {
					attacker = { character = ROOT }
					OR = {
						using_cb = bid_for_independence
						using_cb = cb_faction_independence
						using_cb = bid_for_independence_CW
						using_cb = bid_for_independence_ACOK
					}
				}
			}
		}	
		OR = {
			any_demesne_title = { #One of the empire tier titles is being contested
				tier = EMPEROR
				any_war = {
					attacker = { 
						NOT = { character = ROOT }
						NOT = { trait = rebel_leader }
						NOT = { has_character_flag = considering_surrender }
					}
				}
			}
			any_war = {
				OR = {	
					AND = {
						defender = { character = ROOT }
						attacker = { 
							NOT = { character = ROOT }
							NOT = { culture_group = unoccupied_group }
							NOT = { has_character_flag = considering_surrender }
							OR = {	
								AND = { #King tier vassals always trigger mega war
									NOT = { trait = rebel_leader }
									war_with = ROOT
									liege_before_war = { character = ROOT }
									OR = {	
										tier = KING 
										has_character_flag = indep_war	
									}
									#liege = { character = ROOT }
								}
								AND = { #External Attackers 
									NOT = { trait = rebel_leader }
									war_with = ROOT
									independent = yes
									OR = { #Musn't be landless (with some exceptions)
										demesne_size = 1
										has_character_flag = summer_islander_invader
										has_character_flag = claimant_adventurer
										has_character_flag = duchy_adventurer
									}	
									NOT = { liege = { character = ROOT }	}
									ROOT = { is_primary_war_defender = yes }				
								}			
							}		
						}
					}	
					AND = {
						attacker = { character = ROOT }
						defender = { 
							NOT = { character = ROOT }
							NOT = { culture_group = unoccupied_group }
							NOT = { has_character_flag = considering_surrender }
							OR = {	
								AND = { #King tier vassals always trigger mega war	
									NOT = { trait = rebel_leader }
									war_with = ROOT
									OR = {	
										tier = KING 
										has_character_flag = indep_war
									}
									independent = no		
									#liege = { character = ROOT }
								}
								AND = { #External Defenders
									OR = {
										NOT = { trait = rebel_leader }
										AND = { #Enemy emperors may already have the rebel_leader trait
											tier = EMPEROR
											NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader } }
										}	
									}	
									war_with = ROOT
									independent = yes 
									demesne_size = 1
									NOT = { liege = { character = ROOT }	}
									ROOT = { is_primary_war_attacker = yes }
									NOT = { has_character_flag = crownlander_resists }				
								}			
							}	
						}
					}	
				}
			}
			any_playable_ruler = { #Enemies who have the support of a king tier vassal trigger a mega war
				NOT = { trait = rebel_leader }
				tier = KING 
				independent = no
				OR = {
					liege = { character = ROOT }
					NOT = { liege = { tier = EMPEROR } }
				}	
				war_with = ROOT	
				any_war = {
					OR = {
						attacker = { character = ROOT } 
						defender = { character = ROOT } 
					}
				}					
				NOT = { has_character_flag = against_king }
				NOT = { has_character_flag = inherit_war }
				NOT = { has_character_flag = considering_surrender }
				NOT = {
					any_war = {
						OR = {
							attacker = { trait = rebel_leader } 
							defender = { trait = rebel_leader } 
						}
					}
				}
			}
		}	
	}
	
	immediate = {
		##Make sure empire title has a unique variable set
		e_rebels = {
			ROOT = {
				primary_title = {
					if = {
						limit = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
						set_variable = { which = "de_facto_empire" which = PREVPREV }
						e_rebels = { change_variable = { which = "de_facto_empire" value = 1 } }
					}
				}
				any_demesne_title = {
					limit = {
						tier = EMPEROR
						NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
					}
					set_variable = { which = "de_facto_empire" which = PREVPREV }
					e_rebels = { change_variable = { which = "de_facto_empire" value = 1 } }
				}
			}	
		}
		hidden_tooltip = {
			if = {
				limit = { NOT = { trait = civil_war } }
				# Flag councillors
				any_opinion_modifier_target = {
					limit = {
						OR = {
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
						}
					}
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_castellan }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_marshal }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_learned }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_priest }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_ships }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_admiral }
				}
				job_castellan = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_castellan
							months = 240
						}
					}
				}
				job_chancellor = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_chancellor
							months = 240
						}
					}
				}
				job_marshal = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_marshal
							months = 240
						}
					}
				}
				job_treasurer = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_treasurer
							months = 240
						}
					}
				}
				job_spymaster = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_spymaster
							months = 240
						}
					}
				}
				job_spiritual = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_learned
							months = 240
						}
					}
				}
				job_priest = { 
					if = { 
						limit = { is_ruler = yes }
						reverse_opinion = {
							who = ROOT
							modifier = opinion_pre_mega_war_priest
							months = 240
						}
					}
				}
				# random_vassal = { 
					# limit = { has_minor_title = title_master_of_ships }
					# reverse_opinion = {
						# who = ROOT
						# modifier = opinion_pre_mega_war_ships
						# months = 240
					# }
				# }
				random_vassal = { 
					limit = { has_minor_title = title_high_admiral }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_admiral
						months = 240
					}
				}
				# random_vassal = { 
					# limit = { has_minor_title = title_master_of_ships_B }
					# reverse_opinion = {
						# who = ROOT
						# modifier = opinion_pre_mega_war_ships
						# months = 240
					# }
				# }
				random_vassal = { 
					limit = { has_minor_title = title_high_admiral_B }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_admiral
						months = 240
					}
				}
				any_vassal = { 
					limit = { has_minor_title = title_small_council_advisor }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_advisor
						months = 240
					}
				}
				random_vassal = { 
					limit = { has_minor_title = title_councilmember_king }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_advisor
						months = 240
					}
				}
				random_vassal = { 
					limit = { has_minor_title = title_councilmember_emperor }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_advisor
						months = 240
					}
				}
				random_courtier = { 
					limit = { has_minor_title = title_councilmember_king }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_advisor
						months = 240
					}
				}
				random_courtier = { 
					limit = { has_minor_title = title_councilmember_emperor }
					reverse_opinion = {
						who = ROOT
						modifier = opinion_pre_mega_war_advisor
						months = 240
					}
				}
			}	
		}
		##Flags
		add_trait = civil_war
		clr_global_flag = war_cooldown_period	
		clr_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = rebel_leader
		clr_character_flag = post_civil_war_wars
		clr_character_flag = independant
		clr_character_flag = join_independance_asked	
		hidden_tooltip = {
			any_current_enemy = { #If King owes money to rebel set flag
				limit = {
					liege_before_war = { character = ROOT }
					has_opinion_modifier = { who = ROOT modifier = opinion_liege_loan }
				}	
				set_character_flag = mega_war_liege_loan
			}
			#Flag Crown Loyalists
			random_vassal = { 
				limit = { leads_faction = faction_crown_loyalist }
				set_character_flag = flag_crown_loyalist
				any_faction_backer = {
					faction = faction_crown_loyalist
					set_character_flag = flag_crown_loyalist
				}
			}
			any_vassal = { 
				limit = { tier = KING }
				random_vassal = {
					limit = { leads_faction = faction_crown_loyalist }
					set_character_flag = flag_crown_loyalist
					any_faction_backer = {
						faction = faction_crown_loyalist
						set_character_flag = flag_crown_loyalist
					}
				}
			}
		}
		character_event = { id = maintenance.51 } #crown law maintenance
		##Call the LP/King tier's banners
		#Immediately break king tier vassals so their levies cannot be used
		any_playable_ruler = { 
			limit = {
				tier = KING
				is_nomadic = no
				NOT = { war_with = ROOT }
				war = no
				NOT = {
					liege = { 
						tier = EMPEROR
					}
				}
				OR = {
					NOT = { has_landed_title = k_the_most_devout }
					ROOT = { 
						crownlaw_title = {
							OR = {
								has_law = investiture_law_2
								has_law = investiture_law_3
							}
						}
					}
				}
				has_character_flag = neutral
				NOT = { has_character_flag = issue_punishments }
				primary_title = { 
					ROOT = {
						any_demesne_title = {
							tier = EMPEROR
							is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
				}
			}
			if = {
				limit = { NOT = { has_character_flag = flag_crown_loyalist } }
				letter_event = { id = mega_wars.7 tooltip = EVTTOOLTIPmega_wars.7 }
			}
			if = { #Crown Loyalists
				limit = { has_character_flag = flag_crown_loyalist }
				character_event = { id = mega_wars.19 days = 1 tooltip = EVTTOOLTIPmega_wars.7 }	
			}	
		}
		any_vassal = { 
			limit = {
				tier = KING
				war = no
				OR = {
					is_patrician = no #dont break republic
					is_merchant_republic = yes
				}
				is_nomadic = no
				NOT = { war_with = ROOT }
				NOT = { has_character_flag = issue_punishments }
				NOT = { #not split when outside force is claiming title
					any_realm_title = {
						any_war = { 
							attacker = {
								NOT = { is_liege_or_above = ROOT }
							}
						}
						#holder_scope = { war = yes }
					}
				}			
				# OR = { #Republics are not split from Merchant Republics
					# ROOT = { is_merchant_republic = no }
					# is_republic = no
					# capital_scope = { NOT = { port = yes } }
				# }
				OR = {
					NOT = { has_landed_title = k_the_most_devout }
					ROOT = { 
						crownlaw_title = {
							OR = {
								has_law = investiture_law_2
								has_law = investiture_law_3
							}
						}
					}
				}	
			}
			hidden_tooltip = { character_event = { id = mega_wars.4 } } #set empire title flag
			
			##Copy slavery laws
			if = {
				limit = { crownlaw_title = { has_law = slavery_0 holder_scope = { character = ROOT } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_0 }
					}
					add_law = slavery_0
				}
			}
			if = {
				limit = { crownlaw_title = { has_law = slavery_1 holder_scope = { character = ROOT } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_1 }
					}
					add_law = slavery_1
				}
			}
			if = {
				limit = { crownlaw_title = { has_law = slavery_2 holder_scope = { character = ROOT } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_2 }
					}
					add_law = slavery_2
				}
			}
			if = {
				limit = { crownlaw_title = { has_law = slavery_3 holder_scope = { character = ROOT } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_3 }
					}
					add_law = slavery_3
				}
			}
			if = {
				limit = { 
					NOT = { ROOT = { regent = { character = PREVPREV } } } 
					NAND = {
						ROOT = { government = triarch_merchant_republic_government }
						has_minor_title = title_triarch_for_life
					}
				}
				set_defacto_liege = THIS
			}	
			opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 }
			if = {
				limit = { NOT = { has_character_flag = flag_crown_loyalist } }
				set_character_flag = mega_war_remove_leader
				letter_event = { id = mega_wars.7 days = 1 tooltip = EVTTOOLTIPmega_wars.7 }
			}
			if = { #Crown Loyalists
				limit = { has_character_flag = flag_crown_loyalist }
				set_character_flag = mega_war_remove_leader
				character_event = { id = mega_wars.19 days = 1 tooltip = EVTTOOLTIPmega_wars.7 }	
			}			
		}
		
		character_event = { id = mega_wars.60 days = 30 } #find held courtiers related to enemies/rebels
			
		##Find rebel leader and flag them
		hidden_tooltip = { 
			random_current_enemy = { #for war leaders claiming the empire
				limit = {
					NOT = { trait = rebel_leader }
					NOT = { has_character_flag = considering_surrender }
					ROOT = {
						any_demesne_title = {
							tier = EMPEROR
							any_war = {
								attacker = { 
									character = PREVPREVPREVPREV								
								}
							}
						}
					}
				}
				ROOT = { set_character_flag = rebel_leader_found }
				character_event = { id = mega_wars.5 } #set rebel leader flags
			}
			random_playable_ruler = { #for war leaders that aren't king tier but allied with a King tier
				limit = {
					liege = {
						tier = KING 
						independent = no
						war_with = ROOT
						#NOT = { liege = { war_with = ROOT } }
						any_war = {
							OR = { 
								attacker = { character = ROOT }
								defender = { character = ROOT } 	
							}	
							NOT = {
								OR = { 
									attacker = { tier = KING }
									defender = { tier = KING }
								}	
							}	
							NOT = {
								OR = { 
									attacker = { trait = rebel_leader }
									defender = { trait = rebel_leader }
								}	
							}								
						}
					}
				}
				liege = {
					any_war = {
						limit = {
							OR = { 
								attacker = { character = ROOT }
								defender = { character = ROOT } 	
							}	
							NOT = {
								OR = { 
									attacker = { tier = KING }
									defender = { tier = KING }
								}	
							}
							NOT = {
								OR = { 
									attacker = { trait = rebel_leader }
									defender = { trait = rebel_leader }
								}	
							}
						}
						if = {
							limit = { attacker = { character = ROOT } }
							defender = { 
								ROOT = { set_character_flag = rebel_leader_found }
								character_event = { id = mega_wars.5 } #set rebel leader flags
							}
						}
						if = {
							limit = { defender = { character = ROOT } }
							attacker = { 
								ROOT = { set_character_flag = rebel_leader_found }
								character_event = { id = mega_wars.5 } #set rebel leader flags
							}
						}
					}
				}	
			}
			any_war = { #for LP tier
				limit = {
					OR = { 
						attacker = { character = ROOT }
						defender = { character = ROOT } 	
					}	
					NOT = {
						OR = { 
							attacker = { trait = rebel_leader NOT = { character = ROOT } }
							defender = { 
								trait = rebel_leader 
								OR = { #Enemy emperors may already have the rebel_leader trait
									NOT = { tier = EMPEROR }
									has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader }
								}
								NOT = { character = ROOT }
							}
						}	
					}
				}
				if = {
					limit = {
						attacker = {
							war_with = ROOT 
							NOT = { trait = rebel_leader }
							OR = {	
								AND = {	
									OR = {	
										tier = KING 
										has_character_flag = indep_war
									}
									liege_before_war = { character = ROOT }
									#liege = { character = ROOT }
								}
								AND = {
									liege = { character = PREV }
									OR = {
										demesne_size = 1
										has_character_flag = summer_islander_invader
										has_character_flag = claimant_adventurer
										has_character_flag = duchy_adventurer
									}	
									NOT = { liege = { character = ROOT }	}
								}			
							}
							is_primary_war_attacker = yes
						}
					}
					attacker = {
						ROOT = { set_character_flag = rebel_leader_found }
						character_event = { id = mega_wars.5 } #set rebel leader flags
					}
				}
				if = {
					limit = {
						defender = {
							war_with = ROOT 
							OR = {
								NOT = { trait = rebel_leader }
								AND = { #Enemy emperors may already have the rebel_leader trait
									tier = EMPEROR
									NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader } }
								}	
							}
							OR = {	
								AND = {	
									tier = KING 
									liege_before_war = { character = ROOT }
									#liege = { character = ROOT }
								}
								AND = {
									liege = { character = PREV }
									demesne_size = 1
									NOT = { liege = { character = ROOT }	}
									NOT = { has_character_flag = crownlander_resists }
								}			
							}
							is_primary_war_defender = yes
						}
					}
					defender = {
						ROOT = { set_character_flag = rebel_leader_found }
						character_event = { id = mega_wars.5 } #set rebel leader flags
					}
				}
			}
			any_independent_ruler = { #External Attackers
				limit = {
					war_with = ROOT
					is_primary_war_attacker = yes
					OR = {
						demesne_size = 1
						has_character_flag = summer_islander_invader
						has_character_flag = claimant_adventurer
						has_character_flag = duchy_adventurer
					}	
					NOT = { liege_before_war = { character = ROOT }	}
					ROOT = { is_primary_war_defender = yes }
					NOT = { trait = rebel_leader }
				}	
				add_trait = rebel_leader
				ROOT = { set_character_flag = rebel_leader_found }
			}
			#If no rebel leader found try FROM and FROMFROM scopes as last resort
			if = {
				limit = { NOT = { has_character_flag = rebel_leader_found } }
				FROM = {
					if = {
						limit = {
							war_with = ROOT
							OR = {
								NOT = { trait = rebel_leader }
								AND = { #Enemy emperors may already have the rebel_leader trait
									tier = EMPEROR
									NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader } }
								}	
							}
							NOT = { character = ROOT }
						}
						ROOT = { set_character_flag = rebel_leader_found }
						character_event = { id = mega_wars.5 } #set rebel leader flags
					}
				}
			}	
			if = {
				limit = { NOT = { has_character_flag = rebel_leader_found } }
				FROMFROM = {
					if = {
						limit = {
							war_with = ROOT
							OR = {
								NOT = { trait = rebel_leader }
								AND = { #Enemy emperors may already have the rebel_leader trait
									tier = EMPEROR
									NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader } }
								}	
							}
							NOT = { character = ROOT }
						}
						ROOT = { set_character_flag = rebel_leader_found }
						character_event = { id = mega_wars.5 } #set rebel leader flags
					}
				}
			}
			clr_character_flag = rebel_leader_found
		}
		
		#Lower tier vassal banners called (counts/dukes and dragon riders)
		hidden_tooltip = {
			any_vassal = { 
				limit = {
					NOT = { tier = KING }
					NOT = { tier = BARON }
					NOT = { war_with = root }
					war = no
					NOT = { has_landed_title = d_kingsguard }
					NOT = { #not split when outside force is claiming title
						any_realm_title = {
							any_war = { 
								attacker = {
									NOT = { is_liege_or_above = ROOT }
								}
							}
							#holder_scope = { war = yes }
						}
					}
					# OR = { #Republics are not split from Merchant Republics
						# ROOT = { is_merchant_republic = no }
						# is_republic = no
						# tier = COUNT
						# capital_scope = { NOT = { port = yes } }
					# }
					primary_title = {
						mercenary = no
						holy_order = no
					}
				}
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = { NOT = { has_character_flag = flag_crown_loyalist } }
					letter_event = { id = mega_wars.25 days = 2 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days = 2 }	
				}			
			}	
			any_courtier = { #Dragon Rider's can choose sides
				limit = {
					liege = { character = ROOT }
					is_ruler = no
					trait = dragon_rider
					prisoner = no
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				letter_event = { id = mega_wars.25 days = 2 }				
			}	
			remove_character_modifier = mega_war_no_levies
		}
	}

	option = {
		name = "EVTOPTAmega_wars.3" 	
		tooltip = {
			any_independent_ruler = { #Call the LP's banners
				limit = {
					tier = KING
					NOT = { war_with = ROOT }
					war = no
					has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }				
				}
				custom_tooltip = { text = EVTTOOLTIPmega_wars.7 }	
			}	
		}	
	}
	option = {
		name = "EVTOPTmega_warsTOOLTIP" 	
		trigger = { ai = no }
		custom_tooltip = { text = EVTTOOLTIPmega_warsTOOLTIP }	
	}
}
#Vassal  king/lp has empire title flag set immediately
character_event = {
	id = mega_wars.4
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		clr_character_flag = independant
		FROM = { set_mega_war_empire_variable_ROOT_effect = yes }
		any_demesne_title = {
			limit = { 
				OR = {
					tier = COUNT
					tier = DUKE
				}
			}				
			set_variable = { which = "de_facto_kingdom" value = 0 }
		}
	}
	
	option = {
		name = OK
	}	
}	
#Rebel leader assigned flags and call banners if possible
character_event = {
	id = mega_wars.5
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		clr_character_flag = independant
		
		#Make sure kingdom title has a unique variable set
		if = {
			limit = { tier = KING }
			e_rebels = {
				ROOT = {
					primary_title = {
						if = {
							limit = { NOT = { check_variable = { which = "de_facto_kingdom" value = 1 } } }
							set_variable = { which = "de_facto_kingdom" which = PREVPREV }
							e_rebels = { change_variable = { which = "de_facto_kingdom" value = 1 } }
						}
					}
					any_demesne_title = {
						limit = {
							tier = KING
							NOT = { check_variable = { which = "de_facto_kingdom" value = 1 } }
						}
						set_variable = { which = "de_facto_kingdom" which = PREVPREV }
						e_rebels = { change_variable = { which = "de_facto_kingdom" value = 1 } }
					}
				}	
			}
		}			
		#Make sure empire title has a unique variable set
		if = {
			limit = { tier = EMPEROR }
			e_rebels = {
				ROOT = {
					primary_title = {
						if = {
							limit = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }
							set_variable = { which = "de_facto_empire" which = PREVPREV }
							e_rebels = { change_variable = { which = "de_facto_empire" value = 1 } }
						}
					}
					any_demesne_title = {
						limit = {
							tier = EMPEROR
							NOT = { check_variable = { which = "de_facto_empire" value = 1 } }
						}
						set_variable = { which = "de_facto_empire" which = PREVPREV }
						e_rebels = { change_variable = { which = "de_facto_empire" value = 1 } }
					}
				}	
			}
		}	
		
		if = { #If emperor who already has the rebel_leader trait add an extra flag to show mega wars ahs triggered
			limit = {
				trait = rebel_leader
				tier = EMPEROR
				NOT = { has_opinion_modifier = { who = FROM modifier = opinion_emperor_rebel_leader } }
			}
			opinion = {
				who = FROM
				modifier = opinion_emperor_rebel_leader
				years = 25
			}
		}		
		if = { 	
			limit = { 
				OR = {
					tier = EMPEROR
					AND = {
						liege = { character = ROOT }
						NOT = { 
							liege_before_war = { 
								character = FROM 
								NOT = { character = ROOT }
							} 
						}
						primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } }	#no defacto empire
					}
				}
				NOT = {
					primary_title = { has_title_flag = indep_war }
				}
			}
			set_character_flag = independant
		}
		if = {
			limit = { 
				NOT = { has_character_flag = independant }
				NOT = { tier = EMPEROR }
				NOT = { liege_before_war = { NOT = { character = FROM } } }
				OR = {
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } } #independent
					NOT = { #Make sure rebel isnt actually part of another empire
						any_independent_ruler = {
							tier = EMPEROR
							NOT = { character = FROM }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } 
							any_demesne_title = {
								tier = EMPEROR
								check_variable = { which = "de_facto_empire" value = 0.9 }
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							}
						}
					}	
				}			
			}
			set_defacto_liege = THIS
			FROM = { set_mega_war_empire_variable_ROOT_effect = yes }
			any_demesne_title = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}
				}				
				set_variable = { which = "de_facto_kingdom" value = 0 }
			}
		}	
		clr_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = against_king
		set_character_flag = rebel_leader 
		add_trait = rebel_leader
		add_character_modifier = {
			name = "new_rebel_leader"
			duration = 5
		}
		if = {
			limit = { 
				NOT = { has_character_flag = independant }
				tier = KING
			}	
			any_vassal = {
				limit = {
					NOT = { war_with = ROOT }
					NOT = { tier = BARON }
					war = no
					NOT = { #not split when outside force is claiming title
						any_realm_title = {
							any_war = { 
								attacker = {
									NOT = { is_liege_or_above = FROM }
									NOT = { is_liege_or_above = ROOT }
								}
							}
							#holder_scope = { war = yes }
						}
					}
					# OR = { #Republics are not split from Merchant Republics
						# liege = { is_merchant_republic = no }
						# is_republic = no
						# tier = COUNT
						# capital_scope = { NOT = { port = yes } }
					# }
					primary_title = {
						mercenary = no
						holy_order = no
					}
				}
				set_character_flag = event_triggered_from_rebel_leader
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = {
						NOT = { has_character_flag = flag_crown_loyalist }
						NOT = { in_faction = faction_liege_loyalist }
					}							
					letter_event = { id = mega_wars.25 days=1 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days=1 }	
				}
				if = { #Liege Loyalists
					limit = { in_faction = faction_liege_loyalist }
					character_event = { id = mega_wars.20 days=1 }	
				}
			}
			any_realm_character = { #Dragon Rider's can choose sides
				limit = {
					trait = dragon_rider
					OR = {
						liege = { character = ROOT }	
						liege = { liege = { character = ROOT }	}
					}	
					is_ruler = no	
					prisoner = no				
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				set_character_flag = event_triggered_from_rebel_leader
				letter_event = { id = mega_wars.25 days=3 }				
			}			
		}
		
		#If High Septon is rebel leader maybe seek refuge in another rebel's capital
		if = {
			limit = { 
				has_landed_title = k_the_most_devout
				is_theocracy = yes
				NOT = { num_of_count_titles = 1 }
				capital_scope = { owner = { character = FROM } }
			}
			random_playable_ruler = { #Find King tier first
				limit = { 
					liege = {
						war_with = FROM
						NOT = { war_with = ROOT }
						religion = the_seven
						tier = KING ###
						OR = {
							liege_before_war = { character = FROM }
							AND = {
								war_with = FROM
								has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege }
							}	
						}
						any_vassal = {
							tier = BARON
							religion = the_seven
							is_theocracy = yes
						}
					}	
				}
				liege = {
					character_event = { id = mega_wars.6 }
					ROOT = { set_character_flag = refuge_found }
				}	
			}
			if = {
				limit = { NOT = { has_character_flag = refuge_found } }
				random_playable_ruler = {
					limit = { 
						liege = {
							war_with = FROM
							NOT = { war_with = ROOT }
							religion = the_seven
							OR = {
								liege_before_war = { character = FROM }
								AND = {
									war_with = FROM
									has_opinion_modifier = { who = FROM modifier = opinion_de_facto_liege }
								}	
							}
							any_vassal = {
								tier = BARON
								religion = the_seven
								is_theocracy = yes
							}
						}	
					}
					liege = { character_event = { id = mega_wars.6 } }
				}
			}
			clr_character_flag = refuge_found
		}	
		
		character_event = { id = mega_wars.60 days = 30 } #find held courtiers related to enemies/rebels
	}
	
	option = {
		name = OK
	}	
}
#Inform high Septon seeks refuge in your capital
character_event = {
	id = mega_wars.6
	desc = "EVTDESCmega_wars.6"

	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.6"
		random_vassal = {
			limit = {
				tier = BARON
				religion = the_seven
				is_theocracy = yes
			}
			random_demesne_title = {
				limit = {
					tier = BARON
					holding_type = temple
				}
				gain_title = FROM
				set_title_flag = high_septon_refuge
				FROM = { capital = PREV }
			}
		}
		FROM = { opinion = { who = ROOT modifier = opinion_gave_refuge months = 120 } }
		piety = 200	
		FROM = { 
			hidden_tooltip = {
				any_demesne_title = {
					limit = { location = { owner = { character = FROMFROM } } }
					set_title_flag = high_septon_capital
					gain_title = FROMFROM
				}
			}	
		}		
	}
}	
#Lord Paramount responds
letter_event = {
	id = mega_wars.7
	desc = "EVTDESCmega_wars.7"
	
	is_triggered_only = yes
	war = no
	
	trigger = {
		tier = KING
		is_nomadic = no
		NOT = { war_with = FROM }
		FROM = { war = yes }
		NOT = { has_character_flag = being_issued_punishment }
		NOT = { #not split when outside force is claiming title
			any_realm_title = {
				any_war = { 
					attacker = {
						NOT = { is_liege_or_above = FROM }
					}
				}
				#holder_scope = { war = yes }
			}
		}
		OR = {
			NOT = { has_landed_title = k_the_most_devout }
			FROM = { 
				crownlaw_title = {
					OR = {
						has_law = investiture_law_2
						has_law = investiture_law_3
					}
				}
			}
		}
	}
	
	immediate = {
		###Set Empire Title Law 'Flag'###
		
		#Make sure kingdom title has a unique variable set
		e_rebels = {
			ROOT = {
				primary_title = {
					if = {
						limit = { NOT = { check_variable = { which = "de_facto_kingdom" value = 1 } } }
						set_variable = { which = "de_facto_kingdom" which = PREVPREV }
						e_rebels = { change_variable = { which = "de_facto_kingdom" value = 1 } }
					}
				}
				any_demesne_title = {
					limit = {
						tier = KING
						NOT = { check_variable = { which = "de_facto_kingdom" value = 1 } }
					}
					set_variable = { which = "de_facto_kingdom" which = PREVPREV }
					e_rebels = { change_variable = { which = "de_facto_kingdom" value = 1 } }
				}
			}	
		}
		
		clr_character_flag = independant
		if = {
			limit = { 
				FROM = { NOT = { regent = { character = ROOT } } } 
				NAND = {
					FROM = { government = triarch_merchant_republic_government }
					has_minor_title = title_triarch_for_life
				}
			}
			set_defacto_liege = ROOT
		}	
		set_character_flag = mega_war_remove_leader
		clr_character_flag = must_decide
		clr_character_flag = joined_independance_war
		set_character_flag = mega_war_decision_cooldown
		if = { #If granted LP reset mega war flags
			limit = {
				FROM = {
					NOT = { war_with = ROOT }
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_granted_kingdom
					}
				}
			}	
			clr_character_flag = against_king
			clr_character_flag = neutral
		}
		if = { #If King owes money set flag
			limit = {
				FROM = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_liege_loan
					}
				}
			}	
			set_character_flag = mega_war_liege_loan
		}
		if = { #Check Warden Status
			limit = { FROM = { has_landed_title = e_iron_throne } }	
			if = { #Warden of North
				limit = { 
					has_character_flag = warden_of_the_north
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROM
						primary_title = { NOT = { is_variable_equal = { which = "de_facto_empire" value = 1 } } }
						NOT = { liege_before_war = { character = FROM } }
						capital_scope = { 
							region = world_westeros_north
						}	
						any_war = { defender = { character = FROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
			if = { #Warden of the East
				limit = { 
					has_character_flag = warden_of_the_east
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROM
						primary_title = { NOT = { is_variable_equal = { which = "de_facto_empire" value = 1 } } }
						NOT = { liege_before_war = { character = FROM } }
						capital_scope = { 
							OR = {
								region = world_westeros_east
								AND = {
									NOT = { region = world_westeros }
									NOT = { region = world_summer_sea}
								}
							}	
						}	
						any_war = { defender = { character = FROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
			if = { #Warden of the South
				limit = { 
					has_character_flag = warden_of_the_south
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROM
						primary_title = { NOT = { is_variable_equal = { which = "de_facto_empire" value = 1 } } }
						NOT = { liege_before_war = { character = FROM } }
						capital_scope = { 
							OR = {
								region = world_dorne
								region = world_reach
								region = world_westerlands
								region = world_iron_isles
								region = world_stormlands
								region = world_summer_sea
							}	
						}	
						any_war = { defender = { character = FROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
			if = { #Warden of the West
				limit = { 
					has_character_flag = warden_of_the_west
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROM
						primary_title = { NOT = { is_variable_equal = { which = "de_facto_empire" value = 1 } } }
						NOT = { liege_before_war = { character = FROM } }
						capital_scope = { 
							OR = {
								region = world_westerlands
								region = world_iron_isles
								region = world_reach
							}	
						}	
						any_war = { defender = { character = FROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
		}
	}
	
	option = {
		name = "EVTOPTEmega_wars.7" #Regent, can choose not to fracture from realm
		trigger = {
			OR = {
				FROM = {
					has_regent = yes
					regent = { character = ROOT }
				}
				AND = {
					FROM = { government = triarch_merchant_republic_government }
					has_minor_title = title_triarch_for_life
				}
			}	
		}
		ai_chance = {
			factor = 500
			modifier = {
				factor = 10
				has_character_flag = supporting_king 	
			}
		}	
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
		clr_character_flag = warden_called_to_arms	
		custom_tooltip = {
			text = TOOLTIPEVTOPTEmega_wars.7
		}
		FROM = {
			opinion = {
				modifier = opinion_loyal_to_crown
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				letter_event = { id = mega_wars.34 }
				reverse_opinion = {
					modifier = opinion_with_king
					who = ROOT
					years = 100
				}
			}
		}	
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROM
				OR = {
					is_allied_with = ROOT	
					has_non_aggression_pact_with = ROOT
				}	
			}	
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}
		}	
		hidden_tooltip = {
			any_vassal = {
				limit = {
					NOT = { war_with = root }
					war = no
					primary_title = {
						mercenary = no
						holy_order = no
					}
					NOT = { tier = BARON }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king 
				# clr_character_flag = rebel_leader
				# clr_character_flag = post_civil_war_wars
				# clr_character_flag = independant
				# clr_character_flag = join_independance_asked	
				# clr_character_flag = inherit_war 
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = {
						NOT = { has_character_flag = flag_crown_loyalist }
						NOT = { in_faction = faction_liege_loyalist }
					}
					letter_event = { id = mega_wars.25 days=3 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days=3 }	
				}
				if = { #Liege Loyalists
					limit = { in_faction = faction_liege_loyalist }
					character_event = { id = mega_wars.20 days=3 }	
				}
			}
			any_realm_character = { #Dragon Rider's can choose sides
				limit = {
					trait = dragon_rider
					OR = {
						liege = { character = ROOT }	
						liege = { liege = { character = ROOT }	}
					}	
					is_ruler = no		
					prisoner = no					
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king 
				letter_event = { id = mega_wars.25 days=4 }				
			}			
		}
	}	
	
	option = {
		name = "EVTOPTAmega_wars.7" #support the king
		trigger = {
			NAND = {
				prisoner = yes
				OR = {
					host = { trait = rebel_leader }
					host = { has_character_flag = against_king }
				}	
			}
		}
		ai_chance = {
			factor = 40
			modifier = {
				factor = 5
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 10
				has_character_flag = supporting_king 
				FROM = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_with_king
					}
				}	
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROM }
				}
			}
			modifier = { #fash tamper
				factor = 2
				FROM = {
					ROOT = {
						has_opinion_modifier = { who = PREV modifier = opinion_cadet_affection }
					}
				}
			}
			modifier = { #If external threat highly likely to support
				factor = 4
				religion = FROM
				culture_group = FROM
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					has_character_flag = independant
				}
			}
			modifier = { #Support for anti-piracy campaign
				factor = 5
				OR = {
					trait = just
					trait = diligent
					capital_scope = { port = yes }
				}
				NOR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #Support for 'selfless' wars
				factor = 3
				FROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = { #Support for 'selfless' wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = honorable
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = { #Support for 'anti slavery wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = zealous				
				}
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			
			modifier = {
				factor = 1.5
				OR = {
					is_married = FROM
					any_child = { character = FROM }
					is_child_of = FROM
					any_child = { any_child = { character = FROM } }#grandchild
				}	
			}
			modifier = {
				factor = 4
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
				}	
			}
			#allied with ally of king
			modifier = { 
				factor = 2.5
				any_allied_character = {
					has_opinion_modifier = { who = FROM modifier = opinion_with_king } 
					NOT = { trait = rebel_leader }
				}	
			}
			modifier = {
				factor = 1.3
				FROM = {
					culture_group = ROOT
				}	
			}
			modifier = {
				factor = 1.3
				FROM = {
					religion = ROOT	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					ROOT = {
						NOT = { trait = lunatic }
					}
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROM = {
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 6
				is_friend = FROM
			}
			modifier = {
				factor = 6
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					is_rival = PREV
				}
			}
			modifier = {
				factor = 0.2
				is_rival = FROM
			}
			modifier = {
				factor = 0.2
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					is_friend = ROOT
				}
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROM value =  20 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROM value =  40 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  60 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  80 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  100 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  -20 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  -40 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -60 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -80 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -99 } }
			}
			modifier = { #Don't want to support foreign pretender
				factor = 5
				FROM = {
					religion = ROOT
					culture_group = ROOT
					any_demesne_title = { #One of the empire tier titles is being contested
						tier = EMPEROR
						any_war = {
							attacker = { 						
								trait = rebel_leader
								has_character_modifier = new_rebel_leader
								war_with = FROM
								OR = {
									NOT = { religion_group = ROOT }
									NOT = { culture_group = ROOT }
									has_character_flag = independant
								}	
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}	
			}
			modifier = { #Never join if like rebel and have no relation to king
				factor = 0
				NOT = { is_allied_with = FROM }
				NOT = { has_non_aggression_pact_with = FROM }
				NOT = { opinion = { who = FROM value = 50 } }
				NOT = { is_close_relative = FROM }
				NOT = { is_married = FROM }
				NOT = { has_character_flag = supporting_king }
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					reverse_opinion = { who = ROOT value = 50 }
					OR = {
						is_allied_with = ROOT
						has_non_aggression_pact_with = ROOT
						is_close_relative = ROOT
						is_married = ROOT
					}
				}
			}
		}
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
		clr_character_flag = warden_called_to_arms
		hidden_tooltip = { set_defacto_liege = THIS }
		FROM = {
			if = {
				limit = {
					is_primary_war_defender = yes
					any_war = {
						attacker = { trait = rebel_leader }
						defender = { character = PREVPREV }
					}
				}
				ROOT = { join_defender_wars = PREV }
			}
			if = {
				limit = {
					is_primary_war_attacker = yes
					any_war = {
						defender = { trait = rebel_leader }
						attacker = { character = PREVPREV }
					}
				}
				ROOT = { join_attacker_wars = PREV }
			}	
			hidden_tooltip = { #failsafe
				ROOT = { 
					join_defender_wars = PREV 
					join_attacker_wars = PREV
					if = { #If failed, break and add a cooldown
						limit = {
							NOT = {
								any_war = {
									OR = {
										attacker = { character = ROOT_FROM }
										defender = { character = ROOT_FROM }
									}
								}
							}
						}
						clr_character_flag = mega_war_decision_cooldown
						set_character_flag = mega_war_decision_cooldown
						break = yes
					}
				}			
			}
			opinion = {
				modifier = opinion_loyal_to_crown
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				letter_event = { id = mega_wars.34 }
				reverse_opinion = {
					modifier = opinion_with_king
					who = ROOT
					years = 100
				}
			}
		}	
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROM
				OR = {
					is_allied_with = ROOT	
					has_non_aggression_pact_with = ROOT
				}	
			}	
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}
		}	
		hidden_tooltip = {
			any_vassal = {
				limit = {
					NOT = { war_with = root }
					war = no
					primary_title = {
						mercenary = no
						holy_order = no
					}
					NOT = { tier = BARON }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king 
				# clr_character_flag = rebel_leader
				# clr_character_flag = post_civil_war_wars
				# clr_character_flag = independant
				# clr_character_flag = join_independance_asked	
				# clr_character_flag = inherit_war 
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = {
						NOT = { has_character_flag = flag_crown_loyalist }
						NOT = { in_faction = faction_liege_loyalist }
					}
					letter_event = { id = mega_wars.25 days=3 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days=3 }	
				}
				if = { #Liege Loyalists
					limit = { in_faction = faction_liege_loyalist }
					character_event = { id = mega_wars.20 days=3 }	
				}
			}
			any_realm_character = { #Dragon Rider's can choose sides
				limit = {
					trait = dragon_rider
					OR = {
						liege = { character = ROOT }	
						liege = { liege = { character = ROOT }	}
					}	
					is_ruler = no		
					prisoner = no					
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king 
				letter_event = { id = mega_wars.25 days=4 }				
			}			
		}		
	}
	option = {
		name = "EVTOPTBmega_wars.7" #remain neutral
		ai_chance = {
			factor = 28
			modifier = {
				factor = 3
				has_character_flag = inherit_war
			}
			modifier = {
				factor = 0
				trait = honorable
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 1.2
				NOT = { age = 16 }
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROM }
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { trait = rebel_leader  has_character_modifier = new_rebel_leader  war_with = FROM }
				}
			}
			modifier = {
				factor = 10
				has_character_flag = neutral
			}
			
			modifier = { #against anti-piracy campaign
				factor = 5
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #against 'anti slavery wars
				factor = 5
				OR = {
					has_slavery_religion_trigger = yes
					has_slavery_culture_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			
			modifier = {
				factor = 1.2
				trait = patient
			}
			modifier = {
				factor = 0.8
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 0.8
				trait = brave
			}
			modifier = {
				factor = 3.5
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 0.75
				trait = content
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					trait = dragon_rider
				}
				FROM = {
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 2.5
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { religion_group = ROOT }
				}
				FROM = {
					NOT = { religion_group = ROOT }
				}	
			}
			modifier = {
				factor = 3.5
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { religion = ROOT }
				}
				FROM = {
					NOT = { religion = ROOT }
				}
			}
			modifier = {
				factor = 1.5
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { culture_group = ROOT }
				}
				FROM = {
					NOT = { culture_group = ROOT }
				}
			}
			modifier = {
				factor = 5
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					any_friend = {
						character = ROOT
					}
				}
				FROM = {
					any_friend = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 5
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					any_rival = {
						character = ROOT
					}
				}
				FROM = {
					any_rival = {
						character = ROOT
					}
				}
			}
			modifier = {
				factor = 2.5
				NOT = { opinion = { who = FROM value =  -75 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  -100 }
					NOT = { reverse_opinion = { who = ROOT value =  -75 } } 
				}
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  -75 } 
				NOT = { opinion = { who = FROM value =  -50 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  -75 }
					NOT = { reverse_opinion = { who = ROOT value =  -50 } } 
				}
			}
			modifier = {
				factor = 1.75
				opinion = { who = FROM value =  -50 } 
				NOT = { opinion = { who = FROM value =  -25 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  -50 }
					NOT = { reverse_opinion = { who = ROOT value =  -25 } } 
				}
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value =  -25 } 
				NOT = { opinion = { who = FROM value =  -0 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  -25 } 
					NOT = { reverse_opinion = { who = ROOT value =  -0 } } 
				}
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value =  0 } 
				NOT = { opinion = { who = FROM value =  25 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  0 } 
					NOT = { reverse_opinion = { who = ROOT value =  25 } } 
				}
			}
			modifier = {
				factor = 1.75
				opinion = { who = FROM value =  25 } 
				NOT = { opinion = { who = FROM value =  50 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  25 } 
					NOT = { reverse_opinion = { who = ROOT value =  50 } } 
				}
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  50 } 
				NOT = { opinion = { who = FROM value =  75 } } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  50 } 
					NOT = { reverse_opinion = { who = ROOT value =  75 } } 
				}
			}
			modifier = {
				factor = 2.5
				opinion = { who = FROM value =  75 } 
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  75 } 
				}
			}
			
		}
		set_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
		hidden_tooltip = { set_defacto_liege = THIS }
		if = {
			limit = { has_character_flag = warden_called_to_arms	}
			custom_tooltip = { 
				text = TOOLTIPWARDENMEGAWARWARNING 
				hidden_tooltip = {
					any_playable_ruler = {
						limit = {
							OR = {
								is_liege_or_above = ROOT
								is_liege_or_above = FROM
								primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } #iron throne
							}
						}
						opinion = { modifier = opinion_bad_warden who = ROOT years = 10 }
					}
				}
			}
			prestige = -400
			FROM = {
				opinion = {
					modifier = opinion_warden_no_defend
					who = ROOT
					years = 10
				}
			}	
			clr_character_flag = warden_called_to_arms
		}
		FROM = {
			opinion = {
				modifier = opinion_dithered
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				character_event = { id = mega_wars.33 }
			}
		}
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROM
				is_allied_with = ROOT	
			}	
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}
		}	
		if = { 	
			limit = { 
				is_allied_with = FROM
			}
			FROM = {
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}
			}					
		}
		hidden_tooltip = {
			any_vassal = {
				limit = {
					NOT = { war_with = root }
					war = no
					primary_title = {
						mercenary = no
						holy_order = no
					}
					NOT = { tier = BARON }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king
				# clr_character_flag = rebel_leader
				# clr_character_flag = post_civil_war_wars
				# clr_character_flag = independant
				# clr_character_flag = join_independance_asked	
				# clr_character_flag = inherit_war 
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = {
						NOT = { has_character_flag = flag_crown_loyalist }
						NOT = { in_faction = faction_liege_loyalist }
					}
					letter_event = { id = mega_wars.25 days=3 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days=3 }	
				}
				if = { #Liege Loyalists
					limit = { in_faction = faction_liege_loyalist }
					character_event = { id = mega_wars.20 days=3 }	
				}
			}
			any_realm_character = { #Dragon Rider's can choose sides
				limit = {
					trait = dragon_rider
					OR = {
						liege = { character = ROOT }	
						liege = { liege = { character = ROOT }	}
					}	
					is_ruler = no		
					prisoner = no					
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king
				letter_event = { id = mega_wars.25 days=4 }				
			}			
		}	
	}
	option = {
		name = "EVTOPTCmega_wars.7" #against the king
		trigger = { #only valid for certain CBs
			NOT = { has_character_flag = inherit_war }
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { character = FROM }
						host = { has_character_flag = supporting_king }
					}	
				}
			}
			OR = {
				FROM = {
					any_demesne_title = {
						tier = EMPEROR
						any_war = {
							attacker = { 
								trait = rebel_leader 
								has_character_modifier = new_rebel_leader
								war_with = FROM
								NOT = { trait = white_walker }
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { trait = white_walker }
					any_war = {
						OR = {
							AND = {
								attacker = { character = FROM }
								OR = {
									using_cb = claim_on_vassal_plot
									using_cb = weaken_vassal_plot
								}	
							}
							AND = {	
								defender = { character = FROM }
								OR = {
									AND = {	#have to be neighbours to join independance war
										OR = {	
											using_cb = bid_for_independence
											using_cb = bid_for_independence_CW
											using_cb = bid_for_independence_ACOK
										}
										attacker = { character = PREVPREV }
										PREV = {
											OR = {
												tier = KING
												tier = EMPEROR
											}	
											OR = {
												any_realm_province = {
													any_neighbor_province = {
														any_province_lord = {
															OR = {
																liege = { character = ROOT }
																liege = { liege = { character = ROOT } }
															}	
														}
													}
												}
												AND = {
													has_landed_title = k_iron_isles
													ROOT = {
														OR = { 
															has_landed_title =  k_north
															has_landed_title =  k_riverlands
															has_landed_title =  k_westerlands
															has_landed_title =  k_reach
															has_landed_title =  e_north
															has_landed_title =  e_riverlands
															has_landed_title =  e_westerlands
															has_landed_title =  e_reach
														}
													}
												}	
												AND = {
													ROOT = { has_landed_title = k_iron_isles }
													OR = { 
														has_landed_title =  k_north
														has_landed_title =  k_riverlands
														has_landed_title =  k_westerlands
														has_landed_title =  k_reach
														has_landed_title =  e_north
														has_landed_title =  e_riverlands
														has_landed_title =  e_westerlands
														has_landed_title =  e_reach
													}
												}	
											}
										}	
									}	
									#using_cb = excommunicated_ruler		
									using_cb = depose_liege	
									using_cb = overthrow_ruler	
									using_cb = overthrow_ruler_no_calls				
									using_cb = claim_iron_throne_ACOK							
									#using_cb = cb_faction_unholy_king								
								}
							}
						}	
					}
				}
			}	
		}
		ai_chance = {
			factor = 40
			modifier = {
				factor = 0.25
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 0
				trait = honorable
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 10
				has_character_flag = against_king
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { trait = rebel_leader  has_character_modifier = new_rebel_leader  war_with = FROM }
				}
			}
			modifier = { #close family
				factor = 1.5
				OR = {
					father = { trait = rebel_leader  has_character_modifier = new_rebel_leader war_with = FROM }
					mother = { trait = rebel_leader  has_character_modifier = new_rebel_leader war_with = FROM }
					spouse = { trait = rebel_leader  has_character_modifier = new_rebel_leader war_with = FROM }
					any_child = { trait = rebel_leader  has_character_modifier = new_rebel_leader war_with = FROM }
					any_child = { any_child = { trait = rebel_leader  has_character_modifier = new_rebel_leader war_with = FROM } }
				}	
			}
			modifier = { #fash tamper
				factor = 2
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					ROOT = {
						has_opinion_modifier = { who = PREV modifier = opinion_cadet_affection }
					}
				}	
			}
			modifier = { #alliance
				factor = 4
				rebel_leader = { 
					has_character_modifier = new_rebel_leader
					war_with = FROM		
					OR = {
						has_non_aggression_pact_with = ROOT
						is_allied_with = ROOT
					}	
				}		
			}
			##allied with ally of rebel leader
			modifier = { 
				factor = 2.5
				any_allied_character = {
					war_with = FROM
					NOT = { trait = rebel_leader }
				}		
			}
			modifier = {
				factor = 1.35
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 1.35
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					religion = ROOT
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					trait = lunatic
					ROOT = {
						NOT = { trait = lunatic }
					}	
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 6
				is_rival = FROM
			}
			modifier = {
				factor = 6
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					is_friend = ROOT
				}	
			}
			modifier = {
				factor = 0.2
				is_friend = FROM
			}
			modifier = {
				factor = 0.2
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					is_rival = ROOT
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  20 }
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  40 }
				}
			}
			modifier = {
				factor = 1.3
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  60 }
				}
			}
			modifier = {
				factor = 1.3
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  80 }
				}
			}
			modifier = {
				factor = 1.3
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					reverse_opinion = { who = ROOT value =  100 }
				}
			}
	
			modifier = {
				factor = 0.8
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { reverse_opinion = { who = ROOT value =  -20 } }	
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { reverse_opinion = { who = ROOT value =  -40 } }		
				}
			}
			modifier = {
				factor = 0.7
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { reverse_opinion = { who = ROOT value =  -60 } }		
				}
			}
			modifier = {
				factor = 0.7
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { reverse_opinion = { who = ROOT value =  -80 } }		
				}
			}
			modifier = {
				factor = 0.7
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { reverse_opinion = { who = ROOT value =  -99 } }		
				}
			}
			modifier = {
				factor = 0.75
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}	
			# Fear Intimidation Factor
			modifier = {
				factor = 0.9
				FROM = { has_character_modifier = feared_1 }
			}
			modifier = {
				factor = 0.75
				FROM = { has_character_modifier = feared_2 }
			}
			modifier = {
				factor = 0.6
				FROM = { has_character_modifier = feared_3 }
			}
			modifier = {
				factor = 0.5
				FROM = { has_character_modifier = feared_4 }
			}
			modifier = {
				factor = 0.4
				FROM = { has_character_modifier = feared_5 }
			}
			modifier = {
				factor = 0.2
				trait = craven
				FROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			modifier = {
				factor = 1.25
				OR = {
					trait = brave 
					trait = dragon_rider
				}	
				FROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			##
			
			modifier = { #Never join if like king and have no relation to rebel
				factor = 0			
				OR = {
					opinion = { who = FROM value = 50 }
					is_close_relative = FROM
					is_married = FROM
				}
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					NOT = { is_allied_with = ROOT }
					NOT = { has_non_aggression_pact_with = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 50 } }
					NOT = { is_close_relative = ROOT }
					NOT = { is_married = ROOT }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_with_rebel_leader } }
				}				
			}
		}
		set_character_flag = against_king
		clr_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
		hidden_tooltip = { set_defacto_liege = THIS }
		if = {
			limit = { has_character_flag = warden_called_to_arms	}
			custom_tooltip = { 
				text = TOOLTIPWARDENMEGAWARWARNING 
				hidden_tooltip = {
					any_playable_ruler = {
						limit = {
							OR = {
								is_liege_or_above = ROOT
								is_liege_or_above = FROM
								primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } #iron throne
							}
						}
						opinion = { modifier = opinion_bad_warden who = ROOT years = 10 }
					}
				}
			}
			prestige = -400
			FROM = {
				opinion = {
					modifier = opinion_warden_no_defend
					who = ROOT
					years = 10
				}
			}	
			clr_character_flag = warden_called_to_arms
		}
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROM
			}
			if = {
				limit = {
					is_primary_war_defender = yes
					any_war = {
						attacker = { character = FROM }
						defender = { character = PREVPREV }
					}
				}
				ROOT = { join_defender_wars = PREV }
			}
			if = {
				limit = {
					is_primary_war_attacker = yes
					any_war = {
						defender = { character = FROM }
						attacker = { character = PREVPREV }
					}
				}
				ROOT = { join_attacker_wars = PREV }
			}	
			hidden_tooltip = { #failsafe
				ROOT = { 
					join_defender_wars = PREV 
					join_attacker_wars = PREV
					if = { #If failed, break and add a cooldown
						limit = {
							NOT = {
								any_war = {
									OR = {
										attacker = { has_character_modifier = new_rebel_leader }
										defender = { has_character_modifier = new_rebel_leader }
									}
								}
							}
						}
						clr_character_flag = mega_war_decision_cooldown
						set_character_flag = mega_war_decision_cooldown
						break = yes
					}
				}			
			}
			opinion = {
				modifier = opinion_joined_cause
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				letter_event = { id = mega_wars.30 }
				reverse_opinion = {
					modifier = opinion_with_rebel_leader
					who = ROOT
					years = 100
				}
			}	
		}	
		FROM = {
			opinion = {
				modifier = opinion_joined_rebellion
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				character_event = { id = mega_wars.32 }
			}
			if = { 	
				limit = { 
					OR = {
						is_allied_with = ROOT	
						has_non_aggression_pact_with = ROOT
					}	
				}
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}				
			}
		}
		if = {
			limit = {
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}
			set_character_flag = joined_independance_war
		}
		hidden_tooltip = { 
			any_vassal = {
				limit = {
					NOT = { war_with = root }
					war = no
					primary_title = {
						mercenary = no
						holy_order = no
					}
					NOT = { tier = BARON }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king
				# clr_character_flag = rebel_leader
				# clr_character_flag = post_civil_war_wars
				# clr_character_flag = independant
				# clr_character_flag = join_independance_asked	
				# clr_character_flag = inherit_war 
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = {
						NOT = { has_character_flag = flag_crown_loyalist }
						NOT = { in_faction = faction_liege_loyalist }
					}
					letter_event = { id = mega_wars.25 days=3 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days=3 }	
				}
				if = { #Liege Loyalists
					limit = { in_faction = faction_liege_loyalist }
					character_event = { id = mega_wars.20 days=3 }	
				}
			}	
			any_realm_character = { #Dragon Rider's can choose sides
				limit = {
					trait = dragon_rider
					OR = {
						liege = { character = ROOT }	
						liege = { liege = { character = ROOT }	}
					}	
					is_ruler = no	
					prisoner = no					
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king
				letter_event = { id = mega_wars.25 days=4 }				
			}	
		}	
	}
	option = {
		name = "EVTOPTDmega_wars.7" #declare independance
		ai_chance = {
			factor = 5
			modifier = {
				factor = 5
				in_faction = faction_independence
			}	
			#Recently subjugated
			modifier = {
				factor = 0.1
				liege = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT } }
			}
			#Never do this if recently subjugated by a dragon rider
			modifier = {
				factor = 0
				NOT = { trait = dragon_rider }
				liege = { 
					trait = dragon_rider
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT } 
				}
			}
			# Don't want independence if same culture or relative of liege
			modifier = {
				factor = 0
				NOT = { culture = dothraki }
				NOT = { culture = jogos_nhai }
				is_nomadic = no
				FROM = {
					OR = {
						culture = ROOT
						is_close_relative = ROOT
					}
				}
			}
			# Most culture groups dont mind being lorded by the same culture group
			modifier = {
				factor = 0
				FROM = { 
					culture_group = ROOT 
					religion_group = ROOT
				}
				NOT = { culture_group = free_cities }
				NOT = { culture_group = sothoryos_islands }
				NOT = { in_faction = faction_independence }
				OR = { # If I'm king tier liege has to be very desirable
					NOT = { tier = KING }
					NOT = { relative_power = { who = FROM power = 1.1 } }
					FROM = { has_landed_title = e_iron_throne }
				}
			}
			#If Liege is High Valyrian and my religion that is acceptable
			modifier = {
				factor = 0
				NOT = { culture = dothraki }
				NOT = { culture = jogos_nhai }
				is_nomadic = no
				NOT = { in_faction = faction_independence }
				FROM = {
					culture = high_valyrian
					religion = ROOT
				}
			}
			#If I'm Dornish and liege is Andal and my religion that is acceptable
			modifier = {
				factor = 0
				culture_group = dornish
				NOT = { culture = rhoynar }
				NOT = { in_faction = faction_independence }
				FROM = {
					culture_group = andal
					religion = ROOT
				}
				OR = { # If I'm king tier liege has to be very desirable
					NOT = { tier = KING }
					NOT = { relative_power = { who = FROM power = 1.1 } }
					FROM = { has_landed_title = e_iron_throne }
				}
			}		
			modifier = {
				factor = 0
				NOT = { in_faction = faction_independence }
				FROM = { reverse_opinion = { who = ROOT value =  0 } }
			}
			
			modifier = {
				factor = 0.5
				religion = FROM
				culture_group = FROM
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					has_character_flag = independant
				}
			}
			
			modifier = { #against anti-piracy campaign
				factor = 5
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #against 'anti slavery wars
				factor = 5
				OR = {
					has_slavery_religion_trigger = yes
					has_slavery_culture_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 3
				trait = ambitious
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 0.05
				trait = honorable
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2.5
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROM
					NOT = { religion = ROOT }
				}
				FROM = {
					NOT = { religion = ROOT }
				}
			}
			modifier = {
				factor = 0.05
				NOT = { trait = dragon_rider }
				FROM = { trait = dragon_rider }
			}		
			modifier = {
				factor = 0.1
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 0
				trait = honorable
				has_character_flag = warden_called_to_arms
			}			
			modifier = {
				factor = 1.25
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				}
			}
			modifier = {
				factor = 1.25
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -20 } }
				}
			}
			modifier = {
				factor = 1.25
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -40 } }
				}
			}
			modifier = {
				factor = 1.25
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -60 } }
				}
			}
			modifier = {
				factor = 1.25
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -80 } }
				}
			}
			modifier = {
				factor = 1.25
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -99 } }
				}
			}
		}
		set_character_flag = neutral
		set_character_flag = opportunist_independence
		clr_character_flag = supporting_king
		clr_character_flag = against_king 
		clr_character_flag = inherit_war	
		clr_character_flag = mega_war_remove_leader
		hidden_tooltip = { set_defacto_liege = THIS }
		if = {
			limit = { has_character_flag = warden_called_to_arms	}
			custom_tooltip = { 
				text = TOOLTIPWARDENMEGAWARWARNING 
				hidden_tooltip = {
					any_playable_ruler = {
						limit = {
							OR = {
								is_liege_or_above = ROOT
								is_liege_or_above = FROM
								primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } #iron throne
							}
						}
						opinion = { modifier = opinion_bad_warden who = ROOT years = 10 }
					}
				}
			}
			prestige = -400
			FROM = {
				opinion = {
					modifier = opinion_warden_no_defend
					who = ROOT
					years = 10
				}
			}	
			clr_character_flag = warden_called_to_arms
		}
		FROM = {
			primary_title = {
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence_CW
				}
			}	
			hidden_tooltip = { letter_event = { id = mega_wars.35 days=1 } }	
		}
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROM
				is_allied_with = ROOT	
			}	
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}
		}
		FROM = {
			if = { 	
				limit = { 
					OR = {
						is_allied_with = ROOT	
						has_non_aggression_pact_with = ROOT
					}	
				}	
			}
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}				
		}
		hidden_tooltip = {
			any_vassal = {
				limit = {
					NOT = { war_with = root }
					war = no
					primary_title = {
						mercenary = no
						holy_order = no
					}
					NOT = { tier = BARON }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king
				# clr_character_flag = rebel_leader
				# clr_character_flag = post_civil_war_wars
				# clr_character_flag = independant
				# clr_character_flag = join_independance_asked	
				# clr_character_flag = inherit_war 
				#opinion = { who = FROM modifier = opinion_deciding_king days = 10 }
				if = {
					limit = {
						NOT = { has_character_flag = flag_crown_loyalist }
						NOT = { in_faction = faction_liege_loyalist }
					}
					letter_event = { id = mega_wars.25 days=3 }	
				}
				if = { #Crown Loyalists
					limit = { has_character_flag = flag_crown_loyalist }
					character_event = { id = mega_wars.19 days=3 }	
				}
				if = { #Liege Loyalists
					limit = { in_faction = faction_liege_loyalist }
					character_event = { id = mega_wars.20 days=3 }	
				}	
			}	
			any_realm_character = { #Dragon Rider's can choose sides
				limit = {
					trait = dragon_rider
					OR = {
						liege = { character = ROOT }	
						liege = { liege = { character = ROOT }	}
					}	
					is_ruler = no	
					prisoner = no					
					NOT = { trait = incapable }
					NOT = { trait = maester }
					NOT = { trait = archmaester }
					NOT = { trait = septon }
					NOT = { trait = septa }
					NOT = { trait = kingsguard }
					NOT = { trait = nightswatch }
				}
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king
				letter_event = { id = mega_wars.25 days=4 }				
			}
		}		
	}
	option = {
		name = "EVTOPTmega_warsTOOLTIP" 	
		trigger = { ai = no }
		custom_tooltip = { text = EVTTOOLTIPmega_warsTOOLTIP }	
		hidden_tooltip = { repeat_event = { id = mega_wars.7 } }
	}
}

#War ends (iron throne)
character_event = {
	id = mega_wars.8
	desc = "EVTDESCmega_wars.8"
	
	only_independent = yes
	
	trigger = {
		tier = EMPEROR
		trait = civil_war
		OR = {
			war = no
			# FROM = {
				# has_character_flag = rebel_leader
			# }
			NOR = {
				any_demesne_title = {
					tier = EMPEROR
					any_war = {
						attacker = { 
							NOT = { character = ROOT }
							#trait = rebel_leader
							#NOT = { has_character_flag = considering_surrender }
						}
					}
				}
				any_war = {
					OR = {
						AND = {
							defender = { character = ROOT }
							attacker = { 
								NOT = { character = ROOT }
								NOT = { culture_group = unoccupied_group }
								#NOT = { has_character_flag = considering_surrender }
								OR = {	
									AND = { #King tier vassals always trigger mega war
										war_with = ROOT
										liege_before_war = { character = ROOT }
										OR = {	
											tier = KING 
											has_character_flag = indep_war	
										}
										#liege = { character = ROOT }
									}
									AND = { #External Attackers 
										war_with = ROOT
										independent = yes
										OR = { #Musn't be landless (with some exceptions)
											demesne_size = 1
											has_character_flag = summer_islander_invader
											has_character_flag = claimant_adventurer
											has_character_flag = duchy_adventurer
										}	
										NOT = { liege = { character = ROOT }	}
										ROOT = { is_primary_war_defender = yes }				
									}	
									trait = rebel_leader									
								}		
							}
						}
						AND = {
							attacker = { character = ROOT }
							defender = { 
								NOT = { character = ROOT }
								NOT = { culture_group = unoccupied_group }
								#NOT = { has_character_flag = considering_surrender }
								OR = {	
									AND = { #King tier vassals always trigger mega war	
										war_with = ROOT
										OR = {	
											tier = KING 
											has_character_flag = indep_war
										}
										independent = no		
										#liege = { character = ROOT }
									}
									AND = { #External Defenders
										war_with = ROOT
										independent = yes 
										demesne_size = 1
										NOT = { liege = { character = ROOT }	}
										ROOT = { is_primary_war_attacker = yes }
										NOT = { has_character_flag = crownlander_resists }				
									}	
									trait = rebel_leader										
								}	
							}
						}	
					}
				}
				any_playable_ruler = { #Enemies who have the support of a king tier vassal trigger a mega war
					tier = KING 
					independent = no
					OR = {
						liege = { character = ROOT }
						NOT = { liege = { tier = EMPEROR } }
					}	
					war_with = ROOT	
					any_war = {
						OR = {
							attacker = { character = ROOT } 
							defender = { character = ROOT } 
						}
					}					
					NOT = { has_character_flag = against_king }
					NOT = { has_character_flag = inherit_war }
					#NOT = { has_character_flag = considering_surrender }
				}
			}	
		}	
		OR = {
			NOT = { has_character_flag = issue_punishments }
			had_character_flag = { flag = issue_punishments days = 7 }
		}	
	}
	
	mean_time_to_happen = {
		days = 10
	}
	
	immediate = {
		hidden_tooltip = {
			#clr_global_flag = westeros_civil_war
			remove_trait = civil_war
			clr_character_flag = harsh_justice
			clr_character_flag = issue_punishments
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			any_opinion_modifier_target = {
				remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				remove_opinion = { who = ROOT modifier = opinion_with_king }	
				remove_opinion = { who = ROOT modifier = opinion_emperor_rebel_leader }			
			}	
			any_opinion_modifier_target = {
				limit = {
					OR = {
						independent = no
						war = no
					}
				}
				remove_opinion = { who = ROOT modifier = opinion_de_facto_liege }	
			}
			#Sort out High Septon's refuge
			k_the_most_devout = {
				holder_scope = {
					character_event = { id = mega_wars.10 }
				}
			}
			if = {
				limit = {
					has_landed_title = e_iron_throne
					ai = yes
					NOT = { has_global_flag = KL_not_capital }
					capital_scope = { NOT = { province_id = 226 } }
					has_landed_title = b_red_keep
				}
				b_red_keep = { 
					ROOT = { capital = PREV }
				}	
			}
		}	
	}

	option = {
		name = "EVTOPTAmega_wars.8" 
		hidden_tooltip = {
			#Re-absorb king tier vassals
			any_playable_ruler = {
				limit = {
					tier = KING
					is_nomadic = no
					NOT = { has_character_flag = independant }
					NOT = { war_with = ROOT }
					primary_title = { 					
						ROOT = {
							any_demesne_title = {
								tier = EMPEROR
								is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
							}
						}
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
				if = { 	
					limit = { 
						NOT = { has_character_flag = independant } 
						NOT = { has_character_flag = joined_independance_war }
					}
					character_event = { id = mega_wars.9 days = 1 }
				}	
				if = { 	
					limit = { 
						has_character_flag = joined_independance_war
					}
					set_character_flag = post_civil_war_wars
				}	
			}		
			#Clear flags from lower vassals
			any_realm_lord = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}					
				}
				clr_character_flag = mega_war_remove_leader
				clr_character_flag = issue_punishments
				clr_character_flag = inherit_war
				clr_character_flag = supporting_king 
				clr_character_flag = neutral
				clr_character_flag = against_king 
				clr_character_flag = against_liege
				clr_character_flag = rebel_leader
				clr_character_flag = independant
				clr_character_flag = join_independance_asked
				clr_character_flag = no_kingship
				clr_character_flag = mega_war_decision_cooldown
				remove_trait = rebel_leader
				any_opinion_modifier_target = {
					reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
					reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
					reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege	}				
				}
				if = {
					limit = {
						ROOT = {
							NOT = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
							any_vassal = { has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
						}	
					}
					opinion = { who = ROOT modifier = opinion_defeated_major_revolt }
				}
				any_courtier = {
					limit = { 
						is_ruler = no
						trait = dragon_rider
					}
					clr_character_flag = inherit_war
					clr_character_flag = supporting_king 
					clr_character_flag = neutral
					clr_character_flag = against_king 
					clr_character_flag = against_liege
					clr_character_flag = rebel_leader
					clr_character_flag = mega_war_decision_cooldown
					any_opinion_modifier_target = {
						reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
						reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
						reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege }				
					}	
				}
				character_event = { id = mega_wars.900 days = 2 }
			}
			#Reabsorb split vassals
			any_independent_ruler = {
				limit = { 				
					OR = {
						tier = COUNT
						tier = DUKE
					}
					primary_title = { 					
						ROOT = {
							any_demesne_title = {
								tier = EMPEROR
								is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
							}
						}
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
				character_event = { id = mega_wars.900 days = 2 }
			}
			#Clear flags from dragon riders
			any_courtier = {
				limit = { 
					is_ruler = no
					trait = dragon_rider
				}
				clr_character_flag = inherit_war
				clr_character_flag = supporting_king 
				clr_character_flag = neutral
				clr_character_flag = against_king 
				clr_character_flag = against_liege
				clr_character_flag = rebel_leader
				clr_character_flag = mega_war_decision_cooldown
				any_opinion_modifier_target = {
					reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
					reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
					reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege }				
				}	
			}
			c_the_citadel = {
				holder_scope = {
					set_global_flag = war_cooldown_period
					# character_event = { id = mega_wars.70 days = 25 }
				}
			}
			any_independent_ruler = {
				limit = {
					trait = rebel_leader
					war = no
				}
				remove_trait = rebel_leader
				clr_character_flag = rebel_leader
			}		
			remove_trait = rebel_leader
			character_event = { id = maintenance.51 days = 3 } #crown law maintenance
			character_event = { id = maintenance.52 days = 3 } # Empire AI vassal limit management 			
			set_character_flag = mega_war_reappointing_council
			character_event = { id = mega_wars.101 days = 3 } # Reappoint council
			character_event = { id = faction_event_new.90 } #recalculate fear modifier
			if = { #Special Iron Throne actions
				limit = { has_landed_title = e_iron_throne }
				set_character_flag = mega_war_wardens_reset	
				character_event = { id = warden.10 days = 3 } #Re-appoint Wardens
				#move rogue kingsuard back
				kingsguard = {
					limit = {
						is_alive = yes
						has_character_flag = against_king
					}
					clr_character_flag = against_king
					if = {
						limit = {
							liege = { NOT = { has_landed_title = d_kingsguard } } 
							is_ruler = no
						}	
						d_kingsguard = { holder_scope = { reverse_banish = PREVPREV } }	
					}
				}
				kingsguard = {
					limit = {
						is_alive = yes
						has_character_flag = against_king
					}
					clr_character_flag = against_king
					if = {
						limit = {
							liege = { NOT = { has_landed_title = d_kingsguard } } 
							is_ruler = no
						}	
						d_kingsguard = { holder_scope = { reverse_banish = PREVPREV } }	
					}
				}
				kingsguard = {
					limit = {
						is_alive = yes
						has_character_flag = against_king
					}
					clr_character_flag = against_king
					if = {
						limit = {
							liege = { NOT = { has_landed_title = d_kingsguard } } 
							is_ruler = no
						}	
						d_kingsguard = { holder_scope = { reverse_banish = PREVPREV } }	
					}
				}
				kingsguard = {
					limit = {
						is_alive = yes
						has_character_flag = against_king
					}
					clr_character_flag = against_king
					if = {
						limit = {
							liege = { NOT = { has_landed_title = d_kingsguard } } 
							is_ruler = no
						}	
						d_kingsguard = { holder_scope = { reverse_banish = PREVPREV } }	
					}
				}
				kingsguard = {
					limit = {
						is_alive = yes
						has_character_flag = against_king
					}
					clr_character_flag = against_king
					if = {
						limit = {
							liege = { NOT = { has_landed_title = d_kingsguard } } 
							is_ruler = no
						}	
						d_kingsguard = { holder_scope = { reverse_banish = PREVPREV } }	
					}
				}
				kingsguard = {
					limit = {
						is_alive = yes
						has_character_flag = against_king
					}
					clr_character_flag = against_king
					if = {
						limit = {
							liege = { NOT = { has_landed_title = d_kingsguard } } 
							is_ruler = no
						}	
						d_kingsguard = { holder_scope = { reverse_banish = PREVPREV } }	
					}
				}
			}
		}	
	}
}	
#Inform king/LP of war end
character_event = { #continiously check all king tier character
	id = mega_wars.901
	
	only_independent = yes
	hide_window = yes
	
	trigger = {
		tier = KING
		is_nomadic = no
		NOT = { has_character_flag = independant }
		primary_title = { check_variable = { which = "de_facto_empire" value = 1 } }
		any_independent_ruler = {
			tier = EMPEROR
			war = no
			NOT = { trait = civil_war }
			any_demesne_title = {
				tier = EMPEROR
				ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
				check_variable = { which = "de_facto_empire" value = 0.9 }
			}
		}
		NOT = { has_character_flag = joined_independance_war }
		NOT = { has_character_flag = post_civil_war_wars }	
	}
	
	immediate = {
		character_event = { id = mega_wars.9 }
	}
	
	option = {
		name = OK
	}
}
character_event = { #triggered from both MTTH event above and emperor's war ending event
	id = mega_wars.9
	desc = "EVTDESCmega_wars.9"

	is_triggered_only = yes
	
	trigger = {
		tier = KING
		is_nomadic = no
	}
	
	immediate = {
		set_character_flag = no_kingship
		clr_character_flag = will_be_reabsorbed	
		clr_character_flag = mega_war_remove_leader
		clr_character_flag = end_indep_wars
		clr_character_flag = issue_punishments
		any_realm_lord = {
			limit = { 
				OR = {
					tier = COUNT
					tier = DUKE
				}					
			}
			clr_character_flag = mega_war_remove_leader
			clr_character_flag = issue_punishments
			clr_character_flag = inherit_war
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = against_liege
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			clr_character_flag = mega_war_decision_cooldown
			remove_trait = rebel_leader
			any_opinion_modifier_target = {
				reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
				reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
				reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege	}				
			}
			if = {
				limit = {
					ROOT = {
						NOT = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
						any_vassal = { has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
					}	
				}
				opinion = { who = ROOT modifier = opinion_defeated_major_revolt }
			}
			any_courtier = {
				limit = { 
					is_ruler = no
					trait = dragon_rider
				}
				clr_character_flag = inherit_war
				clr_character_flag = supporting_king 
				clr_character_flag = neutral
				clr_character_flag = against_king 
				clr_character_flag = against_liege
				clr_character_flag = rebel_leader
				clr_character_flag = mega_war_decision_cooldown
				any_opinion_modifier_target = {
					reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
					reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
					reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege }				
				}	
			}
			character_event = { id = mega_wars.900 days = 5 }
		}
		any_courtier = {
			limit = { 
				is_ruler = no
				trait = dragon_rider
			}
			clr_character_flag = inherit_war
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = against_liege
			clr_character_flag = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			any_opinion_modifier_target = {
				reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
				reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
				reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege }				
			}	
		}
		if = {
			limit = { has_landed_title = k_the_most_devout }
			character_event = { id = mega_wars.10 }
		}	
	}
	
	option = {
		name = "EVTOPTAmega_wars.8" #Yes				
		trigger = { 
			OR = {
				has_character_flag = mega_wars_disabled #game rule
				war = no 
			}	
			NOT = { any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } }
			NOT = { 
				liege = { 
					tier = EMPEROR 
					NOT = {
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
				}
			}
		}
		random_independent_ruler = {
			limit = {
				tier = EMPEROR
				NOT = { trait = civil_war }
				OR = {
					war = no
					character = FROM #this means it was triggered by the emperor
					ROOT = { has_character_flag = mega_wars_disabled }
				}	
				any_demesne_title = {
					tier = EMPEROR
					ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
			}
			if = { #Check for granting of independence
				limit = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } }
				hidden_tooltip = {
					ROOT = {
						any_demesne_title = { 
							limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
							set_variable = { which = "de_facto_empire" value = 0 } 
						}
						any_realm_lord = { 
							any_demesne_title = { 
								limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
								set_variable = { which = "de_facto_empire" value = 0 } 
							}
						}
						clr_character_flag = supporting_king 
						clr_character_flag = neutral
						clr_character_flag = against_king 
						clr_character_flag = rebel_leader
						clr_character_flag = independant
						clr_character_flag = join_independance_asked
						clr_character_flag = no_kingship
						remove_trait = rebel_leader
						clr_character_flag = mega_war_decision_cooldown
						any_opinion_modifier_target = {
							remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
							remove_opinion = { who = ROOT modifier = opinion_with_king }	
							remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}		
						}	
						recalc_succession = yes
					}	
				}
				break = yes
			}
			ROOT = { 
				if = { 
					limit = { NOT = { liege = { character = PREVPREV } } }
					set_defacto_liege = PREV 
				}	
			}
		}	
		if = {
			limit = { has_character_flag = mega_war_regent }
			clr_character_flag = mega_war_regent
			if = {
				limit = {
					liege = { 
						has_regent = yes
						NOT = { character = ROOT }
					}
				}
				gain_regency_effect = yes
			}	
		}
		hidden_tooltip = {	
			liege = {
				if = {
					limit = {
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_defeated_major_revolt } }
						any_vassal = { has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
					}
					reverse_opinion = { who = ROOT modifier = opinion_defeated_major_revolt }
				}
				any_vassal = { #Make sure any vassals wrongly gained by liege are taken back
					limit = {
						lower_tier_than = ROOT
						NOT = { tier = BARON }
						primary_title = {
							ROOT = {
								any_demesne_title = {
									tier = KING
									check_variable = { which = "de_facto_kingdom" value = 0.9 }
									is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV }
								}
							}
						}
					}
					set_defacto_liege = ROOT
				}
			}
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			clr_character_flag = mega_wars_disabled
			any_opinion_modifier_target = {
				remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				remove_opinion = { who = ROOT modifier = opinion_with_king }	
				remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}		
			}	
			recalc_succession = yes
		}				
	}
	
	option = {
		name = "EVTOPTBmega_wars.8" #Our war continues	
		trigger = { 
			war = yes 
			NOT = { has_character_flag = mega_wars_disabled } #game rule
			NOT = { any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } }
			NOT = { 
				liege = { 
					tier = EMPEROR 
					NOT = {
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
				}
			}
		}	
		#hidden_tooltip = {
			set_character_flag = post_civil_war_wars
			any_war = {
				limit = { 	
					using_cb = bid_for_independence
					defender = { character = ROOT }
				}
				attacker = { set_character_flag = post_civil_war_indep_war }
			}	
		#}	
		hidden_tooltip = {	
			opinion = { who = FROM modifier = opinion_de_facto_liege years = 25 }	
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			any_opinion_modifier_target = {
				remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				remove_opinion = { who = ROOT modifier = opinion_with_king }				
			}	
		}			
	}
	option = {
		name = "EVTOPTDmega_wars.8" #I was granted independence
		trigger = { 
			OR = {
				liege = { 
					tier = EMPEROR 
					NOT = {
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
				}
				any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } 
			}	
		}
		hidden_tooltip = {
			any_demesne_title = { 
				limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
				set_variable = { which = "de_facto_empire" value = 0 } 
			}
			any_realm_lord = { 
				any_demesne_title = { 
					limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
					set_variable = { which = "de_facto_empire" value = 0 } 
				}
			}
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			any_opinion_modifier_target = {
				remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				remove_opinion = { who = ROOT modifier = opinion_with_king }	
				remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}		
			}	
			recalc_succession = yes
		}
	}
}
#Inform neutral LP vassal of war end
character_event = {
	id = mega_wars.900
	desc = "EVTDESCmega_wars.9"

	is_triggered_only = yes
	
	trigger = {
		primary_title = { check_variable = { which = "de_facto_empire" value = 1 } }
		OR = {
			FROM = {
				any_demesne_title = { 
					tier = EMPEROR
					ROOT = {
						primary_title = {
							lower_tier_than = EMPEROR
							is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
						}
					}
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
			}	
			has_character_flag = mega_wars_disabled
		}	
	}
		
	immediate = {
		clr_character_flag = mega_war_remove_leader
		clr_character_flag = issue_punishments
		any_war = { #End all slave raids on this lord
			limit = { 
				using_cb = slave_raid 
				defender = { character = ROOT }
			}	
			end_war = invalid
		}
		any_courtier = {
			limit = { 
				is_ruler = no
				trait = dragon_rider
			}
			clr_character_flag = inherit_war
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = against_liege
			clr_character_flag = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			any_opinion_modifier_target = {
				reverse_remove_opinion = { who = PREV modifier = opinion_with_rebel_leader }		
				reverse_remove_opinion = { who = PREV modifier = opinion_with_king }	
				reverse_remove_opinion = { who = PREV modifier = opinion_de_facto_liege }				
			}	
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.8" #Yes				
		trigger = { 	
			OR = {
				war = no
				NOT = { independent = yes }
				has_character_flag = mega_wars_disabled
			}	
			NOT = { any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } }
		}
		if = {
			limit = { independent = yes }
			if = {
				limit = { 
					primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } 
					lower_tier_than = KING
					NOT = { liege = { character = FROM } }
				}
				random_playable_ruler = {
					limit = {
						higher_tier_than = DUKE
						any_demesne_title = {
							higher_tier_than = DUKE
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
							check_variable = { which = "de_facto_kingdom" value = 0.9 }
						}	
					}
					ROOT = { set_defacto_liege = PREV }
					recalc_succession = yes
				}
			}	
			if = {
				limit = { 
					independent = yes
				}
				random_independent_ruler = {
					limit = {
						tier = EMPEROR
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
					ROOT = { set_defacto_liege = PREV }
					recalc_succession = yes
				}	
			}
		}	
		hidden_tooltip = {
			liege = {
				if = {
					limit = {
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_defeated_major_revolt } }
						any_vassal = { has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
					}
					reverse_opinion = { who = ROOT modifier = opinion_defeated_major_revolt }
				}
			}
			clr_character_flag = inherit_war
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = against_liege
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			clr_character_flag = mega_war_decision_cooldown
			remove_trait = rebel_leader
			clr_character_flag = mega_wars_disabled
			any_opinion_modifier_target = {
				reverse_remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				reverse_remove_opinion = { who = ROOT modifier = opinion_with_king }	
				reverse_remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}				
			}	
		}				
	}
	
	option = {
		name = "EVTOPTBmega_wars.8" #Our war continues	
		trigger = { 	
			war = yes
			independent = yes
			NOT = { has_character_flag = mega_wars_disabled }
			NOT = { any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } } 
		}	
		#hidden_tooltip = {
			set_character_flag = post_civil_war_wars
			any_war = {
				limit = { 	using_cb = bid_for_independence
							defender = { character = ROOT }
				}
				attacker = { set_character_flag = 	post_civil_war_indep_war }
			}	
		#}		
		hidden_tooltip = {
			opinion = { who = FROM modifier = opinion_de_facto_liege	years = 25 }
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = against_liege
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
		}
	}
	
	option = {
		name = "EVTOPTDmega_wars.8" #I was granted independence
		trigger = { 
			any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } 
		}
		hidden_tooltip = {
			any_demesne_title = { 
				limit = { 
					NOT = { tier = BARON } 
					NOT = { tier = EMPEROR }
				}
				set_variable = { which = "de_facto_empire" value = 0 }
			}
			any_realm_lord = { 
				any_demesne_title = { 
					limit = { 
						NOT = { tier = BARON } 
						NOT = { tier = EMPEROR }
					}
					set_variable = { which = "de_facto_empire" value = 0 } 
				}
			}
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			any_opinion_modifier_target = {
				reverse_remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				reverse_remove_opinion = { who = ROOT modifier = opinion_with_king }	
				reverse_remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}		
			}	
		}
	}
}
#Sort out High Septon refuge
character_event = {
	id = mega_wars.10
	
	is_triggered_only = yes
	hide_window = yes
	war = no
	
	trigger = { 
		has_landed_title = k_the_most_devout
	}
	
	immediate = {		
		#Take back original septs
		any_playable_ruler = {
			limit = {
				liege = {
					any_realm_title = {
						tier = BARON
						holding_type = temple
						has_title_flag = high_septon_capital
					}
				}
			}
			liege = {
				random_realm_title = {
					limit = {
						tier = BARON
						holding_type = temple
						has_title_flag = high_septon_capital
					}
					gain_title = ROOT
					clr_title_flag = high_septon_capital
				}
			}
		}
		#Give refuge back to province owner
		random_demesne_title = {
			limit = {
				tier = BARON
				holding_type = temple
				has_title_flag = high_septon_refuge
			}
			location = {
				owner = {
					character_event = { id = mega_wars.11 }
				}
			}			
		}		
	}
	
	option = { name = OK }
}	
character_event = {
	id = mega_wars.11
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROM = {
			random_demesne_title = {
				limit = {
					tier = BARON
					holding_type = temple
					has_title_flag = high_septon_refuge
				}
				gain_title = ROOT
				clr_title_flag = high_septon_refuge
			}
		}	
	}
	
	option = { name = OK }
}	
#post civil war wars LP revassalise
character_event = {
	id = mega_wars.12
	desc = "EVTDESCmega_wars.12"
	
	only_independent = yes
	war = no
	
	trigger = {
		has_character_flag = post_civil_war_wars	
	}

	mean_time_to_happen = {
		days = 10
		modifier = {
			factor = 5
			has_character_flag = joined_independance_war
		}
	}
	
	immediate = {
		if = {
			limit = { has_landed_title = k_the_most_devout }
			character_event = { id = mega_wars.10 }
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.12" #Yes	
		clr_character_flag = post_civil_war_wars
		clr_character_flag = joined_independance_war
		clr_character_flag = will_be_reabsorbed
		clr_character_flag = mega_war_remove_leader
		if = {
			limit = { 
				lower_tier_than = KING
				primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } 
			}
			random_playable_ruler = {
				limit = {
					liege = {
						higher_tier_than = DUKE
						any_demesne_title = {
							higher_tier_than = DUKE
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
							check_variable = { which = "de_facto_kingdom" value = 0.9 }
						}
					}	
				}
				liege = { ROOT = { set_defacto_liege = PREV } }
				recalc_succession = yes
			}
		}
		if = {
			limit = { 
				independent = yes
			}
			random_independent_ruler = {
				limit = {
					tier = EMPEROR
					any_demesne_title = {
						tier = EMPEROR
						ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
				ROOT = { set_defacto_liege = PREV }
				recalc_succession = yes
			}		
		}
		hidden_tooltip = {
			liege = {
				if = {
					limit = {
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_defeated_major_revolt } }
						any_vassal = { has_opinion_modifier = { who = PREV modifier = opinion_defeated_major_revolt } }
					}
					reverse_opinion = { who = ROOT modifier = opinion_defeated_major_revolt }
				}
				reverse_remove_opinion = { who = ROOT modifier = opinion_de_facto_liege }	
				any_vassal = { #Make sure any vassals wrongly gained by liege are taken back
					limit = {
						lower_tier_than = ROOT
						NOT = { tier = BARON }
						primary_title = {
							ROOT = {
								any_demesne_title = {
									tier = KING
									check_variable = { which = "de_facto_kingdom" value = 0.9 }
									is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV }
								}
							}
						}
					}
					set_defacto_liege = ROOT
				}
			}
			clr_character_flag = inherit_war
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = against_liege
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			clr_character_flag = mega_war_decision_cooldown
			remove_trait = rebel_leader
			any_opinion_modifier_target = {
				remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				remove_opinion = { who = ROOT modifier = opinion_with_king }	
				remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}				
			}	
		}
	}
}
#supporting king rejoin war
character_event = {
	id = mega_wars.13
	desc = "EVTDESCmega_wars.13"
	
	only_independent = yes

	trigger = {
		#has_global_flag = westeros_civil_war
		#tier = KING
		#independent = yes	
		is_nomadic = no
		civil_war = {
			tier = EMPEROR
			is_alive = yes
			war = yes
			reverse_has_opinion_modifier = {
				who = ROOT
				modifier = opinion_with_king
			}
			NOT = {
				any_war = {
					OR = {
						attacker = { 
							#trait = rebel_leader
							war_with = ROOT
						}
						defender = { 
							#trait = rebel_leader
							war_with = ROOT
						}
					}
				}
			}
			any_war = {
				OR = {
					attacker = { 
						trait = rebel_leader
						NOT = { war_with = ROOT }
					}
					defender = { 
						trait = rebel_leader
						NOT = { war_with = ROOT }
					}
				}
			}
			OR = {
				is_primary_war_attacker = yes
				is_primary_war_defender = yes
			}
		}
		OR = {
			has_character_flag = flag_crown_loyalist
			has_character_flag = supporting_king
		}
		# NOT = {
			# any_war = {
				# OR = {
					# attacker = { 
						# has_landed_title = e_iron_throne
					# }
					# defender = { 
						# has_landed_title = e_iron_throne
					# }
				# }
			# }
		# }	
	}
	
	option = {
		name = "EVTOPTAmega_wars.13" #Yes
		clr_character_flag = flag_crown_loyalist
		civil_war = {
			limit = {
				tier = EMPEROR
				is_alive = yes
				war = yes
				reverse_has_opinion_modifier = {
					who = ROOT
					modifier = opinion_with_king
				}
			}	
			if = {
				limit = {
					is_primary_war_defender = yes
					any_war = {
						attacker = { trait = rebel_leader }
						defender = { character = PREVPREV }
					}
				}
				ROOT = { join_defender_wars = PREV }
			}
			if = {
				limit = {
					is_primary_war_attacker = yes
					any_war = {
						defender = { trait = rebel_leader }
						attacker = { character = PREVPREV }
					}
				}
				ROOT = { join_attacker_wars = PREV }
			}	
			hidden_tooltip = { #failsafe
				ROOT = { 
					join_defender_wars = PREV 
					join_attacker_wars = PREV
				}			
			}
		}	
	}
}
#Lord is defending against external realm post civil war- King decides to help or not , triggered by decision
character_event = {
	id = mega_wars.14
	
	hide_window = yes	
	is_triggered_only = yes
	
	immediate = {
		if = { #If granted independence diplomatically cancel this
			limit = { any_opinion_modifier_target = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } } }
			any_demesne_title = { 
				limit = { 
					NOT = { tier = BARON } 
					NOT = { tier = EMPEROR }
				}
				set_variable = { which = "de_facto_empire" value = 0 } 
			}
			break = yes
		}	
		if = { #First try and find king tier liege
			limit = {
				lower_tier_than = KING
				NOT = { has_character_flag = against_loyal_liege }
				NOT = { has_character_flag = against_rebel_liege }
				primary_title = { 
					check_variable = { which = "de_facto_empire" value = 0.9 } 
					check_variable = { which = "de_facto_kingdom" value = 0.9 }
				}
			}
			random_playable_ruler = {
				limit = {
					liege = {
						higher_tier_than = DUKE
						any_demesne_title = {
							higher_tier_than = DUKE
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
							check_variable = { which = "de_facto_kingdom" value = 0.9 }
						}
						NOT = { war_with = ROOT }
					}	
				}
				liege = { character_event = { id = mega_wars.15 days = 1 } }
				break = yes
			}				
		}	
		random_independent_ruler = { #Then try emperor tier liege
			limit = {
				tier = EMPEROR			
				any_demesne_title = {
					tier = EMPEROR
					ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
				NOT = { war_with = ROOT }
			}
			character_event = { id = mega_wars.15 days = 1 }
		}
	}
	
	option = {
		name = OK
	}
}	
character_event = {
	id = mega_wars.15
	desc = "EVTDESCmega_wars.15"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.15" #Yes
		ai_chance = {
			factor = 97
		}
		if = {
			limit = {
				FROM = { is_primary_war_defender = yes }
			}
			FROM = {
				ROOT = {
					join_defender_wars = PREV
				}
			}	
		}
		hidden_tooltip = {
			FROM = { letter_event = { id = mega_wars.16 } }
		}
	}
	option = {
		name = "EVTOPTBmega_wars.15" #No
		ai_chance = {
			factor = 3
			modifier = {
				factor = 0
				opinion = { who = FROM value = 0 }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value = -25 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value = -50 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value = -75 } }
			}
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = arbitrary
			}
			modifier = {
				factor = 2
				trait = deceitful
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 0.5
				trait = brave
			}
			modifier = {
				factor = 0.5
				trait = just
			}
			modifier = {
				factor = 0.5
				trait = honorable
			}
			modifier = {
				factor = 0.5
				trait = honest
			}
			modifier = {
				factor = 0.5
				trait = diligent
			}
		}
		prestige = -100
		FROM = {
			opinion = {
				modifier = opinion_failed_to_protect_me
				who = ROOT
				years = 20
			}
			hidden_tooltip = {
				letter_event = { id = mega_wars.17 }
			}
		}
		any_realm_lord = {
			limit = { NOT = { character = FROM } }
			opinion = {
				modifier = opinion_failed_to_protect_bannerman
				who = ROOT
				years = 10
			}
		}
	}
}
#inform LP King honours call
letter_event = {
	id = mega_wars.16
	desc = "EVTDESCmega_wars.16"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.16" #
	}
}
#inform LP King dishonours call
letter_event = {
	id = mega_wars.17
	desc = "EVTDESCmega_wars.17"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.17" #	
		clr_character_flag = liege_called_to_arms
	}
}
character_event = { #Flag clean up
	id = mega_wars.18
	
	only_independent = yes
	hide_window = yes
	war = no
	
	trigger = {
		has_character_flag = liege_called_to_arms
	}
	
	immediate = { clr_character_flag = liege_called_to_arms }
	
	option = {
		name = "OK"
	}
}
#Crown Loyalist joins King
character_event = { 
	id = mega_wars.19
	desc = "EVTDESCmega_wars.19"
	
	is_triggered_only = yes
	
	trigger = {
		#has_global_flag = westeros_civil_war
		# OR = { 
			# tier = DUKE
			# tier = COUNT
			# trait = dragon_rider
		# }
		war = no
		OR = {
			is_patrician = no #dont break republic
			is_merchant_republic = yes
		}
		is_nomadic = no
		# OR = { #Republics are not split from Merchant Republics
			# liege = { character = ROOT }
			# liege = { is_merchant_republic = no }
			# is_republic = no
			# tier = COUNT
			# capital_scope = { NOT = { port = yes } }
		# }
		FROMFROM = {
			war = yes
		}
		OR = {
			tier = KING
			NOT = { top_liege = { character = ROOT } }
		}
		OR = {
			has_character_flag = inherit_war
			NOT = { 
				OR = {
					has_character_flag = supporting_king 
					has_character_flag = neutral 
					has_character_flag = against_king 
				}	
			}
		}	
	}
	
	immediate = {
		if = {
			limit = { 
				OR = {
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } } #independent
					NOT = { #Make sure isnt actually part of another empire
						any_independent_ruler = {
							tier = EMPEROR
							NOT = { character = FROMFROM }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } 
							any_demesne_title = {
								tier = EMPEROR
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
								check_variable = { which = "de_facto_empire" value = 0.9 }
							}	
						}
					}
				}	
			}
			FROMFROM = {
				set_mega_war_empire_variable_ROOT_effect = yes
			}
		}
	}

	option = {
		name = "EVTOPTAmega_wars.19"
		clr_character_flag = flag_crown_loyalist 
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
		if = {
			limit = { tier = KING }
			hidden_tooltip = { set_defacto_liege = ROOT }
			FROM = {
				if = {
					limit = {
						is_primary_war_defender = yes
						any_war = {
							attacker = { trait = rebel_leader }
							defender = { character = PREVPREV }
						}
					}
					ROOT = { join_defender_wars = PREV }
				}
				if = {
					limit = {
						is_primary_war_attacker = yes
						any_war = {
							defender = { trait = rebel_leader }
							attacker = { character = PREVPREV }
						}
					}
					ROOT = { join_attacker_wars = PREV }
				}	
				hidden_tooltip = { #failsafe
					ROOT = { 
						join_defender_wars = PREV 
						join_attacker_wars = PREV
						if = { #If failed, break and add a cooldown
							limit = {
								NOT = {
									any_war = {
										OR = {
											attacker = { character = ROOT_FROM }
											defender = { character = ROOT_FROM }
										}
									}
								}
							}
							clr_character_flag = mega_war_decision_cooldown
							set_character_flag = mega_war_decision_cooldown
							break = yes
						}
					}			
				}
				opinion = {
					modifier = opinion_loyal_to_crown
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					letter_event = { id = mega_wars.34 }
					reverse_opinion = {
						modifier = opinion_with_king
						who = ROOT
						years = 100
					}
				}
			}
			hidden_tooltip = {
				any_vassal = {
					limit = {
						NOT = { war_with = root }
						war = no
						primary_title = {
							mercenary = no
							holy_order = no
						}
						NOT = { tier = BARON }
					}
					clr_character_flag = supporting_king
					clr_character_flag = neutral 
					clr_character_flag = against_king 
					# clr_character_flag = rebel_leader
					# clr_character_flag = post_civil_war_wars
					# clr_character_flag = independant
					# clr_character_flag = join_independance_asked	
					# clr_character_flag = inherit_war 
					if = {
						limit = {
							NOT = { has_character_flag = flag_crown_loyalist }
							NOT = { in_faction = faction_liege_loyalist }
						}
						letter_event = { id = mega_wars.25 days=3 }	
					}
					if = { #Crown Loyalists
						limit = { has_character_flag = flag_crown_loyalist }
						character_event = { id = mega_wars.19 days=3 }	
					}
					if = { #Liege Loyalists
						limit = { in_faction = faction_liege_loyalist }
						character_event = { id = mega_wars.20 days=3 }	
					}
				}	
			}
		}
		if = {
			limit = {
				NOT = { tier = KING } 
			}
			if = { 
				limit = { liege = { has_character_flag = against_king NOT = { trait = civil_war } } }
				custom_tooltip = { text = TOOLTIP_liege_against_king }
				liege = {
					hidden_tooltip = {
						character_event = { id = mega_wars.36 }
					}	
					opinion = { who = ROOT modifier = opinion_traitor }
				}
				set_character_flag = against_rebel_liege
			}
			if = { 
				limit = { liege = { has_character_flag = neutral } }
				custom_tooltip = { text = TOOLTIP_liege_neutral }
			}
			if = { 
				limit = { liege = { has_character_flag = supporting_king } }
				custom_tooltip = { text = TOOLTIP_liege_supporting_king }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}
			if = { 
				limit = { liege = { character = FROM } }
				custom_tooltip = { text = TOOLTIP_liege_emperor }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}
			if = { 
				limit = { liege = { trait = rebel_leader NOT = { trait = civil_war } } }
				custom_tooltip = { text = TOOLTIP_liege_rebel_leader }
				liege = {
					hidden_tooltip = {
						character_event = { id = mega_wars.36 }
					}	
					opinion = { who = ROOT modifier = opinion_traitor }
				}
				set_character_flag = against_rebel_liege
			}
			if = { 
				limit = { 
					OR = {
						liege = { 
							NOT = { has_character_flag = supporting_king } 
							NOT = { character = FROMFROM } 
						}
						has_character_flag = event_triggered_from_rebel_leader
					}	
				}
				liege = {
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
				hidden_tooltip = { 
					opinion = { who = liege modifier = opinion_de_facto_liege years = 25 }
					set_defacto_liege = ROOT 
				}
				FROM = {
					FROM = {
						if = {
							limit = {
								is_primary_war_defender = yes
								any_war = {
									attacker = { trait = rebel_leader }
									defender = { character = PREVPREV }
								}
							}
							ROOT = { join_defender_wars = PREV }
						}
						if = {
							limit = {
								is_primary_war_attacker = yes
								any_war = {
									defender = { trait = rebel_leader }
									attacker = { character = PREVPREV }
								}
							}
							ROOT = { join_attacker_wars = PREV }
						}	
						hidden_tooltip = { #failsafe
							ROOT = { 
								join_defender_wars = PREV 
								join_attacker_wars = PREV
								if = { #If failed, break and add a cooldown
									limit = {
										NOT = {
											any_war = {
												OR = {
													attacker = { character = ROOT_FROMFROM }
													defender = { character = ROOT_FROMFROM }
												}
											}
										}
									}
									clr_character_flag = event_triggered_from_rebel_leader 
									clr_character_flag = mega_war_decision_cooldown
									set_character_flag = mega_war_decision_cooldown
									break = yes
								}
							}			
						}
						opinion = {
							modifier = opinion_loyal_to_crown
							who = ROOT
							years = 10
						}
						hidden_tooltip = {
							reverse_opinion = {
								modifier = opinion_with_king
								who = ROOT
								years = 100
							}
							letter_event = { id = mega_wars.34 }
						}
					}	
				}
			}				
			clr_character_flag = event_triggered_from_rebel_leader 
		}	
	}	
}	
#Liege Loyalist follows Liege
character_event = {
	id = mega_wars.20
	desc = "EVTDESCmega_wars.20"
	
	is_triggered_only = yes
	
	trigger = {
		#has_global_flag = westeros_civil_war
		OR = { 
			tier = DUKE
			tier = COUNT
		}
		war = no
		OR = {
			is_patrician = no #dont break republic
			is_merchant_republic = yes
		}
		is_nomadic = no
		# OR = { #Republics are not split from Merchant Republics
			# liege = { character = ROOT }
			# liege = { is_merchant_republic = no }
			# is_republic = no
			# tier = COUNT
			# capital_scope = { NOT = { port = yes } }
		# }
		FROMFROM = {
			war = yes
		}
		#OR = {
			#tier = KING
			NOT = { top_liege = { character = ROOT } }
		#}	
		OR = {
			has_character_flag = inherit_war
			NOT = { 
				OR = {
					has_character_flag = supporting_king 
					has_character_flag = neutral 
					has_character_flag = against_king 
				}	
			}
		}	
	}

	option = {
		name = "EVTOPTAmega_wars.20"
		clr_character_flag = event_triggered_from_rebel_leader 
		clr_character_flag = flag_crown_loyalist
		clr_character_flag = mega_war_remove_leader
		if = { 
			limit = { liege = { has_character_flag = against_king } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
			clr_character_flag = supporting_king
			clr_character_flag = neutral 
			set_character_flag = against_king 
		}
		if = { 
			limit = { liege = { has_character_flag = neutral } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
			clr_character_flag = supporting_king
			set_character_flag = neutral 
			clr_character_flag = against_king 
		}
		if = { 
			limit = { liege = { has_character_flag = supporting_king } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
			set_character_flag = supporting_king
			clr_character_flag = neutral 
			clr_character_flag = against_king 
		}
		if = { 
			limit = { liege = { trait = civil_war } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
			set_character_flag = supporting_king
			clr_character_flag = neutral 
			clr_character_flag = against_king
		}
		if = { 
			limit = { liege = { trait = rebel_leader } }
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
			clr_character_flag = supporting_king
			clr_character_flag = neutral 
			set_character_flag = against_king 
		}
	}
}	

#Vassal control events 
#-----------------------

#AI vassal yearly pulse
character_event = {
	id = mega_wars.21
	
	hide_window = yes
	is_triggered_only = yes
	only_playable = yes
	ai = yes
	
	trigger = {		
		demesne_size = 1
		OR = {
			is_patrician = no #dont break republic
			is_merchant_republic = yes
		}
		is_nomadic = no
		OR = {
			independent = no
			primary_title = { check_variable = { which = "de_facto_empire" value = 1 } }
		}
		OR = {
			had_character_flag = { flag = mega_war_decision_cooldown days = 150 }
			NOT = { has_character_flag = mega_war_decision_cooldown }
		}			
		NOT = { has_character_flag = flag_crown_loyalist }
		NOT = { in_faction = faction_liege_loyalist }
		OR = { #High Septon must have enough authority
			NOT = { has_landed_title = k_the_most_devout }
			crownlaw_title = {
				OR = {
					has_law = investiture_law_2
					has_law = investiture_law_3
				}
			}
		}		
		OR = {	
			AND = { #Conditions for LPs
				tier = KING				
				OR = {
					AND = {
						war = no #Cannot already of chosen sides	
						independent = yes
					}	
					liege = { 
						tier = EMPEROR 
						war = yes
					}
				}	
				NAND = { #If already flagged as supporting king cannot choose sides (will be added back to war automatically)
					has_character_flag = supporting_king
					civil_war = {
						tier = EMPEROR
						war = yes
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_with_king  }
					}
				}				
			}	
			AND = { #Conditions for vassals LPs
				#ai = no #temp
				lower_tier_than = KING				
				NOT = { #Cannot be involved in a non-iron throne war
					any_war = {
						NOT = {
							OR = {
								attacker = { tier = EMPEROR trait = civil_war }
								defender = { tier = EMPEROR trait = civil_war }
							}
						}
					}
				}
				OR = { #Cannot already have defected
					NOT = { independent = yes }
					war = no
				}
				OR = { #Initial choice event must have occured
					has_character_flag = supporting_king
					has_character_flag = neutral 
					has_character_flag = against_king 
				}
				OR = {
					independent = yes #Is neutral
					liege = { 
						NOT = { has_character_flag = inherit_war } #Liege must not be deciding after inheriting
						OR = { #Liege must be part of the Iron Throne
							NOT = { has_character_flag = independant } 
							AND = {
								tier = EMPEROR
								trait = civil_war
							}
						}	
						OR = { #Liege must have decided their stance
							AND = {
								tier = EMPEROR
								trait = civil_war
							}
							has_character_flag = supporting_king
							has_character_flag = neutral 
							has_character_flag = against_king 
							trait = rebel_leader
						}	
					}
				}
			}	
		}
		
		capital_holding = { controller = { character = ROOT } } #Cannot change sides if capital is occupied	
		NOT = { #not split when outside force is claiming title
			any_realm_title = {
				any_war = { 
					attacker = {
						NOT = { character = ROOT }
					}
				}
				#holder_scope = { war = yes }
			}
		}
	}
	
	immediate = { 
		#find rebel leader
		clr_character_flag = inherit_war
		rebel_leader = {
			limit = { 
				is_alive = yes 
				is_ruler = yes	
				civil_war = {
					tier = EMPEROR
					war_with = PREV
					OR = {
						is_vassal_or_below = ROOT
						any_demesne_title = {
							tier = EMPEROR
							ROOT = {
								primary_title = {
									is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
								}
							}
						}
					}
					primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } }
				}	
				ROOT = { #Vassal of rebel leader cannot defect to other rebel leaders
					OR = {
						independent = yes
						liege = {
							OR = { #Vassal of rebel leader cannot defect to other rebel leaders
								NOT = { trait = rebel_leader }
								trait = civil_war
								character = PREVPREV
							}
						}
					}
				}
				NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_deciding_rebel_leader } }
			}
			reverse_opinion = { who = ROOT modifier = opinion_deciding_rebel_leader months = 1 }
			character_event = { id = mega_wars.2190 } #set rebel leader as FROMFROM scope
			
			#If other potential rebel leader available repeat event
			if = {
				limit = {
					rebel_leader = {
						is_alive = yes 
						is_ruler = yes
						NOT = { character = PREV }
						civil_war = {
							tier = EMPEROR
							war_with = PREV
							OR = {
								is_vassal_or_below = ROOT
								any_demesne_title = {
									tier = EMPEROR
									ROOT = {
										primary_title = {
											is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
										}
									}
								}
							}
							primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } }
						}
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_deciding_rebel_leader } }						
					}
				}
				ROOT = { character_event = { id = mega_wars.21 days = 2 } }
			}
		}	
	}
	
	option = {
		name = OK
	}	
}	
character_event = { #Rebel leader set as FROMFROM scope
	id = mega_wars.2190
	
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		civil_war = { #Find correct emperor
			limit = {
				tier = EMPEROR
				is_alive = yes
				war_with = ROOT	
				OR = {
					is_vassal_or_below = FROM
					any_demesne_title = {
						tier = EMPEROR
						FROM = {
							primary_title = {
								is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
							}
						}
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
			}
			character_event = { id = mega_wars.22 }			
		}
	}
	
	option = {
		name = OK
	}	
}
#AI dragon rider yearly pulse
character_event = {
	id = mega_wars.2191
	
	hide_window = yes
	is_triggered_only = yes
	prisoner = no
	capable_only = yes
	ai = yes
	
	trigger = {		
		is_ruler = no
		trait = dragon_rider
		OR = {
			had_character_flag = { flag = mega_war_decision_cooldown days = 150 }
			NOT = { has_character_flag = mega_war_decision_cooldown }
		}
		OR = { #Initial choice event must have occured
			has_character_flag = supporting_king
			has_character_flag = neutral 
			has_character_flag = against_king 
		}
		liege = { 
			NOT = { has_character_flag = inherit_war } #Liege must not be deciding after inheriting
			OR = { #Liege must be part of the Iron Throne
				NOT = { has_character_flag = independant } 
				AND = {
					tier = EMPEROR
					trait = civil_war
				}
			}	
			OR = { #Liege must have decided their stance
				AND = {
					tier = EMPEROR
					trait = civil_war
				}
				has_character_flag = supporting_king
				has_character_flag = neutral 
				has_character_flag = against_king 
				trait = rebel_leader
			}
		}
	}
	
	immediate = { 
		#find rebel leader
		rebel_leader = {
			limit = { 
				is_alive = yes 
				is_ruler = yes				
				civil_war = {
					tier = EMPEROR
					war_with = PREV
					OR = {
						is_vassal_or_below = ROOT
						primary_title = {
							ROOT = {
								liege = {
									primary_title = {
										is_variable_equal = { which = "de_facto_empire" which = PREVPREVPREV } 
									}
								}	
							}
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
				}	
				ROOT = { #Vassal of rebel leader cannot defect to other rebel leaders
					liege = {
						OR = { #Vassal of rebel leader cannot defect to other rebel leaders
							NOT = { trait = rebel_leader }
							trait = civil_war
							character = PREVPREV
						}
					}
				}
				NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_deciding_rebel_leader } }
			}
			reverse_opinion = { who = ROOT modifier = opinion_deciding_rebel_leader months = 1 }
			character_event = { id = mega_wars.2192 } #set rebel leader as FROMFROM scope
			#If other potential rebel leader available repeat event
			if = {
				limit = {
					rebel_leader = {
						is_alive = yes 
						is_ruler = yes
						NOT = { character = PREV }
						civil_war = {
							tier = EMPEROR
							war_with = PREV
							OR = {
								is_vassal_or_below = ROOT
								primary_title = {
									ROOT = {
										liege = {
											primary_title = {
												is_variable_equal = { which = "de_facto_empire" which = PREVPREVPREV } 
											}
										}	
									}
									check_variable = { which = "de_facto_empire" value = 0.9 }
								}
							}
						}
						NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_deciding_rebel_leader } }						
					}
				}
				ROOT = { character_event = { id = mega_wars.2191 days = 2 } }
			}
		}	
	}
	
	option = {
		name = OK
	}	
}	
character_event = { #Rebel leader set as FROMFROM scope
	id = mega_wars.2192
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		civil_war = { #find correct emperor
			limit = {
				tier = EMPEROR
				is_alive = yes
				war_with = ROOT	
				OR = {
					is_vassal_or_below = FROM
					primary_title = {
						FROM = {
							liege = {
								primary_title = {
									is_variable_equal = { which = "de_facto_empire" which = PREVPREVPREV } 
								}
							}	
						}
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
			}
			character_event = { id = mega_wars.22 }			
		}
	}
	
	option = {
		name = OK
	}	
}
#Set emperor as FROM scope
character_event = { 
	id = mega_wars.22
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		FROM = { #check for erroneous civil_war trait
			if = {
				limit = { 
					trait = civil_war
					NOT = { tier = EMPEROR } 
				}
				remove_trait = civil_war
			}
		}
		FROMFROM = { 
			if = {
				limit = { tier = KING }
				character_event = { id = mega_wars.24 } 
				break = yes
			}
			#Lower tier than king
			character_event = { id = mega_wars.26 } 		
		}
	}
	
	option = {
		name = OK
	}	
}	
#On death vassal inherit control, set FROM scope to relevent emperor
character_event = {
	id = mega_wars.23
	desc = "EVTDESCmega_wars.23"
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		random_independent_ruler = {
			limit = {
				tier = EMPEROR
				any_demesne_title = {
					tier = EMPEROR
					ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
			}
			character_event = { id = mega_wars.22 }
		}
	}
	
	option = {
		name = OK
	}
}	
#King/LP tier character decides, FROM is emperor, FROMFROM is rebel leader
character_event = {
	id = mega_wars.24
	desc = "EVTDESCmega_wars.24"
	
	is_triggered_only = yes
	
	trigger = {
		#has_global_flag = westeros_civil_war
		tier = KING
		is_nomadic = no
		FROM = { war = yes }
		NOT = { war_with = FROM }
		OR = {
			independent = yes
			liege = { character = FROM }
		}	
		# OR = { #Republics are not split from Merchant Republics
			# liege = { character = ROOT }
			# liege = { is_merchant_republic = no }
			# is_republic = no
			# capital_scope = { NOT = { port = yes } }
		# }
		FROM = { primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } } }
	}
	
	immediate = { 
		if = {
			limit = { 
				liege = { 
					character = FROM 
					NOT = { character = ROOT }
				} 
			}
			##Copy slavery laws
			if = {
				limit = { crownlaw_title = { has_law = slavery_0 holder_scope = { character = FROM } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_0 }
					}
					add_law = slavery_0
				}
			}
			if = {
				limit = { crownlaw_title = { has_law = slavery_1 holder_scope = { character = FROM } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_1 }
					}
					add_law = slavery_1
				}
			}
			if = {
				limit = { crownlaw_title = { has_law = slavery_2 holder_scope = { character = FROM } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_2 }
					}
					add_law = slavery_2
				}
			}
			if = {
				limit = { crownlaw_title = { has_law = slavery_3 holder_scope = { character = FROM } } }
				any_demesne_title = {
					limit = { 
						tier = KING 
						NOT = { has_law = slavery_3 }
					}
					add_law = slavery_3
				}
			}
			###Set Empire Title Law 'Flag'###
			clr_character_flag = independant
			FROM = {
				reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 }
				set_mega_war_empire_variable_ROOT_effect = yes
			}
			any_demesne_title = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}
				}				
				set_variable = { which = "de_facto_kingdom" value = 0 }
			}
			if = {
				limit = { 
					NOT = { FROM = { regent = { character = PREVPREV } } } 
					NAND = {
						FROM = { government = triarch_merchant_republic_government }
						has_minor_title = title_triarch_for_life
					}
				}
				set_defacto_liege = THIS
			}
		}
		if = { #If granted LP reset mega war flags
			limit = {
				FROM = {
					NOT = { war_with = ROOT }
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_granted_kingdom
					}
				}
			}	
			clr_character_flag = against_king
			clr_character_flag = neutral
		}
		if = { #If King owes money set flag
			limit = {
				FROM = {
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_liege_loan
					}
				}
			}	
			set_character_flag = mega_war_liege_loan
		}
	}
	
	option = {
		name = "EVTOPTEmega_wars.7" #Regent, can choose not to fracture from realm
		trigger = {
			OR = {
				FROM = {
					has_regent = yes
					regent = { character = ROOT }
				}
				AND = {
					FROM = { government = triarch_merchant_republic_government }
					has_minor_title = title_triarch_for_life
				}
			}	
		}
		ai_chance = {
			factor = 500
			modifier = {
				factor = 10
				has_character_flag = supporting_king 	
			}
		}	
		if = {
			limit = {
				has_character_flag = against_king
				trait = honorable
			}
			remove_trait = honorable
		}
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		custom_tooltip = {
			text = TOOLTIPEVTOPTEmega_wars.7
		}
		FROM = {
			opinion = {
				modifier = opinion_loyal_to_crown
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				reverse_opinion = {
					modifier = opinion_with_king
					who = ROOT
					years = 100
				}
				letter_event = { id = mega_wars.34 }
			}
		}	
		FROMFROM = {
			if = {
				limit = {
					OR = {
						is_allied_with = ROOT	
						has_non_aggression_pact_with = ROOT
					}	
				}	
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}
			}	
		}	
		hidden_tooltip = {
			any_vassal = {
				limit = { NOT = { tier = BARON } }
				set_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king 
			}			
		}
	}	
	
	option = {
		name = "EVTOPTAmega_wars.7" #support the king
		trigger = {
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { trait = rebel_leader }
						host = { has_character_flag = against_king }
					}	
				}
			}
		}
		ai_chance = {
			factor = 40
			##additional mid war AI modifier##
			modifier = {
				factor = 0.5
				FROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					has_severe_disability_trigger = yes
				}
			}
			modifier = {
				factor = 2
				FROMFROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}	
			}
			modifier = {
				factor = 1.2
				FROMFROM = {
					has_severe_disability_trigger = yes
				}
			}
			##Warscore considerations
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 50
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 50
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 80
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 80
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
					}	
				}
			}
			###
			modifier = {
				factor = 2
				FROM = { has_landed_title = e_iron_throne }
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROM }
				}
			}
			modifier = { #If external threat highly likely to support
				factor = 4
				religion = FROM
				culture_group = FROM
				FROMFROM = {
					has_character_flag = independant
				}
			}
			modifier = { #Support for anti-piracy campaign
				factor = 5
				OR = {
					trait = just
					trait = diligent
					capital_scope = { port = yes }
				}
				NOR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #Support for 'selfless' wars
				factor = 3
				FROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = { #Support for 'selfless' wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = honorable
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = { #Support for 'anti slavery wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = zealous				
				}
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			
			modifier = {
				factor = 1.5
				OR = {
					is_married = FROM
					any_child = { character = FROM }
					father = { character = FROM }
					mother = { character = FROM }
					any_child = { any_child = { character = FROM } }#grandchild
				}	
			}
			modifier = {
				factor = 4
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
				}	
			}
			#allied with ally of king
			modifier = { 
				factor = 2.5
				any_allied_character = {
					is_ruler = yes
					has_opinion_modifier = { who = FROM modifier = opinion_with_king } 
					NOT = { trait = rebel_leader }
				}	
			}
			modifier = {
				factor = 1.3
				culture_group = FROM
			}
			modifier = {
				factor = 1.3
				religion = FROM
			}
			modifier = {
				factor = 0.8
				FROM = {
					trait = lunatic
					ROOT = {
						NOT = { trait = lunatic }
					}	
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROM = { trait = dragon_rider }
			}
			modifier = {
				factor = 6
				is_friend = FROM
			}
			modifier = {
				factor = 6
				is_rival = FROMFROM
			}
			modifier = {
				factor = 0.2
				is_rival = FROM
			}
			modifier = {
				factor = 0.2
				is_friend = FROMFROM
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROM value =  20 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROM value =  40 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  60 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  80 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  100 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  -20 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  -40 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -60 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -80 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -99 } }
			}
			#Mid war trait modifiers
			modifier = {
				factor = 0.1
				trait = honorable
				has_character_flag = against_king
			}
			modifier = {
				factor = 0.5
				trait = honest
				has_character_flag = against_king
			}
			modifier = {
				factor = 0.5
				trait = content
				has_character_flag = against_king
			}
			modifier = {
				factor = 1.5
				trait = ruthless
				has_character_flag = against_king
			}
			modifier = {
				factor = 1.25
				trait = deceitful
				has_character_flag = against_king
			}
			modifier = {
				factor = 1.25
				trait = ambitious
				has_character_flag = against_king
			}
			modifier = { #Don't want to support foreign pretender
				factor = 5
				FROM = {
					religion = ROOT
					culture_group = ROOT	
					any_demesne_title = { #One of the empire tier titles is being contested
						tier = EMPEROR
						any_war = {
							attacker = { 						
								character = ROOT_FROMFROM
								OR = {
									NOT = { religion_group = ROOT }
									NOT = { culture_group = ROOT }
									has_character_flag = independant
								}	
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}	
			}
			modifier = { #Never join if like rebel and have no relation to king
				factor = 0
				NOT = { is_allied_with = FROM }
				NOT = { has_non_aggression_pact_with = FROM }
				NOT = { opinion = { who = FROM value = 50 } }
				NOT = { is_close_relative = FROM }
				NOT = { is_married = FROM }
				NOT = { has_character_flag = supporting_king }
				FROMFROM = {
					reverse_opinion = { who = ROOT value = 50 }
					OR = {
						is_allied_with = ROOT
						has_non_aggression_pact_with = ROOT
						is_close_relative = ROOT
						is_married = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				has_character_flag = against_king
				trait = honorable
			}
			remove_trait = honorable
		}
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		hidden_tooltip = { set_defacto_liege = THIS }
		FROM = {
			if = {
				limit = {
					is_primary_war_defender = yes
					any_war = {
						attacker = { character = ROOT_FROMFROM }
						defender = { character = PREVPREV }
					}
				}
				ROOT = { join_defender_wars = PREV }
			}
			if = {
				limit = {
					is_primary_war_attacker = yes
					any_war = {
						defender = { character = ROOT_FROMFROM }
						attacker = { character = PREVPREV }
					}
				}
				ROOT = { join_attacker_wars = PREV }
			}	
			hidden_tooltip = { #failsafe
				ROOT = { 
					join_defender_wars = PREV 
					join_attacker_wars = PREV
					if = { #If failed, break and add a cooldown
						limit = {
							NOT = {
								any_war = {
									OR = {
										attacker = { character = ROOT_FROM }
										defender = { character = ROOT_FROM }
									}
								}
							}
						}
						clr_character_flag = mega_war_decision_cooldown
						set_character_flag = mega_war_decision_cooldown
						break = yes
					}
				}			
			}
			opinion = {
				modifier = opinion_loyal_to_crown
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				reverse_opinion = {
					modifier = opinion_with_king
					who = ROOT
					years = 100
				}
				letter_event = { id = mega_wars.34 }
			}
		}	
		FROMFROM = {
			if = {
				limit = {
					OR = {
						is_allied_with = ROOT	
						has_non_aggression_pact_with = ROOT
					}	
				}	
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}
			}	
		}	
		hidden_tooltip = {
			any_vassal = {
				limit = { NOT = { tier = BARON } }
				set_character_flag = supporting_king
				clr_character_flag = neutral 
				clr_character_flag = against_king 
			}			
		}	
	}
	option = {
		name = "EVTOPTBmega_wars.7" #remain neutral
		ai_chance = {
			factor = 300
			modifier = {
				factor = 1.2
				NOT = { age = 16 }
			}
			##Warscore considerations
			modifier = { 
				factor = 4
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}
						OR = {							
							defender = { character = ROOT_FROMFROM }
							attacker = { character = ROOT_FROMFROM }
						}	
						war_score = -40
						NOT = { war_score = 40 }
					}
				}
			}
			modifier = { 
				factor = 3
				FROM = { 
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}
						OR = {							
							defender = { character = ROOT_FROMFROM }
							attacker = { character = ROOT_FROMFROM }
						}	
						war_score = -40
						NOT = { war_score = 40 }
					}
				}
			}
			modifier = {
				factor = 2
				FROM = { has_landed_title = e_iron_throne }
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROM }
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROMFROM }
				}
			}
			
			modifier = { #against anti-piracy campaign
				factor = 5
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #against 'anti slavery wars
				factor = 5
				OR = {
					has_slavery_religion_trigger = yes
					has_slavery_culture_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			
			modifier = {
				factor = 1.2
				trait = patient
			}
			modifier = {
				factor = 0.8
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 0.8
				trait = brave
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 0.75
				trait = content
			}
			modifier = {
				factor = 2.5
				NOT = { religion_group = FROMFROM }
				NOT = { religion_group = FROM }
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROMFROM = {
					trait = dragon_rider
				}
				FROM = { trait = dragon_rider }	
			}
			modifier = {
				factor = 3.5
				NOT = { religion = FROMFROM }
				NOT = { religion = FROM }
			}
			modifier = {
				factor = 1.1
				NOT = { culture_group = FROMFROM }
				NOT = { culture_group = FROM }
			}
			modifier = {
				factor = 5
				is_friend = FROMFROM
				is_friend = FROM
			}
			modifier = {
				factor = 5
				is_rival = FROMFROM
				is_rival = FROM
			}
			modifier = {
				factor = 2.5
				NOT = { opinion = { who = FROM value =  -75 } } 
				NOT = { opinion = { who = FROMFROM value =  -75 } } 
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  -75 } 
				NOT = { opinion = { who = FROM value =  -50 } } 
				opinion = { who = FROMFROM value =  -75 }
				NOT = { opinion = { who = FROMFROM value =  -50 } } 
			}
			modifier = {
				factor = 1.75
				opinion = { who = FROM value =  -50 } 
				NOT = { opinion = { who = FROM value =  -25 } } 
				opinion = { who = FROMFROM value =  -50 }
				NOT = { opinion = { who = FROMFROM value =  -25 } } 
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value =  -25 } 
				NOT = { opinion = { who = FROM value =  0 } } 
				opinion = { who = FROMFROM value =  -25 }
				NOT = { opinion = { who = FROMFROM value =  0 } } 
			}
			modifier = {
				factor = 1.5
				opinion = { who = FROM value =  0 } 
				NOT = { opinion = { who = FROM value =  25 } } 
				opinion = { who = FROMFROM value =  0 }
				NOT = { opinion = { who = FROMFROM value =  25 } } 
			}
			modifier = {
				factor = 1.75
				opinion = { who = FROM value =  25 } 
				NOT = { opinion = { who = FROM value =  50 } } 
				opinion = { who = FROMFROM value =  25 }
				NOT = { opinion = { who = FROMFROM value =  50 } } 
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  50 } 
				NOT = { opinion = { who = FROM value =  75 } } 
				opinion = { who = FROMFROM value =  50 }
				NOT = { opinion = { who = FROMFROM value =  75 } } 
			}
			modifier = {
				factor = 2.5
				opinion = { who = FROM value =  75 } 
				opinion = { who = FROMFROM value =  75 }
			}		
		}
		set_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		hidden_tooltip = { set_defacto_liege = THIS }
		hidden_tooltip = {
			any_vassal = {
				limit = { NOT = { tier = BARON } }
				clr_character_flag = supporting_king
				set_character_flag = neutral 
				clr_character_flag = against_king 
			}
		}	
	}
	option = {
		name = "EVTOPTCmega_wars.7" #against the king
		trigger = { #only valid for certain CBs
			NAND = {
				prisoner = yes
				OR = {
					host = { character = FROM }
					host = { has_character_flag = supporting_king }
				}	
			}
			OR = {
				FROM = {
					any_demesne_title = {
						tier = EMPEROR
						any_war = {
							attacker = { 
								character = ROOT_FROMFROM
								NOT = { trait = white_walker }
							}
							NOR = {
								using_cb = bid_for_independence
								using_cb = cb_faction_independence
								using_cb = bid_for_independence_CW
								using_cb = bid_for_independence_ACOK
							}
						}
					}
				}
				ROOT_FROMFROM = {
					NOT = { trait = white_walker }
					any_war = {
						OR = {
							AND = {
								attacker = { character = FROM }
								OR = {
									using_cb = claim_on_vassal_plot
									using_cb = weaken_vassal_plot
								}	
							}
							AND = {	
								defender = { character = FROM }
								OR = {
									# AND = {	#have to be neighbours to join independance war
										# OR = {	
											# using_cb = bid_for_independence
											# using_cb = bid_for_independence_CW
											# using_cb = bid_for_independence_ACOK
										# }
										# defender = { character = FROM }
										# any_playable_ruler = {
											# OR = { 
												# character = PREVPREV
												# AND = {
													# tier = KING
													# has_character_flag = against_king 
													# has_opinion_modifier = { who = PREVPREV modifier = opinion_with_rebel_leader }		
												# }
											# }	
											# OR = {
												# tier = EMPEROR
												# tier = KING
											# }	
											# OR = {
												# any_realm_province = {
													# any_neighbor_province = {
														# any_province_lord = {
															# is_liege_or_above = ROOT
														# }
													# }
												# }
												# AND = {
													# has_landed_title = k_iron_isles
													# ROOT = {
														# OR = { 
															# has_landed_title =  k_north
															# has_landed_title =  k_riverlands
															# has_landed_title =  k_westerlands
															# has_landed_title =  k_reach
															# has_landed_title =  e_north
															# has_landed_title =  e_riverlands
															# has_landed_title =  e_westerlands
															# has_landed_title =  e_reach
														# }
													# }
												# }	
												# AND = {
													# ROOT = { has_landed_title = k_iron_isles }
													# OR = { 
														# has_landed_title =  k_north
														# has_landed_title =  k_riverlands
														# has_landed_title =  k_westerlands
														# has_landed_title =  k_reach
														# has_landed_title =  e_north
														# has_landed_title =  e_riverlands
														# has_landed_title =  e_westerlands
														# has_landed_title =  e_reach
													# }
												# }	
											# }
										# }	
									# }	
									using_cb = bid_for_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
									
									#using_cb = excommunicated_ruler		
									using_cb = depose_liege	
									using_cb = overthrow_ruler	
									using_cb = overthrow_ruler_no_calls				
									using_cb = claim_iron_throne_ACOK	
									#using_cb = cb_faction_unholy_king								
								}
							}
						}	
					}
				}
			}	
		}
		ai_chance = {
			factor = 40
			##additional mid war AI modifier##
			modifier = {
				factor = 40
				has_character_flag = inherit_war
				has_character_flag = against_king
			}
			modifier = {
				factor = 2
				FROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					has_severe_disability_trigger = yes
				}
			}
			modifier = {
				factor = 0.5
				FROMFROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}	
			}
			modifier = {
				factor = 0.8
				FROMFROM = {
					has_severe_disability_trigger = yes
				}
			}
			##Warscore considerations
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 50
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 50
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 80
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 80
						}
					}	
				}
			}
			###########
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROMFROM }
				}
			}
			modifier = { #close family
				factor = 5				
				OR = {
					is_child_of = FROMFROM
					is_married = FROMFROM
					any_child = { character = FROMFROM }
					any_child = { any_child = { character = FROMFROM } }
				}	
			}
			modifier = { #alliance
				factor = 4
				OR = {
					has_non_aggression_pact_with = FROMFROM
					is_allied_with = FROMFROM
				}	
			}
			##allied with ally of rebel leader
			modifier = { #close family
				factor = 2.5
				any_allied_character = {
					war_with = FROM
					is_ruler = yes
					has_opinion_modifier = {
						modifier = opinion_with_rebel_leader
						who = FROMFROM
					}
					NOT = { trait = rebel_leader }
				}	
			}
			modifier = {
				factor = 1.35
				culture_group = FROMFROM
			}
			modifier = {
				factor = 1.35
				religion = FROMFROM
			}
			modifier = {
				factor = 0.8
				NOT = { trait = lunatic }
				FROMFROM = {
					trait = lunatic
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROMFROM = {
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 6
				is_rival = FROM
			}
			modifier = {
				factor = 6
				is_friend = FROMFROM
			}
			modifier = {
				factor = 0.2
				is_friend = FROM
			}
			modifier = {
				factor = 0.2
				is_rival = FROMFROM
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value =  20 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 40 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 60 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 80 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 100 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = 0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -20 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -40 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -60 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -80 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROMFROM value = -99 } }
			}
			modifier = {
				factor = 0.75
				FROMFROM = {
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}	
			#Mid war trait modifiers
			modifier = {
				factor = 0.1
				trait = honorable
				has_character_flag = supporting_king
			}
			modifier = {
				factor = 0.5
				trait = honest
				has_character_flag = supporting_king
			}
			modifier = {
				factor = 0.5
				trait = content
				has_character_flag = supporting_king
			}
			modifier = {
				factor = 1.5
				trait = ruthless
				has_character_flag = supporting_king
			}
			modifier = {
				factor = 1.25
				trait = deceitful
				has_character_flag = supporting_king
			}
			modifier = {
				factor = 1.25
				trait = ambitious
				has_character_flag = supporting_king
			}
			
			# Fear Intimidation Factor
			modifier = {
				factor = 0.9
				FROM = { has_character_modifier = feared_1 }
			}
			modifier = {
				factor = 0.75
				FROM = { has_character_modifier = feared_2 }
			}
			modifier = {
				factor = 0.6
				FROM = { has_character_modifier = feared_3 }
			}
			modifier = {
				factor = 0.5
				FROM = { has_character_modifier = feared_4 }
			}
			modifier = {
				factor = 0.4
				FROM = { has_character_modifier = feared_5 }
			}
			modifier = {
				factor = 0.2
				trait = craven
				FROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			modifier = {
				factor = 1.25
				OR = {
					trait = brave 
					trait = dragon_rider
				}	
				FROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			##
			modifier = { #Never join if like king and have no relation to rebel
				factor = 0			
				OR = {
					opinion = { who = FROM value = 50 }
					is_close_relative = FROM
					is_married = FROM
				}
				FROMFROM = {
					NOT = { is_allied_with = ROOT }
					NOT = { has_non_aggression_pact_with = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 50 } }
					NOT = { is_close_relative = ROOT }
					NOT = { is_married = ROOT }
				}				
			}
		}
		set_character_flag = against_king
		clr_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = inherit_war
		hidden_tooltip = { set_defacto_liege = THIS }
		FROMFROM = {
			if = {
				limit = {
					is_primary_war_defender = yes
					any_war = {
						attacker = { character = ROOT_FROM }
						defender = { character = ROOT_FROMFROM }
					}
				}
				ROOT = { join_defender_wars = PREV }
			}
			if = {
				limit = {
					is_primary_war_attacker = yes
					any_war = {
						defender = { character = ROOT_FROM }
						attacker = { character = ROOT_FROMFROM }
					}
				}
				ROOT = { join_attacker_wars = PREV }
			}	
			hidden_tooltip = { #failsafe
				ROOT = { 
					join_defender_wars = PREV 
					join_attacker_wars = PREV
					if = { #If failed, break and add a cooldown
						limit = {
							NOT = {
								any_war = {
									OR = {
										attacker = { character = ROOT_FROMFROM }
										defender = { character = ROOT_FROMFROM }
									}
								}
							}
						}
						clr_character_flag = mega_war_decision_cooldown
						set_character_flag = mega_war_decision_cooldown
						break = yes
					}
				}			
			}
			opinion = {
				modifier = opinion_joined_cause
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				letter_event = { id = mega_wars.31 }
				reverse_opinion = {
					modifier = opinion_with_rebel_leader
					who = ROOT
					years = 100
				}
			}	
		}	
		# random_playable_ruler = {
			# limit = {
				# liege = { has_character_flag = rebel_leader }
			# }
			# liege = {
				# if = {
					# limit = {
						# is_primary_war_attacker = yes
					# }
					# ROOT = {
						# join_attacker_wars = PREV
					# }
				# }
				# if = {
					# limit = {
						# is_primary_war_defender = yes
					# }
					# ROOT = {
						# join_defender_wars = PREV
					# }
				# }
				# opinion = {
					# modifier = opinion_joined_cause
					# who = ROOT
					# years = 10
				# }
				# hidden_tooltip = {
					# letter_event = { id = mega_wars.30 }
				# }	
			# }	
		# }
		FROM = {
			opinion = {
				modifier = opinion_joined_rebellion
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				character_event = { id = mega_wars.32 }
			}
		}
		if = { 	
			limit = { 
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
				}	
			}
			FROM = {
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}
			}					
		}
		if = {
			limit = {
				FROMFROM = {
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}
			set_character_flag = joined_independance_war
		}
		hidden_tooltip = {	
			any_vassal = {
				limit = { NOT = { tier = BARON } }
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				set_character_flag = against_king 
			}
		}		
	}
	option = {
		name = "EVTOPTDmega_wars.7" #declare independance
		trigger = { ai = yes } #Humans can use the CB
		ai_chance = {
			factor = 5
			modifier = {
				factor = 10
				in_faction = faction_independence
			}	
			# Don't want independence if same culture or relative of liege
			modifier = {
				factor = 0
				NOT = { culture = dothraki }
				NOT = { culture = jogos_nhai }
				is_nomadic = no
				FROM = {
					OR = {
						culture = ROOT
						is_close_relative = ROOT
					}
				}
			}
			# Most culture groups dont mind being lorded by the same culture and religion group
			modifier = {
				factor = 0
				FROM = { 
					culture_group = ROOT 
					religion_group = ROOT
				}
				NOT = { culture_group = free_cities }
				NOT = { culture_group = sothoryos_islands }
				NOT = { in_faction = faction_independence }
				OR = { # If I'm king tier liege has to be very desirable
					NOT = { tier = KING }
					NOT = { relative_power = { who = FROM power = 1.1 } }
					FROM = { has_landed_title = e_iron_throne }
				}
			}
			#If Liege is High Valyrian and my religion that is acceptable
			modifier = {
				factor = 0
				NOT = { culture = dothraki }
				NOT = { culture = jogos_nhai }
				is_nomadic = no
				NOT = { in_faction = faction_independence }
				FROM = {
					culture = high_valyrian
					religion = ROOT
				}
			}
			#If I'm Dornish and liege is Andal and my religion that is acceptable
			modifier = {
				factor = 0
				culture_group = dornish
				NOT = { culture = rhoynar }
				NOT = { in_faction = faction_independence }
				FROM = {
					culture_group = andal
					religion = ROOT
				}
				OR = { # If I'm king tier liege has to be very desirable
					NOT = { tier = KING }
					NOT = { relative_power = { who = FROM power = 1.1 } }
					FROM = { has_landed_title = e_iron_throne }
				}
			}		
			modifier = {
				factor = 0
				NOT = { in_faction = faction_independence }
				FROM = { reverse_opinion = { who = ROOT value =  0 } }
			}
			
			modifier = { 
				factor = 0.5
				religion = FROM
				culture_group = FROM
				FROMFROM = {
					has_character_flag = independant
				}
			}
			modifier = {
				factor = 0.5
				trait = patient
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = craven
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 3
				trait = ambitious
			}
			modifier = {
				factor = 0
				trait = content
			}
			modifier = {
				factor = 0.05
				trait = honorable
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2.5
				NOT = { religion = FROMFROM }
				NOT = { religion = FROM }
			}
			modifier = {
				factor = 0.05
				NOT = { trait = dragon_rider }
				FROM = { trait = dragon_rider }
			}		
			modifier = {
				factor = 0.1
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 0
				trait = honorable
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 1.2
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -20 } }
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -40 } }
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -60 } }
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -80 } }
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					NOT = { reverse_opinion = { who = ROOT value =  -99 } }
				}
			}
		}
		set_character_flag = neutral
		set_character_flag = opportunist_independence
		clr_character_flag = supporting_king
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		hidden_tooltip = { set_defacto_liege = THIS }
		FROM = {	
			primary_title = {
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence_CW
				}			
			}
			hidden_tooltip = { letter_event = { id = mega_wars.35 days = 1 } }	
		}	
		#character_event = { id = mega_wars.42 days = 1 }
		if = {
			limit = {
				is_allied_with = FROMFROM	
			}	
			reverse_opinion = {
				modifier = broke_alliance
				who = FROMFROM
			}
		}	
		if = { 	
			limit = { 
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
				}	
			}
			FROM = {
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}
			}					
		}
		hidden_tooltip = {
			any_vassal = {
				limit = { NOT = { tier = BARON } }
				clr_character_flag = supporting_king
				clr_character_flag = neutral 
				set_character_flag = against_king 
			}
		}	
	}
}
#Vassal of LP/King initial response
letter_event = {
	id = mega_wars.25
	desc = "EVTDESCmega_wars.25"
	
	is_triggered_only = yes
	
	trigger = {
		#has_global_flag = westeros_civil_war
		OR = { 
			tier = DUKE
			tier = COUNT
			trait = dragon_rider
		}
		war = no
		OR = {
			is_patrician = no #dont break republic
			is_merchant_republic = yes
		}
		is_nomadic = no
		# OR = { #Republics are not split from Merchant Republics
			# liege = { character = ROOT }
			# liege = { is_merchant_republic = no }
			# is_republic = no
			# tier = COUNT
			# capital_scope = { NOT = { port = yes } }
		# }
		FROMFROM = {
			war = yes
		}
		NOT = { top_liege = { character = ROOT } }
		OR = {
			has_character_flag = inherit_war
			NOT = { 
				OR = {
					has_character_flag = supporting_king 
					has_character_flag = neutral 
					has_character_flag = against_king 
				}	
			}
		}
		OR = { #Cannot change sides if capital is occupied
			independent = yes
			is_ruler = no
			capital_holding = { controller = { character = ROOT } }
		}		
	}
		
	immediate = {
		set_character_flag = mega_war_decision_cooldown
		###Set Empire Title Law 'Flag'###
		clr_character_flag = independant
		if = {
			limit = { 
				is_ruler = yes
				OR = {
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } } #independent
					NOT = { #Make sure isnt actually part of another empire
						any_independent_ruler = {
							tier = EMPEROR
							NOT = { character = FROMFROM }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
							any_demesne_title = {
								tier = EMPEROR
								check_variable = { which = "de_facto_empire" value = 0.9 }
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							}
						}
					}
				}	
			}
			FROMFROM = {
				if = {
					limit = { tier = EMPEROR }
					set_mega_war_empire_variable_ROOT_effect = yes
				}	
			}
			any_demesne_title = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}
				}				
				set_variable = { which = "de_facto_kingdom" value = 0 }
			}
		}	
		if = { #Check Warden Status
			limit = { FROM = { FROM = { has_landed_title = e_iron_throne } }	}
			if = { #Warden of North
				limit = { 
					has_character_flag = warden_of_the_north
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROMFROM
						NOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } } #iron throne
						NOT = { liege_before_war = { character = FROMFROM } }
						capital_scope = { 
							region = world_westeros_north	
						}	
						any_war = { defender = { character = FROMFROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
			if = { #Warden of the East
				limit = { 
					has_character_flag = warden_of_the_east
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROMFROM
						NOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } } #iron throne
						NOT = { liege_before_war = { character = FROMFROM } }
						capital_scope = { 
							OR = {
								region = world_westeros_east
								AND = {
									NOT = { region = world_westeros }
									NOT = { region = world_summer_sea}
								}
							}	
						}	
						any_war = { defender = { character = FROMFROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
			if = { #Warden of the South
				limit = { 
					has_character_flag = warden_of_the_south
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROMFROM
						NOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } } #iron throne
						NOT = { liege_before_war = { character = FROMFROM } }
						capital_scope = { 
							OR = {
								region = world_westeros_south
								region = world_westerlands
								region = world_iron_isles
								region = world_summer_sea
							}	
						}	
						any_war = { defender = { character = FROMFROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
			if = { #Warden of the West
				limit = { 
					has_character_flag = warden_of_the_west
					rebel_leader = {
						is_alive = yes
						has_character_modifier = new_rebel_leader
						war_with = FROMFROM
						NOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } } #iron throne
						NOT = { liege_before_war = { character = FROMFROM } }
						capital_scope = { 
							region = world_westeros_west	
						}	
						any_war = { defender = { character = FROMFROM } }
					}
				}	
				set_character_flag = warden_called_to_arms	
			}
		}		
	}

	option = {
		name = "EVTOPTAmega_wars.25" #support the king
		trigger = {
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { trait = rebel_leader }
						host = { has_character_flag = against_king }
					}	
				}
			}
		}
		ai_chance = {
			factor = 2
			modifier = {
				factor = 5
				has_character_flag = warden_called_to_arms
			}
			modifier = {
				factor = 10
				has_character_flag = supporting_king 
			}
			modifier = {
				factor = 48
				OR = {
					FROM = { has_character_flag = supporting_king }
					FROM = { FROM = { character = PREV } }
				}
			}
			modifier = {
				factor = 3
				FROM = { FROM = { has_landed_title = e_iron_throne } }
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 3
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROMFROM }
				}
			}
			modifier = { #If external threat highly likely to support
				factor = 4
				religion = FROMFROM
				culture_group = FROMFROM
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					has_character_flag = independant
				}
			}
			modifier = { #Support for anti-piracy campaign
				factor = 5
				OR = {
					trait = just
					trait = diligent
					capital_scope = { port = yes }
				}
				NOR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROMFROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROMFROM }
					}
				}	
			}
			modifier = { #Support for 'selfless' wars
				factor = 3
				FROMFROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROMFROM }
					}
				}
			}
			modifier = { #Support for 'selfless' wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = honorable
				}
				FROMFROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROMFROM }
					}
				}
			}
			modifier = { #Support for 'anti slavery wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = zealous				
				}
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROMFROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROMFROM }
					}
				}
			}
			
			modifier = {
				factor = 1.5
				OR = {
					is_married = FROMFROM
					any_child = { character = FROMFROM }
					father = { character = FROMFROM }
					mother = { character = FROMFROM }
					any_child = { any_child = { character = FROMFROM } }#grandchild
				}	
			}
			modifier = {
				factor = 4
				OR = {
					is_allied_with = FROMFROM
					has_non_aggression_pact_with = FROMFROM
				}	
			}
			#allied with ally of king
			modifier = { #close family
				factor = 2.5
				any_allied_character = {
					has_opinion_modifier = { who = FROMFROM modifier = opinion_with_king } 
					NOT = { trait = rebel_leader }
				}	
			}
			modifier = {
				factor = 1.3	
				culture_group = FROMFROM
			}
			modifier = {
				factor = 1.3
				religion = FROMFROM
			}
			modifier = {
				factor = 0.8
				NOT = { trait = lunatic }
				FROM = {
					FROM = {
						trait = lunatic
					}	
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROM = {
					FROM = {
						trait = dragon_rider
					}	
				}
			}
			modifier = {
				factor = 6
				FROM = {
					FROM = {
						ROOT = {
							is_friend = PREV
						}
					}	
				}
			}
			modifier = {
				factor = 6
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						is_rival = PREV
					}
				}
			}
			modifier = {
				factor = 0.2
				FROM = {
					FROM = {
						ROOT = {
							is_rival = PREV
						}
					}	
				}
			}
			modifier = {
				factor = 0.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					is_friend = ROOT
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					FROM = {
						ROOT = {
							opinion = { who = PREV value =  20 }
						}
					}	
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					FROM = {
						ROOT = {
							opinion = { who = PREV value =  40 }
						}
					}	
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					FROM = {
						ROOT = {
							opinion = { who = PREV value =  60 }
						}
					}	
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					FROM = {
						ROOT = {
							opinion = { who = PREV value =  80 }
						}
					}	
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					FROM = {
						ROOT = {
							opinion = { who = PREV value =  100 }
						}
					}	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					FROM = {
						ROOT = {
							NOT = { opinion = { who = PREV value =  0 } }
						}
					}	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					FROM = {
						ROOT = {
							NOT = { opinion = { who = PREV value =  -20 } }
						}
					}	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					FROM = {
						ROOT = {
							NOT = { opinion = { who = PREV value =  -40 } }
						}
					}	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					FROM = {
						ROOT = {
							NOT = { opinion = { who = PREV value =  -60 } }
						}
					}	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					FROM = {
						ROOT = {
							NOT = { opinion = { who = PREV value =  -80 } }
						}
					}	
				}
			}
			modifier = {
				factor = 0.7
				FROM = {
					FROM = {
						ROOT = {
							NOT = { opinion = { who = PREV value =  -99 } }
						}
					}	
				}
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = supporting_king } 
				opinion = { who = FROM value =  20 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = supporting_king } 
				opinion = { who = FROM value =  40 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = supporting_king } 
				opinion = { who = FROM value =  60 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = supporting_king } 
				opinion = { who = FROM value =  80 } 
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = supporting_king } 
				NOT = { opinion = { who = FROM value =  0 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = supporting_king } 
				NOT = { opinion = { who = FROM value =  -20 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = supporting_king } 
				NOT = { opinion = { who = FROM value =  -40 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = supporting_king } 
				NOT = { opinion = { who = FROM value =  -60 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = supporting_king } 
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = supporting_king } 
				trait = content
			}
			modifier = { #Don't want to support foreign pretender
				factor = 5
				FROMFROM = {
					religion = ROOT
					culture_group = ROOT
					any_demesne_title = { #One of the empire tier titles is being contested
						tier = EMPEROR
						any_war = {
							attacker = { 						
								trait = rebel_leader
								has_character_modifier = new_rebel_leader
								war_with = ROOT_FROMFROM
								OR = {
									NOT = { religion_group = ROOT }
									NOT = { culture_group = ROOT }
									has_character_flag = independant	
								}	
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}
			}
			modifier = { #Never join if like rebel and have no relation to king
				factor = 0
				NOT = { is_allied_with = FROMFROM }
				NOT = { has_non_aggression_pact_with = FROMFROM }
				NOT = { opinion = { who = FROMFROM value = 50 } }
				NOT = { is_close_relative = FROMFROM }
				NOT = { is_married = FROMFROM }
				NOT = { has_character_flag = supporting_king }
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					reverse_opinion = { who = ROOT value = 50 }
					OR = {
						is_allied_with = ROOT
						has_non_aggression_pact_with = ROOT
						is_close_relative = ROOT
						is_married = ROOT
					}
				}
			}
		}
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		if = { 
			limit = { liege = { has_character_flag = against_king NOT = { trait = civil_war } } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}
			set_character_flag = against_rebel_liege
		}
		if = { 
			limit = { liege = { has_character_flag = neutral } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
		}
		if = { 
			limit = { liege = { has_character_flag = supporting_king } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
		}
		if = { 
			limit = { liege = { trait = civil_war } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
		}
		if = { 
			limit = { liege = { trait = rebel_leader NOT = { trait = civil_war } } }
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}
			set_character_flag = against_rebel_liege
		}
		if = { 
			limit = { 
				OR = {
					liege = { 
						NOT = { has_character_flag = supporting_king } 
						NOT = { trait = civil_war } 
					}
					has_character_flag = event_triggered_from_rebel_leader
					has_character_flag = warden_called_to_arms	
				}	
			}
			if = {
				limit = { is_ruler = yes }
				liege = {
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
				set_character_flag = mega_war_remove_leader
			}			
			hidden_tooltip = { 
				liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
				set_defacto_liege = ROOT 
			}
			if = { #Spawn small retinue for landless dragon rider
				limit = { 
					is_ruler = no 
					trait = dragon_rider
				}
				location = {
					FROMFROM = {
						ROOT = { move_character = PREV }
						spawn_unit = {
							province = PREV
							owner = THIS
							leader = ROOT
							disband_on_peace = yes
							troops = {
								archers = { 100 100 }
								heavy_infantry = { 320 320 }
								light_infantry = { 440 440 }	
								light_cavalry = { 80 80 }		
								knights = { 60 60 }					
							}
							attrition = 1.0
						}					
					}	
				}
			}
			FROM = {
				FROM = {
					if = {
						limit = {
							is_primary_war_defender = yes
							any_war = {
								attacker = { trait = rebel_leader }
								defender = { character = PREVPREV }
							}
						}
						ROOT = { join_defender_wars = PREV }
					}
					if = {
						limit = {
							is_primary_war_attacker = yes
							any_war = {
								defender = { trait = rebel_leader }
								attacker = { character = PREVPREV }
							}
						}
						ROOT = { join_attacker_wars = PREV }
					}	
					hidden_tooltip = { #failsafe
						ROOT = { 
							join_defender_wars = PREV 
							join_attacker_wars = PREV
							if = { #If failed, break and add a cooldown
								limit = {
									NOT = {
										any_war = {
											OR = {
												attacker = { character = ROOT_FROMFROM }
												defender = { character = ROOT_FROMFROM }
											}
										}
									}
								}
								clr_character_flag = event_triggered_from_rebel_leader 	
								clr_character_flag = mega_war_remove_leader
								clr_character_flag = warden_called_to_arms
								clr_character_flag = mega_war_decision_cooldown						
								set_character_flag = mega_war_decision_cooldown
								break = yes
							}
						}			
					}	
					opinion = {
						modifier = opinion_loyal_to_crown
						who = ROOT
						years = 10
					}
					hidden_tooltip = {
						reverse_opinion = {
							modifier = opinion_with_king
							who = ROOT
							years = 100
						}
						letter_event = { id = mega_wars.34 }
					}
				}	
			}
		}		
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROMFROM
				OR = {
					is_allied_with = ROOT	
					has_non_aggression_pact_with = ROOT
				}		
			}	
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}
		}		
		clr_character_flag = event_triggered_from_rebel_leader 	
		clr_character_flag = mega_war_remove_leader
		clr_character_flag = warden_called_to_arms
	}
	option = {
		name = "EVTOPTBmega_wars.7" #remain neutral
		trigger = { is_ruler = yes }
		ai_chance = {
			factor = 2
			modifier = {
				factor = 48
				FROM = { has_character_flag = neutral } 
			}
			modifier = {
				factor = 10
				has_character_flag = neutral
			}
			modifier = {
				factor = 2
				FROM = { FROM = { has_landed_title = e_iron_throne } }
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROMFROM }
				}
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { trait = rebel_leader  has_character_modifier = new_rebel_leader  war_with = FROMFROM }
				}
			}
			modifier = {
				factor = 48
				NOT = { FROM = { has_character_flag = neutral } }
				any_dynasty_member = {
					is_close_relative = ROOT
					OR = {
						host = { character = FROMFROM }
						host = { trait = rebel_leader  has_character_modifier = new_rebel_leader  war_with = FROMFROM }
					}	
				}
			}
			modifier = {
				factor = 1.2
				NOT = { age = 16 }
			}	
			modifier = { #against anti-piracy campaign
				factor = 5
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROMFROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROMFROM }
					}
				}	
			}
			modifier = { #against 'anti slavery wars
				factor = 5
				OR = {
					has_slavery_religion_trigger = yes
					has_slavery_culture_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROMFROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { has_character_modifier = new_rebel_leader }
						attacker = { character = ROOT_FROMFROM }
					}
				}
			}
			modifier = {
				factor = 1.2
				trait = patient
			}
			modifier = {
				factor = 0.8
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 0.8
				trait = brave
			}
			modifier = {
				factor = 3.5
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 0.75
				trait = content
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					trait = dragon_rider
				}
				FROM = {
					FROM = {
						trait = dragon_rider
					}	
				}
			}
			modifier = {
				factor = 2.5
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					NOT = { religion_group = ROOT }
				}
				FROM = {
					FROM = {
						NOT = { religion_group = ROOT }
					}	
				}
			}
			modifier = {
				factor = 3.5
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					NOT = { religion = ROOT }
				}
				FROM = {
					FROM = {
						NOT = { religion = ROOT }
					}	
				}
			}
			modifier = {
				factor = 1.1
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					NOT = { culture_group = ROOT }
				}
				FROM = {
					FROM = {
						NOT = { culture_group = ROOT }
					}	
				}
			}
			modifier = {
				factor = 5
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					any_friend = {
						character = ROOT
					}
				}
				FROM = {
					FROM = {
						any_friend = {
							character = ROOT
						}
					}	
				}
			}
			modifier = {
				factor = 5
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					any_rival = {
						character = ROOT
					}
				}
				FROM = {
					FROM = {
						any_rival = {
							character = ROOT
						}
					}	
				}
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = neutral } 
				opinion = { who = FROM value =  20 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = neutral } 
				opinion = { who = FROM value =  40 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = neutral } 
				opinion = { who = FROM value =  60 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = neutral } 
				opinion = { who = FROM value =  80 } 
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = neutral } 
				NOT = { opinion = { who = FROM value =  0 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = neutral } 
				NOT = { opinion = { who = FROM value =  -20 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = neutral } 
				NOT = { opinion = { who = FROM value =  -40 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = neutral } 
				NOT = { opinion = { who = FROM value =  -60 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = neutral } 
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = neutral } 
				trait = content
			}
		}
		if = { 
			limit = { liege = { has_character_flag = against_king } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
		}
		if = { 
			limit = { liege = { has_character_flag = supporting_king } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
		}	
		if = { 
			limit = { liege = { has_character_flag = neutral } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
		}
		if = { 
			limit = { liege = { trait = civil_war } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
		}
		if = { 
			limit = { liege = { trait = rebel_leader NOT = { trait = civil_war } } }
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
		}
		if = {
			limit = { has_character_flag = warden_called_to_arms	}
			custom_tooltip = { 
				text = TOOLTIPWARDENMEGAWARWARNING 
				hidden_tooltip = {
					any_playable_ruler = {
						limit = {
							OR = {
								is_liege_or_above = ROOT
								is_liege_or_above = FROMFROM
								primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } #iron throne
							}
						}
						opinion = { modifier = opinion_bad_warden who = ROOT years = 10 }
					}
				}
			}
			prestige = -400
			FROMFROM = {
				opinion = {
					modifier = opinion_warden_no_defend
					who = ROOT
					years = 10
				}
			}	
			clr_character_flag = warden_called_to_arms
		}
		if = { 
			limit = { 
				liege = { NOT = { has_character_flag = neutral } }
			}			
			liege = {
				opinion = {
					modifier = opinion_dithered
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					character_event = { id = mega_wars.33 }
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
			}
			set_character_flag = mega_war_remove_leader
			hidden_tooltip = { 
				liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
				set_defacto_liege = ROOT 
			}
		}	
		set_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		clr_character_flag = event_triggered_from_rebel_leader 
		clr_character_flag = mega_war_remove_leader
		rebel_leader = {
			limit = {
				is_alive = yes
				has_character_modifier = new_rebel_leader
				war_with = FROMFROM
				is_allied_with = ROOT	
			}	
			opinion = {
				modifier = broke_alliance
				who = ROOT
			}
		}	
		FROM = {
			FROM = {
				if = { 	
					limit = { 			
						is_allied_with = ROOT	
					}
					opinion = {
						modifier = broke_alliance
						who = ROOT
					}				
				}
			}
		}	
	}
	option = {
		name = "EVTOPTCmega_wars.7" #against the liege and king
		trigger = { #only valid for certain CBs
			NOT = { has_character_flag = inherit_war }
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { character = FROMFROM }
						host = { has_character_flag = supporting_king }
					}	
				}
			}
			OR = {
				liege = {
					NOT = { trait = civil_war }
					OR = {
						AND = {
							has_character_flag = rebel_leader 
							has_character_modifier = new_rebel_leader
							war_with = FROMFROM
						}	
						has_character_flag = against_king
					}	
				}
				FROMFROM = {
					NOT = { trait = white_walker }
					any_demesne_title = {
						tier = EMPEROR
						any_war = {
							attacker = { 
								trait = rebel_leader 
								character = ROOT_FROMFROM
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}	
				FROMFROM = {
					NOT = { trait = white_walker }
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}	
						OR = {
							AND = {
								defender = { 
									trait = rebel_leader 
									character = ROOT_FROMFROM
								}
								OR = {
									using_cb = claim_on_vassal_plot
									using_cb = weaken_vassal_plot
								}	
							}
							AND = {	
								attacker = { 
									trait = rebel_leader 
									character = ROOT_FROMFROM
								}
								OR = {
									#using_cb = excommunicated_ruler		
									using_cb = depose_liege	
									using_cb = overthrow_ruler	
									using_cb = overthrow_ruler_no_calls				
									using_cb = claim_iron_throne_ACOK	
									#using_cb = cb_faction_unholy_king								
								}
							}
						}							
					}
				}
			}	
		}
		ai_chance = {
			factor = 2
			modifier = {
				factor = 48
				OR = {
					FROM = { has_character_flag = against_king }
					has_character_flag = event_triggered_from_rebel_leader 
				}	
			}
			modifier = {
				factor = 2
				has_character_flag = against_king
			}
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { trait = rebel_leader  has_character_modifier = new_rebel_leader  war_with = FROMFROM }
				}
			}
			modifier = { #close family
				factor = 1.5
				OR = {
					father = { has_character_flag = rebel_leader has_character_modifier = new_rebel_leader war_with = FROMFROM }
					mother = { has_character_flag = rebel_leader has_character_modifier = new_rebel_leader war_with = FROMFROM }
					spouse = { has_character_flag = rebel_leader has_character_modifier = new_rebel_leader war_with = FROMFROM }
					any_child = { has_character_flag = rebel_leader has_character_modifier = new_rebel_leader war_with = FROMFROM }
					any_child = { any_child = { has_character_flag = rebel_leader has_character_modifier = new_rebel_leader war_with = FROMFROM } }
				}	
			}
			modifier = { #alliance
				factor = 4
				rebel_leader = { 
					has_character_modifier = new_rebel_leader 
					war_with = FROMFROM
					OR = {
						has_non_aggression_pact_with = ROOT
						is_allied_with = ROOT
					}	
				}		
			}
			#allied with ally of king
			modifier = { #close family
				factor = 3
				any_allied_character = {
					war_with = FROMFROM
					NOT = { trait = rebel_leader }
				}	
			}
			modifier = {
				factor = 1.35
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					culture_group = ROOT
				}
			}
			modifier = {
				factor = 1.35
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					religion = ROOT
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					trait = lunatic
					ROOT = {
						NOT = { trait = lunatic }
					}
				}
			}
			modifier = {
				factor = 6
				is_rival = FROMFROM
			}
			modifier = {
				factor = 6
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					is_friend = ROOT
				}
			}
			modifier = {
				factor = 0.2
				is_friend = FROMFROM
			}
			modifier = {
				factor = 0.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						is_rival = PREV
					}
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						opinion = { who = PREV value =  20 }
					}
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						opinion = { who = PREV value =  40 }
					}	
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						opinion = { who = PREV value =  60 }
					}
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						opinion = { who = PREV value =  80 }
					}
				}
			}
			modifier = {
				factor = 1.2
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						opinion = { who = PREV value =  100 }
					}
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						NOT = { opinion = { who = PREV value =  0 } }
					}
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						NOT = { opinion = { who = PREV value =  -20 } }
					}
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						NOT = { opinion = { who = PREV value =  -40 } }
					}
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						NOT = { opinion = { who = PREV value =  -60 } }
					}
				}
			}
			modifier = {
				factor = 0.8
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						NOT = { opinion = { who = PREV value =  -80 } }
					}
				}
			}
			modifier = {
				factor = 0.7
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					ROOT = {
						NOT = { opinion = { who = PREV value =  -99 } }
					}
				}
			}
			
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = against_king } 
				opinion = { who = FROM value =  20 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = against_king } 
				opinion = { who = FROM value =  40 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = against_king } 
				opinion = { who = FROM value =  60 } 
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = against_king } 
				opinion = { who = FROM value =  80 } 
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = against_king } 
				NOT = { opinion = { who = FROM value =  0 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = against_king } 
				NOT = { opinion = { who = FROM value =  -20 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = against_king } 
				NOT = { opinion = { who = FROM value =  -40 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = against_king }  
				NOT = { opinion = { who = FROM value =  -60 } }
			}
			modifier = {
				factor = 0.8
				FROM = { has_character_flag = against_king } 
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				FROM = { has_character_flag = against_king } 
				trait = content
			}
			modifier = {
				factor = 0.75
				rebel_leader = {
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}
			# Fear Intimidation Factor
			modifier = {
				factor = 0.9
				FROMFROM = { has_character_modifier = feared_1 }
			}
			modifier = {
				factor = 0.75
				FROMFROM = { has_character_modifier = feared_2 }
			}
			modifier = {
				factor = 0.6
				FROMFROM = { has_character_modifier = feared_3 }
			}
			modifier = {
				factor = 0.5
				FROMFROM = { has_character_modifier = feared_4 }
			}
			modifier = {
				factor = 0.4
				FROMFROM = { has_character_modifier = feared_5 }
			}
			modifier = {
				factor = 0.2
				trait = craven
				FROMFROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			modifier = {
				factor = 1.25
				OR = {
					trait = brave 
					trait = dragon_rider
				}	
				FROMFROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			##
			modifier = { #Never join if like king and have no relation to rebel
				factor = 0
				OR = {
					opinion = { who = FROMFROM value = 50 }
					is_close_relative = FROMFROM
					is_married = FROMFROM
				}
				rebel_leader = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					NOT = { is_allied_with = ROOT }
					NOT = { has_non_aggression_pact_with = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 50 } }
					NOT = { is_close_relative = ROOT }
					NOT = { is_married = ROOT }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_with_rebel_leader } }
				}				
			}
		}
		if = { 
			limit = { liege = { has_character_flag = supporting_king } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
			set_character_flag = against_loyal_liege
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }	
			}
		}	
		if = { 
			limit = { liege = { has_character_flag = neutral } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
		}	
		if = { 
			limit = { liege = { trait = civil_war } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
			set_character_flag = against_loyal_liege
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}		
			}
		}
		if = { 
			limit = { 
				NOT = { liege = { trait = civil_war } }
				OR = {
					liege = { trait = rebel_leader } 
					liege = { has_character_modifier = new_rebel_leader war_with = FROMFROM } 
					has_character_flag = event_triggered_from_rebel_leader
				}	
			}
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
		}
		if = { 
			limit = { liege = { has_character_flag = against_king } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
			liege = {
				opinion = {
					modifier = opinion_loyal_to_liege
					who = ROOT
					years = 5
				}
			}
		}
		if = {
			limit = { has_character_flag = warden_called_to_arms	}
			custom_tooltip = { 
				text = TOOLTIPWARDENMEGAWARWARNING 
				hidden_tooltip = {
					any_playable_ruler = {
						limit = {
							OR = {
								is_liege_or_above = ROOT
								is_liege_or_above = FROMFROM
								primary_title = { is_variable_equal = { which = "de_facto_empire" value = 1 } } #iron throne
							}
						}
						opinion = { modifier = opinion_bad_warden who = ROOT years = 10 }
					}
				}
			}
			prestige = -400
			FROMFROM = {
				opinion = {
					modifier = opinion_warden_no_defend
					who = ROOT
					years = 10
				}
			}	
			clr_character_flag = warden_called_to_arms
		}
		if = { 
			limit = { 
				NOT = { has_character_flag = event_triggered_from_rebel_leader }
				NOT = { 
					liege = { 
						OR = { 
							has_character_flag = against_king 
							has_character_modifier = new_rebel_leader 
							trait = rebel_leader
						}	
					}	
				} 
			}
			if = {
				limit = { is_ruler = yes }
				liege = {
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
				set_character_flag = mega_war_remove_leader
			}	
			hidden_tooltip = { 
				liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
				set_defacto_liege = ROOT 
			}
			if = { #Spawn small retinue for landless dragon rider
				limit = { 
					is_ruler = no 
					trait = dragon_rider
				}
				location = {
					rebel_leader = {
						limit = {
							has_character_modifier = new_rebel_leader 
							war_with = FROMFROM
						}
						ROOT = { move_character = PREV }
						spawn_unit = {
							province = PREV
							owner = THIS
							leader = ROOT
							disband_on_peace = yes
							troops = {
								archers = { 100 100 }
								heavy_infantry = { 320 320 }
								light_infantry = { 440 440 }	
								light_cavalry = { 80 80 }		
								knights = { 60 60 }					
							}
							attrition = 1.0
						}					
					}	
				}
			}
			rebel_leader = {
				limit = {
					is_alive = yes
					has_character_modifier = new_rebel_leader
					war_with = FROMFROM
				}
				if = {
					limit = {
						is_primary_war_defender = yes
						any_war = {
							attacker = { character = FROMFROM }
							defender = { character = PREVPREV }
						}
					}
					ROOT = { join_defender_wars = PREV }
				}
				if = {
					limit = {
						is_primary_war_attacker = yes
						any_war = {
							defender = { character = FROMFROM }
							attacker = { character = PREVPREV }
						}
					}
					ROOT = { join_attacker_wars = PREV }
				}	
				hidden_tooltip = { #failsafe
					ROOT = { 
						join_defender_wars = PREV 
						join_attacker_wars = PREV
						if = { #If failed, break and add a cooldown
							limit = {
								NOT = {
									any_war = {
										OR = {
											attacker = { has_character_modifier = new_rebel_leader }
											defender = { has_character_modifier = new_rebel_leader }
										}
									}
								}
							}
							clr_character_flag = event_triggered_from_rebel_leader
							clr_character_flag = mega_war_remove_leader	
							clr_character_flag = mega_war_decision_cooldown
							set_character_flag = mega_war_decision_cooldown
							break = yes
						}
					}			
				}
				opinion = {
					modifier = opinion_joined_cause
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					letter_event = { id = mega_wars.30 }
					reverse_opinion = {
						modifier = opinion_with_rebel_leader
						who = ROOT
						years = 100
					}
				}
			}
			FROMFROM = {
				hidden_tooltip = {
					character_event = { id = mega_wars.32 }
				}
			}
		}
		set_character_flag = against_king
		clr_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = event_triggered_from_rebel_leader
		clr_character_flag = mega_war_remove_leader		
		# random_playable_ruler = {
			# limit = {
				# liege = { has_character_flag = rebel_leader }
			# }
			# liege = {
				# if = {
					# limit = {
						# is_primary_war_attacker = yes
					# }
					# ROOT = {
						# join_attacker_wars = PREV
					# }
				# }
				# if = {
					# limit = {
						# is_primary_war_defender = yes
					# }
					# ROOT = {
						# join_defender_wars = PREV
					# }
				# }
				# opinion = {
					# modifier = opinion_joined_cause
					# who = ROOT
					# years = 10
				# }
				# hidden_tooltip = {
					# letter_event = { id = mega_wars.30 }
				# }	
			# }	
		# }
		FROM = {
			FROM = {
				if = { 	
					limit = { 			
						OR = {
							is_allied_with = ROOT	
							has_non_aggression_pact_with = ROOT
						}	
					}
					opinion = {
						modifier = broke_alliance
						who = ROOT
					}				
				}
			}
		}
		# if = {
			# limit = {
				# any_playable_ruler = {
					# liege = {
						# has_character_flag = rebel_leader
						# any_war = {
							# OR = {	
								# using_cb = bid_for_independence
								# using_cb = bid_for_independence_CW
							# }
						# }	
					# }	
				# }
			# }
			# set_character_flag = joined_independance_war
		# }	
	}
	option = {
		name = "EVTOPTmega_warsTOOLTIP" 	
		trigger = { ai = no }
		custom_tooltip = { text = EVTTOOLTIPmega_warsTOOLTIP }	
		hidden_tooltip = { repeat_event = { id = mega_wars.25 } }
	}
}
#Vassal of LP/King  inherit/yearly decision FROM is emperor, FROMFROM is rebel leader
character_event = {
	id = mega_wars.26
	desc = "EVTDESCmega_wars.24"
	
	is_triggered_only = yes
	
	trigger = {
		#has_global_flag = westeros_civil_war
		OR = { 
			tier = DUKE
			tier = COUNT
			trait = dragon_rider
		}
		OR = {
			is_patrician = no #dont break republic
			is_merchant_republic = yes
		}
		is_nomadic = no
		# OR = { #Republics are not split from Merchant Republics
			# liege = { character = ROOT }
			# liege = { is_merchant_republic = no }
			# is_republic = no
			# tier = COUNT
			# capital_scope = { NOT = { port = yes } }
		# }		
		FROM = { war = yes }
		OR = {
			NOT = { liege = { character = ROOT } }
			NOT = { war_with = FROM }
		}	
		FROM = { primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } } }
	}
	
	immediate = {
		###Set Empire Title Law 'Flag'###
		clr_character_flag = independant
		if = {
			limit = { 
				OR = {
					primary_title = { NOT = { check_variable = { which = "de_facto_empire" value = 1 } } } #independent
					NOT = { #Make sure isnt actually part of another empire
						any_independent_ruler = {
							tier = EMPEROR
							NOT = { character = FROM }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } 
							any_demesne_title = {
								tier = EMPEROR
								check_variable = { which = "de_facto_empire" value = 0.9 }
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							}
						}
					}
				}	
			}
			FROM = {
				set_mega_war_empire_variable_ROOT_effect = yes
			}
			any_demesne_title = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}
				}				
				set_variable = { which = "de_facto_kingdom" value = 0 }
			}
		}	
	}
		
	option = {
		name = "EVTOPTAmega_wars.25" #support the king
		trigger = {
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { trait = rebel_leader }
						host = { has_character_flag = against_king }
					}	
				}
			}
		}
		ai_chance = {
			factor = 2
			modifier = {
				factor = 10
				has_character_flag = supporting_king 
			}
			##additional mid war AI modifier##
			modifier = {
				factor = 0.5
				FROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}	
				}
			}
			modifier = {
				factor = 0.8
				FROM = {
					has_severe_disability_trigger = yes	
				}
			}
			modifier = {
				factor = 2
				FROMFROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}	
			}
			modifier = {
				factor = 1.2
				FROMFROM = {
					has_severe_disability_trigger = yes
				}
			}
			##Warscore considerations
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM  }
							war_score = 50
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 50
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 80
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							war_score = 80
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
					}	
				}
			}
			###
			modifier = { #liege is on the King's side
				factor = 20
				OR = {
					liege = { character = FROM }
					liege = { NOT = { character = ROOT } has_character_flag = supporting_king }
					any_playable_ruler = {
						tier = KING
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
						has_character_flag = supporting_king
					}
				}
			}
			modifier = {
				factor = 3
				has_landed_title = e_iron_throne
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 3
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROM }
				}
			}
			modifier = { #If external threat highly likely to support
				factor = 4
				religion = FROM
				culture_group = FROM
				FROMFROM = {
					has_character_flag = independant
				}
			}
			modifier = { #Support for anti-piracy campaign
				factor = 5
				OR = {
					trait = just
					trait = diligent
					capital_scope = { port = yes }
				}
				NOR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #Support for 'selfless' wars
				factor = 3
				FROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = { #Support for 'selfless' wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = honorable
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = restore_nightswatch
							using_cb = war_dawn
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = { #Support for 'anti slavery wars
				factor = 5
				OR = {
					trait = just
					trait = diligent
					trait = zealous				
				}
				OR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			
			modifier = {
				factor = 1.5
				OR = {
					is_married = FROM
					any_child = { character = FROM }
					father = { character = FROM }
					mother = { character = FROM }
					any_child = { any_child = { character = FROM } }#grandchild
				}	
			}
			modifier = {
				factor = 4
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
				}	
			}
			#allied with ally of king
			modifier = { #close family
				factor = 2.5
				any_allied_character = {
					has_opinion_modifier = { who = FROM modifier = opinion_with_king } 
					is_ruler = yes
					NOT = { trait = rebel_leader }
				}	
			}
			modifier = {
				factor = 1.3
				culture_group = FROM
			}
			modifier = {
				factor = 1.3
				religion = FROM
			}
			modifier = {
				factor = 0.8
				FROM = {
					trait = lunatic
					ROOT = {
						NOT = { trait = lunatic }
					}	
				}
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROM = { trait = dragon_rider }
			}
			modifier = {
				factor = 6
				is_friend = FROM
			}
			modifier = {
				factor = 6
				is_rival = FROMFROM
			}
			modifier = {
				factor = 0.2
				is_rival = FROM
			}
			modifier = {
				factor = 0.2
				is_friend = FROMFROM
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROM value =  20 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROM value =  40 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  60 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  80 }
			}
			modifier = {
				factor = 1.3
				opinion = { who = FROM value =  100 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  -20 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROM value =  -40 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -60 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -80 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROM value =  -99 } }
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  20 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  40 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  60 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  80 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  100 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  -20 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  -40 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
					reverse_opinion = { who = ROOT value =  -60 } 
				} 
			}
			modifier = {
				factor = 0.7
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
				} 
				trait = ambitious
			}
			modifier = {
				factor = 1.3
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = supporting_king 
				} 
				trait = content
			}
			modifier = { #Don't want to support foreign pretender
				factor = 5
				FROM = {
					religion = ROOT
					culture_group = ROOT
					any_demesne_title = { #One of the empire tier titles is being contested
						tier = EMPEROR
						any_war = {
							attacker = { 						
								character = ROOT_FROMFROM
								OR = {
									NOT = { religion_group = ROOT }
									NOT = { culture_group = ROOT }
									has_character_flag = independant
								}	
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}	
			}
			modifier = { #Never join if like rebel and have no relation to king
				factor = 0
				NOT = { is_allied_with = FROM }
				NOT = { has_non_aggression_pact_with = FROM }
				NOT = { opinion = { who = FROM value = 50 } }
				NOT = { is_close_relative = FROM }
				NOT = { is_married = FROM }
				NOT = { has_character_flag = supporting_king }
				FROMFROM = {
					reverse_opinion = { who = ROOT value = 50 }
					OR = {
						is_allied_with = ROOT
						has_non_aggression_pact_with = ROOT
						is_close_relative = ROOT
						is_married = ROOT
					}
				}
			}
		}
		if = { 
			limit = { liege = { has_character_flag = against_king NOT = { character = ROOT } NOT = { trait = civil_war } } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}
			set_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { has_character_flag = neutral  NOT = { character = ROOT }  } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { has_character_flag = supporting_king NOT = { character = ROOT } } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
			if = {
				limit = { has_character_flag = inherit_war }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}	
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { trait = civil_war } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
			if = {
				limit = { has_character_flag = inherit_war }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}	
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { trait = rebel_leader NOT = { trait = civil_war } } }
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}
			set_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { 
				independent = yes
				has_character_flag = against_rebel_liege
			}
			random_playable_ruler = {
				limit = {
					higher_tier_than = DUKE
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}

		}	
		if = { 
			limit = { 
				OR = {
					liege = { 
						NOT = { character = ROOT }
						NOT = { has_character_flag = supporting_king } 
						NOT = { character = FROM } 
					}
					independent = yes
				}	
			}
			if = {
				limit = { is_ruler = yes }
				liege = {
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
				set_character_flag = mega_war_remove_leader
			}	
			hidden_tooltip = { 
				liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
				set_defacto_liege = ROOT 
			}
			if = { #Spawn small retinue for landless dragon rider
				limit = { 
					is_ruler = no 
					trait = dragon_rider
				}
				location = {
					FROM = {
						ROOT = { move_character = PREV }
						spawn_unit = {
							province = PREV
							owner = THIS
							leader = ROOT
							disband_on_peace = yes
							troops = {
								archers = { 100 100 }
								heavy_infantry = { 320 320 }
								light_infantry = { 440 440 }	
								light_cavalry = { 80 80 }		
								knights = { 60 60 }					
							}
							attrition = 1.0
						}					
					}	
				}
			}
			FROM = {
				if = {
					limit = {
						is_primary_war_defender = yes
						any_war = {
							attacker = { character = ROOT_FROMFROM }
							defender = { character = PREVPREV }
						}
					}
					ROOT = { join_defender_wars = PREV }
				}
				if = {
					limit = {
						is_primary_war_attacker = yes
						any_war = {
							defender = { character = ROOT_FROMFROM }
							attacker = { character = PREVPREV }
						}
					}
					ROOT = { join_attacker_wars = PREV }
				}	
				hidden_tooltip = { #failsafe
					ROOT = { 
						join_defender_wars = PREV 
						join_attacker_wars = PREV
						if = { #If failed, break and add a cooldown
							limit = {
								NOT = {
									any_war = {
										OR = {
											attacker = { character = ROOT_FROM }
											defender = { character = ROOT_FROM }
										}
									}
								}
							}
							clr_character_flag = mega_war_remove_leader
							clr_character_flag = mega_war_decision_cooldown
							set_character_flag = mega_war_decision_cooldown
							break = yes
						}
					}			
				}	
				opinion = {
					modifier = opinion_loyal_to_crown
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					reverse_opinion = {
						modifier = opinion_with_king
						who = ROOT
						years = 100
					}
					letter_event = { id = mega_wars.34 }
				}
			}
		}		
		set_character_flag = supporting_king
		clr_character_flag = neutral 
		clr_character_flag = against_king 
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
		if = {
			limit = {
				OR = {
					is_allied_with = FROMFROM
					has_non_aggression_pact_with = FROMFROM
				}	
			}	
			reverse_opinion = {
				modifier = broke_alliance
				who = FROMFROM
			}
		}			
	}
	option = {
		name = "EVTOPTBmega_wars.7" #remain neutral
		trigger = {
			is_ruler = yes
			OR = {
				has_character_flag = inherit_war
				has_character_flag = neutral
				AND = {
					prisoner = yes
					host = { 
						OR = {
							character = FROM 
							has_character_flag = supporting_king 
							has_character_flag = against_king 
							has_character_flag = rebel_leader 
						}	
					}	
				}
			}
		}
		ai_chance = {
			factor = 2
			modifier = {
				factor = 10
				has_character_flag = neutral
			}
			modifier = { #liege is neutral
				factor = 20
				OR = {
					liege = { NOT = { character = ROOT } has_character_flag = neutral }
					any_playable_ruler = {
						tier = KING
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
						has_character_flag = neutral
					}
				}
			}
			##Warscore considerations
			modifier = { 
				factor = 4
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}
						OR = {							
							defender = { character = ROOT_FROMFROM }
							attacker = { character = ROOT_FROMFROM }
						}	
						war_score = -40
						NOT = { war_score = 40 }
					}
				}
			}
			modifier = { 
				factor = 3
				FROM = { 
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}
						OR = {							
							defender = { character = ROOT_FROMFROM }
							attacker = { character = ROOT_FROMFROM }
						}	
						war_score = -40
						NOT = { war_score = 40 }
					}
				}
			}
			modifier = {
				factor = 2
				FROM = { has_landed_title = e_iron_throne }
				any_dynasty_member = {
					is_close_relative = ROOT
					trait = kingsguard
				}
			}
			modifier = {
				factor = 10
				any_dynasty_member = {
					is_close_relative = ROOT
					OR = {
						host = { character = FROM }
						host = { character = FROMFROM  }
					}	
				}
			}
			modifier = {
				factor = 1.2
				NOT = { age = 16 }
			}	
			modifier = { #against anti-piracy campaign
				factor = 5
				OR = {
					government = pirate_government
					religion = lady_of_the_waves
					religion = drowned_god
					culture = ironborn
					trait = pirate
				}
				FROM = {
					any_war = {
						using_cb = anti_piracy
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}	
			}
			modifier = { #against 'anti slavery wars
				factor = 5
				OR = {
					has_slavery_religion_trigger = yes
					has_slavery_culture_trigger = yes
				}
				NOR = {
					has_antislavery_religion_trigger = yes
					has_antislavery_culture_trigger = yes
					trait = liberator
				}
				FROM = {
					any_war = {
						OR = {
							using_cb = war_of_emancipation
							using_cb = war_of_liberation
						}
						defender = { character = ROOT_FROMFROM }
						attacker = { character = ROOT_FROM }
					}
				}
			}
			modifier = {
				factor = 1.2
				trait = patient
			}
			modifier = {
				factor = 0.8
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 0.8
				trait = brave
			}
			modifier = {
				factor = 3.5
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 0.75
				trait = content
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROMFROM = {
					trait = dragon_rider
				}
				FROM = {
					trait = dragon_rider
				}	
			}
			modifier = {
				factor = 2.5
				NOT = { religion_group = FROMFROM }
				NOT = { religion_group = FROM }
			}
			modifier = {
				factor = 3.5
				NOT = { religion = FROMFROM }
				NOT = { religion = FROM }
			}
			modifier = {
				factor = 1.1
				NOT = { culture_group = FROMFROM }
				NOT = { culture_group = FROM }
			}
			modifier = {
				factor = 5
				is_friend = FROMFROM
				is_friend = FROM
			}
			modifier = {
				factor = 5
				is_rival = FROMFROM
				is_rival = FROM
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					reverse_opinion = { who = ROOT value =  20 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					reverse_opinion = { who = ROOT value =  40 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					reverse_opinion = { who = ROOT value =  60 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					reverse_opinion = { who = ROOT value =  80 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral 
					reverse_opinion = { who = ROOT value =  100 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					reverse_opinion = { who = ROOT value =  -20 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
					reverse_opinion = { who = ROOT value =  -40 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral 
					reverse_opinion = { who = ROOT value =  -60 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
				} 
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = neutral
				} 
				trait = content
			}
		}
		if = { 
			limit = { liege = { NOT = { character = ROOT } has_character_flag = against_king  } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { NOT = { character = ROOT } has_character_flag = supporting_king } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}	
		if = { 
			limit = { liege = { NOT = { character = ROOT } has_character_flag = neutral } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
			if = {
				limit = { has_character_flag = inherit_war }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}
		}
		if = { 
			limit = { liege = { NOT = { character = ROOT } trait = civil_war } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { NOT = { character = ROOT } trait = rebel_leader NOT = { trait = civil_war } } }
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { 
				independent = yes
				has_character_flag = inherit_war
			}
			random_playable_ruler = {
				limit = {
					higher_tier_than = DUKE
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
				}	
				opinion = { who = ROOT modifier = opinion_dithered years = 10 }
				hidden_tooltip = {
					character_event = { id = mega_wars.33 }
				}
			}
		}	
		if = { 
			limit = { 
				liege = { NOT = { character = ROOT } NOT = { has_character_flag = neutral } }
			}			
			liege = {
				opinion = {
					modifier = opinion_dithered
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					character_event = { id = mega_wars.33 }
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
			}
			set_character_flag = mega_war_remove_leader
			hidden_tooltip = { 
				liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
				set_defacto_liege = ROOT 
			}
		}	
		set_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = against_king 
		clr_character_flag = against_rebel_liege
		clr_character_flag = against_loyal_liege
		clr_character_flag = inherit_war
		clr_character_flag = mega_war_remove_leader
	}
	option = {
		name = "EVTOPTCmega_wars.7" #against the liege and king
		trigger = { #only valid for certain CBs
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { character = FROM }  
						host = { has_character_flag = supporting_king }
					}	
				}
			}
			OR = {
				liege = {
					trait = rebel_leader 
					NOT = { trait = civil_war }
					character = FROMFROM
				}
				liege = {
					has_character_flag = against_king 
					NOT = { trait = civil_war }
				}
				FROM = {
					any_demesne_title = {
						tier = EMPEROR
						any_war = {
							attacker = { 
								character = ROOT_FROMFROM
								NOT = { trait = white_walker }
							}
							NOT = {
								OR = {
									using_cb = bid_for_independence
									using_cb = cb_faction_independence
									using_cb = bid_for_independence_CW
									using_cb = bid_for_independence_ACOK
								}
							}
						}
					}
				}
				FROM = {
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}	
						OR = {
							AND = {
								defender = { 
									trait = rebel_leader 
									character = ROOT_FROMFROM
									NOT = { trait = white_walker }
								}
								OR = {
									using_cb = claim_on_vassal_plot
									using_cb = weaken_vassal_plot
								}	
							}
							AND = {	
								attacker = { 
									trait = rebel_leader 
									character = ROOT_FROMFROM
									NOT = { trait = white_walker }
								}
								OR = {
									#using_cb = excommunicated_ruler		
									using_cb = depose_liege	
									using_cb = overthrow_ruler	
									using_cb = overthrow_ruler_no_calls			
									using_cb = claim_iron_throne_ACOK	
									#using_cb = cb_faction_unholy_king								
								}
							}
						}							
					}
				}
			}	
		}
		ai_chance = {
			factor = 2
			modifier = { #liege is against king
				factor = 20
				OR = {
					liege = { NOT = { character = ROOT } 
						OR = { has_character_flag = against_king trait = rebel_leader }	
					}
					any_playable_ruler = {
						tier = KING
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
						OR = { has_character_flag = against_king trait = rebel_leader }
					}
				}
			}
			modifier = {
				factor = 10
				has_character_flag = against_king
			}
			##additional mid war AI modifier##
			modifier = {
				factor = 40
				has_character_flag = inherit_war
				has_character_flag = against_king
			}
			modifier = {
				factor = 2
				FROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					has_severe_disability_trigger = yes
				}	
			}
			modifier = {
				factor = 0.5
				FROMFROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}	
			}
			modifier = {
				factor = 0.8
				FROMFROM = {
					has_severe_disability_trigger = yes
				}
			}
			##Warscore considerations
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 50
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 50
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 80
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 80
						}
					}	
				}
			}
			###########
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROMFROM  }
				}
			}
			modifier = { #close family
				factor = 5
				OR = {
					is_child_of = FROMFROM
					is_married = FROMFROM
					any_child = { character = FROMFROM }
					any_child = { any_child = { character = FROMFROM } }
				}	
			}
			modifier = { #alliance
				factor = 4
				OR = {
					is_allied_with = FROMFROM		
					has_non_aggression_pact_with = FROMFROM
				}	
			}
			#allied with ally of king
			modifier = { #alliance
				factor = 2.5
				any_allied_character = {
					war_with = FROM
				}	
			}
			modifier = {
				factor = 1.35
				culture_group = FROMFROM
			}
			modifier = {
				factor = 1.35
				religion = FROMFROM
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROMFROM = {
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 0.8
				FROMFROM = {
					trait = lunatic
					ROOT = {
						NOT = { trait = lunatic }
					}
				}
			}
			modifier = {
				factor = 6
				is_rival = FROM
			}
			modifier = {
				factor = 6
				is_friend = FROMFROM
			}
			modifier = {
				factor = 0.2
				is_friend = FROM
			}
			modifier = {
				factor = 0.2
				is_rival = FROMFROM
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value =  20 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value =  40 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value =  60 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value =  80 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value =  100 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = 0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -20 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -40 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -60 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -80 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROMFROM value = -99 } }
			}
			
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  20 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  40 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  60 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  80 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  100 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  -20 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  -40 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king 
					reverse_opinion = { who = ROOT value =  -60 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
				} 
				trait = ambitious
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
				} 
				trait = content
			}
			modifier = {
				factor = 0.75
				FROMFROM = {
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}	
			# Fear Intimidation Factor
			modifier = {
				factor = 0.9
				FROM = { has_character_modifier = feared_1 }
			}
			modifier = {
				factor = 0.75
				FROM = { has_character_modifier = feared_2 }
			}
			modifier = {
				factor = 0.6
				FROM = { has_character_modifier = feared_3 }
			}
			modifier = {
				factor = 0.5
				FROM = { has_character_modifier = feared_4 }
			}
			modifier = {
				factor = 0.4
				FROM = { has_character_modifier = feared_5 }
			}
			modifier = {
				factor = 0.2
				trait = craven
				FROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			modifier = {
				factor = 1.25
				OR = {
					trait = brave 
					trait = dragon_rider
				}	
				FROM = { 
					OR = {
						has_character_modifier = feared_1
						has_character_modifier = feared_2
						has_character_modifier = feared_3
						has_character_modifier = feared_4
						has_character_modifier = feared_5 
					}	
				}
			}
			##
			modifier = { #Never join if like king and have no relation to rebel
				factor = 0	
				OR = {
					opinion = { who = FROM value = 50 }
					is_close_relative = FROM
					is_married = FROM
				}
				FROMFROM = {
					NOT = { is_allied_with = ROOT }
					NOT = { has_non_aggression_pact_with = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 50 } }
					NOT = { is_close_relative = ROOT }
					NOT = { is_married = ROOT }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_with_rebel_leader } }
				}				
			}
		}
		if = { 
			limit = { liege = { NOT = { character = ROOT } has_character_flag = supporting_king } }
			custom_tooltip = { text = TOOLTIP_liege_supporting_king }
			liege = {
				hidden_tooltip = {
					character_event = { id = mega_wars.36 }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}
			clr_character_flag = against_rebel_liege
			set_character_flag = against_loyal_liege
		}	
		if = { 
			limit = { liege = { NOT = { character = ROOT }  has_character_flag = neutral } }
			custom_tooltip = { text = TOOLTIP_liege_neutral }
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}	
		if = { 
			limit = { liege = { NOT = { character = ROOT }  character = FROM } }
			custom_tooltip = { text = TOOLTIP_liege_emperor }
			# liege = {
				# hidden_tooltip = {
					# character_event = { id = mega_wars.36 }
				# }	
			# }
			clr_character_flag = against_rebel_liege
			set_character_flag = against_loyal_liege
		}
		if = { 
			limit = { 
				liege = { 
					NOT = { character = ROOT } 
					NOT = { trait = civil_war }
					trait = rebel_leader  
					character = ROOT_FROMFROM
				} 
			}
			custom_tooltip = { text = TOOLTIP_liege_rebel_leader  }
			if = {
				limit = { has_character_flag = inherit_war }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { liege = { NOT = { character = ROOT } has_character_flag = against_king } }
			custom_tooltip = { text = TOOLTIP_liege_against_king }
			if = {
				limit = { has_character_flag = inherit_war }
				liege = {
					opinion = {
						modifier = opinion_loyal_to_liege
						who = ROOT
						years = 5
					}
				}
			}
			clr_character_flag = against_rebel_liege
			clr_character_flag = against_loyal_liege
		}
		if = { 
			limit = { 
				independent = yes
				has_character_flag = against_loyal_liege
			}
			random_playable_ruler = {
				limit = {
					higher_tier_than = DUKE
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege }
				}	
				opinion = { who = ROOT modifier = opinion_traitor }
			}
		}	
		if = { 
			limit = { 
				OR = {
					independent = yes	
					liege = { 
						OR = {
							character = ROOT
							trait = civil_war 
							NOR = { 
								has_character_flag = against_king 
								character = ROOT_FROMFROM
								trait = rebel_leader
							}
						}	
					}	
				}	
			}
			if = {
				limit = { is_ruler = yes }
				liege = {
					if = {
						limit = { higher_tier_than = DUKE }
						hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
					}
				}
				set_character_flag = mega_war_remove_leader
			}	
			hidden_tooltip = { 
				liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
				set_defacto_liege = ROOT 
			}
			if = { #Spawn small retinue for landless dragon rider
				limit = { 
					is_ruler = no 
					trait = dragon_rider
				}
				location = {
					FROMFROM = {
						ROOT = { move_character = PREV }
						spawn_unit = {
							province = PREV
							owner = THIS
							leader = ROOT
							disband_on_peace = yes
							troops = {
								archers = { 100 100 }
								heavy_infantry = { 320 320 }
								light_infantry = { 440 440 }	
								light_cavalry = { 80 80 }		
								knights = { 60 60 }					
							}
							attrition = 1.0
						}					
					}	
				}
			}
			ROOT_FROMFROM = {
				if = {
					limit = {
						is_primary_war_defender = yes
						any_war = {
							attacker = { character = FROM }
							defender = { character = PREVPREV }
						}
					}
					ROOT = { join_defender_wars = PREV }
				}
				if = {
					limit = {
						is_primary_war_attacker = yes
						any_war = {
							defender = { character = FROM }
							attacker = { character = PREVPREV }
						}
					}
					ROOT = { join_attacker_wars = PREV }
				}	
				hidden_tooltip = { #failsafe
					ROOT = { 
						join_defender_wars = PREV 
						join_attacker_wars = PREV
						if = { #If failed, break and add a cooldown
							limit = {
								NOT = {
									any_war = {
										OR = {
											attacker = { character = ROOT_FROMFROM }
											defender = { character = ROOT_FROMFROM }
										}
									}
								}
							}
							clr_character_flag = event_triggered_from_rebel_leader 
							clr_character_flag = mega_war_remove_leader	
							clr_character_flag = mega_war_decision_cooldown
							set_character_flag = mega_war_decision_cooldown
							break = yes
						}
					}			
				}	
				opinion = {
					modifier = opinion_joined_cause
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					letter_event = { id = mega_wars.30 }
					reverse_opinion = {
						modifier = opinion_with_rebel_leader
						who = ROOT
						years = 100
					}
				}	
			}
			FROM = {
				opinion = {
					modifier = opinion_joined_rebellion
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					character_event = { id = mega_wars.32 }
				}
			}
		}	
		set_character_flag = against_king
		clr_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = event_triggered_from_rebel_leader 
		clr_character_flag = mega_war_remove_leader		
		# random_playable_ruler = {
			# limit = {
				# liege = { has_character_flag = rebel_leader }
			# }
			# liege = {
				# if = {
					# limit = {
						# is_primary_war_attacker = yes
					# }
					# ROOT = {
						# join_attacker_wars = PREV
					# }
				# }
				# if = {
					# limit = {
						# is_primary_war_defender = yes
					# }
					# ROOT = {
						# join_defender_wars = PREV
					# }
				# }
				# opinion = {
					# modifier = opinion_joined_cause
					# who = ROOT
					# years = 10
				# }
				# hidden_tooltip = {
					# letter_event = { id = mega_wars.30 }
				# }	
			# }	
		# }
		FROM = {
			if = { 	
				limit = { 			
					OR = {
						is_allied_with = ROOT	
						has_non_aggression_pact_with = ROOT
					}	
				}
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}				
			}
		}
		# if = {
			# limit = {
				# any_playable_ruler = {
					# liege = {
						# has_character_flag = rebel_leader
						# any_war = {
							# OR = {	
								# using_cb = bid_for_independence
								# using_cb = bid_for_independence_CW
							# }
						# }	
					# }	
				# }
			# }
			# set_character_flag = joined_independance_war
		# }	
	}
	option = {
		name = "EVTOPTD999900937" #I prefer this rebel
		trigger = { #only valid for certain CBs
			NOT = {
				AND = {
					prisoner = yes
					OR = {
						host = { character = FROM }
						host = { has_character_flag = supporting_king }
					}	
				}
			}
			liege = {
				has_character_flag = against_king 
				FROMFROM = {
					trait = rebel_leader
					NOT = { reverse_has_opinion_modifier = { who = PREV modifier = opinion_with_rebel_leader } }
					NOT = { is_liege_of = ROOT }
					NOT = { trait = white_walker }
				}
			}
			OR = {
				FROM = {
					any_demesne_title = {
						tier = EMPEROR
						any_war = {
							attacker = { 
								trait = rebel_leader 
								character = ROOT_FROMFROM
							}
						}
					}
				}
				FROM = {
					any_war = {
						OR = {
							attacker = { character = PREVPREV }
							defender = { character = PREVPREV }
						}	
						attacker = { 
							has_character_flag = rebel_leader 
							character = ROOT_FROMFROM
						}	
						OR = {
							using_cb = claim_on_vassal_plot		
							#using_cb = excommunicated_ruler		
							using_cb = depose_liege	
							using_cb = overthrow_ruler	
							using_cb = overthrow_ruler_no_calls	
							using_cb = weaken_vassal_plot		
							using_cb = claim_iron_throne_ACOK	
						}						
					}
				}
				ROOT_FROMFROM = {
					any_war = {
						OR = {
							attacker = { character = FROM }
							defender = { character = FROM }
						}	
						OR = {
							using_cb = claim_on_vassal_plot		
							#using_cb = excommunicated_ruler		
							using_cb = depose_liege	
							using_cb = overthrow_ruler	
							using_cb = overthrow_ruler_no_calls	
							using_cb = weaken_vassal_plot		
							using_cb = claim_iron_throne_ACOK	
						}
					}
				}
			}	
		}
		ai_chance = {
			factor = 2
			##additional mid war AI modifier##
			modifier = {
				factor = 2
				FROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}
			}
			modifier = {
				factor = 1.2
				FROM = {
					has_severe_disability_trigger = yes
				}	
			}
			modifier = {
				factor = 0.5
				FROMFROM = {
					capital_holding = {
						controller = {
							NOT = { character = PREVPREV }
						}
					}
				}	
			}
			modifier = {
				factor = 0.8
				FROMFROM = {
					has_severe_disability_trigger = yes
				}
			}
			##Warscore considerations
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 50
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -50 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 50
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				has_character_flag = neutral
				OR = {
					trait = patient
					trait = ruthless
					trait = craven
					trait = ambitious
				}
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 80
						}
					}	
				}
			}
			modifier = { 
				factor = 1.5
				FROM = { 
					OR = {
						any_war = {
							attacker = { character = PREVPREV }						
							defender = { character = ROOT_FROMFROM }
							NOT = { war_score = -80 }
						}
						any_war = {
							defender = { character = PREVPREV }						
							attacker = { character = ROOT_FROMFROM }
							war_score = 80
						}
					}	
				}
			}
			###########
			modifier = {
				factor = 2
				any_dynasty_member = {
					is_close_relative = ROOT
					host = { character = FROMFROM  }
				}
			}
			modifier = { #close family
				factor = 1.5
				OR = {
					is_child_of = FROMFROM
					is_married = FROMFROM
					any_child = { character = FROMFROM }
					any_child = { any_child = { character = FROMFROM } }
				}	
			}
			modifier = { #alliance
				factor = 4
				OR = {
					is_allied_with = FROMFROM		
					has_non_aggression_pact_with = FROMFROM
				}	
			}
			modifier = {
				factor = 1.35
				culture_group = FROMFROM
			}
			modifier = {
				factor = 1.35
				religion = FROMFROM
			}
			modifier = {
				factor = 5
				NOT = { trait = dragon_rider }
				FROMFROM = {
					trait = dragon_rider
				}
			}
			modifier = {
				factor = 0.8
				FROMFROM = {
					trait = lunatic
					ROOT = {
						NOT = { trait = lunatic }
					}
				}
			}
			modifier = {
				factor = 6
				is_rival = FROM
			}
			modifier = {
				factor = 6
				is_friend = FROMFROM
			}
			modifier = {
				factor = 0.2
				is_friend = FROM
			}
			modifier = {
				factor = 0.2
				is_rival = FROMFROM
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 20 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 40 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 60 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 80 }
			}
			modifier = {
				factor = 1.2
				opinion = { who = FROMFROM value = 100 }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = 0 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -20 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -40 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -60 } }
			}
			modifier = {
				factor = 0.8
				NOT = { opinion = { who = FROMFROM value = -80 } }
			}
			modifier = {
				factor = 0.7
				NOT = { opinion = { who = FROMFROM value = -99 } }
			}
			
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  20 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  40 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  60 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  80 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  100 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					NOT = { reverse_opinion = { who = ROOT value =  0 } }
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  -20 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
					reverse_opinion = { who = ROOT value =  -40 } 
				} 
			}
			modifier = {
				factor = 1.2
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king 
					reverse_opinion = { who = ROOT value =  -60 } 
				} 
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
				} 
				trait = ambitious
			}
			modifier = {
				factor = 0.8
				liege = { 
					NOT = { character = ROOT } 
					has_character_flag = against_king
				} 
				trait = content
			}
			modifier = {
				factor = 0.75
				FROMFROM = {
					any_war = {
						OR = {	
							using_cb = bid_for_independence
							using_cb = bid_for_independence_CW
							using_cb = bid_for_independence_ACOK
						}
					}	
				}
			}
			modifier = { #Never join if like king and have no relation to rebel
				factor = 0	
				OR = {
					opinion = { who = FROM value = 50 }
					is_close_relative = FROM
					is_married = FROM
				}
				FROMFROM = {
					NOT = { is_allied_with = ROOT }
					NOT = { has_non_aggression_pact_with = ROOT }
					NOT = { reverse_opinion = { who = ROOT value = 50 } }
					NOT = { is_close_relative = ROOT }
					NOT = { is_married = ROOT }
					NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_with_rebel_leader } }
				}				
			}
		}
		liege = { 
			opinion = { who = ROOT modifier = opinion_traitor } 
			if = {
				limit = { tier = KING independent = no }
				liege = { opinion = { who = ROOT modifier = opinion_traitor } }
			}
			rebel_leader = {
				limit = { 
					reverse_has_opinion_modifier = { who = PREV modifier = opinion_with_rebel_leader } 
					PREV = { independent = yes }
				}
				opinion = { who = ROOT modifier = opinion_traitor } 
			}	
		}
		if = {
			limit = { is_ruler = yes }
			liege = {
				if = {
					limit = { higher_tier_than = DUKE }
					hidden_tooltip = { set_mega_war_kingdom_variable_ROOT_effect = yes }
				}
			}
		}	
		hidden_tooltip = { 
			liege = { reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 } }
			set_defacto_liege = ROOT 
		}
		if = { #Spawn small retinue for landless dragon rider
			limit = { 
				is_ruler = no 
				trait = dragon_rider
			}
			location = {
				FROMFROM = {
					ROOT = { move_character = PREV }
					spawn_unit = {
						province = PREV
						owner = THIS
						leader = ROOT
						disband_on_peace = yes
						troops = {
							archers = { 100 100 }
							heavy_infantry = { 320 320 }
							light_infantry = { 440 440 }	
							light_cavalry = { 80 80 }		
							knights = { 60 60 }					
						}
						attrition = 1.0
					}					
				}	
			}
		}
		FROM = {
			any_war = {
				if = { 
					limit = { 
						attacker = { character = ROOT_FROMFROM }
						defender = { character = PREVPREV }							
					}
					attacker = {
						ROOT = {
							join_attacker_wars = PREV
						}
						opinion = {
							modifier = opinion_joined_cause
							who = ROOT
							years = 10
						}
						hidden_tooltip = {
							letter_event = { id = mega_wars.30 }
							reverse_opinion = {
								modifier = opinion_with_rebel_leader
								who = ROOT
								years = 100
							}
						}	
					}
				}	
				if = { 
					limit = { 
						defender = { character = ROOT_FROMFROM }
						attacker = { character = PREVPREV }							
					}
					defender = {
						ROOT = {
							join_defender_wars = PREV
						}
						opinion = {
							modifier = opinion_joined_cause
							who = ROOT
							years = 10
						}
						hidden_tooltip = {
							letter_event = { id = mega_wars.30 }
							reverse_opinion = {
								modifier = opinion_with_rebel_leader
								who = ROOT
								years = 100
							}
						}	
					}
				}	
			}
			opinion = {
				modifier = opinion_joined_rebellion
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				character_event = { id = mega_wars.32 }
			}
		}
		set_character_flag = against_king
		clr_character_flag = neutral
		clr_character_flag = supporting_king
		clr_character_flag = event_triggered_from_rebel_leader 	
		# random_playable_ruler = {
			# limit = {
				# liege = { has_character_flag = rebel_leader }
			# }
			# liege = {
				# if = {
					# limit = {
						# is_primary_war_attacker = yes
					# }
					# ROOT = {
						# join_attacker_wars = PREV
					# }
				# }
				# if = {
					# limit = {
						# is_primary_war_defender = yes
					# }
					# ROOT = {
						# join_defender_wars = PREV
					# }
				# }
				# opinion = {
					# modifier = opinion_joined_cause
					# who = ROOT
					# years = 10
				# }
				# hidden_tooltip = {
					# letter_event = { id = mega_wars.30 }
				# }	
			# }	
		# }
		if = { 	
			limit = { 
				OR = {
					is_allied_with = FROM
					has_non_aggression_pact_with = FROM
				}	
			}	
			FROM = {
				opinion = {
					modifier = broke_alliance
					who = ROOT
				}
			}					
		}
		# if = {
			# limit = {
				# any_playable_ruler = {
					# liege = {
						# has_character_flag = rebel_leader
						# any_war = {
							# OR = {	
								# using_cb = bid_for_independence
								# using_cb = bid_for_independence_CW
							# }
						# }	
					# }	
				# }
			# }
			# set_character_flag = joined_independance_war
		# }	
	}
}

#Inform character events
#----------------------

#Inform rebel of partner (from war start)
letter_event = {
	id = mega_wars.30
	desc = "EVTDESCmega_wars.30"

	is_triggered_only = yes
	
	trigger = {
		OR = {
			NOT = { has_character_flag = mega_war_small_lord_i_dont_care }
			FROM = { higher_tier_than = DUKE }
		}
	}

	option = {
		name = "EVTOPTAmega_wars.30" #Yes			
	}
	
	option = {
		name = "EVTOPTAMEGAWARIDONTCARE" #Yes
		trigger = {
			ai = no
			FROM = { NOT = { higher_tier_than = DUKE } }
		}		
		set_character_flag = mega_war_small_lord_i_dont_care	
	}
}

#Inform rebel of partner (from character death)
letter_event = {
	id = mega_wars.31
	desc = "EVTDESCmega_wars.31"

	is_triggered_only = yes
	
	trigger = {
		OR = {
			NOT = { has_character_flag = mega_war_small_lord_i_dont_care }
			FROM = { higher_tier_than = DUKE }
		}
	}

	option = {
		name = "EVTOPTAmega_wars.30" #Yes			
	}
	
	option = {
		name = "EVTOPTAMEGAWARIDONTCARE" #Yes
		trigger = {
			ai = no
			FROM = { NOT = { higher_tier_than = DUKE } }
		}		
		set_character_flag = mega_war_small_lord_i_dont_care	
	}
}

#Inform king of new rebel
character_event = {
	id = mega_wars.32
	desc = "EVTDESCmega_wars.32"

	is_triggered_only = yes
	
	trigger = {
		OR = {
			NOT = { has_character_flag = mega_war_small_lord_i_dont_care }
			FROM = { higher_tier_than = DUKE }
		}
	}

	option = {
		name = "EVTOPTAmega_wars.32" #Yes			
	}
	
	option = {
		name = "EVTOPTAMEGAWARIDONTCARE" #Yes
		trigger = {
			ai = no
			FROM = { NOT = { higher_tier_than = DUKE } }
		}		
		set_character_flag = mega_war_small_lord_i_dont_care	
	}
}

#Inform king of neutral
character_event = {
	id = mega_wars.33
	desc = "EVTDESCmega_wars.33"

	is_triggered_only = yes
	notification = yes
	
	trigger = {
		OR = {
			NOT = { has_character_flag = mega_war_small_lord_i_dont_care }
			FROM = { higher_tier_than = DUKE }
		}
	}

	option = {
		name = "EVTOPTAmega_wars.33" #Yes			
	}
	
	option = {
		name = "EVTOPTAMEGAWARIDONTCARE" #Yes
		trigger = {
			ai = no
			FROM = { NOT = { higher_tier_than = DUKE } }
		}		
		set_character_flag = mega_war_small_lord_i_dont_care	
	}
}
#Inform king of support
letter_event = {
	id = mega_wars.34
	desc = "EVTDESCmega_wars.34"

	is_triggered_only = yes
	
	trigger = {
		OR = {
			NOT = { has_character_flag = mega_war_small_lord_i_dont_care }
			FROM = { higher_tier_than = DUKE }
		}
	}

	option = {
		name = "EVTOPTAmega_wars.34" #Yes			
	}
	
	option = {
		name = "EVTOPTAMEGAWARIDONTCARE" #Yes
		trigger = {
			ai = no
			FROM = { NOT = { higher_tier_than = DUKE } }
		}		
		set_character_flag = mega_war_small_lord_i_dont_care	
	}
}
#king informed of LP taking chance to break free
letter_event = {
	id = mega_wars.35
	desc = "EVTDESCmega_wars.35"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.35" #Yes		
	}
}
#Inform LP vassal supports kings rather than rebels
character_event = {
	id = mega_wars.36
	desc = "EVTDESCmega_wars.36"

	is_triggered_only = yes

	option = {
		name = "EVTOPTAmega_wars.36" #Yes			
	}
}

#Flag maintenance
#----------------------

#Call to arms accepted set flags
letter_event = {
	id = mega_wars.41

	is_triggered_only = yes

	trigger = {
		OR = {
			AND = {
				tier = EMPEROR
				trait = civil_war
			}	
			trait = rebel_leader
		}	
	}

	desc = "EVTDESC238"

	option = {
		name = "OK"
		hidden_tooltip = {
			if = {
				limit = {
					tier = EMPEROR
					trait = civil_war
					FROM = {
						OR = {
							primary_title = { 
								ROOT = { 
									any_demesne_title = {
										tier = EMPEROR
										is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
									}
								} 
							}
							is_liege_or_above = ROOT
						}
					}
				}
				FROM = {
					clr_character_flag = inherit_war
					clr_character_flag = neutral
					clr_character_flag = against_king
					set_character_flag = supporting_king
					opinion = {
						modifier = opinion_with_king
						who = PREV
						years = 100
					}
				}
				break = yes
			}
			if = {
				limit = {
					trait = rebel_leader
					war = yes
					any_current_enemy = { tier = EMPEROR }
					OR = {
						FROM = { primary_title = { ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } } }
						any_current_enemy = {
							tier = EMPEROR
							primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } }
							any_demesne_title = {
								tier = EMPEROR
								FROM = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } } 
							}
						}
					}
				}
				FROM = {
					clr_character_flag = inherit_war
					clr_character_flag = neutral
					clr_character_flag = supporting_king
					set_character_flag = against_king
					opinion = {
						modifier = opinion_with_rebel_leader
						who = PREV
						years = 100
					}
				}
			}
		}	
	}
}
# Maintain defacto opinion link with split vassal
character_event = {
	id = mega_wars.42
	desc = "EVTDESCmega_wars.42"
	
	hide_window = yes  ###FLAG### temp for testing
	only_independent = yes
	
	trigger = {
		NOT = { tier = EMPEROR }
		NOT = { culture_group = unoccupied_group }
		primary_title = { check_variable = { which = "de_facto_empire" value = 1 } }
		NOT = { 
			any_opinion_modifier_target = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } 
				higher_tier_than = DUKE
				higher_tier_than = ROOT
			} 
		}			
	}
	
	immediate = {
		random_independent_ruler = {
			limit = {
				tier = EMPEROR
				any_demesne_title = {
					tier = EMPEROR
					ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
			}
			reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 }			
		}
		if = {
			limit = { primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } }
			random_playable_ruler = {
				limit = {
					higher_tier_than = DUKE
					higher_tier_than = ROOT
					any_demesne_title = {
						higher_tier_than = DUKE
						check_variable = { which = "de_facto_kingdom" value = 0.9 }
						ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
					}
				}
				reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 }
			}
		}
		#if still no liege found they must be independent
		if = {
			limit = {
				NOT = { 
					any_opinion_modifier_target = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_de_facto_liege } 
						higher_tier_than = DUKE
						higher_tier_than = ROOT
					} 
				}
			}
			any_demesne_title = { 
				limit = { 
					NOT = { tier = BARON } 
					NOT = { tier = EMPEROR }
				}
				set_variable = { which = "de_facto_empire" value = 0 } 
			}
		}	
	}

	option = {
		name = "OK"	
	}
}
#Vassal of split vassal rebels, add defacto liege link to emperor
character_event = {
	id = mega_wars.4299
	
	hide_window = yes
	is_triggered_only = yes
	only_independent = yes
	
	trigger = {
		NOT = { tier = EMPEROR }
		FROM = { liege_before_war = { character = ROOT } }	
		primary_title = { check_variable = { which = "de_facto_empire" value = 0.9 } }
	}
	
	immediate = {
		primary_title = {
			FROM = {
				any_demesne_title = { 
					limit = { 
						NOT = { tier = EMPEROR }
						NOT = { tier = BARON } 
					}
					set_variable = { which = "de_facto_empire" which = PREVPREV } 
				}
				any_demesne_title = { 
					limit = { 
						lower_tier_than = KING
						NOT = { tier = BARON } 
					}
					set_variable = { which = "de_facto_kingdom" which = PREVPREV } 
				}
			}	
		}
		random_independent_ruler = {
			limit = {
				tier = EMPEROR
				any_demesne_title = {
					tier = EMPEROR
					ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
				NOT = { character = ROOT }
			}
			reverse_opinion = { who = FROM modifier = opinion_de_facto_liege years = 25 }			
		}
		if = {
			limit = { primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } }
			random_playable_ruler = {
				limit = {
					higher_tier_than = DUKE
					higher_tier_than = ROOT
					any_demesne_title = {
						higher_tier_than = DUKE
						check_variable = { which = "de_facto_kingdom" value = 0.9 }
						ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
					}
					NOT = { character = ROOT }	
				}
				reverse_opinion = { who = FROM modifier = opinion_de_facto_liege years = 25 }
			}
		}	
	}

	option = {
		name = "OK"	
	}
}
# #Flag maintenance
# character_event = {
	# id = mega_wars.43
	# desc = "EVTDESCmega_wars.43"
	
	# only_rulers = yes
	# hide_window = yes

	# trigger = {
		# OR = {
			# trait = rebel_leader
			# trait = civil_war
			# has_character_flag = neutral
			# has_character_flag = against_king
			# has_character_flag = supporting_king
		# }
		# OR = {
			# top_liege = {
				# NOT = { character = ROOT }
				# OR = {
					# AND = {
						# tier = EMPEROR
						# NOT = { trait = civil_war }
					# }	
					# NOT = {
						# OR = {
							# trait = rebel_leader
							# trait = civil_war
							# has_character_flag = inherit_war
							# has_character_flag = neutral
							# has_character_flag = against_king
							# has_character_flag = supporting_king					
						# }
					# }
				# }	
			# }
			# AND = {
				# tier = EMPEROR
				# trait = rebel_leader
				# NOT = { any_current_enemy = { tier = EMPEROR } }
			# }
		# }		
	# }
	
	# mean_time_to_happen = {
		# days = 30
	# }
	
	# immediate = {
		# clr_character_flag = supporting_king 
		# clr_character_flag = neutral
		# clr_character_flag = against_king 
		# clr_character_flag = rebel_leader		
		# clr_character_flag = independant
		# clr_character_flag = join_independance_asked
		# clr_character_flag = no_kingship
		# remove_trait = rebel_leader	
		# if = {
			# limit = { NOT = { tier = EMPEROR } }
			# remove_trait = civil_war
			# any_opinion_modifier_target = {
				# remove_opinion = { who = ROOT modifier = opinion_with_rebel_leader }		
				# remove_opinion = { who = ROOT modifier = opinion_with_king }	
				# remove_opinion = { who = ROOT modifier = opinion_de_facto_liege	}				
			# }	
			# any_demesne_title = { add_law = empire_none }
			# clr_character_flag = mega_war_decision_cooldown
		# }
	# }

	# option = {
		# name = "EVTOPTAmega_wars.43"	
	# }
# }
# on_create_title , reset defacto empire variables
character_event = {
	id = mega_wars.44
	
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = { NOT = { tier = EMPEROR } }
	}
	
	immediate = {
		FROM = { set_variable = { which = "de_facto_empire" value = 0 } }
	}

	option = {
		name = "OK"	
	}
}
#Independence Events
#----------------------
#Character wins indep war maintenance
character_event = {
	id = mega_wars.50
	desc = "EVTDESCmega_wars.50"
	
	trigger = {
		is_ruler = yes		
		liege = { character = ROOT }
	}

	is_triggered_only = yes
	#hide_window = yes
	
	immediate = {
		clr_character_flag = supporting_king 
		clr_character_flag = neutral
		clr_character_flag = against_king 		
		clr_character_flag = join_independance_asked
		clr_character_flag = no_kingship
		clr_character_flag = mega_war_decision_cooldown
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = must_decide
		clr_character_flag = post_civil_war_indep_war
		if = {
			limit = { war = no }
			clr_character_flag = rebel_leader
			hidden_tooltip = { remove_trait = rebel_leader }
			clr_character_flag = independant		
		}		
		hidden_tooltip = { 
			any_demesne_title = {
				clr_title_flag = indep_war
			}
			any_demesne_title = { 
				limit = { 
					NOT = { tier = EMPEROR }
					NOT = { tier = BARON } 
				}
				set_variable = { which = "de_facto_empire" value = 0 } 
			}
			any_realm_lord = { 
				any_demesne_title = { 
					limit = {
						NOT = { tier = EMPEROR }
						NOT = { tier = BARON } 
					}
					set_variable = { which = "de_facto_empire" value = 0 } 
				}
				clr_character_flag = supporting_king 
				clr_character_flag = neutral
				clr_character_flag = against_king 
			}
			if = {
				limit = { higher_tier_than = DUKE }
				any_demesne_title = {
					limit = {
						tier = KING
						is_variable_equal = { which = "lord_paramount_status" value = 1 } #1 = lord paramount, 2 = interregnum
					}	
					hidden_tooltip = { set_variable = { which = "lord_paramount_status" value = 0 } }
				}
				if = {
					limit = { government = feudal_government_LP }
					set_government_type = feudal_government
				}
				any_independent_ruler = { #Re-vassalise any lords split via mega-war
					limit = {						
						primary_title = {
							ROOT = {
								any_demesne_title = {
									OR = {
										AND = {
											tier = EMPEROR
											check_variable = { which = "de_facto_empire" value = 0.9 }
											is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
										}	
										AND = {
											higher_tier_than = DUKE
											check_variable = { which = "de_facto_kingdom" value = 1 }
											is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV }
										}	
									}
								}
							}
						}
						lower_tier_than = ROOT
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_granted_independence } }
					}
					set_defacto_liege = ROOT
					remove_opinion = { who = ROOT modifier = opinion_de_facto_liege }
					any_demesne_title = { 
						limit = { 
							NOT = { tier = BARON } 
							NOT = { tier = EMPEROR }
						}
						set_variable = { which = "de_facto_empire" value = 0 } 
					}
					clr_character_flag = supporting_king 
					clr_character_flag = neutral
					clr_character_flag = against_king 
				}
			}	
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.34" #Yes	
	}	
}
#A Lord that wins independance from LP/King during civil chooses whether to swear fealty to Emperor (triggered from indep CB in cb_types)
character_event = {
	id = mega_wars.51
	desc = "EVTDESCmega_wars.51"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.51" #Yes	
		ai_chance = { factor = 100 }
		random_independent_ruler = {
			limit = {
				tier = EMPEROR
				any_demesne_title = {
					tier = EMPEROR
					ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
					check_variable = { which = "de_facto_empire" value = 0.9 }
				}
			}
			if = {
				limit = { war = no }
				ROOT = { set_defacto_liege = PREV }
			}	
			if = {
				limit = { war = yes }
				ROOT = {
					set_character_flag = supporting_king
					clr_character_flag = neutral 
					clr_character_flag = against_king 
					clr_character_flag = inherit_war
					clr_character_flag = mega_war_remove_leader
					clr_character_flag = warden_called_to_arms					
				}
				hidden_tooltip = {
					reverse_opinion = {
						modifier = opinion_with_king
						who = ROOT
						years = 100
					}
				}
				if = {
					limit = {
						is_primary_war_defender = yes
						any_war = {
							attacker = { trait = rebel_leader }
							defender = { character = PREVPREV }
						}
					}
					ROOT = { join_defender_wars = PREV }
				}
				if = {
					limit = {
						is_primary_war_attacker = yes
						any_war = {
							defender = { trait = rebel_leader }
							attacker = { character = PREVPREV }
						}
					}
					ROOT = { join_attacker_wars = PREV }
				}
				hidden_tooltip = { #failsafe
					ROOT = { 
						join_defender_wars = PREV 
						join_attacker_wars = PREV
						if = { #If failed, break and add a cooldown
							limit = {
								NOT = {
									any_war = {
										OR = {
											attacker = { character = PREVPREVPREV }
											defender = { character = PREVPREVPREV }
										}
									}
								}
							}
							clr_character_flag = mega_war_decision_cooldown
							set_character_flag = mega_war_decision_cooldown
							break = yes
						}
					}			
				}
			}	
		}		
	}
	option = {
		name = "EVTOPTBmega_wars.51" #No	
		ai_chance = { factor = 0 }		
		hidden_tooltip = { 
			any_demesne_title = { 
				limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
				set_variable = { which = "de_facto_empire" value = 0 } 
			}
		}
	}
}

#Character loses dejure kingdom war against King, assign flag to revassalise (from cb_types)
character_event = {
	id = mega_wars.52
	desc = "EVTDESCmega_wars.52"
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		FROM = {
			if = {
				limit = { NOT = { trait = civil_war } } 
				ROOT = { set_defacto_liege = PREV }
			}
			if = {
				limit = { trait = civil_war } 	
				set_mega_war_empire_variable_ROOT_effect = yes
			}
		}	
		any_demesne_title = {
			limit = { 
				OR = {
					tier = COUNT
					tier = DUKE
				}
			}				
			set_variable = { which = "de_facto_kingdom" value = 0 }
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.52" #Yes	
	}
}
# Indep War Victory Ally Maintenance
character_event = {
	id = mega_wars.53
	desc = "EVTDESCmega_wars.53"
	
	is_triggered_only = yes
	
	trigger = {
		FROM = { tier = EMPEROR }
		OR = {
			has_character_flag = against_king
			has_character_flag = neutral
			has_character_flag = supporting_king
			any_liege = { tier = EMPEROR }
		}
		NOT = { tier = EMPEROR }	
	}
	
	immediate = {
		if = {
			limit = {
				FROM = { 	
					OR = {
						any_realm_province = {
							any_neighbor_province = {
								any_province_lord = {
									OR = {
										character = ROOT
										is_liege_or_above = ROOT
										liege_before_war = { character = ROOT }
									}	
								}
							}
						}	
						AND = {
							ROOT = { has_landed_title = k_riverlands }
							OR = { 
								has_landed_title =  k_north
								has_landed_title =  k_vale
								has_landed_title =  e_north
								has_landed_title =  e_vale
							}
						}
						AND = {
							has_landed_title = e_iron_isles
							ROOT = {
								OR = { 
									has_landed_title =  k_north
									has_landed_title =  k_riverlands
									has_landed_title =  k_westerlands
									has_landed_title =  k_reach
									has_landed_title =  e_north
									has_landed_title =  e_riverlands
									has_landed_title =  e_westerlands
									has_landed_title =  e_reach
								}
							}
						}	
						AND = {
							ROOT = { has_landed_title = k_iron_isles }
							OR = { 
								has_landed_title =  k_north
								has_landed_title =  k_riverlands
								has_landed_title =  k_westerlands
								has_landed_title =  k_reach
								has_landed_title =  e_north
								has_landed_title =  e_riverlands
								has_landed_title =  e_westerlands
								has_landed_title =  e_reach
							}
						}	
					}
				}
			}
			set_character_flag = swear_fealty
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.53" #Swear Fealty to new King
		trigger = { 
			has_character_flag = swear_fealty 
			war = no
		}		
		set_defacto_liege = FROM
		clr_character_flag = swear_fealty
		hidden_tooltip = {
			FROM = {
				set_mega_war_empire_variable_ROOT_effect = yes		
			}
			any_demesne_title = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}
				}				
				set_variable = { which = "de_facto_kingdom" value = 0 }
			}
			primary_title = {
				ROOT = {
					any_realm_lord = {
						any_demesne_title = {
							limit = { 
								NOT = { tier = BARON } 
								NOT = { tier = EMPEROR }
							}				
							set_variable = { which = "de_facto_empire" which = PREVPREVPREV } 
						}
					}
				}	
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_north } }
			}
			any_demesne_title = { 
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_north
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_riverlands } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_riverlands
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_vale } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_vale
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_westerlands } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_westerlands
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_stormlands }	}
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_stormlands
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_reach } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_reach
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_dorne }	}							
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_dorne
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_iron_isles } }								
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_iron_isles
			}
		}
		hidden_tooltip = {
			clr_character_flag = joined_independance_war
			clr_character_flag = post_civil_war_wars
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			clr_character_flag = mega_war_liege_loan
			remove_opinion = { who = FROM modifier = opinion_with_rebel_leader }			
		}	
	}
	
	option = {
		name = "EVTOPTBmega_wars.53" #Yes	
		trigger = { 
			has_character_flag = swear_fealty
			war = yes			
		}
		clr_character_flag = swear_fealty
		hidden_tooltip = {
			FROM = {
				set_mega_war_empire_variable_ROOT_effect = yes		
			}
			any_demesne_title = {
				limit = { 
					OR = {
						tier = COUNT
						tier = DUKE
					}
				}				
				set_variable = { which = "de_facto_kingdom" value = 0 }
			}
			primary_title = {
				ROOT = {
					any_realm_lord = {
						any_demesne_title = {
							limit = { 
								NOT = { tier = BARON } 
								NOT = { tier = EMPEROR }
							}				
							set_variable = { which = "de_facto_empire" which = PREVPREVPREV } 
						}
					}
				}	
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_north } }
			}
			any_demesne_title = { 
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_north
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_riverlands } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_riverlands
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_vale } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_vale
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_westerlands } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_westerlands
			}	
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_stormlands }	}
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_stormlands
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_reach } }
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_reach
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_dorne }	}							
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_dorne
			}
		}
		if = {
			limit = {
				FROM = { primary_title = { title = e_iron_isles } }								
			}
			any_demesne_title = {
				limit = { 
					tier = KING 
					NOT = {
						dejure_liege_title = {
							OR = {
								always = no
								AND = {
									NOT = { capital_scope = { region = world_westeros } }
									NOT = { title = e_iron_isles }#These titles dont have capitals
									NOT = { title = e_riverlands }
								}
							}
						}
					}
				}
				de_jure_liege = e_iron_isles
			}
		}
		set_character_flag = post_civil_war_wars
		clr_character_flag = joined_independance_war
		any_war = {
			limit = { 	using_cb = bid_for_independence
						defender = { character = PREV }
			}
			attacker = { set_character_flag = 	post_civil_war_indep_war }
		}	
		hidden_tooltip = {
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			clr_character_flag = mega_war_liege_loan
			remove_opinion = { who = FROM modifier = opinion_with_rebel_leader }			
		}
	}
	
	option = {
		name = "EVTOPTCmega_wars.53" #Declare Independence
		trigger = { NOT = { has_character_flag = swear_fealty } }	
		set_defacto_liege = ROOT
		hidden_tooltip = {
			add_character_modifier = {
				name = "indep_faction_won"
				duration = 10
			}
			clr_character_flag = joined_independance_war
			clr_character_flag = post_civil_war_wars
			clr_character_flag = supporting_king 
			clr_character_flag = neutral
			clr_character_flag = against_king 
			clr_character_flag = rebel_leader
			clr_character_flag = independant
			clr_character_flag = join_independance_asked
			clr_character_flag = no_kingship
			remove_trait = rebel_leader
			clr_character_flag = mega_war_decision_cooldown
			clr_character_flag = mega_war_liege_loan
			remove_opinion = { who = FROM modifier = opinion_with_rebel_leader }
			
			any_demesne_title = { 
				limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
				set_variable = { which = "de_facto_empire" value = 0 } 
			}	
			any_realm_lord = { 
				any_demesne_title = { 
					limit = { NOT = { tier = BARON } NOT = { tier = EMPEROR } }
					set_variable = { which = "de_facto_empire" value = 0 } 
				}
			}			
		}	
	}
}
#Small AI lords in successful independence faction attach to larger ally
character_event = {
	id = mega_wars.54
	desc = "AI-Event"
	
	is_triggered_only = yes
	
	trigger = {
		ai = yes #Humans can swear fealty to who they want
		NOT = { tier = EMPEROR }
		NOT = { tier = KING }
		any_playable_ruler = {
			has_character_modifier = indep_faction_won
			higher_tier_than = ROOT
			any_realm_province = {
				any_neighbor_province = {
					any_province_lord = {
						is_liege_or_above = ROOT
					}
				}
			}
		}	
	}
	
	option = {
		name = "OK" 
		random_playable_ruler = {
			limit = {
				has_character_modifier = indep_faction_won
				higher_tier_than = ROOT
				any_realm_province = {
					any_neighbor_province = {
						any_province_lord = {
							is_liege_or_above = ROOT
						}
					}
				}
			}
			ROOT = { set_defacto_liege = PREV }
		}
		clr_character_flag = mega_war_liege_loan
	}
}

#Mega War Drama
#-----------------------
#My close relative is opposing my host
character_event = {
	id = mega_wars.60
	desc = "EVTDESCmega_wars.60"
	
	is_triggered_only = yes
	only_playable = yes
	hide_window = yes
	war = yes
	
	trigger = {
		OR = {
			AND = {
				tier = EMPEROR
				trait = civil_war
			}
			trait = rebel_leader
		}	
		any_current_enemy = {
			war_with = ROOT
			OR = {
				independent = yes
				liege_before_war = { character = ROOT }
			}
		}
	}
	
	immediate = {
		any_courtier = {
			limit = {
				host = { character = ROOT }
				NOR = { #does not apply to direct family
					is_child_of = ROOT
					father_even_if_dead = { is_child_of = ROOT }
					mother_even_if_dead = { is_child_of = ROOT }
					any_child = { character = ROOT }
					any_child = { any_child = { character = ROOT } }
					sibling = ROOT
					is_married = ROOT
				}
				ROOT = {
					any_current_enemy = {
						war_with = ROOT
						OR = {
							independent = yes
							liege_before_war = { character = ROOT }
						}
						NOT = { character = PREVPREV }	
						OR = {
							is_child_of = PREVPREV					
							any_child = { character = PREVPREVPREV }
							any_child = { any_child = { character = PREVPREVPREVPREV } }
							sibling = PREVPREV
							is_married = PREVPREV
							AND = { #Can target dynasts only if enemy is close relative
								dynasty = PREVPREV
								NOT = { dynasty = 0 }
								ROOT = { NOT = { dynasty = PREVPREVPREV } }
							}											
						}	
						NAND = { #Ignore half-siblings who are related to ROOT
							sibling = PREVPREV
							NOT = { is_married = PREVPREV }
							PREVPREV = { is_close_relative = ROOT }
							OR = {
								father_even_if_dead = { NOT = { is_father = PREVPREVPREV } }
								mother_even_if_dead = { NOT = { is_mother = PREVPREVPREV } }
							}					
						}	
						NAND = { #Ignore if courtier is same dynasty but NOT same dynasty as enemy
							NOT = { dynasty = PREVPREV }
							ROOT = { dynasty = PREVPREVPREV }
						}						
						NAND = { #If ROOT suspects enemy of being a bastard and is related to target, then ignore
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_suspected_bastard }
							NOR = {				
								any_child = { character = PREVPREVPREV }
								any_child = { any_child = { character = PREVPREVPREVPREV } }
								is_married = PREVPREV										
							}
							PREVPREV = { 
								OR = {
									dynasty = ROOT
									is_close_relative = ROOT
								}	
								NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_suspected_bastard } }
							}
						}				
						# OR = {
							# AND = {
								# has_character_flag = against_king
								# PREV = { tier = EMPEROR trait = civil_war }
							# }	
							# AND = {
								# has_character_flag = supporting_king
								# PREV = { trait = rebel_leader }
							# }	
							# AND = {
								# ai = no
								# trait = rebel_leader
								# PREV = { tier = EMPEROR trait = civil_war }
							# }	
							# AND = {
								# ai = no
								# AND = {
									# tier = EMPEROR
									# trait = civil_war
								# }
								# PREV = { trait = rebel_leader }
							# }	
						# }
						
					}
				}
				NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_merciful } }
				NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_supported_claimant } }	
				NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_my_slave } }	
				NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_with_king } }
				NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_with_rebel_leader } }	
				NOT = { ROOT = { supported_claimant = { character = PREVPREV } } }
				NOT = { trait = dragon }
				NOT = { character = ROOT }			
				NOT = { has_character_flag = captured_in_battle }	
				NOT = { has_character_flag = imprisoned_for_relatives_crimes }
			}
			character_event = { id = mega_wars.6099 }
		}
	}
	
	option = {
		name = OK
	}
}	
character_event = {
	id = mega_wars.6099
	desc = "EVTDESCmega_wars.60"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.60" 
		if = {
			limit = { ai = no }
			FROM = {
				any_current_enemy = {
					limit = {
						war_with = ROOT_FROM
						OR = {
							independent = yes
							liege_before_war = { character = ROOT_FROM }
						}
						NOT = { character = PREVPREV }	
						OR = {
							is_child_of = PREVPREV					
							any_child = { character = PREVPREVPREV }
							any_child = { any_child = { character = PREVPREVPREVPREV } }
							sibling = PREVPREV
							is_married = PREVPREV
							AND = { #Can target dynasts only if enemy is close relative
								dynasty = PREVPREV
								NOT = { dynasty = 0 }
								ROOT_FROM = { NOT = { dynasty = PREVPREVPREV } }
							}											
						}	
						NAND = { #Ignore half-siblings who are related to ROOT
							sibling = PREVPREV
							NOT = { is_married = PREVPREV }
							PREVPREV = { is_close_relative = ROOT_FROM }
							OR = {
								father_even_if_dead = { NOT = { is_father = PREVPREVPREV } }
								mother_even_if_dead = { NOT = { is_mother = PREVPREVPREV } }
							}					
						}	
						NAND = { #Ignore if courtier is same dynasty but NOT same dynasty as enemy
							NOT = { dynasty = PREVPREV }
							ROOT_FROM = { dynasty = PREVPREVPREV }
						}						
						NAND = { #If ROOT suspects enemy of being a bastard and is related to target, then ignore
							reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard }
							NOR = {				
								any_child = { character = PREVPREVPREV }
								any_child = { any_child = { character = PREVPREVPREVPREV } }
								is_married = PREVPREV										
							}
							PREVPREV = { 
								OR = {
									dynasty = ROOT_FROM
									is_close_relative = ROOT_FROM
								}	
								NOT = { reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard } }
							}
						}
					}	
					tooltip = { }
				}
			}
		}	
		FROM = {
			character_event = { id = mega_wars.61 days = 1 tooltip = "EVTTOOLTIPmega_wars.61" }
		}
	}
}	
#I have a close relative of the enemy
character_event = {
	id = mega_wars.61
	desc = "EVTDESCmega_wars.61"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.61" #It's not his fault
		ai_chance = {
			factor = 30
			modifier = { #More tolerent of ignorant AI
				factor = 3
				NOT = {
					any_current_enemy = {
						OR = {
							is_child_of = FROM					
							any_child = { character = FROM }
							any_child = { any_child = { character = FROM } }
							sibling = FROM
							is_married = FROM
							AND = { #Can target dynasts only if enemy is close relative
								dynasty = FROM
								NOT = { dynasty = 0 }
								NOT = { dynasty = ROOT }
							}											
						}
						war_with = ROOT
						OR = {
							ai = no
							AND = {
								has_character_flag = against_king
								ROOT = { tier = EMPEROR trait = civil_war }
							}	
							AND = {
								has_character_flag = supporting_king
								ROOT = { trait = rebel_leader }
							}	
						}
					}	
				}
			}
			modifier = {
				factor = 2
				dynasty = FROM
			}
			modifier = {
				factor = 2
				is_close_relative = FROM
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  25 }
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  50 }
			}
			modifier = {
				factor = 2
				opinion = { who = FROM value =  75 }
			}
			modifier = {
				factor = 1.2
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 1.5
				trait = brave
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 4
				trait = trusting
			}
			modifier = {
				factor = 10 #Enemy has your relative
				any_current_enemy = {
					dynasty = FROM
					is_close_relative = FROM
					any_courtier = {
						host = { character = PREVPREV }
						is_close_relative = ROOT
						AND = {
							NOT = { dynasty = 0 }
							dynasty = ROOT
						}	
					}
				}
			}
		}
		if = {
			limit = { NOT = { dynasty = FROM } }
			prestige = -40
		}	
		if = {
			limit = { dynasty = FROM }
			prestige = -20
		}
		FROM = {
			opinion = {
				modifier = opinion_merciful
				who = ROOT
				years = 10
			}
			hidden_tooltip = {
				character_event = { id = mega_wars.62 }
			}
		}		
	}
	
	option = {
		name = "EVTOPTBmega_wars.61" #Imprison him
		ai_chance = {
			factor = 30
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -25 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -50 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -75 } }
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = envious
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = deceitful
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
		}
		FROM = { 
			set_character_flag = imprisoned_for_relatives_crimes
			if = {
				limit = { prisoner = no }
				imprison = ROOT		
				hidden_tooltip = {
					character_event = { id = mega_wars.67 }
				}
			}	
		}	
	}
	
	option = {
		name = "EVTOPTCmega_wars.61" #execute him!
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0.1
				NOT = { trait = lunatic }
				OR = {
					dynasty = FROM
					is_close_relative = FROM
				}
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -25 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -50 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -75 } }
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = envious
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 1.5
				trait = deceitful
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 4
				trait = paranoid
			}
			modifier = {
				factor = 4
				trait = cruel
			}
		}
		FROM = {
			hidden_tooltip = {
				character_event = { id = mega_wars.68 }
			}
			tooltip = {
				death = {
					death_reason = death_execution
					killer = ROOT
				}
			}	
		}
		if = {
			limit = {
				OR = {
					AND = {
						NOT = { dynasty = 0 }
						dynasty = FROM
					}	
					AND = {
						is_close_relative = FROM
						OR = { #If married must be blood relation
							NOT = { is_married = FROM }
							sibling = FROM
							is_child_of = FROM
							any_child = { character = FROM }
							father_even_if_dead = { sibling = FROM }
							mother_even_if_dead = { sibling = FROM }
							any_sibling = { any_child = { character = FROM } }
						}
					}
				}
			}
			add_trait = kinslayer	
			hidden_tooltip = {
				if = {
					limit = { has_nickname = no }
					random = {
						chance = 15
						give_nickname = nick_the_kinslayer
					}
				}
			}
		}
	}	
	
	option = {
		name = "EVTOPTDmega_wars.61" #torture
		trigger = {
			FROM = { age = 14 }
			OR = {
				trait = impaler
				trait = cruel
			}
			NOT = { trait = honorable }
			NOT = { trait = kind }
		}
		ai_chance = {
			factor = 30
			modifier = {
				factor = 0.1
				NOT = { trait = lunatic }
				OR = {
					dynasty = FROM
					is_close_relative = FROM
				}	
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -25 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -50 } }
			}
			modifier = {
				factor = 2
				NOT = { opinion = { who = FROM value =  -75 } }
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = deceitful
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 4
				trait = paranoid
			}
			modifier = {
				factor = 4
				trait = impaler
			}
			modifier = {
				factor = 4
				trait = cruel
			}
		}
		FROM = {
			imprison = ROOT
			set_character_flag = imprisoned_for_relatives_crimes
			tooltip = {
				if = {
					limit = { is_female = no }
					random_list = {
						25 = { 
							add_character_modifier = { 
								name = tortured
								duration = 60
							}
						}
						25 = { add_trait = wounded }
						25 = { add_maimed_trait_effect = yes }					
						10 = { add_crippled_trait_effect = yes }
						10 = { add_trait = blinded }
						5 = { add_trait = eunuch }
					}
				}
				if = {
					limit = { is_female = yes }
					random_list = {
						25 = { 
							add_character_modifier = { 
								name = tortured
								duration = 60
							}
						}
						25 = { add_trait = wounded }
						25 = { add_maimed_trait_effect = yes }					
						15 = { add_crippled_trait_effect = yes }
						10 = { add_trait = blinded }
					}
				}
			}	
			hidden_tooltip = {
				character_event = { id = mega_wars.71 }
			}
			random = {
				chance = 33
				tooltip = {
					death = yes
					if = {
						limit = {
							OR = {
								AND = {
									NOT = { dynasty = 0 }
									dynasty = ROOT
								}	
								AND = {
									is_close_relative = ROOT
									OR = { #If married must be blood relation
										NOT = { is_married = ROOT }
										sibling = ROOT
										is_child_of = ROOT
										any_child = { character = ROOT }
										father_even_if_dead = { sibling = ROOT }
										mother_even_if_dead = { sibling = ROOT }
										any_sibling = { any_child = { character = ROOT } }
									}
								}
							}
						}
						ROOT = { 
							add_trait = kinslayer	
							hidden_tooltip = {
								if = {
									limit = { has_nickname = no }
									random = {
										chance = 15
										give_nickname = nick_the_kinslayer
									}
								}
							}
						}
					}
				}
			}	
		}
		
	}
}
#Informed spared
character_event = {
	id = mega_wars.62
	desc = "EVTDESCmega_wars.62"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.62" 
	}
	
}
#Informed imprisoned
character_event = {
	id = mega_wars.67
	desc = "EVTDESCmega_wars.67"
	picture = "GFX_evt_into_the_dungeon"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.67" 
		hidden_tooltip = {
			FROM = {
				any_current_enemy = {
					limit = {
						ai = no
						
						war_with = ROOT_FROM
						OR = {
							independent = yes
							liege_before_war = { character = ROOT_FROM }
						}
						NOT = { character = PREVPREV }	
						OR = {
							is_child_of = PREVPREV					
							any_child = { character = PREVPREVPREV }
							any_child = { any_child = { character = PREVPREVPREVPREV } }
							sibling = PREVPREV
							is_married = PREVPREV
							AND = { #Can target dynasts only if enemy is close relative
								dynasty = PREVPREV
								NOT = { dynasty = 0 }
								ROOT_FROM = { NOT = { dynasty = PREVPREVPREV } }
							}											
						}	
						NAND = { #Ignore half-siblings who are related to ROOT
							sibling = PREVPREV
							NOT = { is_married = PREVPREV }
							PREVPREV = { is_close_relative = ROOT_FROM }
							OR = {
								father_even_if_dead = { NOT = { is_father = PREVPREVPREV } }
								mother_even_if_dead = { NOT = { is_mother = PREVPREVPREV } }
							}					
						}	
						NAND = { #Ignore if courtier is same dynasty but NOT same dynasty as enemy
							NOT = { dynasty = PREVPREV }
							ROOT_FROM = { dynasty = PREVPREVPREV }
						}						
						NAND = { #If ROOT suspects enemy of being a bastard and is related to target, then ignore
							reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard }
							NOR = {				
								any_child = { character = PREVPREVPREV }
								any_child = { any_child = { character = PREVPREVPREVPREV } }
								is_married = PREVPREV										
							}
							PREVPREV = { 
								OR = {
									dynasty = ROOT_FROM
									is_close_relative = ROOT_FROM
								}	
								NOT = { reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard } }
							}
						}
					}	
					character_event = { id = mega_wars.69 }
				}
			}	
		}
	}
	
}
#Informed executed
character_event = {
	id = mega_wars.68
	desc = "EVTDESCmega_wars.68"
	picture = GFX_evt_beheading
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.68" 
		hidden_tooltip = {
			FROM = {
				any_current_enemy = {
					limit = { 
						war_with = ROOT_FROM
						OR = {
							independent = yes
							liege_before_war = { character = ROOT_FROM }
						}
						NOT = { character = PREVPREV }	
						OR = {
							is_child_of = PREVPREV					
							any_child = { character = PREVPREVPREV }
							any_child = { any_child = { character = PREVPREVPREVPREV } }
							sibling = PREVPREV
							is_married = PREVPREV
							AND = { #Can target dynasts only if enemy is close relative
								dynasty = PREVPREV
								NOT = { dynasty = 0 }
								ROOT_FROM = { NOT = { dynasty = PREVPREVPREV } }
							}											
						}	
						NAND = { #Ignore half-siblings who are related to ROOT
							sibling = PREVPREV
							NOT = { is_married = PREVPREV }
							PREVPREV = { is_close_relative = ROOT_FROM }
							OR = {
								father_even_if_dead = { NOT = { is_father = PREVPREVPREV } }
								mother_even_if_dead = { NOT = { is_mother = PREVPREVPREV } }
							}					
						}	
						NAND = { #Ignore if courtier is same dynasty but NOT same dynasty as enemy
							NOT = { dynasty = PREVPREV }
							ROOT_FROM = { dynasty = PREVPREVPREV }
						}						
						NAND = { #If ROOT suspects enemy of being a bastard and is related to target, then ignore
							reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard }
							NOR = {				
								any_child = { character = PREVPREVPREV }
								any_child = { any_child = { character = PREVPREVPREVPREV } }
								is_married = PREVPREV										
							}
							PREVPREV = { 
								OR = {
									dynasty = ROOT_FROM
									is_close_relative = ROOT_FROM
								}	
								NOT = { reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard } }
							}
						}
					}
					character_event = { id = mega_wars.70 }
				}
				set_character_flag = unjust_execution
			}	
		}
		tooltip = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}	
		hidden_tooltip = { FROM = { character_event = { id = imprisoned.10 } } }#Select execution method
	}
}

#Informed  relative imprisoned
character_event = {
	id = mega_wars.69
	desc = "EVTDESCmega_wars.69"
	picture = "GFX_evt_into_the_dungeon"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.69" 
		FROM = {
			FROM = {
				tooltip = { }
			}
		}
	}
}
#Informed  relative executed
character_event = {
	id = mega_wars.70
	desc = "EVTDESCmega_wars.70"
	picture = GFX_evt_beheading
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.70" 
		FROM = {
			FROM = {
				tooltip = { }
			}
		}
	}	
}

#Informed tortured (also used in prisoner break chain,  event rescue_prisoner.1399)
character_event = {
	id = mega_wars.71
	desc = "EVTDESCmega_wars.71"
	picture = "GFX_evt_torture"
	
	is_triggered_only = yes
	
	immediate = { set_character_flag = alive }
	
	option = {
		name = "EVTOPTAmega_wars.71" 
		if = {
			limit = { is_female = no }
			random_list = {
				25 = { 
					add_character_modifier = { 
						name = tortured
						duration = 60
					}
				}
				25 = { add_trait = wounded }
				25 = { add_maimed_trait_effect = yes }					
				10 = { add_crippled_trait_effect = yes }
				10 = { add_trait = blinded }
				5 = { add_trait = eunuch }
			}
		}
		if = {
			limit = { is_female = yes }
			random_list = {
				25 = { 
					add_character_modifier = { 
						name = tortured
						duration = 60
					}
				}
				25 = { add_trait = wounded }
				25 = { add_maimed_trait_effect = yes }					
				15 = { add_crippled_trait_effect = yes }
				10 = { add_trait = blinded }
			}
		}
		hidden_tooltip = {
			FROM = {
				any_current_enemy = {
					limit = { 
						war_with = ROOT_FROM
						OR = {
							independent = yes
							liege_before_war = { character = ROOT_FROM }
						}
						NOT = { character = PREVPREV }	
						OR = {
							is_child_of = PREVPREV					
							any_child = { character = PREVPREVPREV }
							any_child = { any_child = { character = PREVPREVPREVPREV } }
							sibling = PREVPREV
							is_married = PREVPREV
							AND = { #Can target dynasts only if enemy is close relative
								dynasty = PREVPREV
								NOT = { dynasty = 0 }
								ROOT_FROM = { NOT = { dynasty = PREVPREVPREV } }
							}											
						}	
						NAND = { #Ignore half-siblings who are related to ROOT
							sibling = PREVPREV
							NOT = { is_married = PREVPREV }
							PREVPREV = { is_close_relative = ROOT_FROM }
							OR = {
								father_even_if_dead = { NOT = { is_father = PREVPREVPREV } }
								mother_even_if_dead = { NOT = { is_mother = PREVPREVPREV } }
							}					
						}	
						NAND = { #Ignore if courtier is same dynasty but NOT same dynasty as enemy
							NOT = { dynasty = PREVPREV }
							ROOT_FROM = { dynasty = PREVPREVPREV }
						}						
						NAND = { #If ROOT suspects enemy of being a bastard and is related to target, then ignore
							reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard }
							NOR = {				
								any_child = { character = PREVPREVPREV }
								any_child = { any_child = { character = PREVPREVPREVPREV } }
								is_married = PREVPREV										
							}
							PREVPREV = { 
								OR = {
									dynasty = ROOT_FROM
									is_close_relative = ROOT_FROM
								}	
								NOT = { reverse_has_opinion_modifier = { who = ROOT_FROM modifier = opinion_suspected_bastard } }
							}
						}
					}
					character_event = { id = mega_wars.72 }
				}
			}
		}	
		random = {
			chance = 33
			clr_character_flag = alive 
			death = {
				death_reason = death_execution_torture
				killer = FROM
			}
			hidden_tooltip = {
				FROM = { 
					character_event = { id = mega_wars.73 } 
					set_character_flag = unjust_execution 
					#set_character_flag = special_execution_found
					save_event_target_as = executioner 
				}
				character_event = { id = 45342 } #Universal on_execution event
			}
		}
		if = { #If still alive apply 'tortured me' opinion penalty
			limit = { has_character_flag = alive }
			clr_character_flag = alive 
			hidden_tooltip = {
				opinion = {
					who = FROM
					modifier = opinion_tortured_me
				}	
				mother = {
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = opinion_tortured_kin
					}			
				}		
				father = {
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = opinion_tortured_kin
					}		
				}
				any_child = {
					limit = { 
						NOT = { character = FROM }
						NOT = { has_character_flag = murder_opinion_set }
					}	
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = opinion_tortured_kin
					}				
				}	
				any_spouse = {
					limit = { 
						NOT = { character = FROM }
						opinion = { who = ROOT value = -25 }
						NOT = { has_character_flag = murder_opinion_set }
					}	
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = opinion_tortured_kin
					}			
				}
				any_lover = {
					limit = { 
						NOT = { character = FROM }
						NOT = { has_character_flag = murder_opinion_set }
					}	
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = opinion_tortured_lover
					}			
				}
				any_friend = {
					limit = { 
						NOT = { character = FROM }
						NOT = { has_character_flag = murder_opinion_set }
					}	
					set_character_flag = murder_opinion_set
					opinion = {
						who = FROM
						modifier = opinion_tortured_friend
					}			
				}
				any_dynasty_member = {
					limit = { 
						is_close_relative = ROOT
						NOT = { character = FROM }
						NOT = { has_character_flag = murder_opinion_set }
					}	
					opinion = {
						who = FROM
						modifier = opinion_tortured_kin
					}				
				}
				mother = { clr_character_flag = murder_opinion_set	}
				father = { clr_character_flag = murder_opinion_set }	
				any_child = { clr_character_flag = murder_opinion_set }
				any_lover = { clr_character_flag = murder_opinion_set }
				any_friend = { clr_character_flag = murder_opinion_set }
				any_spouse = { clr_character_flag = murder_opinion_set }
			}
		}		
	}
}
#Informed  relative tortured
character_event = {
	id = mega_wars.72
	desc = "EVTDESCmega_wars.72"
	picture = "GFX_evt_torture"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.72" 
		FROM = {
			FROM = {
				tooltip = { }
			}
		}
	}	
}
#Inform torturer
character_event = {
	id = mega_wars.73
	desc = "EVTDESCmega_wars.73"
	picture = "GFX_evt_torture"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.73" 
		piety = -30
	}	
}
#Emperor deals with defeated rebels/traitors
character_event = {
	id = mega_wars.74
	desc = "EVTDESCmega_wars.74"
	
	is_triggered_only = yes
	
	trigger = { 
		demesne_size = 1
		NOT = { tier = EMPEROR } 
		FROM = {
			FROM = {
				OR = {
					AND = {
						trait = civil_war
						ROOT = {
							NOT = { has_character_flag = independant }
							NOT = { any_liege = { has_character_flag = independant } }
						}
						any_demesne_title = {
							tier = EMPEROR
							ROOT = {
								primary_title = {
									lower_tier_than = EMPEROR
									is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
								}
							}
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}	
					ROOT = { liege_before_war = { character = PREVPREV } }
					ROOT = { liege = { character = PREVPREV } }
				}
			}
		}
	}
	
	immediate = {
		hidden_tooltip = { remove_trait = civil_war }
		FROMFROM = {
			reverse_opinion = { who = ROOT modifier = opinion_de_facto_liege years = 25 }
			set_mega_war_empire_variable_ROOT_effect = yes
		}
		if = {
			limit = { 
				is_ruler = yes
				lower_tier_than = KING 
				primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } }
				NOT = { liege = { character = FROMFROM } }
			}
			random_playable_ruler = {
				limit = {
					liege = {
						higher_tier_than = DUKE
						any_demesne_title = {
							higher_tier_than = DUKE
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
							check_variable = { which = "de_facto_kingdom" value = 0.9 }
						}
					}	
				}
				liege = { ROOT = { set_defacto_liege = PREV } }
			}
		}
		if = {
			limit = { 
				independent = yes
			}
			random_independent_ruler = {
				limit = {
					tier = EMPEROR
					war = no
					any_demesne_title = {
						tier = EMPEROR
						ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
				ROOT = { set_defacto_liege = PREV }
			}
		}
		clr_character_flag = mega_war_liege_loan
		hidden_tooltip = { remove_trait = rebel_leader }
		# any_courtier = {
			# limit = { trait = kingsguard }
			# d_kingsguard = { holder_scope = { move_character = FROMFROM } }
		# }
	}
	
	option = {
		name = "EVTOPTAmega_wars.74" 
		set_character_flag = issue_punishments
		FROM = {
			FROM = {
				character_event = { id = mega_wars.75 days = 1  tooltip = "TOOLTIPmega_wars.75" }
				set_character_flag = issue_punishments
			}
		}
	}
}
#Emperor decides
character_event = {
	id = mega_wars.75
	desc = "EVTDESCmega_wars.75"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.75" #pardon
		ai_chance = {
			factor = 40
			modifier = {
				factor = 0.4
				FROM = { trait = kingsguard }
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 0
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 20
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 40
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 60
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 80
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 100
				}
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = patient
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = kind
			}
			modifier = {
				factor = 1.2
				trait = slothful
			}
			modifier = {
				factor = 1.2
				trait = charitable
			}
			modifier = {
				factor = 1.2
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = honorable
			}
		}
		FROM = { 
			if = {
				limit = {
					NOT = { has_landed_title = k_the_most_devout }
					NOT = { has_landed_title = d_kingsguard }
					NOT = { primary_title = { controls_religion = yes } }
				}
				custom_tooltip = { text = TOOLTTIPmega_wars.76 }
				hidden_tooltip = {
					letter_event = { id = mega_wars.76 days = 1 }
				}
			}	
			if = {
				limit = {
					OR = {
						has_landed_title = k_the_most_devout 
						primary_title = { controls_religion = yes }
						has_landed_title = d_kingsguard
					}	
				}
				custom_tooltip = { text = TOOLTTIPmega_wars.76KG } 
				hidden_tooltip = {
					letter_event = { id = mega_wars.85 days = 1 }
				}
			}	
			opinion = {
				who = ROOT
				modifier = opinion_merciful
				years = 5
			}
			if = {
				limit = { is_ruler = yes }
				ROOT = { 
					change_variable = { which = fear_actions value = -5 } 
					hidden_tooltip = { character_event = { id = faction_event_new.90 } }
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = patient }
				NOT = { trait = wroth }
				NOT = { personality_traits = 6 }
			}
			random = {
				chance = 10
				add_trait = patient
				hidden_tooltip = {
					character_event = {
						id = 38264 #Notify Patient
					}
				}
			}
		}
	}
	option = {
		name = "EVTOPTBmega_wars.75" #Imprison
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
		}
		FROM = {
			set_character_flag = being_issued_punishment
			if = {
				limit = { prisoner = yes }
				custom_tooltip = { text = TOOLTIPmega_wars.77LIEGE }
			}	
			if = {
				limit = { prisoner = no }
				custom_tooltip = { text = TOOLTIPmega_wars.77LIEGEREBEL }
			}	
			hidden_tooltip = { letter_event = { id = mega_wars.77 days = 1 } }
		}
	}
	
	option = {
		name = "EVTOPTCmega_wars.75" #revoke primary title
		trigger = {
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
			FROM = {
				is_nomadic = no
				NOT = {
					OR = {
						has_landed_title = k_the_most_devout
						primary_title = { controls_religion = yes }
						trait = kingsguard
					}	
				}	
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				FROM = { prisoner = no }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = arbitrary
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
			modifier = {
				factor = 4
				has_character_flag = harsh_justice
			}		
		}
		if = {
			limit = { 
				FROM = {
					OR = {
						independent = yes
						tier = KING
						liege = { character = ROOT }
					}
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.78LIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.78LIEGEREBEL }
				}	
				hidden_tooltip = { letter_event = { id = mega_wars.78 days = 1 } }
			}
		}
		if = {
			limit = { 
				FROM = {
					NOT = {
						OR = {
							independent = yes
							tier = KING
							liege = { character = ROOT }
						}
					}	
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.78NONLIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.78NONLIEGEREBEL }
				}
				hidden_tooltip = { letter_event = { id = mega_wars.78 days = 1 } }
			}
		}
	}
	
	option = {
		name = "EVTOPTDmega_wars.75" #revoke all titles
		trigger = {
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
			FROM = {
				is_nomadic = no
				OR = {
					demesne_size = 2
					higher_tier_than = count
				}
				NOT = {
					OR = {
						has_landed_title = k_the_most_devout
						primary_title = { controls_religion = yes }
						trait = kingsguard
					}	
				}					
			}
			NOT = {
				OR = {
					trait = just
					trait = honorable
					trait = patient
				}
			}	
			OR = {
				trait = wroth
				trait = lunatic
				trait = arbitrary
				trait = cruel
				trait = ruthless
				has_character_flag = harsh_justice
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.5
				FROM = { prisoner = no }
			}
			modifier = {
				factor = 0.5
				NOT = { has_landed_title = e_iron_throne }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.1
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 6
				has_character_flag = harsh_justice
			}	
		}
		if = {
			limit = { 
				FROM = {
					OR = {	
						tier = KING
						liege = { character = ROOT }
						independent = yes
					}
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.79LIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.79LIEGEREBEL }
				}
				hidden_tooltip = { letter_event = { id = mega_wars.79 days = 1 } }
			}
		}
		if = {
			limit = { 
				FROM = {
					NOT = {
						OR = {
							tier = KING
							liege = { character = ROOT }
							independent = yes
						}
					}	
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.79NONLIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.79NONLIEGEREBEL }
				}
				hidden_tooltip = { letter_event = { id = mega_wars.79 days = 1 } }
			}
		}	
		change_variable = { which = "tyrant" value = 5 } 
		hidden_tooltip = { character_event = { id = maintenance.1 } }#tyrant trait	
	}
	option = {
		name = "EVTOPTEmega_wars.75" #Remove from the Kingsguard
		trigger = {
			has_landed_title = e_iron_throne
			FROM = { trait = kingsguard }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
		}
		FROM = {
			remove_trait = kingsguard
			if = {
				limit = { is_ruler = yes }
				hidden_tooltip = { #Universal on death/abdication event
					if = {
						limit = { has_character_modifier = owns_valyrian_steel_sword }
						set_character_flag = do_not_inherit_sword
					}
					set_character_flag = abdication
					character_event = { id = 45341 } 
					clr_character_flag = abdication
					clr_character_flag = do_not_inherit_sword
					transfer_wealth_to_heir_effect = yes
				}
				abdicate = yes
			}	
			recalc_succession = yes
			#hidden_tooltip = { letter_event = { id = 999900962 days = 1 } }
		}
	}	
	option = {
		name = "EVTOPTFmega_wars.75" #New High Septon
		trigger = {
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			FROM = { has_landed_title = k_the_most_devout  }
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
		}
		FROM = {
			set_character_flag = being_issued_punishment
			if = {
				limit = { prisoner = yes }
				custom_tooltip = { text = TOOLTIPmega_wars.78HS }
			}	
			if = {
				limit = { prisoner = no }
				custom_tooltip = { text = TOOLTIPmega_wars.78HSREBEL }
			}
			hidden_tooltip = { letter_event = { id = mega_wars.78 days = 1 } }
		}
	}	
	option = {
		name = "EVTOPTGmega_wars.75" #Bring me his head!
		trigger = {
			FROM = {
				OR = {
					has_landed_title = k_the_most_devout
					primary_title = { controls_religion = yes }
					trait = kingsguard
				}	
			}
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.5
				FROM = { prisoner = no }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.1
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
		}
		FROM = {
			set_character_flag = being_issued_punishment
			if = {
				limit = { prisoner = yes }
				custom_tooltip = { text = TOOLTIPmega_wars.79HSKG }
			}	
			if = {
				limit = { prisoner = no }
				custom_tooltip = { text = TOOLTIPmega_wars.79HSKGREBEL }
			}
			hidden_tooltip = { letter_event = { id = mega_wars.79 days = 1 } }
		}
	}	
}
#Inform pardoned
letter_event = {
	id = mega_wars.76
	desc = "EVTDESCmega_wars.76"
	
	is_triggered_only = yes
	
	immediate = {
		clear_event_target = mega_war_hostage
		current_heir = {
			if = {
				limit = {
					dynasty = ROOT
					is_ruler = no
					liege = { character = ROOT }
					NOT = { character = ROOT }
					NOT = { character = FROM }
				}
				save_event_target_as = mega_war_hostage
				break = yes
			}			
		}
		random_child = {
			limit = {
				is_alive = yes
				is_ruler = no
				liege = { character = ROOT }
				NOT = { character = ROOT }
				NOT = { character = FROM }
			}	
			save_event_target_as = mega_war_hostage
			break = yes
		}		
		random_dynasty_member = {
			limit = {
				is_alive = yes
				is_close_relative = ROOT
				is_ruler = no
				liege = { character = ROOT }
				NOT = { character = ROOT }
				NOT = { character = FROM }
			}	
			save_event_target_as = mega_war_hostage
			break = yes
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.76" 		
		event_target:mega_war_hostage = {
			move_character = FROM
			if = {
				limit = { FROM = { is_in_interregnum_trigger = yes } }
				set_character_flag = interregnum_hostage
			}
			ROOT = {
				if = {
					limit = { 
						prisoner = yes
						host = { character = FROM }
					}
					prisoner = no
				}
			}		
		}	
		if = {
			limit = { NOT = { event_target:mega_war_hostage = { always = yes } } }
			custom_tooltip = { text = NOSUITABLEHOSTAGE }	 
			hidden_tooltip = { 
				if = {
					limit = { prisoner = no }
					imprison = FROM 
					set_character_flag = interregnum_prisoner
				}	
				remove_character_modifier = the_oubliette
				remove_character_modifier = the_dungeon
				add_character_modifier = { 
					name = house_arrest
					duration = -1
				}
			}
		}
		clear_event_target = mega_war_hostage
		clr_character_flag = issue_punishments
		hidden_tooltip = {
			reverse_remove_opinion = {
				who = FROM
				modifier = opinion_traitor
			}
			reverse_remove_opinion = {
				who = FROM
				modifier = opinion_joined_rebellion
			}
			if = {
				limit = {
					demesne_size = 1
					trait = civil_war
					FROM = { has_landed_title = e_iron_throne }
				}
				any_demesne_title = {
					limit = {
						region = world_crownlands
					}
					gain_title = FROM
				}
				if = {
					limit = {
						demesne_size = 1
						NOT = { dynasty = FROM }
					}
					any_dynasty_member = {
						limit = {
							has_character_flag = exiled_royal_family
						}
						reverse_banish = PREV	
					}	
				}
			}			
		}
	}
}
#Inform imprisoned
letter_event = {
	id = mega_wars.77
	desc = "EVTDESCmega_wars.77"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.77" #OK	
		ai_chance = {
			factor = 25
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 1.5
				trait = shy
			}
			modifier = {
				factor = 1.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				NOT = { age = 16 }
			}
		}		
		imprison = FROM
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
	}
	
	option = {
		name = "EVTOPTCmega_wars.79" #Freedom!
		trigger = { 
			prisoner = no 
			higher_tier_than = BARON
		}
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.1
				NOT = { any_demesne_title = { tier = COUNT } }
			}
			modifier = {
				factor = 0.2
				tier = COUNT
			}
			modifier = {
				factor = 0.4
				tier = DUKE
			}
			modifier = {
				factor = 2
				num_of_king_titles = 2
			}
			modifier = {
				factor = 1.5
				num_of_king_titles = 3
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = gregarious
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				martial = 14
			}
		}
		if = {
			limit = { 
				tier = KING
				NOT = { liege = { character = FROM } }
				FROM = { tier = EMPEROR }
			}
			clr_character_flag = against_king 
			set_character_flag = neutral
			set_character_flag = opportunist_independence
			hidden_tooltip = { opinion = { who = FROM modifier = opinion_de_facto_liege years = 25 } }
			FROM = {
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence_CW
				}
			}	
			set_character_flag = war_declared
		}
		if = {
			limit = { NOT = { primary_title = { title = d_kingsguard } } }
			if = {
				limit = { 
					liege = { character = FROM } 
					NOT = { has_character_flag = war_declared }
				}
				FROM = {
					reverse_war = {
						target = ROOT
						casus_belli = bid_for_independence
					}
				}	
				set_character_flag = war_declared
			}
			if = {
				limit = { 
					NOT = {
						OR = {
							tier = KING
							liege = { character = FROM }
						}
					}	
					NOT = { has_character_flag = war_declared }
				}
				FROM = {
					hidden_tooltip = { ROOT = { set_defacto_liege = PREV } }
					reverse_war = {
						target = ROOT
						casus_belli = bid_for_independence
					}
				}	
			}
		}	
		if = {
			limit = { primary_title = { title = d_kingsguard } }
			if = {
				limit = { NOT = { liege = { character = FROM } } }
				set_defacto_liege = FROM
			}
			FROM = {
				reverse_war = {
					target = ROOT
					casus_belli = overthrow_ruler
				}
			}
		}
		clr_character_flag = war_declared
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.84 } } }
	}
}
#Inform primary title revoked
letter_event = {
	id = mega_wars.78
	desc = "EVTDESCmega_wars.78"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.78" #fair enough
		ai_chance = {
			factor = 25
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 1.5
				trait = shy
			}
			modifier = {
				factor = 1.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				NOT = { age = 16 }
			}
		}
		hidden_tooltip = {
			any_vassal = {
				limit = { 
					opinion = { who = ROOT value = 15 }
				}
				opinion = {
					who = FROM
					modifier = opinion_usurped_my_liege
					years = 10
				}
			}
			if = {
				limit = { 
					lower_tier_than = KING
					primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } 
				}
				random_playable_ruler = {
					limit = {
						liege = {
							higher_tier_than = DUKE
							any_demesne_title = {
								higher_tier_than = DUKE
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
								check_variable = { which = "de_facto_kingdom" value = 0.9 }
							}
						}	
					}
					liege = { ROOT = { set_defacto_liege = PREV } }
				}
			}
			if = {
				limit = { 
					independent = yes
				}
				random_independent_ruler = {
					limit = {
						tier = EMPEROR
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
					ROOT = { set_defacto_liege = PREV }
				}		
			}
		}
		if = {
			limit = { 
				OR = {
					tier = KING
					liege = { character = FROM }
				}
				NOT = { has_landed_title = k_the_most_devout }
			}
			set_character_flag = title_revoked
			if = {
				limit = { 
					tier = COUNT
				}
				primary_title = {
					usurp_title = { target = FROM type = claim }
					hidden_tooltip = { succession = primogeniture }
				}
			}
			if = {
				limit = { 
					tier = DUKE 
				}
				any_demesne_title = {
					limit = { tier = DUKE }
					usurp_title = { target = FROM type = claim }
					hidden_tooltip = { succession = primogeniture }
				}
				
			}
			if = {
				limit = { tier = KING }
				any_demesne_title = {
					limit = {
						tier = KING
					}
					usurp_title = { target = FROM type = claim }
					hidden_tooltip = { succession = primogeniture }
				}
			}			
		}
		if = {
			limit = { 
				NOT = { has_character_flag = brightwater_keep_promised }
				NOT = { has_character_flag = title_revoked }
				NOT = {
					OR = {
						tier = KING
						liege = { character = FROM }
					}
				}	
				NOT = { has_landed_title = k_the_most_devout }
			}
			set_character_flag = title_revoked
			if = {
				limit = { 
					tier = COUNT
				}
				liege = {
					ROOT = {
						primary_title = {
							usurp_title = { target = PREVPREV type = claim }
							hidden_tooltip = { succession = primogeniture }
						}
					}	
				}			
			}
			if = {
				limit = { 
					tier = DUKE 
				}
				liege = {
					ROOT = {
						any_demesne_title = {
							limit = {
								tier = DUKE
							}
							usurp_title = { target = PREVPREV type = claim }
							hidden_tooltip = { succession = primogeniture }
						}
					}	
				}	
			}		
		}
		if = {
			limit = { 
				has_character_flag = brightwater_keep_promised 
			}
			liege = {
				random_realm_character = {
					limit = { has_character_flag = brightwater_keep_promised }
					ROOT = {
						any_demesne_title = {
							usurp_title = { target = PREVPREV type = claim }
							hidden_tooltip = { succession = primogeniture }
						}
						clr_character_flag = brightwater_keep_promised
					}	
				}	
			}	
			set_character_flag = title_revoked
			clr_character_flag = brightwater_keep_promised
		}
		if = {
			limit = { 
				has_landed_title = k_the_most_devout 
			}
			set_global_flag = need_new_high_septon
			hidden_tooltip = {
				FROM = {
					character_event = { id = religious.11 }
					set_character_flag = select_next_high_septon
				}
			}	
			hidden_tooltip = { #Universal on death/abdication event
				if = {
					limit = { has_character_modifier = owns_valyrian_steel_sword }
					set_character_flag = do_not_inherit_sword
				}
				set_character_flag = abdication
				character_event = { id = 45341 } 
				clr_character_flag = abdication
				clr_character_flag = do_not_inherit_sword
				transfer_wealth_to_heir_effect = yes
			}
			abdicate = yes
			recalc_succession = yes
		}
		clr_character_flag = title_revoked
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		if = {
			limit = { 
				prisoner = no
			}
			imprison = FROM
			hidden_tooltip = {
				reverse_remove_opinion = {
					who = FROM
					modifier = opinion_traitor
				}
				reverse_remove_opinion = {
					who = FROM
					modifier = opinion_joined_rebellion
				}
				reverse_opinion = {
					who = FROM
					modifier = opinion_traitor_AGOT
				}
			}
		}
		hidden_tooltip = {
			if = {
				limit = { is_ruler = yes }
				set_defacto_liege = FROM
			}
		}	
	}
	
	option = {
		name = "EVTOPTCmega_wars.79" #Freedom!
		trigger = { prisoner = no }
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.1
				NOT = { any_demesne_title = { tier = COUNT } }
			}
			modifier = {
				factor = 0.2
				tier = COUNT
			}
			modifier = {
				factor = 0.4
				tier = DUKE
			}
			modifier = {
				factor = 2
				num_of_king_titles = 2
			}
			modifier = {
				factor = 1.5
				num_of_king_titles = 3
			}
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = gregarious
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 1.5
				martial = 14
			}
		}
		if = {
			limit = { 
				tier = KING
				NOT = { liege = { character = FROM } }
				FROM = { tier = EMPEROR }
			}
			clr_character_flag = against_king 
			set_character_flag = neutral
			set_character_flag = opportunist_independence
			hidden_tooltip = { opinion = { who = FROM modifier = opinion_de_facto_liege years = 25 } }
			FROM = {
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence_CW
				}
			}	
			set_character_flag = war_declared
		}
		if = {
			limit = { 
				liege = { character = FROM } 
				NOT = { has_character_flag = war_declared }
			}
			FROM = {
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence
				}
			}	
			set_character_flag = war_declared
		}
		if = {
			limit = { 
				NOT = {
					OR = {
						tier = KING
						liege = { character = FROM }
					}
				}	
				NOT = { has_character_flag = war_declared }
			}
			FROM = {
				hidden_tooltip = { ROOT = { set_defacto_liege = PREV } }
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence
				}
			}	
		}
		clr_character_flag = war_declared
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.84 } } }
	}
}
#Inform all titles revoked
letter_event = {
	id = mega_wars.79
	desc = "EVTDESCmega_wars.79"
	
	is_triggered_only = yes
	
	immediate = {
		clear_event_target = mega_war_hostage
		current_heir = {
			if = {
				limit = {
					dynasty = ROOT
					is_ruler = no
					liege = { character = ROOT }
					NOT = { character = ROOT }
					NOT = { character = FROM }
				}
				save_event_target_as = mega_war_hostage
				break = yes
			}			
		}
		random_child = {
			limit = {
				is_alive = yes
				is_ruler = no
				liege = { character = ROOT }
				NOT = { character = ROOT }
				NOT = { character = FROM }
			}	
			save_event_target_as = mega_war_hostage
			break = yes
		}		
		random_dynasty_member = {
			limit = {
				is_alive = yes
				is_close_relative = ROOT
				is_ruler = no
				liege = { character = ROOT }
				NOT = { character = ROOT }
				NOT = { character = FROM }
			}	
			save_event_target_as = mega_war_hostage
			break = yes
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.79" #damn
		trigger = { 
			prisoner = yes 
			NOT = {
				OR = {
					has_landed_title = k_the_most_devout
					trait = kingsguard
					primary_title = { controls_religion = yes }
				}
			}	
		}
		hidden_tooltip = {
			if = {
				limit = { 
					lower_tier_than = KING
					primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } 
				}
				random_playable_ruler = {
					limit = {
						liege = {
							higher_tier_than = DUKE
							any_demesne_title = {
								higher_tier_than = DUKE
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
								check_variable = { which = "de_facto_kingdom" value = 0.9 }
							}
						}	
					}
					liege = { ROOT = { set_defacto_liege = PREV } }
				}
			}
			if = {
				limit = { 
					independent = yes
				}
				random_independent_ruler = {
					limit = {
						tier = EMPEROR
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
					ROOT = { set_defacto_liege = PREV }
				}		
			}
		}
		event_target:mega_war_hostage = {
			move_character = FROM
			if = {
				limit = { FROM = { is_in_interregnum_trigger = yes } }
				set_character_flag = interregnum_hostage
			}		
		}
		clr_character_flag = hostage_taken
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		hidden_tooltip = {
			any_vassal = {
				limit = { 
					opinion = { who = ROOT value = 15 }
				}
				opinion = {
					who = FROM
					modifier = opinion_wiped_out_my_liege
					years = 10
				}
			}
		}	
		if = {
			limit = { 
				OR = {
					tier = KING
					liege = { character = FROM }
				}
			}
			any_demesne_title = {
				usurp_title = { target = FROM type = claim }
				hidden_tooltip = { succession = primogeniture }
			}
		}
		if = {
			limit = { 
				NOT = {
					OR = {
						tier = KING
						liege = { character = FROM }
					}
				}	
			}
			liege = {
				ROOT = {
					any_demesne_title = {
						usurp_title = { target = PREVPREV type = claim }
						hidden_tooltip = { succession = primogeniture }
					}
				}	
			}	
		}
		tooltip = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}	
		hidden_tooltip = { FROM = { character_event = { id = imprisoned.10 } } } #Select execution method	
		if = {
			limit = { 
				NOT = { age = 16 } 
			}
			any_dynasty_member = {
				limit = {
					is_alive = yes
					NOT = { character = FROM }
					is_close_relative = ROOT
				}
				opinion = {
					who = FROM
					modifier = opinion_executed_child
					years = 25
				}
			}
		}
		any_dynasty_member = {
			limit = {
				is_alive = yes
				NOT = { character = FROM }
				is_close_relative = ROOT
				NOT = { is_close_relative = FROM }
			}
			opinion = {
				who = FROM
				modifier = opinion_wiped_out_my_family
				years = 25
			}
		}
	}
	option = {
		name = "EVTOPTAmega_wars.79" #damn (KG/HS)
		trigger = { 
			prisoner = yes 
			OR = {
				has_landed_title = k_the_most_devout
				trait = kingsguard
				primary_title = { controls_religion = yes }
			}
		}
		hidden_tooltip = {
			if = {
				limit = { 
					lower_tier_than = KING
					primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } 
				}
				random_playable_ruler = {
					limit = {
						liege = {
							higher_tier_than = DUKE
							any_demesne_title = {
								higher_tier_than = DUKE
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
								check_variable = { which = "de_facto_kingdom" value = 0.9 }
							}
						}	
					}
					liege = { ROOT = { set_defacto_liege = PREV } }
				}
			}
			if = {
				limit = { 
					independent = yes
				}
				random_independent_ruler = {
					limit = {
						tier = EMPEROR
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
					ROOT = { set_defacto_liege = PREV }
				}		
			}
			any_vassal = {
				limit = { 
					opinion = { who = ROOT value = 15 }
				}
				opinion = {
					who = FROM
					modifier = opinion_wiped_out_my_liege
					years = 10
				}
			}
		}	
		tooltip = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}	
		hidden_tooltip = { FROM = { character_event = { id = imprisoned.10 } } } #Select execution method		
		any_dynasty_member = {
			limit = {
				is_alive = yes
				NOT = { character = FROM }
				is_close_relative = ROOT
				NOT = { is_close_relative = FROM }
			}
			opinion = {
				who = FROM
				modifier = opinion_wiped_out_my_family
				years = 5
			}
		}
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		clear_event_target = mega_war_hostage
	}
	option = {
		name = "EVTOPTBmega_wars.79" #Run Away!
		trigger = { prisoner = no }
		ai_chance = {
			factor = 25
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 1.5
				trait = shy
			}
			modifier = {
				factor = 1.5
				trait = slothful
			}
			modifier = {
				factor = 1.5
				trait = humble
			}
			modifier = {
				factor = 1.5
				NOT = { age = 16 }
			}
		}
		clear_event_target = mega_war_hostage
		hidden_tooltip = {
			if = {
				limit = { 
					lower_tier_than = KING
					primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } } 
				}
				random_playable_ruler = {
					limit = {
						liege = {
							higher_tier_than = DUKE
							any_demesne_title = {
								higher_tier_than = DUKE
								ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
								check_variable = { which = "de_facto_kingdom" value = 0.9 }
							}
						}	
					}
					liege = { ROOT = { set_defacto_liege = PREV } }
				}
			}
			if = {
				limit = { 
					independent = yes
				}
				random_independent_ruler = {
					limit = {
						tier = EMPEROR
						any_demesne_title = {
							tier = EMPEROR
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
					ROOT = { set_defacto_liege = PREV }
				}		
			}
			any_vassal = {
				limit = { 
					opinion = { who = ROOT value = 15 }
				}
				opinion = {
					who = FROM
					modifier = opinion_wiped_out_my_liege
					years = 10
				}
			}
		}	
		if = {
			limit = { 
				OR = {
					tier = KING
					liege = { character = FROM }
				}
				NOT = {
					OR = {
						has_landed_title = k_the_most_devout
						trait = kingsguard
						primary_title = { controls_religion = yes }
					}
				}	
			}
			any_demesne_title = {
				usurp_title = { target = FROM type = claim }
				hidden_tooltip = { succession = primogeniture }
			}
		}
		if = {
			limit = { 
				NOT = {
					OR = {
						tier = KING
						liege = { character = FROM }
					}
				}	
				NOT = {
					OR = {
						has_landed_title = k_the_most_devout
						trait = kingsguard
						primary_title = { controls_religion = yes }
					}
				}	
			}
			liege = {
				ROOT = {
					any_demesne_title = {
						usurp_title = { target = PREVPREV type = claim }
						hidden_tooltip = { succession = primogeniture }
					}
				}	
			}	
		}
		if = {
			limit = { 
				has_landed_title = k_the_most_devout
				NOT = { has_dlc = "Sons of Abraham" }
			}
			set_global_flag = need_new_high_septon
			hidden_tooltip = {
				FROM = {
					character_event = { id = religious.11 }
					set_character_flag = select_next_high_septon
				}
			}
		}	
		if = {
			limit = { 
				OR = {
					has_landed_title = k_the_most_devout
					trait = kingsguard
					primary_title = { controls_religion = yes }
				}
			}
			hidden_tooltip = { #Universal on death/abdication event
				if = {
					limit = { has_character_modifier = owns_valyrian_steel_sword }
					set_character_flag = do_not_inherit_sword
				}
				set_character_flag = abdication
				character_event = { id = 45341 } 
				clr_character_flag = abdication
				clr_character_flag = do_not_inherit_sword
				transfer_wealth_to_heir_effect = yes
			}
			abdicate = yes	
			set_character_flag = non_lord_revoked
		}
		if = {
			limit = { 
				trait = kingsguard
			}
			remove_trait = kingsguard
			set_character_flag = non_lord_revoked
		}
		custom_tooltip = { text = TOOLTIPmega_wars.79RUNAWAY }
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		hidden_tooltip = { 
			c_the_citadel = { holder_scope = { character_event = { id = mega_wars.80 } } } 
			character_event = { id = mega_wars.82 days = 7 }
		}
	}
	option = {
		name = "EVTOPTCmega_wars.79" #Freedom!
		trigger = { 
			prisoner = no 
			OR = {
				NOT = { trait = kingsguard }
				is_ruler = yes
			}	
		}
		ai_chance = {
			factor = 75
			modifier = {
				factor = 0.1
				NOT = { any_demesne_title = { tier = COUNT } }
			}
			modifier = {
				factor = 0.2
				tier = COUNT
			}
			modifier = {
				factor = 0.4
				tier = DUKE
			}
			modifier = {
				factor = 2
				num_of_king_titles = 2
			}
			modifier = {
				factor = 1.5
				num_of_king_titles = 3
			}
			modifier = {
				factor = 1.5
				trait = brave
			}
			modifier = {
				factor = 1.5
				trait = ambitious
			}
			modifier = {
				factor = 1.25
				trait = gregarious
			}
			modifier = {
				factor = 1.25
				trait = diligent
			}
			modifier = {
				factor = 1.25
				trait = proud
			}
			modifier = {
				factor = 1.25
				martial = 14
			}
		}
		clear_event_target = mega_war_hostage
		if = {
			limit = { 
				tier = KING
				NOT = { liege = { character = FROM } }
				FROM = { tier = EMPEROR }
			}
			clr_character_flag = against_king 
			set_character_flag = neutral
			set_character_flag = opportunist_independence
			hidden_tooltip = { opinion = { who = FROM modifier = opinion_de_facto_liege years = 25 } }
			FROM = {
				reverse_war = {
					target = ROOT
					casus_belli = bid_for_independence_CW
				}
			}	
		}
		if = {
			limit = { NOT = { primary_title = { title = d_kingsguard } } }
			if = {
				limit = { 
					liege = { character = FROM } 
				}
				FROM = {
					reverse_war = {
						target = ROOT
						casus_belli = bid_for_independence
					}
				}	
			}
			if = {
				limit = { 
					NOT = {
						OR = {
							tier = KING
							liege = { character = FROM }
						}
					}	
				}
				FROM = {
					hidden_tooltip = { ROOT = { set_defacto_liege = PREV } }
					reverse_war = {
						target = ROOT
						casus_belli = bid_for_independence
					}
				}	
			}
		}	
		if = {
			limit = { primary_title = { title = d_kingsguard } }
			if = {
				limit = { NOT = { liege = { character = FROM } } }
				set_defacto_liege = FROM
			}
			FROM = {
				reverse_war = {
					target = ROOT
					casus_belli = overthrow_ruler
				}
			}
		}	
		clr_character_flag = mega_war_liege_loan
		clr_character_flag = being_issued_punishment
		clr_character_flag = issue_punishments
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.84 } } }
	}
}
#Character tries to Flee
character_event = {
	id = mega_wars.80
	desc = "Character tries to Flee"
	
	is_triggered_only = yes
	
	option = {
		name = "Got Away" 
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.3
				FROM = { intrigue = 10 }
			}
			modifier = {
				factor = 1.3
				FROM = { intrigue = 13 }
			}
			modifier = {
				factor = 1.3
				FROM = { intrigue = 16 }
			}
			modifier = {
				factor = 1.4
				FROM = { intrigue = 19 }
			}
			modifier = {
				factor = 1.4
				FROM = { job_spymaster = { intrigue = 14 } }
			}
			modifier = {
				factor = 1.4
				FROM = { job_spymaster = { intrigue = 17 } }
			}
			modifier = {
				factor = 1.4
				FROM = { job_spymaster = { intrigue = 20 } }
			}
			modifier = {
				factor = 1.4
				FROM = { job_spymaster = { intrigue = 23 } }
			}
			modifier = {
				factor = 1.4
				FROM = { job_spymaster = { intrigue = 26 } }
			}
		}
		FROM = { character_event = { id = mega_wars.81 days = 10 } }
		FROM = { FROM = { character_event = { id = mega_wars.83 days = 10 } } }
	}
	option = {
		name = "Captured" 
		ai_chance = {
			factor = 50
			modifier = {
				factor = 1.3
				FROM = { FROM = { intrigue = 10 } }
			}
			modifier = {
				factor = 1.3
				FROM = { FROM = { intrigue = 13 } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { intrigue = 16 } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { intrigue = 19 } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { job_spymaster = { intrigue = 14 } } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { job_spymaster = { intrigue = 17 } } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { job_spymaster = { intrigue = 20 } } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { job_spymaster = { intrigue = 23 } } }
			}
			modifier = {
				factor = 1.4
				FROM = { FROM = { job_spymaster = { intrigue = 26 } } }
			}
		}
		FROM = { set_character_flag = captured }
		FROM = { FROM = { character_event = { id = mega_wars.830 days = 10 } } }
	}
}
#Inform got away
character_event = {
	id = mega_wars.81
	desc = "EVTDESCmega_wars.81"
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_playable_ruler = {
			limit = {
				demesne_size = 1
				OR = {
					higher_tier_than = DUKE
					culture_group = ROOT
				}
				NOT = { same_realm = ROOT }
				is_within_diplo_range = ROOT
				
				NOT = { trait = nightswatch }
				NOT = { culture_group = unoccupied_group }
				OR = {
					NOT = { trait = wildling }
					ROOT = { trait = wildling }
				}
				NOT = { culture = old_andal }
				NOT = { culture = rhoynar }	
				NOT = { trait = pirate }
				is_nomadic = no
			}
			save_event_target_as = come_to_me
		}	
	}
	
	option = {
		name = "EVTOPTBmega_wars.81" #golden company
		trigger = { d_golden_company = { has_holder = yes } }
		any_dynasty_member = {
			limit = { 
				NOT = { demesne_size = 1 } 
				at_location = ROOT
			}
			d_golden_company = { holder_scope = { reverse_banish = PREVPREV } }
		}
		any_spouse = {
			limit = { 
				NOT = { demesne_size = 1 } 
				at_location = ROOT
			}
			d_golden_company = { holder_scope = { reverse_banish = PREVPREV } }
		}
		d_golden_company = { holder_scope = { reverse_banish = PREVPREV } }
	}
	option = {
		name = "EVTOPTCmega_wars.81" #random kingdom
		trigger = {
			event_target:come_to_me = { always = yes }
		}
		event_target:come_to_me = {
			ROOT = {
				random_dynasty_member = {
					limit = { 
						NOT = { demesne_size = 1 } 
						at_location = ROOT
					}
					move_character = PREVPREV
				}
				random_spouse = {
					limit = { 
						NOT = { demesne_size = 1 } 
						at_location = ROOT
					}
					move_character = PREVPREV
				}
				move_character = PREV
			}	
		}
		clear_event_target = come_to_me
	}
}
#Inform captured
character_event = {
	id = mega_wars.82
	desc = "EVTDESCmega_wars.82"
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_character_flag = captured
	}
	
	option = {
		name = "EVTOPTAmega_wars.82" 
	}
}	
#Inform King got away
character_event = {
	id = mega_wars.83
	desc = "EVTDESCmega_wars.83"
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.83" 
	}
}	
#Inform King captured
character_event = {
	id = mega_wars.830
	desc = "EVTDESCmega_wars.830"
	
	show_from_from = yes
	
	is_triggered_only = yes
	
	immediate = {
		clear_event_target = mega_war_hostage
		FROMFROM = {
			if = {
				limit = { NOT = { has_character_flag = non_lord_revoked }	}
				current_heir = {
					if = {
						limit = {
							dynasty = PREV
							is_ruler = no
							liege = { character = PREVPREV }
							NOT = { character = ROOT }
							NOT = { character = PREV }
						}
						save_event_target_as = mega_war_hostage
						break = yes
					}			
				}
				random_child = {
					limit = {
						is_alive = yes
						is_ruler = no
						liege = { character = PREVPREV }
						NOT = { character = ROOT }
						NOT = { character = PREV }
					}	
					save_event_target_as = mega_war_hostage
					break = yes
				}		
				random_dynasty_member = {
					limit = {
						is_alive = yes
						is_close_relative = PREV
						is_ruler = no
						liege = { character = PREVPREV }
						NOT = { character = ROOT }
						NOT = { character = PREV }
					}	
					save_event_target_as = mega_war_hostage
					break = yes
				}
			}	
		}	
	}
	
	option = {
		name = "EVTOPTAmega_wars.830" 
		event_target:mega_war_hostage = {
			move_character = FROM
			if = {
				limit = { FROM = { is_in_interregnum_trigger = yes } }
				set_character_flag = interregnum_hostage
			}		
		}
		FROM = {
			FROM = {
				if = {
					limit = {
						NOT = { has_character_flag = non_lord_revoked }
					}	
					any_dynasty_member = {
						limit = {
							is_alive = yes
							NOT = { character = ROOT }
							is_close_relative = FROMFROM
							NOT = { is_close_relative = ROOT }
						}
						opinion = {
							who = ROOT
							modifier = opinion_wiped_out_my_family
							years = 25
						}
					}	
				}	
				hidden_tooltip = {
					character_event = { id = 154 } #on_executed event
				}	
				death = {
					death_reason = death_execution
					killer = ROOT
				}
			}
		}
		if = {
			limit = { 
				FROM = { FROM = { NOT = { age = 16 } } }
			}
			FROM = {
				FROM = {
					any_dynasty_member = {
						limit = {
							is_alive = yes
							NOT = { character = ROOT }
							is_close_relative = FROMFROM
						}
						opinion = {
							who = ROOT
							modifier = opinion_executed_child
							years = 25
						}
					}
				}
			}	
		}	
	}
}	
#Inform King of rebellion
letter_event = {
	id = mega_wars.84
	desc = "EVTDESCmega_wars.84"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.84" 
	}
}	
#Inform Kingsguard/Most Devout pardoned
letter_event = {
	id = mega_wars.85
	desc = "EVTDESCmega_wars.85"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.76" 
		clr_character_flag = issue_punishments
	}
}	

#Rebel Leader resolution, deals with defeated emperor
character_event = {
	id = mega_wars.86
	desc = "EVTDESCmega_wars.86"
	
	is_triggered_only = yes
	
	trigger = { 
		OR = {
			AND = {
				trait = kingsguard
				NOT = { has_character_flag = TOJ_kingsguard }	
			}	
			AND = { #Is the emperor
				trait = civil_war
				OR = { #Must have reason to judge
					AND = {
						NOT = { tier = EMPEROR } #implies usurped
						FROM = { 
							tier = EMPEROR
							OR = {
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_usurped_title }
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT }
							}	
						}
					}	
					reverse_has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
					reverse_has_opinion_modifier = { who = FROMFROM modifier = opinion_vengeance }
					AND = {
						prisoner = yes
						host = { character = FROM }
					}
				}
			}	
			AND = { #Any other defenders must be vassal of victor
				demesne_size = 1
				FROM = { 
					tier = EMPEROR 
					OR = {
						is_vassal_or_below = ROOT
						any_demesne_title = {
							tier = EMPEROR
							ROOT = {
								primary_title = {
									lower_tier_than = EMPEROR
									is_variable_equal = { which = "de_facto_empire" which = PREVPREV }
								}
							}
							check_variable = { which = "de_facto_empire" value = 0.9 }
						}
					}
				}
				NOT = { tier = EMPEROR } 
				NOT = { has_character_flag = independant }
				NOT = { any_liege = { has_character_flag = independant NOT = { character = FROM } } }
			}
		}
	}
	
	immediate = {	
		# any_courtier = {
			# limit = { trait = kingsguard }
			# d_kingsguard = { holder_scope = { move_character = FROMFROM } }
		# }
		if = { #Special effects for defeated 'emperor'
			limit = { 
				trait = civil_war
			}
			any_courtier = { #Remove descendants of rebel victor from potential judgement
				limit = {
					has_character_flag = former_royal_courtier
					OR = {
						is_close_relative = ROOT
						dynasty = ROOT
					}
					OR = {
						is_child_of = FROM
						is_married = FROM
						father_even_if_dead = { is_child_of = FROM }
						mother_even_if_dead = { is_child_of = FROM }
					}	
					NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_vengeance } }
					NOT = { character = ROOT }
				}	
				clr_character_flag = former_royal_courtier
			}
			#If enemy has usurped the emperor's title, change orientation of former emperor's allies and manage flags
			if = {
				limit = { 
					NOT = { tier = EMPEROR }
					FROM = { 
						tier = EMPEROR
						OR = {
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_usurped_title }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_subjugated_AGOT }
						}	
					}
				}
				
				#Manage traits/flags
				FROM = { #Victor
					add_trait = civil_war 
					if = {
						limit = { ROOT = { NOT = { trait = rebel_leader } } }
						remove_trait = rebel_leader
					}
					if = { #If old emperor was at war with another emperor reset connections
						limit = { trait = rebel_leader }
						any_independent_ruler = {
							limit = { 
								tier = EMPEROR
								NOT = { character = ROOT }
								NOT = { character = PREV }
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader } 
							}
							reverse_opinion = { who = PREV modifier = opinion_emperor_rebel_leader years = 25 }
						}	
						any_independent_ruler = {
							limit = { 
								tier = EMPEROR
								NOT = { character = ROOT }
								NOT = { character = PREV }
								has_opinion_modifier = { who = ROOT modifier = opinion_emperor_rebel_leader } 
							}
							opinion = { who = PREV modifier = opinion_emperor_rebel_leader years = 25 }
						}						
					}
				}			
				any_independent_ruler = {
					limit = {
						has_character_flag = supporting_king
						has_opinion_modifier = { modifier = opinion_with_king who = ROOT }
					}
					clr_character_flag = supporting_king
					set_character_flag = neutral
					any_vassal = {
						clr_character_flag = supporting_king
						set_character_flag = neutral
					}
				}
				any_playable_ruler = {
					limit = {
						has_character_flag = against_king
						has_opinion_modifier = { modifier = opinion_with_rebel_leader who = FROM }
					}
					clr_character_flag = against_king
					set_character_flag = supporting_king
					any_vassal = {
						clr_character_flag = against_king
						set_character_flag = supporting_king
					}
					remove_opinion = { modifier = opinion_with_rebel_leader who = FROM }
					opinion = {
						modifier = opinion_with_king
						who = FROM
						years = 100
					}
				}		
				
				any_courtier = { #Any non hidden relatives stand judgement
					limit = {
						has_character_flag = former_royal_courtier
						NOT = { is_inaccessible_trigger = yes }
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
						}
						OR = {
							prisoner = no
							host = { character = FROM }
							host = { character = ROOT }
						}
						NOT = { demesne_size = 1 }
						NOT = { has_character_flag = exiled_royal_family }
					}
					clr_character_flag = former_royal_courtier
					set_character_flag = judge_me
				}
				if = { #If iron Throne judge kingsguard as well
					limit = { 
						FROM = { has_landed_title = e_iron_throne }
						ROOT = { any_claim = { title = e_iron_throne } }
					}
					d_kingsguard = {
						holder_scope = {
							#character_event = { id = mega_wars.86 }
							any_courtier = {
								limit = { 
									trait = kingsguard
									NOT = { has_character_flag = TOJ_kingsguard }									
								}
								if = {
									limit = { NOT = { has_character_flag = against_king } }
									character_event = { id = mega_wars.86 }
								}	
								if = {
									limit = { has_character_flag = against_king } 
									clr_character_flag = against_king
								}	
							}
						}
					}
				}
				any_courtier = { #Any hidden relatives may go into exile
					limit = {
						has_character_flag = former_royal_courtier
						NOT = { demesne_size = 1 }
						is_inaccessible_trigger = yes
						OR = {
							is_close_relative = ROOT
							dynasty = ROOT
						} 
					}
					clr_character_flag = former_royal_courtier
					remove_trait = in_hiding
					set_character_flag = exiled_royal_family				
				}				
			}	
			if = { #If the enemy desires vengeance judge entire family
				limit = { FROM = { has_opinion_modifier = { who = ROOT modifier = opinion_vengeance } } }
				any_courtier = { #Any non-hidden relatives stand judgement
					limit = {
						has_character_flag = former_royal_courtier
						NOT = { is_inaccessible_trigger = yes }
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
						}
						NOR = {
							is_child_of = FROM
							father_even_if_dead = { is_child_of = FROM }
							mother_even_if_dead = { is_child_of = FROM }
						}
						NOT = { demesne_size = 1 }
						NOT = { has_character_flag = exiled_royal_family }
					}
					clr_character_flag = former_royal_courtier
					set_character_flag = judge_me
				}
			}	
			any_courtier = { #Also judge particular courtiers for vengeance
				limit = {
					has_character_flag = former_royal_courtier
					NOT = { is_inaccessible_trigger = yes }
					NOT = { demesne_size = 1 }
					NOT = { has_character_flag = exiled_royal_family }
					reverse_has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
				}
				clr_character_flag = former_royal_courtier
				set_character_flag = judge_me
			}
			any_courtier = { #Clear the rest
				limit = { has_character_flag = former_royal_courtier }
				clr_character_flag = former_royal_courtier
			}
			if = {
				limit = { #if ROOT is hidden send into exile as well
					trait = in_hiding
					is_ruler = no
				}
				set_character_flag = exiled_royal_family
				remove_trait = in_hiding
				clr_character_flag = judge_me
				clr_character_flag = former_royal_courtier
				prisoner = no
			}
			clr_character_flag = former_royal_courtier
		}
		if = {
			limit = { 
				lower_tier_than = KING
				primary_title = { check_variable = { which = "de_facto_kingdom" value = 1 } }
				NOT = { liege = { character = FROM } }
			}
			random_playable_ruler = {
				limit = {
					liege = {
						higher_tier_than = DUKE
						any_demesne_title = {
							higher_tier_than = DUKE
							ROOT = { primary_title = { is_variable_equal = { which = "de_facto_kingdom" which = PREVPREV } } }
							check_variable = { which = "de_facto_kingdom" value = 0.9 }
						}
					}	
				}
				liege = { ROOT = { set_defacto_liege = PREV } }
			}
		}
		if = {
			limit = { 
				independent = yes
			}
			random_independent_ruler = {
				limit = {
					tier = EMPEROR
					war = no
					any_demesne_title = {
						tier = EMPEROR
						ROOT = { primary_title = { is_variable_equal = { which = "de_facto_empire" which = PREVPREV } } }
						check_variable = { which = "de_facto_empire" value = 0.9 }
					}
				}
				ROOT = { set_defacto_liege = PREV }
			}		
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.86" 
		if = {
			limit = { 
				NOT = { has_character_flag = exiled_pretender }
				NOT = { trait = kingsguard } 				
			}
			set_character_flag = issue_punishments
			FROM = {
				character_event = { id = mega_wars.87 tooltip = "TOOLTIPmega_wars.75" }
				set_character_flag = issue_punishments
			}
		}
		if = {
			limit = { 
				trait = kingsguard			
			}
			FROM = {
				FROM = {
					character_event = { id = mega_wars.87 tooltip = "TOOLTIPmega_wars.75" }
					set_character_flag = issue_punishments
				}
			}	
		}			
	}
}
#Rebel Leader decides
character_event = {
	id = mega_wars.87
	desc = "EVTDESCmega_wars.87"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTFmega_wars.87" #pardon
		ai_chance = {
			factor = 40
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 0
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 20
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 40
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 60
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 80
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 100
				}
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = patient
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = kind
			}
			modifier = {
				factor = 1.2
				trait = slothful
			}
			modifier = {
				factor = 1.2
				trait = charitable
			}
			modifier = {
				factor = 1.2
				trait = humble
			}
			modifier = {
				factor = 1.5
				trait = honorable
			}
		}
		FROM = { 
			if = {
				limit = {
					NOT = { has_landed_title = k_the_most_devout }
					NOT = { trait = kingsguard }
					NOT = { primary_title = { controls_religion = yes } }
				}
				custom_tooltip = { text = TOOLTTIPmega_wars.76 } 
				hidden_tooltip = {
					letter_event = { id = mega_wars.76 days = 1 }
				}
			}	
			if = {
				limit = {
					OR = {
						has_landed_title = k_the_most_devout 
						primary_title = { controls_religion = yes }
						trait = kingsguard
					}	
				}
				custom_tooltip = { text = TOOLTTIPmega_wars.76KG } 
				hidden_tooltip = {
					letter_event = { id = mega_wars.85 days = 1 }
				}
			}	
			opinion = {
				who = ROOT
				modifier = opinion_merciful
				years = 5
			}
			if = {
				limit = { is_ruler = yes }
				ROOT = { 
					change_variable = { which = fear_actions value = -5 } 
					hidden_tooltip = { character_event = { id = faction_event_new.90 } }
				}
			}
		}
		if = {
			limit = {
				NOT = { trait = patient }
				NOT = { trait = wroth }
				NOT = { personality_traits = 6 }
			}
			random = {
				chance = 10
				add_trait = patient
				hidden_tooltip = {
					character_event = {
						id = 38264 #Notify Patient
					}
				}
			}
		}
		hidden_tooltip = { #manage flags
			if = {
				limit = { 
					FROM = { trait = civil_war }				
				} 
				FROM = { 
					clr_character_flag = exiled_royal_family
					clr_character_flag = judge_me
					any_courtier = { #Clear the rest
						clr_character_flag = exiled_royal_family
						clr_character_flag = judge_me
					}
				}
			}
		}	
	}
	option = {
		name = "EVTOPTAmega_wars.87" #decide fate individually
		trigger = {
			FROM = {
				trait = civil_war
			}
		}
		ai_chance = {
			factor = 80
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 1.5
				trait = kind
			}
			modifier = {
				factor = 0.8
				trait = slothful
			}
			modifier = {
				factor = 1.2
				trait = charitable
			}
			modifier = {
				factor = 1.2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = honorable
			}
		}
		FROM = { 
			if = { #decide what to do with exiles
				limit = { 
					OR = {
						has_character_flag = exiled_royal_family
						any_courtier = { 
							has_character_flag = exiled_royal_family 
							OR = {
								dynasty = PREV
								is_close_relative = PREV
							}
						}
						any_spouse = { has_character_flag = exiled_royal_family }
					}			
				} 
				ROOT = { character_event = { id = mega_wars.94 tooltip = TOOLTIPmega_wars.94 } }
			}			
			if = { #Check if execution of emperor is just
				limit = { 
					has_opinion_modifier = { who = ROOT modifier = opinion_usurped_title }
					any_claim = { tier = EMPEROR }
					ROOT = { tier = EMPEROR } 
					NOT = { has_character_flag = exiled_royal_family }
				}
				set_character_flag = just_execution
			}	
			
			#Find family members to judge
			if = {
				limit = { 
					NOT = { has_character_flag = exiled_royal_family }
				}
				character_event = { id = mega_wars.88 days = 1 tooltip = "TOOLTIPmega_wars.88" }
			}	
			any_courtier = {
				limit = {
					has_character_flag = judge_me
				}
				character_event = { id = mega_wars.88 days = 1 tooltip = "TOOLTIPmega_wars.88" }
				clr_character_flag = judge_me
			}	
		}
	}
	option = {
		name = "EVTOPTBmega_wars.87" #Kill them all!
		trigger = {
			OR = {
				AND = {
					FROM = {
						has_opinion_modifier = { who = ROOT modifier = opinion_usurped_title }
						any_claim = { tier = EMPEROR }
					}	
					ROOT = { tier = EMPEROR }
				}
				has_opinion_modifier = { who = FROM modifier = opinion_vengeance }
			}
			FROM = {
				trait = civil_war
			}
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
		}
		ai_chance = {
			factor = 20
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.05
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}	
		}
		FROM = {
			#Hidden family is Exiled
			if = {
				limit = { 
					OR = {
						has_character_flag = exiled_royal_family
						any_courtier = { 
							has_character_flag = exiled_royal_family 
							OR = {
								dynasty = PREV
								is_close_relative = PREV
							}
						}
						any_spouse = { has_character_flag = exiled_royal_family }
					}				
				} 
				ROOT = {
					set_character_flag = mega_wars.94alreadyexiled
					character_event = { id = mega_wars.94 tooltip = CTOOLTIPmega_wars.94 }
				}	
			}
			any_demesne_title = {
				limit = { empire = { holder_scope = { character = ROOT } } }
				usurp_title = { target = ROOT type = claim }
			}
			if = {
				limit = { 
					has_opinion_modifier = { who = ROOT modifier = opinion_usurped_title }
					any_claim = { tier = EMPEROR }
					ROOT = { tier = EMPEROR } 
					NOT = { has_character_flag = exiled_royal_family }
				}
				set_character_flag = just_execution
			}	
			if = {
				limit = { 
					NOT = { has_character_flag = exiled_royal_family }
				}			
				letter_event = { id = mega_wars.93 days = 1 tooltip = TOOLTIPmega_wars.93 }
			}	
			any_courtier = {
				limit = {
					has_character_flag = judge_me	
				}
				if = {
					limit = {
						ROOT = { PREV = { just_execution_reason_PREV_trigger = yes } }
					}
					set_character_flag = just_execution
				}
				letter_event = { id = mega_wars.93 tooltip = TOOLTIPmega_wars.93 } 
				clr_character_flag = judge_me
			}		
		}		
		custom_tooltip = { text = 999900967WARNING }
	}	
	option = {
		name = "EVTOPTBmega_wars.75" #Imprison
		trigger = {
			tier = EMPEROR
			FROM = { NOT = { trait = civil_war } }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
		}
		FROM = {
			set_character_flag = being_issued_punishment
			if = {
				limit = { prisoner = yes }
				custom_tooltip = { text = TOOLTIPmega_wars.77LIEGE }
			}	
			if = {
				limit = { prisoner = no }
				custom_tooltip = { text = TOOLTIPmega_wars.77LIEGEREBEL }
			}	
			hidden_tooltip = { letter_event = { id = mega_wars.77 days = 1 } }
		}
	}
	
	option = {
		name = "EVTOPTCmega_wars.75" #revoke primary title
		trigger = {
			tier = EMPEROR
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
			FROM = {
				NOT = { trait = civil_war }
				is_nomadic = no
				NOT = {
					OR = {
						has_landed_title = k_the_most_devout
						primary_title = { controls_religion = yes }
						trait = kingsguard
					}	
				}	
			}
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 0.5
				FROM = { prisoner = no }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = arbitrary
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
			modifier = {
				factor = 4
				has_character_flag = harsh_justice
			}		
		}
		if = {
			limit = { 
				FROM = {
					OR = {
						independent = yes
						tier = KING
						liege = { character = ROOT }
					}
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.78LIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.78LIEGEREBEL }
				}	
				hidden_tooltip = { letter_event = { id = mega_wars.78 days = 1 } }
			}
		}
		if = {
			limit = { 
				FROM = {
					NOT = {
						OR = {
							independent = yes
							tier = KING
							liege = { character = ROOT }
						}
					}	
				}	
			}
			FROM = {	
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.78NONLIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.78NONLIEGEREBEL }
				}
				hidden_tooltip = { letter_event = { id = mega_wars.78 days = 1 } }
			}
		}
		custom_tooltip = { text = TOOLTIPmega_wars.78TYRANNY }
		change_variable = { which = "tyrant" value = 5 } 
		hidden_tooltip = { character_event = { id = maintenance.1 } }#tyrant trait	
	}
	
	option = {
		name = "EVTOPTDmega_wars.75" #revoke all titles
		trigger = {
			tier = EMPEROR
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			OR = {
				NOT = { has_dlc = "Zeus" }
				AND = {
					has_regent = no
					NOT = { primary_title = { has_law = justice_voting_power_1 } }
				}	
			}
			FROM = {
				is_nomadic = no
				NOT = { trait = civil_war }
				OR = {
					demesne_size = 2
					higher_tier_than = COUNT
				}
				NOT = {
					OR = {
						has_landed_title = k_the_most_devout
						primary_title = { controls_religion = yes }
						trait = kingsguard
					}	
				}					
			}
			NOT = {
				OR = {
					trait = just
					trait = honorable
					trait = patient
				}
			}	
			OR = {
				trait = wroth
				trait = lunatic
				trait = arbitrary
				trait = cruel
				trait = ruthless
				has_character_flag = harsh_justice
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.5
				FROM = { prisoner = no }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.1
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 6
				has_character_flag = harsh_justice
			}	
		}
		if = {
			limit = { 
				FROM = {
					OR = {	
						tier = KING
						liege = { character = ROOT }
						independent = yes
					}
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.79LIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.79LIEGEREBEL }
				}
				hidden_tooltip = { letter_event = { id = mega_wars.79 days = 1 } }
			}
		}
		if = {
			limit = { 
				FROM = {
					NOT = {
						OR = {
							tier = KING
							liege = { character = ROOT }
							independent = yes
						}
					}	
				}	
			}
			FROM = {
				set_character_flag = being_issued_punishment
				if = {
					limit = { prisoner = yes }
					custom_tooltip = { text = TOOLTIPmega_wars.79NONLIEGE }
				}	
				if = {
					limit = { prisoner = no }
					custom_tooltip = { text = TOOLTIPmega_wars.79NONLIEGEREBEL }
				}
				hidden_tooltip = { letter_event = { id = mega_wars.79 days = 1 } }
			}
		}	
		custom_tooltip = { text = TOOLTIPmega_wars.78TYRANNY }
		change_variable = { which = "tyrant" value = 10 } 
		hidden_tooltip = { character_event = { id = maintenance.1 } }#tyrant trait	
	}
	option = {
		name = "EVTOPTEmega_wars.75" #Remove from the Kingsguard
		trigger = {
			has_landed_title = e_iron_throne
			FROM = { trait = kingsguard }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
		}
		FROM = {
			remove_trait = kingsguard
			if = {
				limit = { is_ruler = yes }
				hidden_tooltip = { #Universal on death/abdication event
					if = {
						limit = { has_character_modifier = owns_valyrian_steel_sword }
						set_character_flag = do_not_inherit_sword
					}
					set_character_flag = abdication
					character_event = { id = 45341 } 
					clr_character_flag = abdication
					clr_character_flag = do_not_inherit_sword
					transfer_wealth_to_heir_effect = yes
				}
				abdicate = yes
			}	
			recalc_succession = yes
			#hidden_tooltip = { letter_event = { id = 999900962 days = 1 } }
		}
	}	
	option = {
		name = "EVTOPTFmega_wars.75" #New High Septon
		trigger = {
			tier = EMPEROR
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			FROM = { has_landed_title = k_the_most_devout  }
		}
		ai_chance = {
			factor = 25
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.2
				trait = just
			}
			modifier = {
				factor = 1.2
				trait = cruel
			}
			modifier = {
				factor = 1.2
				trait = diligent
			}
			modifier = {
				factor = 1.2
				trait = greedy
			}
			modifier = {
				factor = 1.2
				trait = proud
			}
			modifier = {
				factor = 1.2
				trait = ruthless
			}
		}
		extrajudicial_action_tyranny_effect = yes #Using this when council has powers over justice incurs 10 tyranny
		FROM = {
			set_character_flag = being_issued_punishment
			if = {
				limit = { prisoner = yes }
				custom_tooltip = { text = TOOLTIPmega_wars.78HS }
			}	
			if = {
				limit = { prisoner = no }
				custom_tooltip = { text = TOOLTIPmega_wars.78HSREBEL }
			}
			hidden_tooltip = { letter_event = { id = mega_wars.78 days = 1 } }
		}
	}	
	option = {
		name = "EVTOPTGmega_wars.75" #Bring me his head!
		trigger = {
			has_landed_title = e_iron_throne
			FROM = {
				OR = {
					has_landed_title = k_the_most_devout
					trait = kingsguard
				}	
			}
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 0.5
				FROM = { prisoner = no }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.1
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
		}
		extrajudicial_action_tyranny_effect = yes #Using this when council has powers over justice incurs 10 tyranny
		FROM = {
			set_character_flag = being_issued_punishment
			if = {
				limit = { prisoner = yes }
				custom_tooltip = { text = TOOLTIPmega_wars.79HSKG }
			}	
			if = {
				limit = { prisoner = no }
				custom_tooltip = { text = TOOLTIPmega_wars.79HSKGREBEL }
			}
			hidden_tooltip = { letter_event = { id = mega_wars.79 days = 1 } }
		}
	}	
}
#Inform royal family rebel leader will judge them
character_event = {
	id = mega_wars.88
	desc = "EVTDESCmega_wars.88"
	
	is_triggered_only = yes
		
	option = {
		name = "EVTOPTAmega_wars.88" 
		clr_character_flag = former_royal_courtier
		FROM = {
			character_event = { id = mega_wars.89 tooltip = "TOOLTIPmega_wars.75" }
		}
	}
}	
#Rebel leader decides fate
character_event  = {
	id = mega_wars.89
	desc = "EVTDESCmega_wars.89"
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				FROM = { just_execution_reason_PREV_trigger = yes }
			}
			FROM = { set_character_flag = just_execution }
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.89" #spare
		ai_chance = {
			factor = 10
			modifier = {
				factor = 5
				OR = {
					any_child = { character = FROM }
					any_child = { any_child = { character = FROM } }
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 0
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 20
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 40
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 60
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 80
				}
			}
			modifier = {
				factor = 1.2
				opinion = {
					who = FROM
					value = 100
				}
			}
			modifier = {
				factor = 1.5
				trait = trusting
			}
			modifier = {
				factor = 1.5
				trait = craven
			}
			modifier = {
				factor = 1.5
				trait = patient
			}
			modifier = {
				factor = 1.2
				trait = kind
			}
			modifier = {
				factor = 1.2
				trait = slothful
			}
			modifier = {
				factor = 1.2
				trait = charitable
			}
			modifier = {
				factor = 1.2
				trait = humble
			}
		}
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.90 } } }
	}
	option = {
		name = "EVTOPTBmega_wars.89" #imprison
		ai_chance = {
			factor = 10
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
		}
		FROM = {
			imprison = ROOT
		}
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.91 } } }
	}
	option = {
		name = "EVTOPTCmega_wars.89" #take as hostage
		trigger = { 
			FROM = {
				NOT = { age = 16 } 
				is_ruler = no
			} 
		}
		ai_chance = {
			factor = 10
			modifier = {
				factor = 20
				OR = {
					any_child = { character = FROM }
					any_child = { any_child = { character = FROM } }
				}
			}
			modifier = {
				factor = 1.5
				trait = diligent
			}
			modifier = {
				factor = 1.5
				trait = just
			}
			modifier = {
				factor = 1.5
				trait = honorable
			}
		}
		FROM = { move_character = ROOT }
		if = {
			limit = { prisoner = yes }
			prisoner = no
		}		
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.92 } } }
	}
	option = {
		name = "EVTOPTDmega_wars.89" #execute	
		trigger = { 
			OR = {
				NOT = { has_dlc = "Zeus" }				
				NOT = { primary_title = { has_law = justice_voting_power_1 } }
				has_regent = no
			}
		}
		ai_chance = {
			factor = 1
			
			modifier = {
				factor = 0			
				NOT = { trait = arbitrary }
				primary_title = { has_law = justice_voting_power_1 }
			}
			modifier = {
				factor = 0.1
				trait = just
				FROM = { NOT = { has_character_flag = just_execution } }
			}
			modifier = {
				factor = 0.1
				trait = honorable
				FROM = { NOT = { has_character_flag = just_execution } }
			}
			modifier = {
				factor = 25
				FROM = { has_character_flag = just_execution } 
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.1
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
		}
		if = {
			limit = {
				FROM = { NOT = { has_character_flag = just_execution } }
			}	
			tooltip = { change_variable = { which = "tyrant" value = 10 } }
			piety = -30
		}
		extrajudicial_action_tyranny_effect = yes #Using this when council has powers over justice incurs 10 tyranny
		FROM = { letter_event = { id = mega_wars.93 tooltip = TOOLTIPmega_wars.93 } } 
	}
	option = {
		name = "EVTOPTEmega_wars.89" #execute & confiscate lands
		trigger = {
			OR = {
				NOT = { has_dlc = "Zeus" }				
				NOT = { primary_title = { has_law = justice_voting_power_1 } }
				has_regent = no
			}
			NOT = { crownlaw_title = { has_law = centralization_0 } } #Can't revoke on minimum authority
			FROM = {
				has_opinion_modifier = { who = ROOT modifier = opinion_usurped_title }
				any_claim = { tier = EMPEROR }
				any_demesne_title = { empire = { holder_scope = { character = ROOT } } }
			} 
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 0			
				NOT = { trait = arbitrary }
				primary_title = { has_law = justice_voting_power_1 }
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = 0 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -19 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -39 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -59 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -79 }
				}	
			}
			modifier = {
				factor = 1.2
				NOT = {
					opinion = { who = FROM value = -99 }
				}	
			}
			modifier = {
				factor = 0.1
				FROM = { dynasty = ROOT }
			}
			modifier = {
				factor = 0.25
				FROM = { NOT = { age = 16 } }
			}
			modifier = {
				factor = 1.5
				trait = paranoid
			}
			modifier = {
				factor = 1.5
				trait = wroth
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				trait = cruel
			}
			modifier = {
				factor = 1.5
				trait = greedy
			}
			modifier = {
				factor = 1.5
				trait = proud
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = lunatic
			}
		}
		tooltip = { change_variable = { which = "tyrant" value = 10 } }
		piety = -30
		extrajudicial_action_tyranny_effect = yes #Using this when council has powers over justice incurs 10 tyranny
		FROM = { 
			clr_character_flag = just_execution
			any_demesne_title = {
				limit = { empire = { holder_scope = { character = ROOT } } }
				usurp_title = { target = ROOT type = claim }
			}
			letter_event = { id = mega_wars.93 tooltip = TOOLTIPmega_wars.93 } 
		} 
	}	
}
#Inform spared
letter_event  = {
	id = mega_wars.90
	desc = "EVTDESCmega_wars.90"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.90"  
		clr_character_flag = just_execution
		clr_character_flag = issue_punishments
	}
}
#Inform imprisoned
letter_event  = {
	id = mega_wars.91
	desc = "EVTDESCmega_wars.91"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.91"  		
		imprison = FROM
		clr_character_flag = just_execution
		clr_character_flag = issue_punishments
		if = {
			limit = { FROM = { is_in_interregnum_trigger = yes } }
			set_character_flag = interregnum_prisoner
		}
	}
}
#Inform taken hostage
letter_event  = {
	id = mega_wars.92
	desc = "EVTDESCmega_wars.92"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.92"  
		FROM = { ROOT = { move_character = PREV } }
		if = {
			limit = { FROM = { is_in_interregnum_trigger = yes } }
			set_character_flag = interregnum_hostage
		}
		clr_character_flag = just_execution
		clr_character_flag = issue_punishments
	}
}
#Inform executed
letter_event  = {
	id = mega_wars.93
	desc = "EVTDESCmega_wars.93"
	
	is_triggered_only = yes
	
	immediate = {
		hidden_tooltip = {
			if = {
				limit = {
					NOT = { has_character_flag = just_execution }
				}
				FROM = {
					set_character_flag = unjust_execution #This give family the vengeance modifier
					change_variable = { which = "tyrant" value = 5 } 
					hidden_tooltip = { character_event = { id = maintenance.1 } }#tyrant trait	
				}	
			}		
		}	
	}
	
	option = {
		name = "EVTOPTAmega_wars.93" 
		tooltip = {
			death = {
				death_reason = death_execution
				killer = FROM
			}
		}	
		hidden_tooltip = { FROM = { character_event = { id = imprisoned.10 } } } #Select execution method		
	}
}
#Inform rebel leader royal family flees
character_event  = {
	id = mega_wars.94

	is_triggered_only = yes
	
	desc = {
		text = EVTDESCmega_wars.94
		trigger = { NOT = { has_character_flag = mega_wars.94alreadyexiled } }
	}
	desc = {
		text = EVTDESCmega_wars.94B
		trigger = { has_character_flag = mega_wars.94alreadyexiled }
	}
	
	immediate = {
		#Move exiles to another court if in ROOT's realm
		random_playable_ruler = { 
			limit = {
				demesne_size = 1
				OR = {
					higher_tier_than = DUKE
					culture_group = FROMFROM
				}
				NOT = { same_realm = ROOT }
				is_within_diplo_range = ROOT
				NOT = { 
					primary_title = { 
						ROOT = { 
							any_demesne_title = {
								tier = EMPEROR
								is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
							}
						} 
					}
				}
				
				NOT = { trait = nightswatch }
				NOT = { culture_group = unoccupied_group }
				OR = {
					NOT = { trait = wildling }
					FROMFROM = { trait = wildling }
				}
				NOT = { culture = old_andal }
				NOT = { culture = rhoynar }	
				NOT = { trait = pirate }	
				is_nomadic = no
			}
			save_event_target_as = exiled_realm
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.94"  #Leave them be
		trigger = { NOT = { has_character_flag = mega_wars.94alreadyexiled } }
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 2
				trait = kind
			}
		}
		piety = 50
		FROM = {
			FROM = { 
				clr_character_flag = exiled_royal_family
				any_courtier = { #Clear the rest
					clr_character_flag = exiled_royal_family
				}
				any_spouse = { #Clear the rest
					clr_character_flag = exiled_royal_family
				}
			}
		}	
	}
	
	option = {
		name = "EVTOPTBmega_wars.94"   #Declare them enemies of the realm
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = cruel
			}
		}
		custom_tooltip = { text = CTOOLTIPmega_wars.94A }		
		clr_character_flag = mega_wars.94alreadyexiled
		event_target:exiled_realm = {
			FROMFROM = { 
				any_courtier = {
					limit = { 
						has_character_flag = exiled_royal_family 
						is_ruler = no
						NOT = { character = PREV }
						OR = {
							dynasty = PREV
							is_close_relative = PREV
						}
					}
					reverse_opinion = {
						who = ROOT
						modifier = opinion_exiled_pretender
					}
					hidden_tooltip = { 
						if = {
							limit = {
								liege = { 
									primary_title = { 
										ROOT = { 
											any_demesne_title = {
												tier = EMPEROR
												is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
											} 
										}
									}
								}
							}
							move_character = PREVPREV
						}							
					}
				}
				any_spouse = {
					limit = { 
						has_character_flag = exiled_royal_family 
						is_ruler = no
						NOT = {
							OR = {
								dynasty = PREV
								is_close_relative = PREV
							}
						}	
					}
					reverse_opinion = {
						who = ROOT
						modifier = opinion_exiled_pretender
					}
					hidden_tooltip = { 
						if = {
							limit = {
								liege = { 
									primary_title = { 
										ROOT = { 
											any_demesne_title = {
												tier = EMPEROR
												is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
											} 
										}
									}
								}
							}
							move_character = PREVPREV
						}							
					}
				}
				if = {
					limit = { 
						has_character_flag = exiled_royal_family 
						is_ruler = no
					}
					reverse_opinion = {
						who = ROOT
						modifier = opinion_exiled_pretender
					}
					hidden_tooltip = { 
						if = {
							limit = {
								liege = { 
									primary_title = { 
										ROOT = { 
											any_demesne_title = {
												tier = EMPEROR
												is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
											} 
										}
									}
								}
							}
							move_character = PREVPREV
						}							
					}
				}
			}
		}	
		hidden_tooltip = {
			any_playable_ruler = {
				limit = { 
					ai = no
					NOT = { character = ROOT }
					OR = {
						is_liege_or_above = ROOT
						primary_title = { 
							ROOT = { 
								any_demesne_title = {
									tier = EMPEROR
									is_variable_equal = { which = "de_facto_empire" which = PREVPREV } 
								} 
							} 
						}
					}
				}
				letter_event = { id = mega_wars.95 }
			}
		}
	}
}
#Inform realm
letter_event  = {
	id = mega_wars.95
	desc = "EVTDESCmega_wars.95"
	
	is_triggered_only = yes
	
	option = {
		name = "OK"  
		FROMFROMFROM = {
			any_dynasty_member = {
				limit = { has_character_flag = exiled_royal_family }
				tooltip = { }
			}
		}	
	}
}	
#Vassal is harbouring exiled pretender
character_event  = {
	id = mega_wars.96
	desc = "EVTDESCmega_wars.96"
	
	only_independent = yes
	is_triggered_only = yes
	
	trigger = {
		tier = EMPEROR
		any_demesne_title = {
			tier = EMPEROR
			any_claimant = {
				is_ruler = no
				is_liege_or_above = ROOT
				NOT = { liege = { character = ROOT } }
				OR = {
					has_character_flag = exiled_royal_family
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_exiled_pretender
					}
				}	
				NOT = { dynasty = ROOT }
				NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_merciful } }
			}
		}
	}
	
	immediate = {
		random_realm_character = {
			limit = {
				is_ruler = no
				NOT = { liege = { character = ROOT } }
				any_claim = { tier = EMPEROR holder_scope = { character = ROOT } }
				OR = {
					has_character_flag = exiled_royal_family
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_exiled_pretender
					}
				}
				NOT = { dynasty = ROOT }
				NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_merciful } }
			}
			save_event_target_as = exiled_target
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.96"  #Demand they hand them over	
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				trait = lunatic
			}
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = paranoid
			}
			modifier = {
				factor = 2
				trait = cruel
			}
		}
		event_target:exiled_target = {
			custom_tooltip = { text = TOOLTIPmega_wars.96 }
			liege = { tooltip = { } }
			hidden_tooltip = { liege = { letter_event = { id = mega_wars.97 days = 4 } } }
		}
	}
	
	option = {
		name = "EVTOPTBmega_wars.96"  #Leave them be
		ai_chance = {
			factor = 5
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 2
				trait = patient
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 2
				trait = kind
			}
		}
		event_target:exiled_target = {
			opinion = {
				modifier = opinion_merciful
				who = ROOT
				years = 20
			}
		}
	}
}
#Inform lord of demand to hand over exile
letter_event  = {
	id = mega_wars.97
	desc = "EVTDESCmega_wars.97"
	
	is_triggered_only = yes
	
	trigger = {
		event_target:exiled_target = {
			liege = { character = ROOT }
			any_claim = { tier = EMPEROR holder_scope = { character = FROM } }
		}
	}
	
	option = {
		name = "EVTOPTAmega_wars.97"  #I have no choice
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				trait = craven
			}
			modifier = {
				factor = 2
				trait = slothful
			}
			modifier = {
				factor = 2
				trait = content
			}
			modifier = {
				factor = 2
				is_weak_trigger = yes
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = just
			}
			modifier = {
				factor = 2
				tier = COUNT
			}
		}
		event_target:exiled_target = {
			move_character = FROM
			imprison = FROM
			hidden_tooltip = {
				if = {
					limit = { trait = slave }
					reverse_remove_opinion = { who = ROOT modifier = opinion_my_slave }
					remove_opinion = { who = ROOT modifier = opinion_my_owner }
					reverse_opinion = { who = FROM modifier = opinion_my_slave }
					opinion = { who = FROM modifier = opinion_my_owner }
				}
			}	
			opinion = {
				modifier = opinion_gave_me_up
				who = ROOT
				years = 10
			}
			any_courtier = {
				limit = {
					liege = { character = ROOT }
					OR = {
						has_character_flag = exiled_royal_family
						reverse_has_opinion_modifier = {
							who = FROM
							modifier = opinion_exiled_pretender
						}
					}
					OR = {
						dynasty = PREV
						is_close_relative = PREV
					}
					NOT = { character = PREV }
					NOT = { has_opinion_modifier = { who = FROM modifier = opinion_merciful } }
				}
				move_character = FROM
				imprison = FROM
				opinion = {
					modifier = opinion_gave_me_up
					who = ROOT
					years = 10
				}
				hidden_tooltip = {
					if = {
						limit = { trait = slave }
						reverse_remove_opinion = { who = ROOT modifier = opinion_my_slave }
						remove_opinion = { who = ROOT modifier = opinion_my_owner }
						reverse_opinion = { who = FROM modifier = opinion_my_slave }
						opinion = { who = FROM modifier = opinion_my_owner }
					}
				}
			}
		}
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.98 } } }
	}
	
	option = {
		name = "EVTOPTBmega_wars.97"  #Never!
		ai_chance = {
			factor = 10
			modifier = {
				factor = 2
				trait = brave
			}
			modifier = {
				factor = 2
				trait = diligent
			}
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 2
				is_strong_trigger = yes
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = arbitrary
			}
			modifier = {
				factor = 1.5
				tier = KING
			}
			modifier = {
				factor = 10
				event_target:exiled_target = {
					dynasty = ROOT
				}	
			}
			modifier = {
				factor = 3
				event_target:exiled_target = {
					is_married = ROOT
				}	
			}
			modifier = {
				factor = 5
				trait = honorable
				event_target:exiled_target = {
					OR = {
						is_married = ROOT
						dynasty = ROOT
					}	
				}	
			}
		}
		clr_global_flag = war_cooldown_period
		set_character_flag = faction_claimant_ultimatum_taken
		if = {
			limit = { liege = { NOT = { character = FROM } } }
			hidden_tooltip = { set_defacto_liege = FROM }
		}
		hidden_tooltip = { FROM = { letter_event = { id = mega_wars.99 } } }
		event_target:exiled_target = {
			if = { #Check war is actually possible
				limit = {
					OR = {			
						can_press_claims_trigger = yes
						trait = slave
					}
				}
				character_event = { id = mega_wars.100 tooltip = TOOLTIPmega_wars.100 days = 1 }
			}	
			if = { #If not, try another courtier
				limit = {
					NOR = {			
						can_press_claims_trigger = yes
						trait = slave
					}
				}
				random_courtier = {
					limit = {
						liege = { character = ROOT }
						any_claim = { tier = EMPEROR holder_scope = { character = FROM } }
						OR = {
							dynasty = PREV
							is_close_relative = PREV
						}
						OR = {			
							can_press_claims_trigger = yes
							trait = slave
						}
					}
					character_event = { id = mega_wars.100 tooltip = TOOLTIPmega_wars.100 days = 1 }
				}
				#Else just rebel
				if = {
					limit = {
						NOT = {
							any_courtier = {
								liege = { character = ROOT }
								any_claim = { tier = EMPEROR holder_scope = { character = FROM } }
								OR = {
									dynasty = PREV
									is_close_relative = PREV
								}
								OR = {			
									can_press_claims_trigger = yes
									trait = slave
								}
							}
						}
					}
					FROM = {
						reverse_war = {
							target = ROOT
							casus_belli = overthrow_ruler
						}
					}
				}
			}
		}		
	}
}	
#Inform King lord accepts
letter_event  = {
	id = mega_wars.98
	desc = "EVTDESCmega_wars.98"
	
	is_triggered_only = yes
	
	option = {
		name = "OK"  
		reverse_opinion = {
			modifier = opinion_demanded_exile
			who = FROM
			years = 10
		}
	}
}	
#Inform King lord rejects
letter_event  = {
	id = mega_wars.99
	desc = "EVTDESCmega_wars.99"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.99"  
	}
}	
#Claimant delcares war
character_event  = {
	id = mega_wars.100
	desc = "EVTDESCmega_wars.100"
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPTAmega_wars.100" 
		random_claim = {
			limit = {
				tier = EMPEROR
				holder_scope = { character = FROMFROM }
			}
			reverse_war = {
				target = ROOT
				casus_belli = other_claim_on_liege
				thirdparty = FROM
			}
		}	
		FROM = { clr_character_flag = faction_claimant_ultimatum_taken }
	}
}	

### Maintaining the Council ###
character_event = {
	id = mega_wars.101
	desc = EVTDESCmega_wars.101
	
	is_triggered_only = yes
	
	immediate = { # Can't reappoint rulers that are no longer your vassal for whatever reason or already a councillor
		any_opinion_modifier_target = {
			limit = {
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
				}
				OR = {
					NOT = { liege = { character = ROOT } }
					is_councillor = yes
					is_voter = yes
					#has_minor_title = title_master_of_ships_B
					has_minor_title = title_small_council_advisor
					has_minor_title = title_high_admiral_B
					prisoner = yes
					trait = incapable
					is_inaccessible_trigger = yes
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_traitor }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_joined_rebellion }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_traitor_AGOT }
				}
			}
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_castellan }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_marshal }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_learned }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_priest }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_ships }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_advisor }
			reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_admiral }
		}
		clr_character_flag = mega_war_reappointing_council
	}
	
	option = { 
		name = {
			text = EVTOPTAmega_wars.101 # I will reapoint the old council
			trigger = { 
				any_opinion_modifier_target = {
					OR = {
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					}
				}
			}
		}	
		name = {
			text = EVTOPCmega_wars.101 # I will decide my new council
			trigger = { 
				NOT = {
					any_opinion_modifier_target = {
						OR = {
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
						}
					}
				}	
			}
		}
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
				NOT = { ROOT = { regent = { has_job_title = job_castellan } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_castellan
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_castellan } }
			}
		}
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
				NOT = { ROOT = { regent = { has_job_title = job_chancellor } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_chancellor
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_chancellor } }
			}
		}
		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
				NOT = { ROOT = { regent = { has_job_title = job_marshal } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_marshal
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_marshal } }
			}
		}
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
				NOT = { ROOT = { regent = { has_job_title = job_treasurer } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_treasurer
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_treasurer } }
			}
		}
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
				NOT = { ROOT = { regent = { has_job_title = job_spymaster } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_spymaster
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_spymaster } }
			}
		}
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
				NOT = { ROOT = { regent = { has_job_title = job_spiritual } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_spiritual
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_learned } }
			}
		}
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
				NOT = { ROOT = { regent = { has_job_title = job_priest } } }
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				give_job_title = job_priest
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_priest } }
			}
		}
		# random_opinion_modifier_target = {
			# limit = { 
				# reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
				# NOT = { 
					# ROOT = { 
						# regent = { 
							# OR = {
								# has_minor_title = title_master_of_ships
								# has_minor_title = title_master_of_ships_B
							# }	
						# } 
					# } 
				# }
			# }
			# if = {
				# limit = { ai = no }
				# letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			# }
			# if = {
				# limit = { ai = yes }
				# if = {
					# limit = { has_dlc = "Zeus" }
					# hidden_tooltip = {
						# ROOT = {
							# random_courtier = { 
								# limit = { has_minor_title = title_master_of_ships }
								# remove_title = title_master_of_ships
							# }
							# random_vassal = { 
								# limit = { has_minor_title = title_master_of_ships }
								# remove_title = title_master_of_ships
							# }
						# }	
					# }
					# give_minor_title = title_master_of_ships
				# }	
				# if = {
					# limit = { NOT = { has_dlc = "Zeus" } }
					# hidden_tooltip = {
						# ROOT = {
							# random_courtier = { 
								# limit = { has_minor_title = title_master_of_ships_B }
								# remove_title = title_master_of_ships_B
							# }
							# random_vassal = { 
								# limit = { has_minor_title = title_master_of_ships_B }
								# remove_title = title_master_of_ships_B
							# }
						# }	
					# }
					# give_minor_title = title_master_of_ships_B
				# }	
				# hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_ships } }
			# }
		# }
		random_opinion_modifier_target = {
			limit = { 
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
				NOT = { 
					ROOT = { 
						regent = { 
							OR = {
								has_minor_title = title_high_admiral
								has_minor_title = title_high_admiral_B
							}	
						} 
					} 
				}
			}
			if = {
				limit = { ai = no }
				letter_event = { id = mega_wars.102 tooltip = TOOLTIPmega_wars.101 }
			}
			if = {
				limit = { ai = yes }
				if = {
					limit = { has_dlc = "Zeus" }
					hidden_tooltip = {
						ROOT = {
							random_courtier = { 
								limit = { has_minor_title = title_high_admiral }
								remove_title = title_high_admiral
							}
							random_vassal = { 
								limit = { has_minor_title = title_high_admiral }
								remove_title = title_high_admiral
							}
						}	
					}
					give_minor_title = title_high_admiral
				}	
				if = {
					limit = { NOT = { has_dlc = "Zeus" } }
					hidden_tooltip = {
						ROOT = {
							random_courtier = { 
								limit = { has_minor_title = title_high_admiral_B }
								remove_title = title_high_admiral_B
							}
							random_vassal = { 
								limit = { has_minor_title = title_high_admiral_B }
								remove_title = title_high_admiral_B
							}
						}	
					}
					give_minor_title = title_high_admiral_B
				}
				hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_admiral } }
			}
		}
		#Advisors
		if = {
			limit = { has_dlc = "Zeus" }
			tooltip = { #check each in turn so limit isnt exceeded
				any_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					}
					give_minor_title = title_councilmember_king			
				}
			}
			hidden_tooltip = {
				random_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					}
					ROOT = {
						if = {
							limit = { any_voter = { has_minor_title = title_councilmember_king } }
							random_realm_character = { 
								limit = { 
									liege = { character = ROOT }
									has_minor_title = title_councilmember_king
									NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
									NOT = { ROOT = { regent = { character = PREVPREV } } }
								}
								remove_title = title_councilmember_king
								PREVPREV = { give_minor_title = title_councilmember_king }
							}
						}
						if = {
							limit = { NOT = { any_voter = { has_minor_title = title_councilmember_king } } }
							PREV = { give_minor_title = title_councilmember_king }
						}											
					}
					hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
				}
				random_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					}
					ROOT = {
						if = {
							limit = { any_voter = { has_minor_title = title_councilmember_emperor } }
							random_realm_character = { 
								limit = { 
									liege = { character = ROOT }
									has_minor_title = title_councilmember_emperor
									NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
									NOT = { ROOT = { regent = { character = PREVPREV } } }
								}
								remove_title = title_councilmember_emperor
								PREVPREV = { give_minor_title = title_councilmember_emperor }
							}
						}
						if = {
							limit = { NOT = { any_voter = { has_minor_title = title_councilmember_emperor } } }
							PREV = { give_minor_title = title_councilmember_emperor }
						}	
					}
					hidden_tooltip = { reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
				}
			}	
		}	
		if = {
			limit = { NOT = { has_dlc = "Zeus" } }
			tooltip = { #check each in turn so limit isnt exceeded
				any_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					}
					give_minor_title = title_small_council_advisor				
				}
			}	
			hidden_tooltip = {
				random_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
						NOT = { has_minor_title = title_small_council_advisor }
					}
					ROOT = {
						if = {
							limit = {
								any_realm_character = {
									liege = { character = ROOT }
									has_minor_title = title_small_council_advisor 
									count = 3
								}
							}
							random_realm_character = { 
								limit = { 
									liege = { character = ROOT }
									has_minor_title = title_small_council_advisor 
									NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
									NOT = { ROOT = { regent = { character = PREVPREV } } }
								}
								remove_title = title_small_council_advisor 
							}
						}	
					}	
					give_minor_title = title_small_council_advisor
				}
				random_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
						NOT = { has_minor_title = title_small_council_advisor }
					}
					ROOT = {
						if = {
							limit = {
								any_realm_character = {
									liege = { character = ROOT }
									has_minor_title = title_small_council_advisor 
									count = 3
								}
							}
							random_realm_character = { 
								limit = { 
									liege = { character = ROOT }
									has_minor_title = title_small_council_advisor 
									NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
									NOT = { ROOT = { regent = { character = PREVPREV } } }
								}
								remove_title = title_small_council_advisor 
							}
						}	
					}	
					give_minor_title = title_small_council_advisor
				}
				random_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
						NOT = { has_minor_title = title_small_council_advisor }
					}
					ROOT = {
						if = {
							limit = {
								any_realm_character = {
									liege = { character = ROOT }
									has_minor_title = title_small_council_advisor 
									count = 3
								}
							}
							random_realm_character = { 
								limit = { 
									liege = { character = ROOT }
									has_minor_title = title_small_council_advisor 
									NOT = { reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor } }
									NOT = { ROOT = { regent = { character = PREVPREV } } }
								}
								remove_title = title_small_council_advisor 
							}
						}	
					}		
					give_minor_title = title_small_council_advisor
				}	
			}
			hidden_tooltip = {
				any_opinion_modifier_target = {
					limit = { 
						reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
					}
					reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_advisor }
				}
			}
		}		
	}
	option = { # The current council is fine
		name = EVTOPBmega_wars.101
		trigger = {  
			ai = no
			any_opinion_modifier_target = {
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
				}
			}
		}
		any_opinion_modifier_target = {
			limit = {
				OR = {
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_castellan }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_marshal }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_learned }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_priest }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_ships }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_admiral }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_pre_mega_war_advisor }
				}
			}
			opinion = {
				who = ROOT
				modifier = opinion_fired_from_council
			}
			hidden_tooltip = {
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_castellan }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_chancellor }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_marshal }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_treasurer }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_spymaster }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_learned }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_priest }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_ships }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_admiral }
				reverse_remove_opinion  = { who = ROOT modifier = opinion_pre_mega_war_advisor }
			}	
		}
	}
}
# Player offered their old council position back
letter_event = {
	id = mega_wars.102
	desc = EVTDESCmega_wars.102
	
	is_triggered_only = yes
	
	option = { # Of course I want my old job back
		name = EVTOPTAmega_wars.102
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_castellan }
			}
			give_job_title = job_castellan
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_castellan } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_chancellor }
			}
			give_job_title = job_chancellor
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_chancellor } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_marshal }
			}
			give_job_title = job_marshal
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_marshal } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_treasurer }
			}
			give_job_title = job_treasurer
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_treasurer } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_spymaster }
			}
			give_job_title = job_spymaster
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_spymaster } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_learned }
			}
			give_job_title = job_spiritual
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_learned } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_priest }
			}
			give_job_title = job_priest
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_priest } }
		}
		# if = {
			# limit = { 
				# reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_ships }
			# }
			# if = {
				# limit = { has_dlc = "Zeus" }
				# hidden_tooltip = {
					# FROM = {
						# random_courtier = { 
							# limit = { has_minor_title = title_master_of_ships }
							# remove_title = title_master_of_ships
						# }
						# random_vassal = { 
							# limit = { has_minor_title = title_master_of_ships }
							# remove_title = title_master_of_ships
						# }
					# }	
				# }
				# give_minor_title = title_master_of_ships
			# }	
			# if = {
				# limit = { NOT = { has_dlc = "Zeus" } }
				# hidden_tooltip = {
					# FROM = {
						# random_courtier = { 
							# limit = { has_minor_title = title_master_of_ships_B }
							# remove_title = title_master_of_ships_B
						# }
						# random_vassal = { 
							# limit = { has_minor_title = title_master_of_ships_B }
							# remove_title = title_master_of_ships_B
						# }
					# }	
				# }
				# give_minor_title = title_master_of_ships_B
			# }
			# hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_ships } }
		# }
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_admiral }
			}
			if = {
				limit = { has_dlc = "Zeus" }
				hidden_tooltip = {
					FROM = {
						random_courtier = { 
							limit = { has_minor_title = title_high_admiral }
							remove_title = title_high_admiral
						}
						random_vassal = { 
							limit = { has_minor_title = title_high_admiral }
							remove_title = title_high_admiral
						}
					}	
				}
				give_minor_title = title_high_admiral
			}	
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				hidden_tooltip = {
					FROM = {
						random_courtier = { 
							limit = { has_minor_title = title_high_admiral_B }
							remove_title = title_high_admiral_B
						}
						random_vassal = { 
							limit = { has_minor_title = title_high_admiral_B }
							remove_title = title_high_admiral_B
						}
					}	
				}
				give_minor_title = title_high_admiral_B
			}
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_admiral } }
		}
		if = {
			limit = { 
				reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor }
			}
			#Advisors
			if = {
				limit = { has_dlc = "Zeus" }
				hidden_tooltip = {
					FROM = {
						random_opinion_modifier_target = {
							limit = { 
								reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor }
							}
							FROM = {
								random_realm_character = { 
									limit = { 
										liege = { character = FROM }
										has_minor_title = title_councilmember_king
										NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor } }
									}
									remove_title = title_councilmember_king
									PREVPREV = { give_minor_title = title_councilmember_king }
								}	
							}
						}
						random_opinion_modifier_target = {
							limit = { 
								reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor }
							}
							FROM = {
								random_realm_character = { 
									limit = { 
										liege = { character = FROM }
										has_minor_title = title_councilmember_emperor
										NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor } }
									}
									remove_title = title_councilmember_emperor
									PREVPREV = { give_minor_title = title_councilmember_emperor }
								}	
							}
						}
					}
				}	
			}	
			if = {
				limit = { NOT = { has_dlc = "Zeus" } }
				hidden_tooltip = {
					FROM = {
						random_opinion_modifier_target = {
							limit = { 
								reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor }
							}
							FROM = {
								if = {
									limit = {
										any_realm_character = {
											liege = { character = FROM }
											has_minor_title = title_small_council_advisor 
											count = 3
										}
									}
									random_realm_character = { 
										limit = { 
											liege = { character = FROM }
											has_minor_title = title_small_council_advisor 
											NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor } }
										}
										remove_title = title_small_council_advisor 
									}
								}	
							}	
							give_minor_title = title_small_council_advisor
						}
						random_opinion_modifier_target = {
							limit = { 
								reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor }
							}
							FROM = {
								if = {
									limit = {
										any_realm_character = {
											liege = { character = FROM }
											has_minor_title = title_small_council_advisor 
											count = 3
										}
									}
									random_realm_character = { 
										limit = { 
											liege = { character = FROM }
											has_minor_title = title_small_council_advisor 
											NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor } }
										}
										remove_title = title_small_council_advisor 
									}
								}	
							}	
							give_minor_title = title_small_council_advisor
						}
						random_opinion_modifier_target = {
							limit = { 
								reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor }
							}
							FROM = {
								if = {
									limit = {
										any_realm_character = {
											liege = { character = FROM }
											has_minor_title = title_small_council_advisor 
											count = 3
										}
									}
									random_realm_character = { 
										limit = { 
											liege = { character = FROM }
											has_minor_title = title_small_council_advisor 
											NOT = { reverse_has_opinion_modifier = { who = FROM modifier = opinion_pre_mega_war_advisor } }
										}
										remove_title = title_small_council_advisor 
									}
								}	
							}		
							give_minor_title = title_small_council_advisor
						}
					}	
				}
			}
			hidden_tooltip = { reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_advisor } }
		}
		FROM = { letter_event = { id = mega_wars.103 tooltip = TOOLTIPmega_wars.102 } }
	}
	option = { # I am alright thanks
		name = EVTOPTBmega_wars.102
		FROM = { 
			letter_event = { id = mega_wars.103 tooltip = TOOLTIPBmega_wars.102 }		
		}
		hidden_tooltip = {
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_castellan }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_chancellor }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_marshal }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_treasurer }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_spymaster }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_learned }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_priest }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_ships }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_admiral }
			reverse_remove_opinion  = { who = FROM modifier = opinion_pre_mega_war_advisor }
		}
	}
}
# FROM is informed whether the player accepted or not
letter_event = {
	id = mega_wars.103
	
	desc = { # Accepted
		text = EVTDESACmega_wars.103
		trigger = { FROM = { is_councillor = yes } }
	}
	desc = { # Rejected
		text = EVTDESBCmega_wars.103
		trigger = { FROM = { is_councillor = no } }
	}
	
	is_triggered_only = yes
	
	option = {
		name = {
			text = EVTOPTAmega_wars.103
			trigger = { FROM = { is_councillor = yes } }
		}
		name = {
			text = EVTOPTBmega_wars.103
			trigger = { FROM = { is_councillor = no } }
		}
	}
}
# Check player actually sends help in the war
character_event = {
	id = mega_wars.105
	desc = EVTDESACmega_wars.105
	
	is_triggered_only = yes
	ai = no
	only_independent = yes
	war = yes
	
	trigger = {
		any_opinion_modifier_target = {
			is_ruler = yes
			war = yes
			NOT = { war_with = ROOT }	
			OR = {
				AND = {
					tier = EMPEROR
					trait = civil_war
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_with_king
					}
				}
				AND = {
					trait = rebel_leader
					is_ruler = yes
					reverse_has_opinion_modifier = {
						who = ROOT
						modifier = opinion_with_rebel_leader
					}
				}
			}				
			any_war = {
				OR = {
					AND = {
						attacker = { character = PREVPREV }
						defender = { war_with = ROOT }
					}
					AND = {
						defender = { character = PREVPREV }
						attacker = { war_with = ROOT }
					}						
				}
				days_since_last_hostile_action = {
					who = ROOT     # The character whose activity is being checked
					days = 730    # Number of days since last battle participation or offensive siege (2 years)
				}
			}
			NOT = {
				any_war = {
					OR = {
						AND = {
							attacker = { character = PREVPREV }
							defender = { war_with = ROOT }
						}
						AND = {
							defender = { character = PREVPREV }
							attacker = { war_with = ROOT }
						}						
					}
					NOT = {
						days_since_last_hostile_action = {
							who = ROOT     # The character whose activity is being checked
							days = 730    # Number of days since last battle participation or offensive siege (2 years)
						}
					}	
				}
			}	
		}
	}
	
	immediate = {
		if = {
			limit = { has_nickname = no }
			random_list = {
				100 = { }
				10 = { set_character_flag = nick_the_latecomer }
				10 = { 
					modifier = {
						factor = 0
						OR =  {
							is_female = yes
							is_feudal = no
						}	
					}
					set_character_flag = nick_the_late_lord 
				}
				10 = { set_character_flag = nick_the_late }
				10 = { set_character_flag = nick_the_cautious }
				10 = { set_character_flag = nick_the_indecisive }
				10 = { set_character_flag = nick_the_ditherer }
				10 = { set_character_flag = nick_the_waverer }
				10 = { set_character_flag = nick_the_hesitant }
			}
		}
		random_opinion_modifier_target = {
			limit = {
				is_ruler = yes
				war = yes
				NOT = { war_with = ROOT }	
				OR = {
					AND = {
						tier = EMPEROR
						trait = civil_war
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_with_king
						}
					}
					AND = {
						trait = rebel_leader
						is_ruler = yes
						reverse_has_opinion_modifier = {
							who = ROOT
							modifier = opinion_with_rebel_leader
						}
					}
				}				
				any_war = {
					OR = {
						AND = {
							attacker = { character = PREVPREV }
							defender = { war_with = ROOT }
						}
						AND = {
							defender = { character = PREVPREV }
							attacker = { war_with = ROOT }
						}						
					}
					days_since_last_hostile_action = {
						who = ROOT     # The character whose activity is being checked
						days = 730    # Number of days since last battle participation or offensive siege (2 years)
					}
				}
				NOT = {
					any_war = {
						OR = {
							AND = {
								attacker = { character = PREVPREV }
								defender = { war_with = ROOT }
							}
							AND = {
								defender = { character = PREVPREV }
								attacker = { war_with = ROOT }
							}						
						}
						NOT = {
							days_since_last_hostile_action = {
								who = ROOT     # The character whose activity is being checked
								days = 730    # Number of days since last battle participation or offensive siege (2 years)
							}
						}	
					}
				}	
			}	
			save_event_target_as = disgruntled_ally
		}
	}

	option = {
		name = EVTOPTAmega_wars.105
		event_target:disgruntled_ally = {
			opinion = { 
				who = ROOT 
				modifier = opinion_dithered 
				years = 10
				multiplier = 2
			}
		}	
		prestige = -100
		if = { #If this happens more than once, add dishonour
			limit = { has_character_flag = mega_war_known_ditherer }
			change_variable = { which = "dishonorable" value = 10 } 
			hidden_tooltip = { character_event = { id = maintenance.3 } } #dishonour trait
		}
		set_character_flag = mega_war_known_ditherer
		if = {
			limit = { has_character_flag = nick_the_latecomer }
			clr_character_flag = nick_the_latecomer
			give_nickname = nick_the_latecomer
		}
		if = {
			limit = { has_character_flag = nick_the_late_lord }
			clr_character_flag = nick_the_late_lord
			give_nickname = nick_the_late_lord
		}
		if = {
			limit = { has_character_flag = nick_the_late }
			clr_character_flag = nick_the_late
			give_nickname = nick_the_late
		}
		if = {
			limit = { has_character_flag = nick_the_cautious }
			clr_character_flag = nick_the_cautious
			give_nickname = nick_the_cautious
		}
		if = {
			limit = { has_character_flag = nick_the_indecisive }
			clr_character_flag = nick_the_indecisive
			give_nickname = nick_the_indecisive
		}
		if = {
			limit = { has_character_flag = nick_the_ditherer }
			clr_character_flag = nick_the_ditherer
			give_nickname = nick_the_ditherer
		}
		if = {
			limit = { has_character_flag = nick_the_waverer }
			clr_character_flag = nick_the_waverer
			give_nickname = nick_the_waverer
		}
		if = {
			limit = { has_character_flag = nick_the_hesitant }
			clr_character_flag = nick_the_hesitant
			give_nickname = nick_the_hesitant
		}
	}
}
