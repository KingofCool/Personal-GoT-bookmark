namespace = siege_agot

#Originally by waylit
#Extended and adjusted for AGOT

#on_siege_won_leader events
#siege_agot.1
#siege_agot.2
#siege_agot.3
#siege_agot.4


#1 prestige for the winner of a siege, or take banner for 5 prestige and op malus
character_event = {
	id = siege_agot.1
	desc = "EVTDESCsiegeprestige"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		FROM = { 
			holder_scope = { 
				NOT = { culture_group = unoccupied_group }
			}
			NOT = { holding_type = nomad }
		}	
	}
	
	immediate = {
		FROM = { #Destroy Colony
			if = {
				limit = { is_capital = yes }
				location = {
					if = {
						limit = { 
							has_province_flag = colony_province
							owner = {
								NOT = { culture_group = unoccupied_group }
								any_demesne_title = { title = ROOT_FROM }
							}
						}
						random = {
							chance = 50
							province_event = { id = unoccupied.7 days = 1 } 
						}
					}
				}
			}	
			holder_scope = { #Destroy Infrastructure
				if = {
					limit = { #Owns province
						OR = {
							character = ROOT
							same_realm = ROOT
							ROOT = {
								is_ruler = yes
								is_allied_with = PREV
							}	
							ROOT = { 
								is_ruler = no
								liege = { is_allied_with = PREVPREV }
							}	
						}
					}
					random = {
						chance = 30
						character_event = { id = siege_agot.9 } 
					}	
				}
				if = {
					limit = { #Does not own province
						NOR = {
							character = ROOT
							same_realm = ROOT
							ROOT = {
								is_ruler = yes
								is_allied_with = PREV
							}	
							ROOT = { 
								is_ruler = no
								liege = { is_allied_with = PREVPREV }
							}	
						}	
					}
					character_event = { id = siege_agot.9 } 
				}
				if = {
					limit = { #Destroy flagship
						OR = {
							has_character_modifier = enormous_flagship
							has_character_modifier = regular_flagship
							has_character_modifier = small_flagship
						}
					}
					random = {
						chance = 50
						character_event = { id = ironborn_events.89 } 
					}	
				}
			}
			if = {
				limit = { #Nickname
					ROOT = { 
						has_nickname = no
					}	
					is_capital = yes
					location = {
						is_capital = yes 
						NOT = { has_province_flag = prohibited_nickname_location }
					}
					holder_scope = { 
						NOT = { character = ROOT }
						NOT = { is_vassal_or_below = ROOT }
					}	
					OR = { #only important locations
						holder_scope = { higher_tier_than = DUKE }
						location = { num_of_max_settlements = 5 }
						AND = {
							ROOT = { is_ruler = no }
							location = { num_of_settlements = 3 }
						}
					}
				}
				ROOT = {
					random_list = {
						2000 = { 
							modifier = {
								factor = 2
								higher_tier_than = DUKE #less likely for high rank characters
							}
						}
						5 = { give_nickname = nick_of_the_scourge_of_location }
						5 = { give_nickname = nick_of_the_bane_of_location }
						5 = { give_nickname = nick_of_the_butcher_of_location }
						5 = { give_nickname = nick_of_the_burner_of_location }
						5 = { give_nickname = nick_of_the_breaker_of_location }
						5 = { give_nickname = nick_of_the_hammer_of_location }
						5 = { give_nickname = nick_of_the_fist_of_location }
					}
				}					
			}
		}
	}
	
	option = {
		name = "EVTOPTAsiegewinprestige"
		ai_chance = { 
			factor = 1 
		}
		FROM = { 
			tooltip = { }
		}
	}
	
	# option = {
		# name = "EVTOPTAsiegewinbanner"
		# trigger = {
			# FROM = { holder_scope = { war_with = ROOT } }
		# }		
		
		# ai_chance = { 
			# factor = 0.2 
			# modifier = {
				# factor = 10
				# trait = wroth 
			# }
			# modifier = {
				# factor = 10
				# trait = envious 
			# }
			# modifier = {
				# factor = 20
				# trait = proud
			# }
			# modifier = {
				# factor = 0.1
				# trait = humble
			# }	
		# }
		
		# prestige = 5
		
		# FROM = { 
			# holder_scope = { 
				# prestige = -5	 			
				# opinion = {
					# modifier = stolen_banner
					# who = ROOT
					# months = 12
				# }	
			# }
		# }			
	# }
}

#attacker gets imprisonment options if owner of holding is at holding when it falls in siege, unless all family #"hidden"

character_event = {
	id = siege_agot.2
	desc = "EVTDESCsiegewin01"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	trigger = {
		NOT = { any_liege = { has_landed_title = e_rebels } }
		NOT = { culture_group = winter_group }
		FROM = {
			NOT = { holding_type = nomad }
			holder_scope = {
				NOT = { culture_group = unoccupied_group }
				NOT = { culture_group = winter_group }
				capital_holding = { 
					OR = {
						title = PREVPREV
						controller = {
							NOT = { character = PREVPREV }
						}						
					}	
				}
				at_location = ROOT 
				OR = {
					higher_tier_than = DUKE				
					AND = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}	
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
					any_current_enemy = {
						OR = {
							character = ROOT
							ROOT = { any_liege = { character = PREVPREV } }
						}
					}
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
					any_courtier = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}
					any_liege = {
						NOT = { in_command = yes }
						at_location = ROOT
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}
				}
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
				prisoner = no
			}			
		}
	}

	option = {
		name = "EVTOPTAsiegewin1"
		trigger = {
			liege = {
				FROM = { 
					holder_scope = { 
						OR = {
							war_with = ROOT 
							war_with = PREVPREV
						}	
					} 
				}
			}	
		} 
		ai_chance = {
			factor = 10
			modifier = {
				factor = 1000
				FROM = { 
					holder_scope = { 
						OR = {	
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							any_courtier = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							any_liege = {
								NOT = { in_command = yes }
								at_location = ROOT
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
						}
					} 
				}
			}
			modifier = {
				factor = 5  
				FROM = { holder_scope = { tier = DUKE } }
			}
			modifier = {
				factor = 10  
				FROM = { holder_scope = { higher_tier_than = DUKE } }
			}
			modifier = {
				factor = 2
				trait = cruel
			}
			modifier = {
				factor = 2
				trait = greedy
			}
			modifier = {
				factor = 2
				trait = envious
			}
			modifier = {
				factor = 10
				trait = impaler
			}
			modifier = {
				factor = 10
				trait = wroth
			}
			modifier = {
				factor = 0.25
				trait = charitable
			}
			modifier = {
				factor = 1.5
				trait = just
			}
		}	
		FROM = { 
			holder_scope = {
				#Always imprison direct war enemies
				any_courtier = {  
					limit = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
						NOT = { in_command = yes }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
					}		
					set_character_flag = captured_in_battle 
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
				}
				any_liege = {
					limit = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
						NOT = { in_command = yes }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
					}	
					guardian = { 
						if = {
							limit = {
								NOT = { in_command = yes }
								at_location = ROOT 
								NOT = { character = ROOT } 
								NOT = { is_inaccessible_trigger = yes }
								NOT = { trait = wikid }
								prisoner = no
							}
							set_character_flag = captured_in_battle 
							if = {
								limit = { ROOT = { is_ruler = yes } }
								imprison = ROOT 	
							}
							hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
						}				
					}
					set_character_flag = captured_in_battle 
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform				
				}
				
				###
				
				if = {
					limit = { 
						#at_location = ROOT
						NOT = { is_inaccessible_trigger = yes } 
						NOT = { trait = wikid }
						prisoner = no
						NOT = { character = ROOT }
					}  
					set_character_flag = captured_in_battle
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}	
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
				}							
			}		
		}
		if = {
			limit = { is_ruler = no }
			liege = { character_event = { id = siege_agot.5 } }
		}
	}
		
	option = {
		name = "EVTOPTAsiegewin2"
		trigger = {
			liege = {
				FROM = { 
					holder_scope = { 
						OR = {
							war_with = ROOT 
							war_with = PREVPREV
						}
						any_courtier = {
							OR = {
								AND = {
									dynasty = PREV
									NOT = { dynasty = 0 }
								}	
								is_close_relative = PREV
								is_married = PREV
								AND = {
									OR = {
										is_primary_war_defender = yes
										is_primary_war_attacker = yes						
									}
									ROOT = { 
										OR = {
											war_with = PREV
											any_liege = { war_with = PREVPREV }
										}
									}
								}
								AND = { #Commanders
									government = military_command_government
									tier = BARON
								}
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
							}	
							NOT = { in_command = yes }
							NOT = { trait = dragon }
							NOT = { trait = white_walker }
							NOT = { trait = winter_wasteland }
							NOT = { character = ROOT }
							NOT = { character = PREV }
							at_location = ROOT
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
							NOT = { is_child_of = ROOT }	
							NOT = { father = { is_child_of = ROOT } }
							NOT = { mother = { is_child_of = ROOT } } 			
						}
					} 
				}
			}	
		} #trg
	
		ai_chance = {
			factor = 20
			modifier = {
				factor = 1000
				FROM = { 
					holder_scope = { 
						OR = {	
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							any_courtier = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							any_liege = {
								NOT = { in_command = yes }
								at_location = ROOT
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
						}
					} 
				}
			}
			modifier = {
				factor = 5  
				FROM = { holder_scope = { tier = DUKE } }
			}
			modifier = {
				factor = 10  
				FROM = { holder_scope = { higher_tier_than = DUKE } }
			}
			modifier = {
				factor = 20
				trait = slave_trader
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 4
				trait = cruel
			}
			modifier = {
				factor = 4
				trait = greedy
			}
			modifier = {
				factor = 4
				trait = ruthless
			}
			modifier = {
				factor = 4
				trait = wroth
			}
			modifier = {
				factor = 0.05
				trait = kind
			}
			modifier = {
				factor = 0.05
				trait = honorable
			}			
		} 
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random = { 
				chance = 10
				if = {
					limit = {
						NOT = { trait = greedy }
						NOT = { trait = charitable }
					}	
					add_trait = greedy
					hidden_tooltip = {
						character_event = {
							id = 38252 #Notify
						}
					}
				}
			}
		}	
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random = { 
				chance = 10
				if = {
					limit = {
						NOT = { trait = cruel }
						NOT = { trait = kind }
					}	
					add_trait = cruel
					hidden_tooltip = {
						character_event = {
							id = 38259 #Notify
						}
					}
				}
				if = {
					limit = {
						trait = kind
					}	
					remove_trait = kind
					hidden_tooltip = {
						character_event = {
							id = 38307 #Notify
						}
					}
				}	
			}
		}	
		FROM = { 
			holder_scope = { 
				any_courtier = { 
					limit = {
						OR = {
							is_close_relative = PREV
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
						}	
						NOT = { character = ROOT }
						NOT = { is_liege_or_above = ROOT }
						has_guardian = yes
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
						at_location = ROOT 
						NOT = { is_inaccessible_trigger = yes } 
						NOT = { trait = wikid }
						prisoner = no
						guardian = { 
							in_command = no 
							at_location = ROOT 
							NOT = { character = ROOT } 
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
						}
					}	
					guardian = { 
						set_character_flag = captured_in_battle 
						if = {
							limit = { ROOT = { is_ruler = yes } }
							imprison = ROOT 	
						}
						hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
					}
				}
				any_courtier = {  
					limit = {
						OR = {
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
							is_close_relative = PREV
							is_married = PREV
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							AND = { #Commanders
								government = military_command_government
								tier = BARON
							}
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
						}	
						NOT = { in_command = yes }
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { is_child_of = ROOT }	
						NOT = { father = { is_child_of = ROOT } }
						NOT = { mother = { is_child_of = ROOT } } 	
					}		
					set_character_flag = captured_in_battle 
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
				}
				if = {
					limit = { 
						ROOT = { religion = drowned_god } 
						NOT = { religion = drowned_god } 
					}
					random_courtier = {
						limit = {		
							is_female = yes
							age = 16
							NOT = { in_command = yes }
							NOT = { character = ROOT }
							NOT = { is_liege_or_above = ROOT }
							NOT = { dynasty = ROOT }
							at_location = ROOT 
							NOT = { is_inaccessible_trigger = yes } 
							NOT = { trait = wikid }
							prisoner = no
							NOT = { is_child_of = ROOT }	
							NOT = { father = { is_child_of = ROOT } }
							NOT = { mother = { is_child_of = ROOT }} 
							NOT = { trait = dragon }
							NOT = { trait = white_walker }
							NOT = { trait = winter_wasteland }							
						}
						set_character_flag = captured_in_battle 
						if = {
							limit = { ROOT = { is_ruler = yes } }
							imprison = ROOT 	
						}
						hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
					}
				}
				if = {
					limit = { 
						#at_location = ROOT
						NOT = { is_inaccessible_trigger = yes } 
						NOT = { trait = wikid }
						prisoner = no
						NOT = { character = ROOT }
					}  
					set_character_flag = captured_in_battle
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
				}

				##
				#Always imprison direct war enemies
				any_liege = {
					limit = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
						NOT = { in_command = yes }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
					}	
					guardian = { 
						if = {
							limit = {
								NOT = { in_command = yes }
								at_location = ROOT 
								NOT = { character = ROOT } 
								NOT = { is_inaccessible_trigger = yes }
								NOT = { trait = wikid }
								prisoner = no
							}
							set_character_flag = captured_in_battle 
							if = {
								limit = { ROOT = { is_ruler = yes } }
								imprison = ROOT 	
							}
							hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
						}				
					}
					set_character_flag = captured_in_battle 
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform					
				}
				
				###
			}			
		}
		if = {
			limit = { is_ruler = no }
			liege = { character_event = { id = siege_agot.5 } }
		}
	}
			 
	option = {
		name = "EVTOPTAsiegewin3"
		trigger = {
			liege = {
				FROM = { 
					holder_scope = { 
						OR = {
							war_with = ROOT 
							war_with = PREVPREV
						}	
					} 
				}
			}	
		} 
		ai_chance = {
			factor = 10
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 3
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}	
		} 
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random = { 
				chance = 10
				if = {
					limit = {
						NOT = { trait = kind }
						NOT = { trait = cruel }
					}	
					add_trait = kind
					hidden_tooltip = {
						character_event = {
							id = 38268 #Notify
						}
					}
				}
				if = {
					limit = {
						trait = cruel
					}	
					remove_trait = cruel
					hidden_tooltip = {
						character_event = {
							id = trait_notification.1 #Notify
						}
					}
				}
			}
		}	
		FROM = { 
			holder_scope = { 	
				any_courtier = { 
					limit = {
						OR = {
							is_close_relative = PREV
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
						}
						NOT = { character = ROOT }
						NOT = { is_liege_or_above = ROOT }
						has_guardian = yes
						at_location = ROOT 
						NOT = { is_inaccessible_trigger = yes } 
						NOT = { trait = wikid }
						prisoner = no
						guardian = { 
							in_command = no 
							at_location = ROOT 
							NOT = { character = ROOT } 
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
						}
					}	
					guardian = { 
						opinion = {
							who = ROOT
							modifier = opinion_relieved
							months = 12
						}
					}
				}
				any_courtier = {  
					limit = {
						OR = {
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
							is_close_relative = PREV
							is_married = PREV
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							AND = { #Commanders
								government = military_command_government
								tier = BARON
							}
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
						}	
						NOT = { in_command = yes }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { is_child_of = ROOT }	
						NOT = { father = { is_child_of = ROOT } }
						NOT = { mother = { is_child_of = ROOT } } 
						NOT = { trait = dragon }	
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }					
					}			
					opinion = {
						who = ROOT
						modifier = opinion_relieved
						months = 12
					}
				}
			}
		}
	}
	
	option = {
		name = "EVTOPTAwaylitfriendlycapture"
		trigger = {
			NOT = {
				liege = {
					FROM = { 
						holder_scope = { 
							OR = {
								war_with = ROOT 
								war_with = PREVPREV
							}	
						} 
					}
				}	
			}	
		} 
		ai_chance = {
			factor = 100
		}
		prestige = 1
		FROM = { 
			holder_scope = { 
				any_courtier = { 
					if = { 
						limit = { 
							NOT = { character = ROOT }
							at_location = ROOT 
							NOT = { war_with = ROOT }
						}
						opinion = {
							who = ROOT
							modifier = liberated
							months = 12
						}
					}
					hidden_tooltip = {
						if = { 
							limit = { 
								at_location = ROOT 
								NOT = { war_with = ROOT }
								trait = in_hiding
							} 
							remove_trait = in_hiding
						}
					}	
				}
			}
		}	
	}
}

	
#If owner not at location, event for imprisoning their family.  If all hidden, then it should say "Fine lets go"
character_event = {

	id = siege_agot.3
	desc = "EVTDESCsiegenoenemy"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war


	is_triggered_only = yes
	
	trigger = {
		NOT = { any_liege = { has_landed_title = e_rebels } }
		NOT = { culture_group = winter_group }
		FROM = { 
			NOT = { holding_type = nomad }
			holder_scope = {
				NOT = { culture_group = unoccupied_group }
				NOT = { culture_group = winter_group }
				capital_holding = { 
					OR = {
						title = PREVPREV
						controller = {
							NOT = { character = PREVPREV }
						}						
					}	
				}
				OR = {
					higher_tier_than = DUKE
					AND = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
					AND = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
					reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
					any_courtier = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}
					any_liege = {
						NOT = { in_command = yes }
						at_location = ROOT
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
					}
				}
				OR = {
					NOT = { at_location = ROOT }
					is_inaccessible_trigger = yes
					trait = wikid
					prisoner = yes
				}
				 
			}
		}
	}
		
	option = {
		name = "EVTOPTAnoenemy2"
		trigger = {
			liege = {
				FROM = { 
					holder_scope = { 
						OR = {
							war_with = ROOT 
							war_with = PREVPREV
						}
						any_courtier = {
							OR = {
								AND = {
									dynasty = PREV
									NOT = { dynasty = 0 }
								}
								is_close_relative = PREV
								is_married = PREV
								AND = {
									OR = {
										is_primary_war_defender = yes
										is_primary_war_attacker = yes						
									}
									ROOT = { 
										OR = {
											war_with = PREV
											any_liege = { war_with = PREVPREV }
										}
									}
								}
								AND = { #Commanders
									government = military_command_government
									tier = BARON
								}
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
								reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
							}	
							NOT = { in_command = yes }
							NOT = { character = ROOT }
							NOT = { character = PREV }
							at_location = ROOT
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
							NOT = { is_child_of = ROOT }	
							NOT = { father = { is_child_of = ROOT } }
							NOT = { mother = { is_child_of = ROOT } }
							NOT = { trait = dragon }
							NOT = { trait = white_walker }
							NOT = { trait = winter_wasteland }							
						}
					} 
				}
			}	
		} #tgr
				
		ai_chance = {
			factor = 20
			modifier = {
				factor = 1000
				FROM = { 
					holder_scope = { 
						OR = {	
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							any_courtier = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							any_liege = {
								NOT = { in_command = yes }
								at_location = ROOT
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
						}
					} 
				}
			}
			modifier = {
				factor = 5  
				FROM = { holder_scope = { tier = DUKE } }
			}
			modifier = {
				factor = 10  
				FROM = { holder_scope = { higher_tier_than = DUKE } }
			}
			modifier = {
				factor = 20
				trait = slave_trader
			}
			modifier = {
				factor = 20
				trait = impaler
			}
			modifier = {
				factor = 4
				trait = cruel
			}
			modifier = {
				factor = 4
				trait = greedy
			}
			modifier = {
				factor = 4
				trait = ruthless
			}
			modifier = {
				factor = 4
				trait = wroth
			}
			modifier = {
				factor = 0.05
				trait = kind
			}
			modifier = {
				factor = 0.05
				trait = honorable
			}			
		} 
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random = { 
				chance = 10
				if = {
					limit = {
						NOT = { trait = greedy }
						NOT = { trait = charitable }
					}	
					add_trait = greedy
					hidden_tooltip = {
						character_event = {
							id = 38252 #Notify
						}
					}
				}	
			}
		}	
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random = { 
				chance = 10
				if = {
					limit = {
						NOT = { trait = cruel }
						NOT = { trait = kind }
					}	
					add_trait = cruel
					hidden_tooltip = {
						character_event = {
							id = 38259 #Notify
						}
					}
				}
				if = {
					limit = {
						trait = kind
					}	
					remove_trait = kind
					hidden_tooltip = {
						character_event = {
							id = 38307 #Notify
						}
					}
				}	
			}
		}	
		FROM = { 
			holder_scope = {
				any_courtier = { 
					limit = {
						OR = {
							is_close_relative = PREV
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
						}	
						NOT = { character = ROOT }
						NOT = { is_liege_or_above = ROOT }
						has_guardian = yes
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
						at_location = ROOT 
						NOT = { is_inaccessible_trigger = yes } 
						NOT = { trait = wikid }
						prisoner = no
						guardian = { 
							in_command = no 
							at_location = ROOT 
							NOT = { character = ROOT } 
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
						}
					}	
					guardian = { 
						set_character_flag = captured_in_battle 
						if = {
							limit = { ROOT = { is_ruler = yes } }
							imprison = ROOT 	
						}
						hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
					}
				}
				any_courtier = {  
					limit = {
						OR = {
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
							is_close_relative = PREV
							is_married = PREV
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							AND = { #Commanders
								government = military_command_government
								tier = BARON
							}
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
						}	
						NOT = { in_command = yes }
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { is_child_of = ROOT }	
						NOT = { father = { is_child_of = ROOT } }
						NOT = { mother = { is_child_of = ROOT } } 	
					}		
					set_character_flag = captured_in_battle 
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
				}
				#Always imprison direct war enemies
				any_liege = {
					limit = {
						OR = {
							is_primary_war_defender = yes
							is_primary_war_attacker = yes						
						}
						ROOT = { 
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
							}
						}
						NOT = { in_command = yes }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { trait = dragon }
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }
					}	
					guardian = { 
						if = {
							limit = {
								NOT = { in_command = yes }
								at_location = ROOT 
								NOT = { character = ROOT } 
								NOT = { is_inaccessible_trigger = yes }
								NOT = { trait = wikid }
								prisoner = no
							}
							set_character_flag = captured_in_battle 
							if = {
								limit = { ROOT = { is_ruler = yes } }
								imprison = ROOT 	
							}
							hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
						}				
					}
					set_character_flag = captured_in_battle 
					if = {
						limit = { ROOT = { is_ruler = yes } }
						imprison = ROOT 	
					}
					hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform				
				}				
				###
				
				if = {
					limit = { 
						ROOT = { religion = drowned_god } 
						NOT = { religion = drowned_god } 
					}
					random_courtier = {
						limit = {		
							is_female = yes
							age = 16
							NOT = { in_command = yes }
							NOT = { character = ROOT }
							NOT = { is_liege_or_above = ROOT }
							NOT = { dynasty = ROOT }
							at_location = ROOT 
							NOT = { is_inaccessible_trigger = yes } 
							NOT = { trait = wikid }
							prisoner = no
							NOT = { is_child_of = ROOT }	
							NOT = { father = { is_child_of = ROOT } }
							NOT = { mother = { is_child_of = ROOT }} 
							NOT = { trait = dragon }
							NOT = { trait = white_walker }
							NOT = { trait = winter_wasteland }							
						}
						set_character_flag = captured_in_battle 
						if = {
							limit = { ROOT = { is_ruler = yes } }
							imprison = ROOT 	
						}
						hidden_tooltip = { character_event = { id = siege_agot.6 } } #Inform
					}
				}
			}			
		}
		if = {
			limit = { is_ruler = no }
			liege = { character_event = { id = siege_agot.5 } }
		}
	}
		
	option = { 
		name = "EVTOPTAnoenemy1"
		trigger = {
			liege = {
				FROM = { 
					holder_scope = { 
						OR = {
							war_with = ROOT 
							war_with = PREVPREV
						}	
					} 
				}
			}	
		} 		
		ai_chance = {
			factor = 10
			modifier = {
				factor = 10
				trait = kind
			}
			modifier = {
				factor = 3
				trait = charitable
			}
			modifier = {
				factor = 3
				trait = humble
			}
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = greedy
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}	
		} 
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random = { 
				chance = 10
				if = {
					limit = {
						NOT = { trait = kind }
						NOT = { trait = cruel }
					}	
					add_trait = kind
					hidden_tooltip = {
						character_event = {
							id = 38268 #Notify
						}
					}
				}
				if = {
					limit = {
						trait = cruel
					}	
					remove_trait = cruel
					hidden_tooltip = {
						character_event = {
							id = trait_notification.1 #Notify
						}
					}
				}
			}
		}
		FROM = { 
			holder_scope = { 			
				any_courtier = { 
					limit = {
						OR = {
							is_close_relative = PREV
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
						}
						NOT = { character = ROOT }
						NOT = { is_liege_or_above = ROOT }
						has_guardian = yes
						at_location = ROOT 
						NOT = { is_inaccessible_trigger = yes } 
						NOT = { trait = wikid }
						prisoner = no
						guardian = { 
							in_command = no 
							at_location = ROOT 
							NOT = { character = ROOT } 
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
						}
					}	
					guardian = { 
						opinion = {
							who = ROOT
							modifier = opinion_relieved
							months = 12
						}
					}
				}
				any_courtier = {  
					limit = {
						OR = {
							AND = {
								dynasty = PREV
								NOT = { dynasty = 0 }
							}
							is_close_relative = PREV
							is_married = PREV
							AND = {
								OR = {
									is_primary_war_defender = yes
									is_primary_war_attacker = yes						
								}
								ROOT = { 
									OR = {
										war_with = PREV
										any_liege = { war_with = PREVPREV }
									}
								}
							}
							AND = { #Commanders
								government = military_command_government
								tier = BARON
							}
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_vengeance }
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_blood_feud }
						}	
						NOT = { in_command = yes }
						NOT = { character = ROOT }
						NOT = { character = PREV }
						at_location = ROOT
						NOT = { is_inaccessible_trigger = yes }
						NOT = { trait = wikid }
						prisoner = no
						NOT = { is_child_of = ROOT }	
						NOT = { father = { is_child_of = ROOT } }
						NOT = { mother = { is_child_of = ROOT } } 
						NOT = { trait = dragon }			
						NOT = { trait = white_walker }
						NOT = { trait = winter_wasteland }						
					}		
					opinion = {
						who = ROOT
						modifier = opinion_relieved
						months = 12
					}
				}
			}
		}
	}	
	option = {
		name = "EVTOPTAwaylitfriendlycapture"
		trigger = {
			NOT = {
				liege = {
					FROM = { 
						holder_scope = { 
							OR = {
								war_with = ROOT 
								war_with = PREVPREV
							}	
						} 
					}
				}
			}	
		} 
		ai_chance = {
			factor = 100
		}
		prestige = 1
		FROM = { 
			holder_scope = { 
				any_courtier = { 
					if = { 
						limit = { 
							NOT = { character = ROOT }
							at_location = ROOT 
							NOT = { war_with = ROOT }
							NOT = { trait = dragon }
							NOT = { trait = wikid }
							prisoner = no
							in_command = no
						}
						opinion = {
							who = ROOT
							modifier = liberated
							months = 12
						}
					}
					hidden_tooltip = {
						if = { 
							limit = { 
								NOT = { character = ROOT }
								at_location = ROOT 
								NOT = { war_with = ROOT }
								trait = in_hiding
							} 
							remove_trait = in_hiding
						}
					}
				}
			}
		}
	}
}

#if dungeons have anybody worth freeing, there are options for that on siege win
character_event = {
	id = siege_agot.4
	desc = "EVTDESCWAYsearchdungeons"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
		
	trigger = { 
		NOT = { culture_group = winter_group }
		FROM = {
			NOT = { holding_type = nomad }
			holder_scope = {
				NOT = { culture_group = unoccupied_group }
				NOT = { culture_group = winter_group }
				NOT = { character = ROOT }
				NOT = { is_liege_or_above = ROOT }
				NOT = { is_vassal_or_below = ROOT }
				OR = {
					AND = {
						war_with = ROOT
						any_courtier = {
							prisoner = yes 
							at_location = ROOT
							host = { character = PREVPREV }
						}
					}
					any_courtier = { #Rescue slaves/concubines
						OR = {
							trait = slave
							trait = salt_wife
							is_consort = yes
						}
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
							is_friend = ROOT
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_my_abducted_spouse }
						}
						liege = { character = PREVPREV }
						at_location = ROOT
					}
				}	
			}
		} 					
	}
	
	option = {
		name = "EVTOPWAYprisonrelease01"
		ai_chance = { 
			factor = 5
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = arbitrary
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}			
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
			modifier = {
				factor = 0.5
				trait = paranoid
			}   
			modifier = {
				factor = 0.5
				trait = just
			}
		}	
		FROM = { 
			holder_scope = {
				any_courtier = {	
					limit = { 
						prisoner = yes 
						at_location = ROOT
						host = { character = PREVPREV }
					}
					prisoner = no
					clr_character_flag = captured_in_battle
					clr_character_flag = kidnapped_by_plot
					clr_character_flag = lost_trial_by_combat
					hidden_tooltip = { character_event = { id = siege_agot.7 } } #Inform
				}
				any_courtier = { #Rescue slaves/concubines
					limit = {
						OR = {
							trait = slave
							trait = salt_wife
							is_consort = yes
						}
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
							is_friend = ROOT
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_my_abducted_spouse }
						}
						liege = { character = PREVPREV }
						at_location = ROOT
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_my_owner } }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_salt_wife } }
						NOT = { consort = { character = ROOT } }
					}
					if = {
						limit = { 
							trait = slave 						
						}
						character_event = { id = slavery.0 tooltip = EVTTOOLTIPSLAVERY0 }
					}
					if = {
						limit = { 
							trait = salt_wife 						
						}
						remove_trait = salt_wife
					}
					if = {
						limit = { 
							is_consort = yes
						}
						any_spouse = { remove_spouse = PREV }
						consort = { remove_consort = PREV }
					}
					move_character = ROOT
					opinion = {
						modifier = rescued_my_sorry_ass
						who = ROOT
					}
				}	
			}
		}
	}
		
	option = {
		name = "EVTOPWAYprisonrelease02"
		trigger = { 
			FROM = { 
				holder_scope = { 
					AND = { 
						war_with = ROOT 
						any_courtier = { 
							prisoner = yes 
							at_location = ROOT
							host = { character = PREVPREV }
							OR = {
								war_with = PREV
								any_liege = { war_with = PREVPREV }
								is_liege_or_above = ROOT
							}
						} 
					} 
				} 
			} 
		} 
		ai_chance = { 
			factor = 20
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 2
				trait = trusting
			}
			modifier = {
				factor = 2
				trait = charitable
			}
			modifier = {
				factor = 2
				trait = ruthless
			}
			modifier = {
				factor = 2
				trait = deceitful
			}
			modifier = {
				factor = 0.5
				trait = cruel
			}			
			modifier = {
				factor = 0.5
				trait = wroth
			}
			modifier = {
				factor = 0.5
				trait = cynical
			}
			modifier = {
				factor = 0.5
				trait = paranoid
			}   
			modifier = {
				factor = 0.5
				trait = honorable
			}
			modifier = {
				factor = 0.5
				trait = honest
			}
		}		
		FROM = { 
			holder_scope = {
				any_courtier = {	
					limit = { 
						prisoner = yes 
						at_location = ROOT
						host = { character = PREVPREV }
						OR = {
							war_with = PREV
							any_liege = { war_with = PREVPREV }
							is_liege_or_above = ROOT
						}
					}
					prisoner = no
					clr_character_flag = captured_in_battle
					clr_character_flag = kidnapped_by_plot
					clr_character_flag = lost_trial_by_combat
					hidden_tooltip = { character_event = { id = siege_agot.7 } } #Inform
				}
				any_courtier = { #Rescue slaves/concubines
					limit = {
						OR = {
							trait = slave
							trait = salt_wife
							is_consort = yes
						}
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
							is_friend = ROOT
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_my_abducted_spouse }
						}
						liege = { character = PREVPREV }
						at_location = ROOT
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_my_owner } }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_salt_wife } }
						NOT = { consort = { character = ROOT } }
					}
					if = {
						limit = { trait = slave }
						character_event = { id = slavery.0 tooltip = EVTTOOLTIPSLAVERY0 }
					}
					if = {
						limit = { trait = salt_wife }
						remove_trait = salt_wife
					}
					if = {
						limit = { is_consort = yes }
						any_spouse = { remove_spouse = PREV }
						consort = { remove_consort = PREV }
					}
					move_character = ROOT
					opinion = {
						modifier = rescued_my_sorry_ass
						who = ROOT
					}
				}	
			}
		}
	}
	
	option = {
		name = "EVTOPWAYprisonrelease03"		 
		trigger = { 
			FROM = { 
				holder_scope = { 
					any_courtier = {
						prisoner = yes 
						at_location = ROOT
						host = { character = PREVPREV }
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
							is_friend = ROOT
							is_married = ROOT
						}
					}		
				}
			} 
		} #trigger	
		ai_chance = { 
			factor = 40
			modifier = {
				factor = 2
				trait = kind
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = familyperson
			}
			modifier = {
				factor = 2
				trait = honorable
			}
		}
		FROM = { 
			holder_scope = {
				any_courtier = {	
					limit = { 
						prisoner = yes 
						at_location = ROOT
						host = { character = PREVPREV }
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
							is_friend = ROOT
							is_married = ROOT
						}
					}
					prisoner = no
					clr_character_flag = captured_in_battle
					clr_character_flag = kidnapped_by_plot
					clr_character_flag = lost_trial_by_combat
					hidden_tooltip = { character_event = { id = siege_agot.7 } } #Inform
				}
				any_courtier = { #Rescue slaves/concubines
					limit = {
						OR = {
							trait = slave
							trait = salt_wife
							is_consort = yes
						}
						OR = {
							dynasty = ROOT
							is_close_relative = ROOT
							is_friend = ROOT
							reverse_has_opinion_modifier = { who = ROOT modifier = opinion_my_abducted_spouse }
						}
						liege = { character = PREVPREV }
						at_location = ROOT
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_my_owner } }
						NOT = { has_opinion_modifier = { who = ROOT modifier = opinion_salt_wife } }
						NOT = { consort = { character = ROOT } }
					}
					if = {
						limit = { trait = slave }
						character_event = { id = slavery.0 tooltip = EVTTOOLTIPSLAVERY0 }
					}
					if = {
						limit = { trait = salt_wife }
						remove_trait = salt_wife
					}
					if = {
						limit = { is_consort = yes }
						any_spouse = { remove_spouse = PREV }
						consort = { remove_consort = PREV }
					}
					move_character = ROOT
					opinion = {
						modifier = rescued_my_sorry_ass
						who = ROOT
					}
				}	
			}
		}
	}

	option = {
		name = "EVTOPWAYprisonrelease04"	
		ai_chance = { 
			factor = 5
			modifier = {
				factor = 0.5
				trait = kind
			}
			modifier = {
				factor = 0.5
				trait = trusting
			}
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 0.5
				trait = arbitrary
			}
			modifier = {
				factor = 2
				trait = cruel
			}			
			modifier = {
				factor = 2
				trait = wroth
			}
			modifier = {
				factor = 2
				trait = cynical
			}
			modifier = {
				factor = 2
				trait = paranoid
			}   
			modifier = {
				factor = 2
				trait = just
			}
		}
		FROM = { 
			holder_scope = {
				any_courtier = {	
					limit = { 
						prisoner = yes 
						at_location = ROOT
						host = { character = PREVPREV }
					}
					opinion = {
						who = ROOT
						modifier = left_to_rot
						months = 60
					}
				}
			}
		}
	}
}
#Liege takes prsioners
character_event = {
	id = siege_agot.5
	desc = "EVTDESCsiege_agot.5"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
		
	option = {
		name = "EVTOPsiege_agot.5"
		FROM = {
			FROM = { 
				holder_scope = {
					if = {
						limit = { 
							NOT = { character = ROOT }
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
							has_character_flag = captured_in_battle						
						}  
						imprison = ROOT 		
					}
					any_courtier = {
						limit = { 
							NOT = { liege = { character = ROOT } }
							NOT = { character = ROOT }
							NOT = { is_inaccessible_trigger = yes }
							NOT = { trait = wikid }
							prisoner = no
							NOT = { character = PREV }
							has_character_flag = captured_in_battle						
						}
						imprison = ROOT 
					}					
				}		
			}
		}	
	}
}	
#Inform taken prisoner
character_event = {
	id = siege_agot.6
	desc = "EVTDESCsiege_agot.6"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPsiege_agot.6"
	}
}
#Inform released
character_event = {
	id = siege_agot.7
	desc = "EVTDESCsiege_agot.7"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = "EVTOPsiege_agot.7"
	}
}	
	
#Siege destroys infrastructure
character_event = { #if triggered from pillage change holding scope
	id = siege_agot.8
	
	is_triggered_only = yes
	hide_window = yes

	immediate = {
		character_event = { id = siege_agot.9 }
	}
}	
character_event = {
	id = siege_agot.9
	desc = "EVTDESCsiege_agot.9"
	picture = "GFX_evt_siege"
	border = GFX_event_normal_frame_war
	
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			FROM = {
				num_of_buildings = 5
				OR = {
					has_building = ca_wall_1
					has_building = ca_wall_q_1
					has_building = ct_wall_1
					has_building = ct_wall_q_1
					NOR = {
						holding_type = castle
						holding_type = city
					}
				}
			}	
		}	
	}
	
	immediate = {
		FROM = {
			FROM = {			
				#Record Base Value, in case these are destroyed
				if = {
					limit = { 
						OR = {
							holding_type = castle
							holding_type = city
						}
					}
					clr_title_flag = base_value_1
					clr_title_flag = base_value_2
					clr_title_flag = base_value_3
					clr_title_flag = base_value_4
					clr_title_flag = base_value_5
					clr_title_flag = base_value_6
					if = {
						limit = { base_value_6_trigger = yes }
						set_title_flag = base_value_6
					}
					if = {
						limit = { base_value_5_trigger = yes }
						set_title_flag = base_value_5
					}
					if = {
						limit = { base_value_4_trigger = yes }
						set_title_flag = base_value_4
					}
					if = {
						limit = { base_value_3_trigger = yes }
						set_title_flag = base_value_3
					}
					if = {
						limit = { base_value_2_trigger = yes }
						set_title_flag = base_value_2
					}
					if = {
						limit = { base_value_1_trigger = yes }
						set_title_flag = base_value_1
					}
				}
				#Record undestroyable buildings
				if = {
					limit = { holding_type = castle }
					if = {
						limit = { has_building = ca_wallportion }
						set_title_flag = ca_wallportion
					}
					if = {
						limit = { has_building = ca_dragonmont }
						set_title_flag = ca_dragonmont
					}
					if = {
						limit = { has_building = ca_harrenhal_ruins }
						set_title_flag = ca_harrenhal_ruins
					}
					if = {
						limit = { has_building = ca_dragon_pit }
						set_title_flag = ca_dragon_pit
					}
					if = {
						limit = { has_building = ca_cellar_1 }
						set_title_flag = ca_cellar_1
					}
					if = {
						limit = { has_building = ca_cellar_2 }
						set_title_flag = ca_cellar_2
					}
					if = {
						limit = { has_building = ca_upgrade_bv_1 }
						set_title_flag = ca_upgrade_bv_1
					}
					if = {
						limit = { has_building = ca_upgrade_bv_2 }
						set_title_flag = ca_upgrade_bv_2
					}
					if = {
						limit = { has_building = ca_upgrade_bv_3 }
						set_title_flag = ca_upgrade_bv_3
					}
					if = {
						limit = { has_building = ca_upgrade_bv_4 }
						set_title_flag = ca_upgrade_bv_4
					}
					if = {
						limit = { has_building = ca_upgrade_bv_5 }
						set_title_flag = ca_upgrade_bv_5
					}
					if = {
						limit = { has_building = ca_upgrade_bv_6 }
						set_title_flag = ca_upgrade_bv_6
					}
					
					if = {
						limit = { has_building = ca_sub_barony_ruin }
						set_title_flag = ca_sub_barony_ruin
					}
					if = {
						limit = { has_building = ca_colony_1 }
						set_title_flag = ca_colony_1
					}
					if = {
						limit = { has_building = ca_colony_2 }
						set_title_flag = ca_colony_2
					}
					if = {
						limit = { has_building = ca_colony_3 }
						set_title_flag = ca_colony_3
					}
					if = {
						limit = { has_building = ca_colony_4 }
						set_title_flag = ca_colony_4
					}
					if = {
						limit = { has_building = ca_colony_5 }
						set_title_flag = ca_colony_5
					}
					if = {
						limit = { has_building = ca_colony_6 }
						set_title_flag = ca_colony_6
					}
					
					if = {
						limit = { has_building = ca_kingsroad }
						set_title_flag = ca_kingsroad
					}
					if = {
						limit = { has_building = ca_river_road }
						set_title_flag = ca_river_road
					}
					if = {
						limit = { has_building = ca_goldroad }
						set_title_flag = ca_goldroad
					}
					if = {
						limit = { has_building = ca_roseroad }
						set_title_flag = ca_roseroad
					}
					if = {
						limit = { has_building = ca_oceanroad }
						set_title_flag = ca_oceanroad
					}
					if = {
						limit = { has_building = ca_high_road }
						set_title_flag = ca_high_road
					}
				}	
				if = {
					limit = { holding_type = city }
					if = {
						limit = { has_building = ct_upgrade_bv_1 }
						set_title_flag = ct_upgrade_bv_1
					}
					if = {
						limit = { has_building = ct_upgrade_bv_2 }
						set_title_flag = ct_upgrade_bv_2
					}
					if = {
						limit = { has_building = ct_upgrade_bv_3 }
						set_title_flag = ct_upgrade_bv_3
					}
					if = {
						limit = { has_building = ct_upgrade_bv_4 }
						set_title_flag = ct_upgrade_bv_4
					}
					if = {
						limit = { has_building = ct_upgrade_bv_5 }
						set_title_flag = ct_upgrade_bv_5
					}
					if = {
						limit = { has_building = ct_upgrade_bv_6 }
						set_title_flag = ct_upgrade_bv_6
					}
					
					if = {
						limit = { has_building = ct_sub_barony_ruin }
						set_title_flag = ct_sub_barony_ruin
					}
					if = {
						limit = { has_building = ct_colony_1 }
						set_title_flag = ct_colony_1
					}
					if = {
						limit = { has_building = ct_colony_2 }
						set_title_flag = ct_colony_2
					}
					if = {
						limit = { has_building = ct_colony_3 }
						set_title_flag = ct_colony_3
					}
					if = {
						limit = { has_building = ct_colony_4 }
						set_title_flag = ct_colony_4
					}
					if = {
						limit = { has_building = ct_colony_5 }
						set_title_flag = ct_colony_5
					}
					if = {
						limit = { has_building = ct_colony_6 }
						set_title_flag = ct_colony_6
					}
				}	
				if = {
					limit = { holding_type = temple }
					if = {
						limit = { has_building = tp_weirwood_tree }
						set_title_flag = tp_weirwood_tree
						if = {
							limit = { has_building = tp_small_godswood }
							set_title_flag = tp_small_godswood
							if = {
								limit = { has_building = tp_godswood }
								set_title_flag = tp_godswood
								if = {
									limit = { has_building = tp_large_godswood }
									set_title_flag = tp_large_godswood
									if = {
										limit = { has_building = tp_godswood_forest }
										set_title_flag = tp_godswood_forest
									}
								}
							}
						}
					}
				}	
				if = {
					limit = { holding_type = family_palace }
					if = {
						limit = { has_building = fp_dragon_pit }
						set_title_flag = fp_dragon_pit
					}
				}	
				#Select number of buldings to destroy
				random_list = {
					10 = {
						set_title_flag = destroy_buildings_1
					}
					10 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 6 }
						}	
						set_title_flag = destroy_buildings_2
					}
					10 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 7 }
						}	
						set_title_flag = destroy_buildings_3
					}
					10 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 8 }
						}	
						set_title_flag = destroy_buildings_4
					}
					10 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 9 }
						}	
						set_title_flag = destroy_buildings_5
					}
					5 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 11 }
						}	
						set_title_flag = destroy_buildings_6
					}
					5 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 13 }
						}	
						set_title_flag = destroy_buildings_7
					}
					5 = {
						modifier = { 
							factor = 0
							NOT = { num_of_buildings = 15 }
						}	
						set_title_flag = destroy_buildings_8
					}
				}
			}
		}	
	}
		
	option = {
		name = "EVTOPsiege_agot.9"
		FROM = {
			FROM = {
				#Always Destroy siege prep
				if = {
					limit = { holding_type = castle }					
					if = {
						limit = { has_building = ca_wall_q_5 }
						remove_building = ca_wall_q_5
						remove_building = ca_wall_q_4
					}
					if = {
						limit = { 
							has_building = ca_wall_q_4 
							NOT = { has_building = ca_wall_q_5 }
						}
						remove_building = ca_wall_q_4
						remove_building = ca_wall_q_3
					}
					if = {
						limit = { 
							has_building = ca_wall_q_3
							NOT = { has_building = ca_wall_q_4 }
						}
						remove_building = ca_wall_q_3
						remove_building = ca_wall_q_2
					}
					if = {
						limit = { 
							has_building = ca_wall_q_2
							NOT = { has_building = ca_wall_q_3 }
						}
						remove_building = ca_wall_q_2
						remove_building = ca_wall_q_1
					}
					if = {
						limit = { 
							has_building = ca_wall_q_1
							NOT = { has_building = ca_wall_q_2 }
						}
						remove_building = ca_wall_q_1
					}
				}	
				if = {
					limit = { holding_type = city }					
					if = {
						limit = { has_building = ct_wall_q_5 }
						remove_building = ct_wall_q_5
						remove_building = ct_wall_q_4
					}
					if = {
						limit = { 
							has_building = ct_wall_q_4 
							NOT = { has_building = ct_wall_q_5 }
						}
						remove_building = ct_wall_q_4
						remove_building = ct_wall_q_3
					}
					if = {
						limit = { 
							has_building = ct_wall_q_3
							NOT = { has_building = ct_wall_q_4 }
						}
						remove_building = ct_wall_q_3
						remove_building = ct_wall_q_2
					}
					if = {
						limit = { 
							has_building = ct_wall_q_2
							NOT = { has_building = ct_wall_q_3 }
						}
						remove_building = ct_wall_q_2
						remove_building = ct_wall_q_1
					}
					if = {
						limit = { 
							has_building = ct_wall_q_1
							NOT = { has_building = ct_wall_q_2 }
						}
						remove_building = ct_wall_q_1
					}
				}
				if = {
					limit = { holding_type = temple }					
					if = {
						limit = { has_building = tp_wall_q_5 }
						remove_building = tp_wall_q_5
						remove_building = tp_wall_q_4
					}
					if = {
						limit = { 
							has_building = tp_wall_q_4 
							NOT = { has_building = tp_wall_q_5 }
						}
						remove_building = tp_wall_q_4
						remove_building = tp_wall_q_3
					}
					if = {
						limit = { 
							has_building = tp_wall_q_3
							NOT = { has_building = tp_wall_q_4 }
						}
						remove_building = tp_wall_q_3
						remove_building = tp_wall_q_2
					}
					if = {
						limit = { 
							has_building = tp_wall_q_2
							NOT = { has_building = tp_wall_q_3 }
						}
						remove_building = tp_wall_q_2
						remove_building = tp_wall_q_1
					}
					if = {
						limit = { 
							has_building = tp_wall_q_1
							NOT = { has_building = tp_wall_q_2 }
						}
						remove_building = tp_wall_q_1
					}
				}
				if = {
					limit = { has_title_flag = destroy_buildings_1 }
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_1
				}
				if = {
					limit = { has_title_flag = destroy_buildings_2 }
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_2
				}
				if = {
					limit = { has_title_flag = destroy_buildings_3 }
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_3
				}
				if = {
					limit = { has_title_flag = destroy_buildings_4 }
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_4
				}
				if = {
					limit = { has_title_flag = destroy_buildings_5 }
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_5
				}
				if = {
					limit = { has_title_flag = destroy_buildings_6 }
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_6
				}
				if = {
					limit = { has_title_flag = destroy_buildings_7 }
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_7
				}
				if = {
					limit = { has_title_flag = destroy_buildings_8 }
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					destroy_random_building = yes
					clr_title_flag = destroy_buildings_8
				}
				hidden_tooltip = { #make sure base value is retained
					clear_event_target = repair_base_value
					if = {
						limit = { 
							OR = {
								holding_type = castle
								holding_type = city
							}
							has_title_flag = base_value_1
						}											
						save_event_target_as = repair_base_value
						location = { province_event = { id = siege_agot.10 } }
						#increase_holding_base_value_effect = yes #this has a 'break' so subsequent event is needed							
					}	
				}				
			}
		}	
	}
	
	after = {
		#Rebuild undestroyable buildings
		if = {
			limit = { holding_type = castle }
			if = {
				limit = { has_title_flag = ca_wallportion }
				add_building = ca_wallportion
				clr_title_flag = ca_wallportion
			}
			if = {
				limit = { has_title_flag = ca_dragonmont }
				add_building = ca_dragonmont
				clr_title_flag = ca_dragonmont
			}
			if = {
				limit = { has_title_flag = ca_harrenhal_ruins }
				add_building = ca_harrenhal_ruins
				clr_title_flag = ca_harrenhal_ruins
			}
			if = {
				limit = { has_title_flag = ca_dragon_pit }
				add_building = ca_dragon_pit
				clr_title_flag = ca_dragon_pit
			}
			if = {
				limit = { has_title_flag = ca_cellar_1 }
				add_building = ca_cellar_1
				clr_title_flag = ca_cellar_1
			}
			if = {
				limit = { has_title_flag = ca_cellar_2 }
				add_building = ca_cellar_2
				clr_title_flag = ca_cellar_2
			}
			if = {
				limit = { has_title_flag = ca_upgrade_bv_1 }
				add_building = ca_upgrade_bv_1
				clr_title_flag = ca_upgrade_bv_1
			}
			if = {
				limit = { has_title_flag = ca_upgrade_bv_2 }
				add_building = ca_upgrade_bv_2
				clr_title_flag = ca_upgrade_bv_2
			}
			if = {
				limit = { has_title_flag = ca_upgrade_bv_3 }
				add_building = ca_upgrade_bv_3
				clr_title_flag = ca_upgrade_bv_3
			}
			if = {
				limit = { has_title_flag = ca_upgrade_bv_4 }
				add_building = ca_upgrade_bv_4
				clr_title_flag = ca_upgrade_bv_4
			}
			if = {
				limit = { has_title_flag = ca_upgrade_bv_5 }
				add_building = ca_upgrade_bv_5
				clr_title_flag = ca_upgrade_bv_5
			}
			if = {
				limit = { has_title_flag = ca_upgrade_bv_6 }
				add_building = ca_upgrade_bv_6
				clr_title_flag = ca_upgrade_bv_6
			}
			
			if = {
				limit = { has_title_flag = ca_sub_barony_ruin }
				add_building = ca_sub_barony_ruin
				clr_title_flag = ca_sub_barony_ruin
			}
			if = {
				limit = { has_title_flag = ca_colony_1 }
				add_building = ca_colony_1
				clr_title_flag = ca_colony_1
			}
			if = {
				limit = { has_title_flag = ca_colony_2 }
				add_building = ca_colony_2
				clr_title_flag = ca_colony_2
			}
			if = {
				limit = { has_title_flag = ca_colony_3 }
				add_building = ca_colony_3
				clr_title_flag = ca_colony_3
			}
			if = {
				limit = { has_title_flag = ca_colony_4 }
				add_building = ca_colony_4
				clr_title_flag = ca_colony_4
			}
			if = {
				limit = { has_title_flag = ca_colony_5 }
				add_building = ca_colony_5
				clr_title_flag = ca_colony_5
			}
			if = {
				limit = { has_title_flag = ca_colony_6 }
				add_building = ca_colony_6
				clr_title_flag = ca_colony_6
			}
			
			if = {
				limit = { has_title_flag = ca_kingsroad }
				add_building = ca_kingsroad
				clr_title_flag = ca_kingsroad
			}
			if = {
				limit = { has_title_flag = ca_river_road }
				add_building = ca_river_road
				clr_title_flag = ca_river_road
			}
			if = {
				limit = { has_title_flag = ca_goldroad }
				add_building = ca_goldroad
				clr_title_flag = ca_goldroad
			}
			if = {
				limit = { has_title_flag = ca_roseroad }
				add_building = ca_roseroad
				clr_title_flag = ca_roseroad
			}
			if = {
				limit = { has_title_flag = ca_oceanroad }
				add_building = ca_oceanroad
				clr_title_flag = ca_oceanroad
			}
			if = {
				limit = { has_title_flag = ca_high_road }
				add_building = ca_high_road
				clr_title_flag = ca_high_road
			}
		}	
		if = {
			limit = { holding_type = city }
			if = {
				limit = { has_title_flag = ct_upgrade_bv_1 }
				add_building = ct_upgrade_bv_1
				clr_title_flag = ct_upgrade_bv_1
			}
			if = {
				limit = { has_title_flag = ct_upgrade_bv_2 }
				add_building = ct_upgrade_bv_2
				clr_title_flag = ct_upgrade_bv_2
			}
			if = {
				limit = { has_title_flag = ct_upgrade_bv_3 }
				add_building = ct_upgrade_bv_3
				clr_title_flag = ct_upgrade_bv_3
			}
			if = {
				limit = { has_title_flag = ct_upgrade_bv_4 }
				add_building = ct_upgrade_bv_4
				clr_title_flag = ct_upgrade_bv_4
			}
			if = {
				limit = { has_title_flag = ct_upgrade_bv_5 }
				add_building = ct_upgrade_bv_5
				clr_title_flag = ct_upgrade_bv_5
			}
			if = {
				limit = { has_title_flag = ct_upgrade_bv_6 }
				add_building = ct_upgrade_bv_6
				clr_title_flag = ct_upgrade_bv_6
			}
			
			if = {
				limit = { has_title_flag = ct_sub_barony_ruin }
				add_building = ct_sub_barony_ruin
				clr_title_flag = ct_sub_barony_ruin
			}
			if = {
				limit = { has_title_flag = ct_colony_1 }
				add_building = ct_colony_1
				clr_title_flag = ct_colony_1
			}
			if = {
				limit = { has_title_flag = ct_colony_2 }
				add_building = ct_colony_2
				clr_title_flag = ct_colony_2
			}
			if = {
				limit = { has_title_flag = ct_colony_3 }
				add_building = ct_colony_3
				clr_title_flag = ct_colony_3
			}
			if = {
				limit = { has_title_flag = ct_colony_4 }
				add_building = ct_colony_4
				clr_title_flag = ct_colony_4
			}
			if = {
				limit = { has_title_flag = ct_colony_5 }
				add_building = ct_colony_5
				clr_title_flag = ct_colony_5
			}
			if = {
				limit = { has_title_flag = ct_colony_6 }
				add_building = ct_colony_6
				clr_title_flag = ct_colony_6
			}
		}	
		if = {
			limit = { holding_type = temple }
			if = {
				limit = { has_title_flag = tp_weirwood_tree }
				add_building = tp_weirwood_tree
				clr_title_flag = tp_weirwood_tree
				if = {
					limit = { has_title_flag = tp_small_godswood }
					add_building = tp_small_godswood
					clr_title_flag = tp_small_godswood
					if = {
						limit = { has_title_flag = tp_godswood }
						add_building = tp_godswood
						clr_title_flag = tp_godswood
						if = {
							limit = { has_title_flag = tp_large_godswood }
							add_building = tp_large_godswood
							clr_title_flag = tp_large_godswood
							if = {
								limit = { has_title_flag = tp_godswood_forest }
								add_building = tp_godswood_forest
								clr_title_flag = tp_godswood_forest
							}
						}
					}
				}
			}
		}	
		if = {
			limit = { holding_type = family_palace }
			if = {
				limit = { has_title_flag = fp_dragon_pit }
				add_building = fp_dragon_pit
				clr_title_flag = fp_dragon_pit
			}
		}
	}
}
province_event = { #repair base values
	id = siege_agot.10
	
	is_triggered_only = yes
	hide_window = yes
	
	immediate = {
		event_target:repair_base_value = {
			if = {
				limit = { 
					has_title_flag = base_value_1 
					NOT = { base_value_1_trigger = yes }
				}
				set_title_flag = repair_base_value
				clr_title_flag = base_value_1
				increase_holding_base_value_effect = yes #this has a 'break' so subsequent event is needed							
			}
			if = {
				limit = { 
					has_title_flag = base_value_2
					NOT = { base_value_2_trigger = yes }
				}
				set_title_flag = repair_base_value
				clr_title_flag = base_value_2
				increase_holding_base_value_effect = yes							
			}
			if = {
				limit = { 
					has_title_flag = base_value_3
					NOT = { base_value_3_trigger = yes }
				}
				set_title_flag = repair_base_value
				clr_title_flag = base_value_3
				increase_holding_base_value_effect = yes							
			}
			if = {
				limit = { 
					has_title_flag = base_value_4 
					NOT = { base_value_4_trigger = yes }
				}
				set_title_flag = repair_base_value
				clr_title_flag = base_value_4
				increase_holding_base_value_effect = yes							
			}
			if = {
				limit = { 
					has_title_flag = base_value_5 
					NOT = { base_value_5_trigger = yes }
				}
				set_title_flag = repair_base_value
				clr_title_flag = base_value_5
				increase_holding_base_value_effect = yes							
			}
			if = {
				limit = { 
					has_title_flag = base_value_6
					NOT = { base_value_6_trigger = yes }
				}
				set_title_flag = repair_base_value
				clr_title_flag = base_value_6
				increase_holding_base_value_effect = yes							
			}	
		}	
	}
	
	after = {
		if = {
			limit = { event_target:repair_base_value = { has_title_flag = repair_base_value } }
			event_target:repair_base_value = { clr_title_flag = repair_base_value }
			province_event = { id = siege_agot.10 }
		}
	}
	
	option = {
		name = OK
	}
}	

#on_siege_pulse events


#on start of siege, give option to send family away or flee entirely
character_event = { #Trigger from owner
	id = siege_agot.20

	is_triggered_only = yes
	hide_window = yes
	only_rulers = yes
	min_age = 14
	capable_only = yes
	prisoner = no
	
	trigger = {
		siege = {
			is_attacker = no
			troops = { #enemy must have enough troops
				who = troops
				value = 1
				enemy = yes
			}
			location = {
				county = {
					any_direct_de_jure_vassal_title = {
						holder = ROOT
					}
				}	
			}
			OR = {
				location = { is_capital = yes }
				ROOT = {
					capital_holding = { 
						controller = {
							NOT = { character = PREVPREV }
						}						
					}
				}	
			}	
		}
		OR = {
			higher_tier_than = DUKE
			is_primary_war_attacker = yes
			is_primary_war_defender = yes
		}
		NOT = { has_character_modifier = stalwart_defender }
		NOT = { is_inaccessible_trigger = yes }
		NOT = { trait = wikid }
		OR = {
			NOT = { has_character_flag = siege_choice_made }
			had_character_flag = { flag = siege_choice_made days = 500 }
		}	
	}
	
	immediate = { 
		character_event = { id = siege_agot.22 }
	}

	option = {
		name = OK
	}	
}	
character_event = { #Trigger from courtier
	id = siege_agot.21

	is_triggered_only = yes
	hide_window = yes
	
	trigger = {
		siege = {
			is_attacker = no
			troops = { #enemy must have enough troops
				who = troops
				value = 1
				enemy = yes
			}
			location = {
				county = {
					any_direct_de_jure_vassal_title = {
						holder_scope = { is_liege_of = ROOT }
					}
				}	
			}
			OR = {
				location = { is_capital = yes }
				ROOT = {
					liege = {
						capital_holding = { 
							controller = {
								NOT = { character = PREVPREV }
							}						
						}
					}	
				}	
			}
			enemy = {
				leader = {
					OR = {
						ROOT = { liege = { war_with = PREVPREV } }
						any_liege = { ROOT = { liege = { war_with = PREVPREV } } }
					}
				}
			}
		}
		liege = {
			NOT = { character = ROOT }
			OR = {
				higher_tier_than = DUKE
				is_primary_war_attacker = yes
				is_primary_war_defender = yes
			}
			NOT = { has_character_modifier = stalwart_defender }
			NOT = { is_inaccessible_trigger = yes }
			NOT = { trait = wikid }
			prisoner = no
			OR = {
				NOT = { has_character_flag = siege_choice_made }
				had_character_flag = { flag = siege_choice_made days = 500 }
			}
		}	
	}
	
	immediate = { 
		liege = { 
			character_event = { id = siege_agot.22 }
		}
	}

	option = {
		name = OK
	}	
}	

character_event = {
	id = siege_agot.22
	desc = "EVTDESCWAYsiegepulseflee"
	title = "EVTNAMEWAYsiegepulseflee"
	
	picture = "GFX_evt_Council_Around_Table"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes
	
	immediate = { set_character_flag = siege_choice_made }

	option = {
		name = "EVTOPTWAYsiegepulseDRAGON" #Dragon fly away
		trigger = { 
			trait = dragon_rider
		}
		ai_chance = { 
			factor = 20 
		}
		location = {
			random_neighbor_province = {
				limit = { is_land = yes }
				custom_tooltip = { text = TOOLTIPsiegepulseDRAGON }
				hidden_tooltip = {
					ROOT = {
						set_character_flag = sent_back_to_field
						spawn_unit = {
							province = PREV
							leader = ROOT
							#scaled_by_biggest_garrison = 0.6
							troops = {
								archers = { 50 50 }
								heavy_infantry = { 160 160 }
								light_infantry = { 220 220 }	
								light_cavalry = { 40 40 }		
								knights = { 30 30 }						
							}
							attrition = 1.0
							earmark = dragon_unit
						}
					}
				}	
			}
		}		
	}

	option = {
		name = "EVTOPTWAYsiegepulseflee01"		
		ai_chance = { 
			factor = 0.5 
			modifier = {
				factor = 5
				trait = slothful
			}
			modifier = {
				factor = 2
				trait = proud
			}
			modifier = {
				factor = 2
				trait = zealous
			}
		} 	
		add_character_modifier = {
			name = stalwart_defender
			duration = 730
		}		
		if = {
			limit = { NOT = { personality_traits = 5 } }
			random_list = {
				70 = {
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = zealous }
							NOT = { trait = cynical }
						}	
						add_trait = zealous
						hidden_tooltip = {
							character_event = {
								id = 38269 #Notify
							}
						}
					}
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = brave }
							NOT = { trait = craven }
						}	
						add_trait = brave
						hidden_tooltip = {
							character_event = {
								id = 38270 #Notify
							}
						}
					}
					if = {
						limit = {
							trait = craven
						}	
						remove_trait = craven
						hidden_tooltip = {
							character_event = {
								id = 38296 #Notify
							}
						}
					}
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = proud }
							NOT = { trait = humble }
						}	
						add_trait = proud
						hidden_tooltip = {
							character_event = {
								id = 38261 #Notify
							}
						}
					}
				}
			}
		}	
		# ROOT = {
			# any_dynasty_member = {
				# limit = { 
					# at_location = ROOT 
					# same_realm = ROOT
					# NOT = { character = ROOT }
				# }
				# hidden_tooltip = {
					# add_character_modifier = {
						# name = left_at_siege
						# duration = 180
					# }
				# }	
			# }	 
			# any_spouse = {								
				# limit = { 
					# NOT = { dynasty = ROOT }
					# same_realm = ROOT
					# at_location = ROOT 
				# }
				# hidden_tooltip = {
					# add_character_modifier = {
						# name = left_at_siege
						# duration = 180
					# }
				# }
			# }	 
		# } 
	} 

	option = {
		name = "EVTOPTWAYsiegepulseflee02"
		trigger = {
			any_dynasty_member = { 
				at_location = ROOT
				same_realm = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}
		} #trig
		ai_chance = {
			factor = 1
			modifier = {
				factor = 5
				trait = diligent
			}
			modifier = {
				factor = 5
				trait = just
			}

			modifier = {
				factor = 5
				trait = brave
			}
		} 
		if = {
			limit = { yearly_income = 143 }
			wealth = -35
		}
		if = {
			limit = { NOT = { yearly_income = 143 } }
			scaled_wealth = -0.25
		}
		add_character_modifier = {
			name = stalwart_defender
			duration = 730
		}	
		if = {
			limit = { NOT = { personality_traits = 5 } }	
			random_list = {
				70 = {
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = just }
							NOT = { trait = arbitrary }
						}		
						add_trait = just
						hidden_tooltip = {
							character_event = {
								id = 38267 #Notify
							}
						}
					}
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = diligent }
							NOT = { trait = slothful }
						}		
						add_trait = diligent
						hidden_tooltip = {
							character_event = {
								id = 38256 #Notify
							}
						}
					}
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = proud }
							NOT = { trait = humble }
						}		
						add_trait = proud
						hidden_tooltip = {
							character_event = {
								id = 38261 #Notify
							}
						}
					}
				}
			}		
		}	
		any_courtier = { 
			limit = {
				OR = {
					is_close_relative = ROOT
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
				}	
				NOT = { character = ROOT }
				has_guardian = yes
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				at_location = ROOT 
				NOT = { is_inaccessible_trigger = yes } 
				NOT = { trait = wikid }
				guardian = { 
					in_command = no 
					at_location = ROOT 
					NOT = { character = ROOT } 
					NOT = { is_inaccessible_trigger = yes }
					NOT = { trait = wikid }
				}
			}	
			guardian = { 
				add_trait = in_hiding
				set_character_flag = hidden_from_siege
			}
		}
		any_courtier = {  
			limit = {
				OR = {
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
					is_close_relative = ROOT
					is_married = ROOT				
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
				}	
				NOT = { in_command = yes }
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				NOT = { character = ROOT }
				at_location = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}		
			add_trait = in_hiding
			set_character_flag = hidden_from_siege
		}
	} 
	
	option = {
		name = "EVTOPTWAYsiegepulseflee03"
		trigger = { 
			age = 14
			NOT = { age = 65 } 
			NOT = { trait = incapable }
			NOT = { trait = berserker }
		}
		ai_chance = { 
			factor = 0.25 
			modifier = {
				factor = 20
				trait = craven
			}
			modifier = {
				factor = 2
				trait = humble
			}
			modifier = {
				factor = 2
				trait = diligent
			}
		} 
		if = {
			limit = { yearly_income = 143 }
			wealth = -50
		}
		if = {
			limit = { NOT = { yearly_income = 143 } }
			scaled_wealth = -0.35
		}
		if = {
			limit = { NOT = { personality_traits = 5 } }	
			random_list = {
				70 = {
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = brave }
							NOT = { trait = craven }
						}	
						add_trait = craven
						hidden_tooltip = {
							character_event = {
								id = 38257 #Notify
							}
						}
					}
					if = {
						limit = {
							trait = brave
						}	
						remove_trait = brave
					}
				}
				10 = {
					if = {
						limit = {
							trait = proud
						}	
						remove_trait = proud
						hidden_tooltip = {
							character_event = {
								id = 38300 #Notify
							}
						}
					}
				}
				10 = {
					if = {
						limit = {
							NOT = { trait = diligent }
							NOT = { trait = slothful }
						}	
						add_trait = diligent
						hidden_tooltip = {
							character_event = {
								id = 38256 #Notify
							}
						}
					}
					if = {
						limit = {
							trait = slothful
						}	
						remove_trait = slothful
						hidden_tooltip = {
							character_event = {
								id = 38298 #Notify
							}
						}
					}
				}
			}		
		}
		add_trait = in_hiding
		set_character_flag = hidden_from_siege
		any_courtier = { 
			limit = {
				OR = {
					is_close_relative = ROOT
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
				}	
				NOT = { character = ROOT }
				has_guardian = yes
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				at_location = ROOT 
				NOT = { is_inaccessible_trigger = yes } 
				NOT = { trait = wikid }
				guardian = { 
					in_command = no 
					at_location = ROOT 
					NOT = { character = ROOT } 
					NOT = { is_inaccessible_trigger = yes }
					NOT = { trait = wikid }
				}
			}	
			guardian = { 
				add_trait = in_hiding
				set_character_flag = hidden_from_siege
			}
		}
		any_courtier = {  
			limit = {
				OR = {
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
					is_close_relative = ROOT
					is_married = ROOT
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
				}	
				NOT = { in_command = yes }
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				NOT = { character = ROOT }
				at_location = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}		
			add_trait = in_hiding
			set_character_flag = hidden_from_siege
		}		
	}  
}
 
#Escape from a siege where you have not hidden						
character_event = {
	id = siege_agot.23
	desc = "EVTDESCWAYsiegeescape"
	title = "EVTNAMEWAYnotifyofoutcome"
	
	picture = "GFX_evt_siege"
	border = "GFX_event_normal_frame_war"

	is_triggered_only = yes
	only_rulers = yes
	min_age = 13
	max_age = 65 #Glover/I'm gettin' too old for this shit
	prisoner = no
	capable_only = yes

	trigger = {
		NOT = { is_inaccessible_trigger = yes }
		OR = {
			tier = KING
			tier = EMPEROR
			is_primary_war_attacker = yes
			is_primary_war_defender = yes
		}
		is_ill = no
		siege = {
			is_attacker = no
			OR = {
				location = {
					is_capital = yes
				}
				ROOT = {
					capital_holding = { 
						controller = {
							NOT = { character = ROOT }
						}						
					}
				}	
			}
			troops = { #enemy must have enough troops
				who = troops
				value = 1
				enemy = yes
			}		
		}
	}
	
	option = { 
		name = "EVTOPTWAYsiegesescapeattempt01"
		ai_chance = { 
			factor = 1
			modifier = {
				factor = 0
				trait = craven 
			}
			modifier = {
				factor = 3
				trait = brave 
			}
			modifier = {
				factor = 1.5
				trait = ambitious 
			}
			modifier = {
				factor = 0.75
				trait = slothful 
			}
		} 
		random_list = {
			33 = {
				custom_tooltip = { text = EVTTOOLTIPsiegeescaped }
				hidden_tooltip = {
					character_event = { id = siege_agot.25 }
				}
			} 
			66 = {
				ROOT = { 
					custom_tooltip = { text = EVTTOOLTIPsiegecapturedenemy }
					set_character_flag = captured 
				}
				hidden_tooltip = {
					ROOT = { character_event = { id = siege_agot.24 } }		
					siege = { enemy = { leader = { character_event = { id = siege_agot.28 } } } }
				}
			} 	
		} 
		if = {
			limit = {
				NOT = { trait = brave }
				NOT = { trait = craven }
				NOT = { personality_traits = 5 }
			}	
			random = { 
				chance = 25			
				add_trait = brave
				hidden_tooltip = {
					character_event = {
						id = 38270 #Notify
					}
				}
			}
		}			
		if = {
			limit = {
				trait = craven
			}	
			random = { 
				chance = 15
				remove_trait = craven
				hidden_tooltip = {
					character_event = {
						id = 38296 #Notify
					}
				}
			}
		}
	}

	option = { 
		name = "EVTOPTWAYsiegesescapeattempt02"
		ai_chance = { 
			factor = 0.5 
			modifier = {
				factor = 1.5
				trait = ambitious 
			}
			modifier = {
				factor = 3
				trait = brave 
			}
			modifier = {
				factor = 1.5
				trait = humble 
			}
			modifier = {
				factor = 0
				trait = craven 
			}
			modifier = {
				factor = 0.75
				trait = slothful 
			}
		} 
		random_list = {
			75 = {
				custom_tooltip = { text = EVTTOOLTIPsiegeescaped }
				hidden_tooltip = {
					character_event = { id = siege_agot.26 }
				}
			}
			25 = {
				ROOT = { 
					custom_tooltip = { text = EVTTOOLTIPsiegecapturedenemy } 
					set_character_flag = captured 
				}	

				hidden_tooltip = {
					ROOT = { character_event = { id = siege_agot.24 } }
					siege = { enemy = { leader = { character_event = { id = siege_agot.28 } } } } 
				}
		 
			}
		} 
		if = {
			limit = {
				NOT = { trait = brave }
				NOT = { trait = craven }
				NOT = { personality_traits = 5 }
			}	
			random = { 
				chance = 25			
				add_trait = brave
				hidden_tooltip = {
					character_event = {
						id = 38270 #Notify
					}
				}
			}
		}			
		if = {
			limit = {
				trait = craven
			}	
			random = { 
				chance = 15
				remove_trait = craven
				hidden_tooltip = {
					character_event = {
						id = 38296 #Notify
					}
				}
			}
		}
		
		random_list = {
			80 = {
			}
			10 = {
				if = {
					limit = {
						NOT = {
							has_dlc = "Reapers"
						}
					}
					add_trait = ill
					hidden_tooltip = {
						character_event = {
							id = 38290
						}
					}
				}
				if = {
					limit = {
						has_dlc = "Reapers"
					}
					add_symptom_effect = yes
				}	
			}
			4 = {
				add_trait = pneumonic
				hidden_tooltip = {
					character_event = {
						id = 38290 #Notify
					}
				}
			}
			4 = {
				modifier = {
					factor = 0
					OR = {
						trait = wounded
						is_maimed_trigger = yes
					}
				}
				add_trait = wounded
				hidden_tooltip = {
					character_event = {
						id = 38280 #Notify
					}
				}
			}
			1 = {
				modifier = {
					factor = 0
					is_maimed_trigger = yes
				}
				add_maimed_trait_effect = yes
			}
			1 = {
				add_trait = has_bloody_flux
				hidden_tooltip = {
					character_event = {
						id = 38290 #Notify
					}
				}
			}
		}
	}

	option = { 
		name = "EVTOPTWAYsiegesescapeattempt03"
		trigger = {
			NOT = { has_severe_disability_trigger = yes }
		}
		ai_chance = { 
			factor = 0.1 
			modifier = {
				factor = 1.5
				trait = ambitious 
			}
			modifier = {
				factor = 20
				trait = lunatic 
			}
			modifier = {
				factor = 20
				trait = possessed 
			}
			modifier = {
				factor = 3
				trait = brave 
			}
			modifier = {
				factor = 0
				trait = craven 
			}
			modifier = {
				factor = 0.5
				trait = slothful 
			}
			modifier = {
				factor = 0.1
				trait = clubfooted
			}

		}
		random_list = {
			70 = {
				custom_tooltip = { text = EVTTOOLTIPsiegeescaped }
				hidden_tooltip = {
					character_event = { id = siege_agot.27 }
				}
			} 
			20 = {
				ROOT = { 
					custom_tooltip = { text = EVTTOOLTIPsiegecapturedenemy } 
					set_character_flag = captured 
				}		
				hidden_tooltip = {
					ROOT = { character_event = { id = siege_agot.24 } }
					siege = { enemy = { leader = { character_event = { id = siege_agot.28 } } } }
				}
		
			} 
			10 = {
				ROOT = { death = { death_reason = death_battle } }
			} 
		} 	
		if = {
			limit = {
				NOT = { trait = brave }
				NOT = { trait = craven }
				NOT = { personality_traits = 5 }
			}	
			random = { 
				chance = 25			
				add_trait = brave
				hidden_tooltip = {
					character_event = {
						id = 38270 #Notify
					}
				}
			}
		}			
		if = {
			limit = {
				trait = craven
			}	
			random = { 
				chance = 15
				remove_trait = craven
				hidden_tooltip = {
					character_event = {
						id = 38296 #Notify
					}
				}
			}
		}
		random_list = {
			83 = {
			}
			10 = {
				modifier = {
					factor = 0
					trait = wounded
				}
				add_trait = wounded
				hidden_tooltip = {
					character_event = {
						id = 38280 #Notify
					}
				}
			}
			5 = {
				add_maimed_trait_effect = yes
			}
			2 = {
				add_crippled_trait_effect = yes
			}
		}
	}
	option = {
		name = "EVTOPTWAYsiegesescapeattempt04"
		ai_chance = {
			factor = 5
			modifier = {
				factor = 3
				has_character_modifier = stalwart_defender
			}
			modifier = {
				factor = 2
				trait = content 
			}
			modifier = {
				factor = 2
				trait = patient 
			}
			modifier = {
				factor = 2
				trait = slothful 
			}
		} 
		if = {
			limit = {
				NOT = { trait = stressed }
			}	
			random = { 
				chance = 15		
				add_trait = stressed
				hidden_tooltip = {
					character_event = {
						id = 38282 #Notify
					}
				}
			}
		}	
	}
} #evnt	
			
#captured by the enemy

character_event = {
	id = siege_agot.24
	desc = "EVTDESCRWAYnotifyofcapture1"
	title = "EVTNAMEWAYnotifyofoutcome"
	
	picture = "GFX_evt_Bloody_man"
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPWAYsiegecapture02"
		tooltip = { imprison = yes }
		remove_character_modifier = stalwart_defender
		any_courtier = {  
			limit = {
				OR = {
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
					is_close_relative = ROOT
					is_married = ROOT
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
				}	
				NOT = { in_command = yes }
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				NOT = { character = ROOT }
				at_location = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}	
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}		
	}
}

#escape by postern
character_event = {
	id = siege_agot.25
	desc = "EVTDESCRWAYnotifyofescape01"
	title = "EVTNAMEWAYnotifyofoutcome"
	
	picture = "GFX_evt_Courier_Riding"
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	trigger = { is_alive = yes }

	option = {
		name = "EVTTOOLTIPsiegeescaped"
		remove_character_modifier = stalwart_defender
		add_trait = in_hiding
		set_character_flag = hidden_from_siege
		add_character_modifier = {
			name = escaped_siege
			duration = 365
		}
		any_courtier = {  
			limit = {
				OR = {
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
					is_close_relative = ROOT
					is_married = ROOT
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
				}	
				NOT = { in_command = yes }
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				NOT = { character = ROOT }
				at_location = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}	
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}
	}
}

#escape by sewer
character_event = {
	id = siege_agot.26
	desc = "EVTDESCRWAYnotifyofescape02"
	title = "EVTNAMEWAYnotifyofoutcome"
	
	picture = "GFX_evt_Courier_Riding"
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	trigger = { is_alive = yes }

	option = {
		name = "EVTTOOLTIPsiegeescaped"
		remove_character_modifier = stalwart_defender
		add_trait = in_hiding
		set_character_flag = hidden_from_siege
		add_character_modifier = {
			name = escaped_siege
			duration = 365
		}
		any_courtier = {  
			limit = {
				OR = {
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
					is_close_relative = ROOT
					is_married = ROOT
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
				}	
				NOT = { in_command = yes }
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				NOT = { character = ROOT }
				at_location = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}	
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}
	}
}

#escape by wall
character_event = {
	id = siege_agot.27
	desc = "EVTDESCRWAYnotifyofescape03"
	title = "EVTNAMEWAYnotifyofoutcome"
	
	picture = "GFX_evt_Courier_Riding"
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	trigger = { is_alive = yes }

	option = {
		name = "EVTTOOLTIPsiegeescaped"
		remove_character_modifier = stalwart_defender
		add_trait = in_hiding
		set_character_flag = hidden_from_siege
		add_character_modifier = {
			name = escaped_siege
			duration = 365
		}
		any_courtier = {  
			limit = {
				OR = {
					AND = {
						dynasty = ROOT
						NOT = { dynasty = 0 }
					}
					is_close_relative = ROOT
					is_married = ROOT
					AND = { #Commanders
						government = military_command_government
						tier = BARON
					}
				}	
				NOT = { in_command = yes }
				NOT = { trait = dragon }
				NOT = { trait = white_walker }
				NOT = { trait = winter_wasteland }
				NOT = { character = ROOT }
				at_location = ROOT
				NOT = { is_inaccessible_trigger = yes }
				NOT = { trait = wikid }
			}	
			opinion = {
				modifier = left_behind
				who = ROOT
				months = 12
			}
		}
	}
}
	
#capture event
character_event = {
	id = siege_agot.28
	desc = "EVTDESCRWAYnotifyofcapture2"
	title = "EVTNAMEWAYnotifyofoutcome"
	
	picture = "GFX_evt_Thrown_into_dungeon"
	border = "GFX_event_normal_frame_war"
	is_triggered_only = yes
	
	option = {
		name = "EVTOPWAYsiegecapture01"
		FROM = {
			imprison = ROOT 
			set_character_flag = captured_in_battle
			clr_character_flag = captured
		}
	}
}
# #surrender or die events
# character_event = { #attacker

	# id = siege_agot.29 
	# desc = "EVTDESCsiege_agot.29"
	# picture = "GFX_evt_siege"
	# border = "GFX_event_normal_frame_war"
	
	# #is_triggered_only = yes #need a lesson about "on actions"

	# trigger = {
		
		# siege = { 
			# is_attacker = yes
			# enemy = {
				# leader = {
					# is_primary_war_attacker = no
					# is_primary_war_defender = no
				# }
			
			# }
		# }
			
		
	# }
	# mean_time_to_happen = {
		
		# days = 70
		
		# modifier = { #every 12 days, no flag to mark cooldown, storm end wotu is like 6 months.
			# factor = 5
			# trait = wroth
		# }
		
		# modifier = { 
			# factor = 1.75
			# martial = 7
		# }
		
		# modifier = { 
			# factor = 0.8
			# martial = 12
		# }
		
		# modifier = { 
			# factor = 0.8
			# diplomacy = 10
		# }
		# modifier = { 
			# factor = 0.75
			# siege = {
				# enemy = {
					# leader = {
						# NOT = { martial = 8 }
					# }
				# }
			# }
		# }
		# modifier = {
			# factor = 0.85
			# siege = {
				# enemy = {
					# leader = {
						# NOT = { martial = 10 }
					# }
				# }
			# }
		# }
	# }

	# option = {
		# name = "EXCELLENT"	#Propose surrender
		# siege = {enemy = {leader = {character_event = { id = siege_agot.30  }}}}
	# }
	
# }
		
# character_event = { #defender

	# id = siege_agot.30
	# desc = "EVTDESCsiege_agot.30"
	# picture = "GFX_evt_siege"
	# border = "GFX_event_normal_frame_war"
	
	# is_triggered_only = yes
	
	# option = {
		# name = "OK"	#surrender 
		# siege = {
			# morale = -1 #will surrender
		# }
		
		# ai_chance = { 
			# factor = 3 #doesnt really matter but why is this a decimal? Ruthless, honorable etc but really need to tie the above comment for any of this to be justified.
			# modifier = { 
				# factor = 1.5
				# trait = slothful
			# }
			# modifier = {
				# factor = 2
				# is_weak_trigger = yes
			# }
			
			# modifier = {
				# factor = 1.5
				# trait = craven
			# }
			
			# modifier = { 
				# factor = 1.1
				# trait = humble
			# }
			
			# modifier = {
				# factor = 2.3
				# trait = depressed
			# }
			# modifier = {
				# factor = 2.1
				# trait = trusting
			# }
			
			# modifier = {
				# factor = 0.2
				# trait = paranoid
			# }
			
			
		# }
		# FROM = {character_event = { id = siege_agot.31}}
	# }
	
	# option = {
		# name = "REFUSE"	#NEVA!
		# ai_chance = {
		# factor = 7
			# modifier = {
				# factor = 2
				# trait = proud
			# }
			
			# modifier = {
				# factor = 1.5
				# trait = knight
			# }
			
			# modifier = {
				# factor = 2
				# martial = 11
			# }
			
			# modifier = {
				# factor = 1.3
				# trait = trained_warrior
			# }
			
			# modifier = {
				# factor = 1.5
				# trait = skilled_warrior
			# }
			
			# modifier = {
				# factor = 2
				# trait = master_warrior
			# }
			
			# modifier = { 
				# factor = 3
				# trait = brilliant_strategist
			# }
			
			# modifier = { 
				# factor = 2
				# trait = wroth
			# }
			
			# modifier = {
				# factor = 4
				# trait = brave
			# }
			
		# }
		# FROM = {character_event = { id = siege_agot.32}}
			
			
	# }
	
# }
	
# character_event = { #information accept

	# id = siege_agot.31
	# desc = "EVTDESCsiege_agot.31"
	# picture = "GFX_evt_siege"
	# border = "GFX_event_normal_frame_war"
	
	# is_triggered_only = yes
	
	# option = {
	# name = "EXCELLENT"}
# }

